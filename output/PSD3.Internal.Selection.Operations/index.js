// Generated by purs version 0.15.15
import * as $foreign from "./foreign.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_FoldableWithIndex from "../Data.FoldableWithIndex/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Newtype from "../Data.Newtype/index.js";
import * as Data_Nullable from "../Data.Nullable/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Ordering from "../Data.Ordering/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Traversable from "../Data.Traversable/index.js";
import * as Data_TraversableWithIndex from "../Data.TraversableWithIndex/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect from "../Effect/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Effect_Class_Console from "../Effect.Class.Console/index.js";
import * as PSD3_AST from "../PSD3.AST/index.js";
import * as PSD3_Internal_Attribute from "../PSD3.Internal.Attribute/index.js";
import * as PSD3_Internal_Behavior_FFI from "../PSD3.Internal.Behavior.FFI/index.js";
import * as PSD3_Internal_Behavior_Types from "../PSD3.Internal.Behavior.Types/index.js";
import * as PSD3_Internal_Selection_Join from "../PSD3.Internal.Selection.Join/index.js";
import * as PSD3_Internal_Selection_Types from "../PSD3.Internal.Selection.Types/index.js";
import * as PSD3_Internal_Transition_FFI from "../PSD3.Internal.Transition.FFI/index.js";
import * as Partial_Unsafe from "../Partial.Unsafe/index.js";
import * as Web_DOM_Document from "../Web.DOM.Document/index.js";
import * as Web_DOM_Element from "../Web.DOM.Element/index.js";
import * as Web_DOM_Node from "../Web.DOM.Node/index.js";
import * as Web_DOM_NodeList from "../Web.DOM.NodeList/index.js";
import * as Web_DOM_ParentNode from "../Web.DOM.ParentNode/index.js";
import * as Web_HTML from "../Web.HTML/index.js";
import * as Web_HTML_HTMLDocument from "../Web.HTML.HTMLDocument/index.js";
import * as Web_HTML_Window from "../Web.HTML.Window/index.js";
import * as Web_UIEvent_MouseEvent from "../Web.UIEvent.MouseEvent/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Effect.bindEffect);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect.applicativeEffect);
var traverse = /* #__PURE__ */ Data_Traversable.traverse(Data_Traversable.traversableArray)(Effect.applicativeEffect);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var mapFlipped = /* #__PURE__ */ Data_Functor.mapFlipped(Effect.functorEffect);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Ord.ordString);
var traverse_ = /* #__PURE__ */ Data_Foldable.traverse_(Effect.applicativeEffect)(Data_Foldable.foldableArray);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var mapFlipped1 = /* #__PURE__ */ Data_Functor.mapFlipped(Data_Maybe.functorMaybe);
var compare = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordInt);
var mapFlipped2 = /* #__PURE__ */ Data_Functor.mapFlipped(Data_Functor.functorArray);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showBoolean);
var unwrap = /* #__PURE__ */ Data_Newtype.unwrap();
var traverseWithIndex_ = /* #__PURE__ */ Data_FoldableWithIndex.traverseWithIndex_(Effect.applicativeEffect)(Data_FoldableWithIndex.foldableWithIndexArray);
var $$void = /* #__PURE__ */ Data_Functor["void"](Effect.functorEffect);
var unsafeIndex = /* #__PURE__ */ Data_Array.unsafeIndex();
var traverseWithIndex = /* #__PURE__ */ Data_TraversableWithIndex.traverseWithIndex(Data_TraversableWithIndex.traversableWithIndexArray)(Effect.applicativeEffect);
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var union = /* #__PURE__ */ Data_Map_Internal.union(Data_Ord.ordString);
var insert = /* #__PURE__ */ Data_Map_Internal.insert(Data_Ord.ordString);
var liftEffect = /* #__PURE__ */ Effect_Class.liftEffect(Effect_Class.monadEffectEffect);
var log = /* #__PURE__ */ Effect_Class_Console.log(Effect_Class.monadEffectEffect);
var show2 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var join = /* #__PURE__ */ Control_Bind.join(Control_Bind.bindArray);
var tooltipTriggerToInt = function (v) {
    if (v instanceof PSD3_Internal_Behavior_Types.OnHover) {
        return 0;
    };
    if (v instanceof PSD3_Internal_Behavior_Types.WhenPrimary) {
        return 1;
    };
    if (v instanceof PSD3_Internal_Behavior_Types.WhenRelated) {
        return 2;
    };
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 969, column 1 - line 969, column 45): " + [ v.constructor.name ]);
};
var syncDOMToData = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (selector) {
        return liftEffect1($foreign.syncDOMToData_(selector));
    };
};
var stringToElementType = function (v) {
    if (v === "circle") {
        return PSD3_Internal_Selection_Types.Circle.value;
    };
    if (v === "rect") {
        return PSD3_Internal_Selection_Types.Rect.value;
    };
    if (v === "path") {
        return PSD3_Internal_Selection_Types.Path.value;
    };
    if (v === "line") {
        return PSD3_Internal_Selection_Types.Line.value;
    };
    if (v === "polygon") {
        return PSD3_Internal_Selection_Types.Polygon.value;
    };
    if (v === "text") {
        return PSD3_Internal_Selection_Types.Text.value;
    };
    if (v === "g") {
        return PSD3_Internal_Selection_Types.Group.value;
    };
    if (v === "svg") {
        return PSD3_Internal_Selection_Types.SVG.value;
    };
    if (v === "defs") {
        return PSD3_Internal_Selection_Types.Defs.value;
    };
    if (v === "linearGradient") {
        return PSD3_Internal_Selection_Types.LinearGradient.value;
    };
    if (v === "stop") {
        return PSD3_Internal_Selection_Types.Stop.value;
    };
    if (v === "pattern") {
        return PSD3_Internal_Selection_Types.PatternFill.value;
    };
    if (v === "div") {
        return PSD3_Internal_Selection_Types.Div.value;
    };
    if (v === "span") {
        return PSD3_Internal_Selection_Types.Span.value;
    };
    if (v === "table") {
        return PSD3_Internal_Selection_Types.Table.value;
    };
    if (v === "tr") {
        return PSD3_Internal_Selection_Types.Tr.value;
    };
    if (v === "td") {
        return PSD3_Internal_Selection_Types.Td.value;
    };
    if (v === "th") {
        return PSD3_Internal_Selection_Types.Th.value;
    };
    if (v === "tbody") {
        return PSD3_Internal_Selection_Types.Tbody.value;
    };
    if (v === "thead") {
        return PSD3_Internal_Selection_Types.Thead.value;
    };
    return PSD3_Internal_Selection_Types.Group.value;
};
var selectElement = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (element) {
        return liftEffect1(function __do() {
            var htmlDoc = bind(Web_HTML.window)(Web_HTML_Window.document)();
            var doc = Web_HTML_HTMLDocument.toDocument(htmlDoc);
            return new PSD3_Internal_Selection_Types.EmptySelection({
                parentElements: [ element ],
                document: doc
            });
        });
    };
};
var selectChildInheriting = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (selector) {
        return function (v) {
            return liftEffect1((function () {
                var v1 = (function () {
                    if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                        return v.value0;
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 571, column 82 - line 572, column 28): " + [ v.constructor.name ]);
                })();
                return function __do() {
                    var results = traverse(function (v2) {
                        var parentNode = Web_DOM_Element.toParentNode(v2.value0);
                        return function __do() {
                            var maybeChild = Web_DOM_ParentNode.querySelector(selector)(parentNode)();
                            if (maybeChild instanceof Data_Maybe.Nothing) {
                                return Data_Maybe.Nothing.value;
                            };
                            if (maybeChild instanceof Data_Maybe.Just) {
                                $foreign.setElementData_(v2.value1)(maybeChild.value0)();
                                return new Data_Maybe.Just(new Data_Tuple.Tuple(maybeChild.value0, v2.value1));
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 578, column 5 - line 583, column 40): " + [ maybeChild.constructor.name ]);
                        };
                    })(Data_Array.zipWith(Data_Tuple.Tuple.create)(v1.elements)(v1.data))();
                    var paired = Data_Array.catMaybes(results);
                    var childElements = map(Data_Tuple.fst)(paired);
                    var childData = map(Data_Tuple.snd)(paired);
                    return new PSD3_Internal_Selection_Types.BoundSelection({
                        elements: childElements,
                        data: childData,
                        indices: Data_Maybe.Nothing.value,
                        document: v1.document
                    });
                };
            })());
        };
    };
};
var select = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (selector) {
        return liftEffect1(function __do() {
            var htmlDoc = bind(Web_HTML.window)(Web_HTML_Window.document)();
            var doc = Web_HTML_HTMLDocument.toDocument(htmlDoc);
            var parentNode = Web_HTML_HTMLDocument.toParentNode(htmlDoc);
            var maybeElement = Web_DOM_ParentNode.querySelector(selector)(parentNode)();
            if (maybeElement instanceof Data_Maybe.Nothing) {
                return new PSD3_Internal_Selection_Types.EmptySelection({
                    parentElements: [  ],
                    document: doc
                });
            };
            if (maybeElement instanceof Data_Maybe.Just) {
                return new PSD3_Internal_Selection_Types.EmptySelection({
                    parentElements: [ maybeElement.value0 ],
                    document: doc
                });
            };
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 96, column 3 - line 104, column 8): " + [ maybeElement.constructor.name ]);
        });
    };
};
var reselect = function (name) {
    return function (selectionsMap) {
        return function __do() {
            var doc = mapFlipped(bind(Web_HTML.window)(Web_HTML_Window.document))(Web_HTML_HTMLDocument.toDocument)();
            var v = lookup(name)(selectionsMap);
            if (v instanceof Data_Maybe.Just) {
                var elements = (function () {
                    if (v.value0 instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                        return v.value0.value0.elements;
                    };
                    if (v.value0 instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                        return v.value0.value0.parentElements;
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2250, column 34 - line 2252, column 47): " + [ v.value0.constructor.name ]);
                })();
                return new PSD3_Internal_Selection_Types.EmptySelection({
                    parentElements: elements,
                    document: doc
                });
            };
            if (v instanceof Data_Maybe.Nothing) {
                return new PSD3_Internal_Selection_Types.EmptySelection({
                    parentElements: [  ],
                    document: doc
                });
            };
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2244, column 3 - line 2263, column 10): " + [ v.constructor.name ]);
        };
    };
};
var remove = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (v) {
        return liftEffect1((function () {
            var v1 = (function () {
                if (v instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
                    return v.value0;
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 352, column 34 - line 353, column 30): " + [ v.constructor.name ]);
            })();
            return traverse_(function (element) {
                var node = Web_DOM_Element.toNode(element);
                return function __do() {
                    var maybeParent = Web_DOM_Node.parentNode(node)();
                    if (maybeParent instanceof Data_Maybe.Just) {
                        return Web_DOM_Node.removeChild(node)(maybeParent.value0)();
                    };
                    if (maybeParent instanceof Data_Maybe.Nothing) {
                        return Data_Unit.unit;
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 357, column 5 - line 359, column 27): " + [ maybeParent.constructor.name ]);
                };
            })(v1.elements);
        })());
    };
};
var remove1 = /* #__PURE__ */ remove(Effect_Class.monadEffectEffect);
var querySelectorAllElements = function (selector) {
    return function (parents) {
        return function __do() {
            var nodeArrays = traverse(function (parent) {
                var parentNode = Web_DOM_Element.toParentNode(parent);
                return function __do() {
                    var nodeList = Web_DOM_ParentNode.querySelectorAll(selector)(parentNode)();
                    var nodes = Web_DOM_NodeList.toArray(nodeList)();
                    return Data_Array.mapMaybe(Web_DOM_Element.fromNode)(nodes);
                };
            })(parents)();
            return Data_Array.concat(nodeArrays);
        };
    };
};
var merge = function (dictMonadEffect) {
    var pure1 = Control_Applicative.pure((dictMonadEffect.Monad0()).Applicative0());
    return function (v) {
        return function (v1) {
            var v2 = (function () {
                if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                    return v.value0;
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 614, column 68 - line 615, column 28): " + [ v.constructor.name ]);
            })();
            var v3 = (function () {
                if (v1 instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                    return v1.value0;
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 617, column 53 - line 618, column 28): " + [ v1.constructor.name ]);
            })();
            return pure1(new PSD3_Internal_Selection_Types.BoundSelection({
                elements: append1(v2.elements)(v3.elements),
                data: append1(v2.data)(v3.data),
                indices: Data_Maybe.Nothing.value,
                document: v2.document
            }));
        };
    };
};
var joinDataWithKey = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (dictFoldable) {
        var fromFoldable = Data_Array.fromFoldable(dictFoldable);
        return function (dictEq) {
            var computeJoinWithKey = PSD3_Internal_Selection_Join.computeJoinWithKey(dictEq);
            return function (foldableData) {
                return function (keyFn) {
                    return function (selector) {
                        return function (v) {
                            return liftEffect1((function () {
                                var v1 = (function () {
                                    if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                                        return v.value0;
                                    };
                                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 738, column 55 - line 739, column 28): " + [ v.constructor.name ]);
                                })();
                                return function __do() {
                                    var existingElements = querySelectorAllElements(selector)(v1.parentElements)();
                                    var oldBindings = traverse(function (element) {
                                        return function __do() {
                                            var nullableDatum = $foreign.getElementData_(element)();
                                            var maybeDatum = Data_Nullable.toMaybe(nullableDatum);
                                            return {
                                                element: element,
                                                datum: maybeDatum
                                            };
                                        };
                                    })(existingElements)();
                                    var validOldBindings = Data_Array.mapMaybe(function (v2) {
                                        return mapFlipped1(v2.datum)(function (d) {
                                            return {
                                                element: v2.element,
                                                datum: d
                                            };
                                        });
                                    })(oldBindings);
                                    var newDataArray = fromFoldable(foldableData);
                                    var joinSets = computeJoinWithKey(newDataArray)(validOldBindings)(keyFn);
                                    var sortedEnter = Data_Array.sortBy(function (a) {
                                        return function (b) {
                                            return compare(a.newIndex)(b.newIndex);
                                        };
                                    })(joinSets.enter);
                                    var enterSelection = new PSD3_Internal_Selection_Types.PendingSelection({
                                        parentElements: v1.parentElements,
                                        pendingData: mapFlipped2(sortedEnter)(function (v2) {
                                            return v2.datum;
                                        }),
                                        indices: new Data_Maybe.Just(mapFlipped2(sortedEnter)(function (v2) {
                                            return v2.newIndex;
                                        })),
                                        document: v1.document
                                    });
                                    var sortedUpdate = Data_Array.sortBy(function (a) {
                                        return function (b) {
                                            return compare(a.newIndex)(b.newIndex);
                                        };
                                    })(joinSets.update);
                                    var updateSelection = new PSD3_Internal_Selection_Types.BoundSelection({
                                        elements: mapFlipped2(sortedUpdate)(function (v2) {
                                            return v2.element;
                                        }),
                                        data: mapFlipped2(sortedUpdate)(function (v2) {
                                            return v2.newDatum;
                                        }),
                                        indices: new Data_Maybe.Just(mapFlipped2(sortedUpdate)(function (v2) {
                                            return v2.newIndex;
                                        })),
                                        document: v1.document
                                    });
                                    var exitSelection = new PSD3_Internal_Selection_Types.ExitingSelection({
                                        elements: mapFlipped2(joinSets.exit)(function (v2) {
                                            return v2.element;
                                        }),
                                        data: mapFlipped2(joinSets.exit)(function (v2) {
                                            return v2.datum;
                                        }),
                                        document: v1.document
                                    });
                                    return new PSD3_Internal_Selection_Types.JoinResult({
                                        enter: enterSelection,
                                        update: updateSelection,
                                        exit: exitSelection
                                    });
                                };
                            })());
                        };
                    };
                };
            };
        };
    };
};
var joinDataWithKey1 = /* #__PURE__ */ joinDataWithKey(Effect_Class.monadEffectEffect)(Data_Foldable.foldableArray)(Data_Eq.eqString);
var joinData = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (dictFoldable) {
        var fromFoldable = Data_Array.fromFoldable(dictFoldable);
        return function (dictOrd) {
            var computeJoin = PSD3_Internal_Selection_Join.computeJoin(dictOrd.Eq0());
            return function (foldableData) {
                return function (selector) {
                    return function (v) {
                        return liftEffect1((function () {
                            var v1 = (function () {
                                if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                                    return v.value0;
                                };
                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 649, column 55 - line 650, column 28): " + [ v.constructor.name ]);
                            })();
                            return function __do() {
                                var existingElements = querySelectorAllElements(selector)(v1.parentElements)();
                                var oldBindings = traverse(function (element) {
                                    return function __do() {
                                        var nullableDatum = $foreign.getElementData_(element)();
                                        var maybeDatum = Data_Nullable.toMaybe(nullableDatum);
                                        return {
                                            element: element,
                                            datum: maybeDatum
                                        };
                                    };
                                })(existingElements)();
                                var validOldBindings = Data_Array.mapMaybe(function (v2) {
                                    return mapFlipped1(v2.datum)(function (d) {
                                        return {
                                            element: v2.element,
                                            datum: d
                                        };
                                    });
                                })(oldBindings);
                                var newDataArray = fromFoldable(foldableData);
                                var joinSets = computeJoin(newDataArray)(validOldBindings);
                                var sortedEnter = Data_Array.sortBy(function (a) {
                                    return function (b) {
                                        return compare(a.newIndex)(b.newIndex);
                                    };
                                })(joinSets.enter);
                                var enterSelection = new PSD3_Internal_Selection_Types.PendingSelection({
                                    parentElements: v1.parentElements,
                                    pendingData: mapFlipped2(sortedEnter)(function (v2) {
                                        return v2.datum;
                                    }),
                                    indices: new Data_Maybe.Just(mapFlipped2(sortedEnter)(function (v2) {
                                        return v2.newIndex;
                                    })),
                                    document: v1.document
                                });
                                var sortedUpdate = Data_Array.sortBy(function (a) {
                                    return function (b) {
                                        return compare(a.newIndex)(b.newIndex);
                                    };
                                })(joinSets.update);
                                var updateSelection = new PSD3_Internal_Selection_Types.BoundSelection({
                                    elements: mapFlipped2(sortedUpdate)(function (v2) {
                                        return v2.element;
                                    }),
                                    data: mapFlipped2(sortedUpdate)(function (v2) {
                                        return v2.newDatum;
                                    }),
                                    indices: new Data_Maybe.Just(mapFlipped2(sortedUpdate)(function (v2) {
                                        return v2.newIndex;
                                    })),
                                    document: v1.document
                                });
                                var exitSelection = new PSD3_Internal_Selection_Types.ExitingSelection({
                                    elements: mapFlipped2(joinSets.exit)(function (v2) {
                                        return v2.element;
                                    }),
                                    data: mapFlipped2(joinSets.exit)(function (v2) {
                                        return v2.datum;
                                    }),
                                    document: v1.document
                                });
                                return new PSD3_Internal_Selection_Types.JoinResult({
                                    enter: enterSelection,
                                    update: updateSelection,
                                    exit: exitSelection
                                });
                            };
                        })());
                    };
                };
            };
        };
    };
};
var joinData1 = /* #__PURE__ */ joinData(Effect_Class.monadEffectEffect)(Data_Foldable.foldableArray);
var highlightClassToInt = function (v) {
    if (v instanceof PSD3_Internal_Behavior_Types.Primary) {
        return 0;
    };
    if (v instanceof PSD3_Internal_Behavior_Types.Related) {
        return 1;
    };
    if (v instanceof PSD3_Internal_Behavior_Types.Dimmed) {
        return 2;
    };
    if (v instanceof PSD3_Internal_Behavior_Types.Neutral) {
        return 3;
    };
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 961, column 1 - line 961, column 45): " + [ v.constructor.name ]);
};
var getExitingElementDatumPairs = function (v) {
    var v1 = (function () {
        if (v instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
            return v.value0;
        };
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1315, column 52 - line 1316, column 30): " + [ v.constructor.name ]);
    })();
    return Data_Array.zipWith(Data_Tuple.Tuple.create)(v1.elements)(v1.data);
};
var getElementsFromBoundSelection = function (v) {
    if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
        return v.value0.elements;
    };
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1338, column 17 - line 1339, column 35): " + [ v.constructor.name ]);
};
var getDocument = function (v) {
    if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
        return pure(v.value0.document);
    };
    if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
        return pure(v.value0.document);
    };
    if (v instanceof PSD3_Internal_Selection_Types.PendingSelection) {
        return pure(v.value0.document);
    };
    if (v instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
        return pure(v.value0.document);
    };
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 927, column 1 - line 927, column 82): " + [ v.constructor.name ]);
};
var selectAll = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (selector) {
        return function (v) {
            return liftEffect1(function __do() {
                var doc = getDocument(v)();
                var parentElems = (function () {
                    if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                        return v.value0.parentElements;
                    };
                    if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                        return v.value0.elements;
                    };
                    if (v instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                        return v.value0.parentElements;
                    };
                    if (v instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
                        return v.value0.elements;
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 150, column 19 - line 154, column 48): " + [ v.constructor.name ]);
                })();
                return new PSD3_Internal_Selection_Types.EmptySelection({
                    parentElements: parentElems,
                    document: doc
                });
            });
        };
    };
};
var selectAllWithData = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (selector) {
        return function (v) {
            return liftEffect1(function __do() {
                var doc = getDocument(v)();
                var elements = (function () {
                    if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                        return querySelectorAllElements(selector)(v.value0.parentElements)();
                    };
                    if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                        return querySelectorAllElements(selector)(v.value0.elements)();
                    };
                    if (v instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                        return querySelectorAllElements(selector)(v.value0.parentElements)();
                    };
                    if (v instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
                        return querySelectorAllElements(selector)(v.value0.elements)();
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 182, column 15 - line 190, column 50): " + [ v.constructor.name ]);
                })();
                var dataArray = traverse(function (el) {
                    return function __do() {
                        var nullableDatum = $foreign.getElementData_(el)();
                        var v1 = Data_Nullable.toMaybe(nullableDatum);
                        if (v1 instanceof Data_Maybe.Just) {
                            return v1.value0;
                        };
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return Data_Unit.unit;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 196, column 16 - line 198, column 39): " + [ v1.constructor.name ]);
                    };
                })(elements)();
                return new PSD3_Internal_Selection_Types.BoundSelection({
                    elements: elements,
                    data: dataArray,
                    indices: Data_Maybe.Nothing.value,
                    document: doc
                });
            });
        };
    };
};
var getBoundElementDatumPairs = function (v) {
    var v1 = (function () {
        if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
            return v.value0;
        };
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1327, column 52 - line 1328, column 28): " + [ v.constructor.name ]);
    })();
    return Data_Array.zipWith(Data_Tuple.Tuple.create)(v1.elements)(v1.data);
};
var eqOrdWrapper = {
    eq: function (v) {
        return function (v1) {
            return true;
        };
    }
};
var ordOrdWrapper = {
    compare: function (v) {
        return function (v1) {
            return Data_Ordering.EQ.value;
        };
    },
    Eq0: function () {
        return eqOrdWrapper;
    }
};
var elementTypeToString = function (v) {
    if (v instanceof PSD3_Internal_Selection_Types.Circle) {
        return "circle";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Rect) {
        return "rect";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Path) {
        return "path";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Line) {
        return "line";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Polygon) {
        return "polygon";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Text) {
        return "text";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Group) {
        return "g";
    };
    if (v instanceof PSD3_Internal_Selection_Types.SVG) {
        return "svg";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Defs) {
        return "defs";
    };
    if (v instanceof PSD3_Internal_Selection_Types.LinearGradient) {
        return "linearGradient";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Stop) {
        return "stop";
    };
    if (v instanceof PSD3_Internal_Selection_Types.PatternFill) {
        return "pattern";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Div) {
        return "div";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Span) {
        return "span";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Table) {
        return "table";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Tr) {
        return "tr";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Td) {
        return "td";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Th) {
        return "th";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Tbody) {
        return "tbody";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Thead) {
        return "thead";
    };
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1130, column 1 - line 1130, column 45): " + [ v.constructor.name ]);
};
var createElementWithNS = function (elemType) {
    return function (doc) {
        var v = PSD3_Internal_Selection_Types.elementContext(elemType);
        if (v instanceof PSD3_Internal_Selection_Types.SVGContext) {
            return Web_DOM_Document.createElementNS(new Data_Maybe.Just("http://www.w3.org/2000/svg"))(elementTypeToString(elemType))(doc);
        };
        if (v instanceof PSD3_Internal_Selection_Types.HTMLContext) {
            return Web_DOM_Document.createElement(elementTypeToString(elemType))(doc);
        };
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 937, column 3 - line 943, column 64): " + [ v.constructor.name ]);
    };
};
var clear = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (selector) {
        return liftEffect1($foreign.clearElement_(selector));
    };
};
var attributeValueToString = function (v) {
    if (v instanceof PSD3_Internal_Attribute.StringValue) {
        return v.value0;
    };
    if (v instanceof PSD3_Internal_Attribute.NumberValue) {
        return show(v.value0);
    };
    if (v instanceof PSD3_Internal_Attribute.BooleanValue) {
        return show1(v.value0);
    };
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1125, column 1 - line 1125, column 51): " + [ v.constructor.name ]);
};
var applyTransitionToSingleElement = function (config) {
    return function (index) {
        return function (element) {
            return function (datum) {
                return function (attrs) {
                    var baseDelay = Data_Maybe.maybe(0.0)(unwrap)(config.delay);
                    var stagger = Data_Maybe.fromMaybe(0.0)(config.staggerDelay);
                    var effectiveDelay = baseDelay + Data_Int.toNumber(index) * stagger;
                    var delayNullable = Data_Nullable.toNullable(new Data_Maybe.Just(effectiveDelay));
                    var easingNullable = PSD3_Internal_Transition_FFI.maybeEasingToNullable(config.easing);
                    return function __do() {
                        var transition = PSD3_Internal_Transition_FFI.createTransition_(config.duration)(delayNullable)(easingNullable)(element)();
                        return traverse_(function (attr) {
                            if (attr instanceof PSD3_Internal_Attribute.StaticAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value1))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.DataAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(datum)))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.IndexedAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(datum)(index)))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.AnimatedAttr) {
                                return pure(Data_Unit.unit);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.AnimatedCompound) {
                                return pure(Data_Unit.unit);
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1247, column 30 - line 1261, column 16): " + [ attr.constructor.name ]);
                        })(attrs)();
                    };
                };
            };
        };
    };
};
var applyTransitionToElements = function (config) {
    return function (elementDatumPairs) {
        return function (attrs) {
            var baseDelay = Data_Maybe.maybe(0.0)(unwrap)(config.delay);
            var stagger = Data_Maybe.fromMaybe(0.0)(config.staggerDelay);
            var easingNullable = PSD3_Internal_Transition_FFI.maybeEasingToNullable(config.easing);
            return traverseWithIndex_(function (index) {
                return function (v) {
                    var effectiveDelay = baseDelay + Data_Int.toNumber(index) * stagger;
                    var delayNullable = Data_Nullable.toNullable(new Data_Maybe.Just(effectiveDelay));
                    return function __do() {
                        var transition = PSD3_Internal_Transition_FFI.createTransition_(config.duration)(delayNullable)(easingNullable)(v.value0)();
                        return traverse_(function (attr) {
                            if (attr instanceof PSD3_Internal_Attribute.StaticAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value1))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.DataAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(v.value1)))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.IndexedAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(v.value1)(index)))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.AnimatedAttr) {
                                return pure(Data_Unit.unit);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.AnimatedCompound) {
                                return pure(Data_Unit.unit);
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1209, column 32 - line 1223, column 18): " + [ attr.constructor.name ]);
                        })(attrs)();
                    };
                };
            })(elementDatumPairs);
        };
    };
};
var applyExitTransitionToElements = function (config) {
    return function (elementDatumPairs) {
        return function (attrs) {
            var baseDelay = Data_Maybe.maybe(0.0)(unwrap)(config.delay);
            var stagger = Data_Maybe.fromMaybe(0.0)(config.staggerDelay);
            var easingNullable = PSD3_Internal_Transition_FFI.maybeEasingToNullable(config.easing);
            return traverseWithIndex_(function (index) {
                return function (v) {
                    var effectiveDelay = baseDelay + Data_Int.toNumber(index) * stagger;
                    var delayNullable = Data_Nullable.toNullable(new Data_Maybe.Just(effectiveDelay));
                    return function __do() {
                        var transition = PSD3_Internal_Transition_FFI.createTransition_(config.duration)(delayNullable)(easingNullable)(v.value0)();
                        traverse_(function (attr) {
                            if (attr instanceof PSD3_Internal_Attribute.StaticAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value1))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.DataAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(v.value1)))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.IndexedAttr) {
                                return PSD3_Internal_Transition_FFI.transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(v.value1)(index)))(transition);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.AnimatedAttr) {
                                return pure(Data_Unit.unit);
                            };
                            if (attr instanceof PSD3_Internal_Attribute.AnimatedCompound) {
                                return pure(Data_Unit.unit);
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1289, column 32 - line 1303, column 18): " + [ attr.constructor.name ]);
                        })(attrs)();
                        return PSD3_Internal_Transition_FFI.transitionRemove_(transition)();
                    };
                };
            })(elementDatumPairs);
        };
    };
};
var applyBehaviorToElement = function (v) {
    return function (v1) {
        if (v instanceof PSD3_Internal_Behavior_Types.Zoom) {
            return $$void(PSD3_Internal_Behavior_FFI.attachZoom_(v1)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimpleDrag) {
            return $$void(PSD3_Internal_Behavior_FFI.attachSimpleDrag_(v1)(Data_Unit.unit));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDrag) {
            return $$void(PSD3_Internal_Behavior_FFI.attachSimulationDragById_(v1)(v.value0.value0));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDragNested) {
            return $$void(PSD3_Internal_Behavior_FFI.attachSimulationDragNestedById_(v1)(v.value0.value0));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.Click) {
            return $$void(PSD3_Internal_Behavior_FFI.attachClick_(v1)(v.value0));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.ClickWithDatum) {
            return $$void(PSD3_Internal_Behavior_FFI.attachClickWithDatum_(v1)(v.value0));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.MouseEnter) {
            return $$void(PSD3_Internal_Behavior_FFI.attachMouseEnter_(v1)(v.value0));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.MouseLeave) {
            return $$void(PSD3_Internal_Behavior_FFI.attachMouseLeave_(v1)(v.value0));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.Highlight) {
            return $$void(PSD3_Internal_Behavior_FFI.attachHighlight_(v1)(v.value0.enter)(v.value0.leave));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.MouseMoveWithInfo) {
            return $$void(PSD3_Internal_Behavior_FFI.attachMouseMoveWithEvent_(v1)(function (d, evt) {
                return v.value0({
                    datum: d,
                    clientX: Data_Int.toNumber(Web_UIEvent_MouseEvent.clientX(evt)),
                    clientY: Data_Int.toNumber(Web_UIEvent_MouseEvent.clientY(evt)),
                    pageX: Data_Int.toNumber(Web_UIEvent_MouseEvent.pageX(evt)),
                    pageY: Data_Int.toNumber(Web_UIEvent_MouseEvent.pageY(evt)),
                    offsetX: $foreign.offsetX(evt),
                    offsetY: $foreign.offsetY(evt)
                })();
            }));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.MouseEnterWithInfo) {
            return $$void(PSD3_Internal_Behavior_FFI.attachMouseEnterWithEvent_(v1)(function (d, evt) {
                return v.value0({
                    datum: d,
                    clientX: Data_Int.toNumber(Web_UIEvent_MouseEvent.clientX(evt)),
                    clientY: Data_Int.toNumber(Web_UIEvent_MouseEvent.clientY(evt)),
                    pageX: Data_Int.toNumber(Web_UIEvent_MouseEvent.pageX(evt)),
                    pageY: Data_Int.toNumber(Web_UIEvent_MouseEvent.pageY(evt)),
                    offsetX: $foreign.offsetX(evt),
                    offsetY: $foreign.offsetY(evt)
                })();
            }));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.MouseLeaveWithInfo) {
            return $$void(PSD3_Internal_Behavior_FFI.attachMouseLeaveWithEvent_(v1)(function (d, evt) {
                return v.value0({
                    datum: d,
                    clientX: Data_Int.toNumber(Web_UIEvent_MouseEvent.clientX(evt)),
                    clientY: Data_Int.toNumber(Web_UIEvent_MouseEvent.clientY(evt)),
                    pageX: Data_Int.toNumber(Web_UIEvent_MouseEvent.pageX(evt)),
                    pageY: Data_Int.toNumber(Web_UIEvent_MouseEvent.pageY(evt)),
                    offsetX: $foreign.offsetX(evt),
                    offsetY: $foreign.offsetY(evt)
                })();
            }));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.MouseDown) {
            return $$void(PSD3_Internal_Behavior_FFI.attachMouseDown_(v1)(v.value0));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.MouseDownWithInfo) {
            return $$void(PSD3_Internal_Behavior_FFI.attachMouseDownWithEvent_(v1)(function (d, evt) {
                return v.value0({
                    datum: d,
                    clientX: Data_Int.toNumber(Web_UIEvent_MouseEvent.clientX(evt)),
                    clientY: Data_Int.toNumber(Web_UIEvent_MouseEvent.clientY(evt)),
                    pageX: Data_Int.toNumber(Web_UIEvent_MouseEvent.pageX(evt)),
                    pageY: Data_Int.toNumber(Web_UIEvent_MouseEvent.pageY(evt)),
                    offsetX: $foreign.offsetX(evt),
                    offsetY: $foreign.offsetY(evt)
                })();
            }));
        };
        if (v instanceof PSD3_Internal_Behavior_Types.CoordinatedHighlight) {
            var tooltipTrigger = (function () {
                if (v.value0.tooltip instanceof Data_Maybe.Just) {
                    return tooltipTriggerToInt(v.value0.tooltip.value0.showWhen);
                };
                if (v.value0.tooltip instanceof Data_Maybe.Nothing) {
                    return 0;
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1053, column 22 - line 1055, column 19): " + [ v.value0.tooltip.constructor.name ]);
            })();
            var tooltipContentFn = mapFlipped1(v.value0.tooltip)(function (v2) {
                return v2.content;
            });
            var classifyAsInt = function (hoveredId) {
                return function (datum) {
                    return highlightClassToInt(v.value0.classify(hoveredId)(datum));
                };
            };
            return $$void(PSD3_Internal_Behavior_FFI.attachCoordinatedHighlight_(v1)(v.value0.identify)(classifyAsInt)(Data_Nullable.toNullable(v.value0.group))(Data_Nullable.toNullable(tooltipContentFn))(tooltipTrigger));
        };
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 978, column 1 - line 978, column 81): " + [ v.constructor.name, v1.constructor.name ]);
    };
};
var on = function (behavior) {
    return function (v) {
        var getElements = function (v1) {
            if (v1 instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                return v1.value0.parentElements;
            };
            if (v1 instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                return v1.value0.elements;
            };
            if (v1 instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                return v1.value0.parentElements;
            };
            if (v1 instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
                return v1.value0.elements;
            };
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1089, column 3 - line 1089, column 59): " + [ v1.constructor.name ]);
        };
        var elements = getElements(v);
        return function __do() {
            traverse_(applyBehaviorToElement(behavior))(elements)();
            return v;
        };
    };
};
var applyAttributes = function (element) {
    return function (datum) {
        return function (index) {
            return function (attrs) {
                return traverse_(function (attr) {
                    if (attr instanceof PSD3_Internal_Attribute.StaticAttr) {
                        var $451 = attr.value0 === "textContent";
                        if ($451) {
                            return $foreign.setTextContent_(attributeValueToString(attr.value1))(element);
                        };
                        return Web_DOM_Element.setAttribute(attr.value0)(attributeValueToString(attr.value1))(element);
                    };
                    if (attr instanceof PSD3_Internal_Attribute.DataAttr) {
                        var val = attributeValueToString(attr.value2(datum));
                        var $454 = attr.value0 === "textContent";
                        if ($454) {
                            return $foreign.setTextContent_(val)(element);
                        };
                        return Web_DOM_Element.setAttribute(attr.value0)(val)(element);
                    };
                    if (attr instanceof PSD3_Internal_Attribute.IndexedAttr) {
                        var val = attributeValueToString(attr.value2(datum)(index));
                        var $458 = attr.value0 === "textContent";
                        if ($458) {
                            return $foreign.setTextContent_(val)(element);
                        };
                        return Web_DOM_Element.setAttribute(attr.value0)(val)(element);
                    };
                    if (attr instanceof PSD3_Internal_Attribute.AnimatedAttr) {
                        return pure(Data_Unit.unit);
                    };
                    if (attr instanceof PSD3_Internal_Attribute.AnimatedCompound) {
                        return pure(Data_Unit.unit);
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1100, column 30 - line 1123, column 16): " + [ attr.constructor.name ]);
                })(attrs);
            };
        };
    };
};
var applyPerDatumAttrs = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (mkAttrs) {
        return function (v) {
            return liftEffect1((function () {
                if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                    var paired = Data_Array.zipWith(Data_Tuple.Tuple.create)(v.value0.data)(v.value0.elements);
                    return function __do() {
                        traverseWithIndex_(function (index) {
                            return function (v1) {
                                var attrs = mkAttrs(v1.value0);
                                return applyAttributes(v1.value1)(v1.value0)(index)(attrs);
                            };
                        })(paired)();
                        return v;
                    };
                };
                return pure(v);
            })());
        };
    };
};
var setAttrs = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (attrs) {
        return function (v) {
            return liftEffect1((function () {
                var v1 = (function () {
                    if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                        return v.value0;
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 288, column 76 - line 289, column 28): " + [ v.constructor.name ]);
                })();
                var paired = Data_Array.zipWith(Data_Tuple.Tuple.create)(v1.data)(v1.elements);
                return function __do() {
                    traverseWithIndex_(function (arrayIndex) {
                        return function (v2) {
                            var logicalIndex = (function () {
                                if (v1.indices instanceof Data_Maybe.Just) {
                                    return unsafeIndex(v1.indices.value0)(arrayIndex);
                                };
                                if (v1.indices instanceof Data_Maybe.Nothing) {
                                    return arrayIndex;
                                };
                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 294, column 22 - line 296, column 30): " + [ v1.indices.constructor.name ]);
                            })();
                            return applyAttributes(v2.value1)(v2.value0)(logicalIndex)(attrs);
                        };
                    })(paired)();
                    return new PSD3_Internal_Selection_Types.BoundSelection({
                        elements: v1.elements,
                        data: v1.data,
                        indices: v1.indices,
                        document: v1.document
                    });
                };
            })());
        };
    };
};
var setAttrs1 = /* #__PURE__ */ setAttrs(Effect_Class.monadEffectEffect);
var setAttrsExit = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (attrs) {
        return function (v) {
            return liftEffect1((function () {
                var v1 = (function () {
                    if (v instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
                        return v.value0;
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 323, column 67 - line 324, column 30): " + [ v.constructor.name ]);
                })();
                var paired = Data_Array.zipWith(Data_Tuple.Tuple.create)(v1.data)(v1.elements);
                return function __do() {
                    traverseWithIndex_(function (index) {
                        return function (v2) {
                            return applyAttributes(v2.value1)(v2.value0)(index)(attrs);
                        };
                    })(paired)();
                    return new PSD3_Internal_Selection_Types.ExitingSelection({
                        elements: v1.elements,
                        data: v1.data,
                        document: v1.document
                    });
                };
            })());
        };
    };
};
var setAttrsExit1 = /* #__PURE__ */ setAttrsExit(Effect_Class.monadEffectEffect);
var updateElementFromTree = function (element) {
    return function (datum) {
        return function (index) {
            return function (tree) {
                return function (doc) {
                    return function __do() {
                        $foreign.setElementData_(datum)(element)();
                        if (tree instanceof PSD3_AST.Node) {
                            return applyAttributes(element)(datum)(index)(tree.value0.attrs)();
                        };
                        return Data_Unit.unit;
                    };
                };
            };
        };
    };
};
var renderTemplatesForBoundSelection = function (dictOrd) {
    return function (templateFn) {
        return function (boundSel) {
            var v = (function () {
                if (boundSel instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                    return boundSel.value0;
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2043, column 66 - line 2044, column 32): " + [ boundSel.constructor.name ]);
            })();
            return traverseWithIndex(function (idx) {
                return function (datum) {
                    var v1 = Data_Array.index(v.elements)(idx);
                    if (v1 instanceof Data_Maybe.Nothing) {
                        return Partial_Unsafe.unsafeCrashWith("renderTemplatesForBoundSelection: index out of bounds");
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        var tree = templateFn(datum);
                        return function __do() {
                            updateElementFromTree(v1.value0)(datum)(idx)(tree)(v.document)();
                            return v1.value0;
                        };
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2049, column 9 - line 2058, column 25): " + [ v1.constructor.name ]);
                };
            })(v.data);
        };
    };
};
var appendChildWithDatum = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (elemType) {
        return function (attrs) {
            return function (datumOpt) {
                return function (logicalIndex) {
                    return function (v) {
                        return liftEffect1((function () {
                            var v1 = (function () {
                                if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                                    return v.value0;
                                };
                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 462, column 55 - line 463, column 28): " + [ v.constructor.name ]);
                            })();
                            return function __do() {
                                var elements = traverse(function (parent) {
                                    return function __do() {
                                        var element = createElementWithNS(elemType)(v1.document)();
                                        var datum = (function () {
                                            if (datumOpt instanceof Data_Maybe.Just) {
                                                return datumOpt.value0;
                                            };
                                            if (datumOpt instanceof Data_Maybe.Nothing) {
                                                return Data_Unit.unit;
                                            };
                                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 470, column 15 - line 472, column 49): " + [ datumOpt.constructor.name ]);
                                        })();
                                        applyAttributes(element)(datum)(logicalIndex)(attrs)();
                                        var elementNode = Web_DOM_Element.toNode(element);
                                        var parentNode = Web_DOM_Element.toNode(parent);
                                        Web_DOM_Node.appendChild(elementNode)(parentNode)();
                                        return element;
                                    };
                                })(v1.parentElements)();
                                return new PSD3_Internal_Selection_Types.EmptySelection({
                                    parentElements: elements,
                                    document: v1.document
                                });
                            };
                        })());
                    };
                };
            };
        };
    };
};
var appendChildWithDatum1 = /* #__PURE__ */ appendChildWithDatum(Effect_Class.monadEffectEffect);
var renderTemplatesForPendingSelection = function (dictOrd) {
    return function (templateFn) {
        return function (pendingSel) {
            var v = (function () {
                if (pendingSel instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                    return pendingSel.value0;
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1986, column 68 - line 1987, column 34): " + [ pendingSel.constructor.name ]);
            })();
            var $525 = Data_Array["null"](v.parentElements);
            if ($525) {
                return pure([  ]);
            };
            return traverseWithIndex(function (idx) {
                return function (datum) {
                    var parentIdx = mod(idx)(Data_Array.length(v.parentElements));
                    var v1 = Data_Array.index(v.parentElements)(parentIdx);
                    if (v1 instanceof Data_Maybe.Nothing) {
                        return Partial_Unsafe.unsafeCrashWith("renderTemplatesForPendingSelection: no parent elements");
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        var tree = templateFn(datum);
                        var singleParentSel = new PSD3_Internal_Selection_Types.EmptySelection({
                            parentElements: [ v1.value0 ],
                            document: v.document
                        });
                        return function __do() {
                            var v2 = renderNodeHelperWithDatum(dictOrd)(singleParentSel)(tree)(new Data_Maybe.Just(datum))(idx)();
                            $foreign.setElementData_(datum)(v2.value0)();
                            return new Data_Tuple.Tuple(v2.value0, v2.value1);
                        };
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1999, column 11 - line 2019, column 51): " + [ v1.constructor.name ]);
                };
            })(v.pendingData);
        };
    };
};
var renderNodeHelperWithDatum = function (dictOrd) {
    return function (v) {
        return function (v1) {
            return function (v2) {
                return function (v3) {
                    if (v1 instanceof PSD3_AST.Node) {
                        return function __do() {
                            var childSel = appendChildWithDatum1(v1.value0.elemType)(v1.value0.attrs)(v2)(v3)(v)();
                            var element = (function () {
                                if (childSel instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                                    var v4 = Data_Array.head(childSel.value0.parentElements);
                                    if (v4 instanceof Data_Maybe.Just) {
                                        return v4.value0;
                                    };
                                    if (v4 instanceof Data_Maybe.Nothing) {
                                        return Partial_Unsafe.unsafeCrashWith("renderTree: appendChild returned empty selection");
                                    };
                                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1364, column 29 - line 1366, column 102): " + [ v4.constructor.name ]);
                                };
                                return Partial_Unsafe.unsafeCrashWith("renderTree: appendChild should return EmptySelection");
                            })();
                            traverse_(function (behavior) {
                                return applyBehaviorToElement(behavior)(element);
                            })(v1.value0.behaviors)();
                            var childMaps = traverse(function (child) {
                                return renderNodeHelperWithDatum(dictOrd)(childSel)(child)(v2)(v3);
                            })(v1.value0.children)();
                            var combinedChildMap = Data_Array.foldl(union)(Data_Map_Internal.empty)(map(Data_Tuple.snd)(childMaps));
                            var selectionsMap = (function () {
                                if (v1.value0.name instanceof Data_Maybe.Just) {
                                    return insert(v1.value0.name.value0)(childSel)(combinedChildMap);
                                };
                                if (v1.value0.name instanceof Data_Maybe.Nothing) {
                                    return combinedChildMap;
                                };
                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1379, column 21 - line 1381, column 34): " + [ v1.value0.name.constructor.name ]);
                            })();
                            return new Data_Tuple.Tuple(element, selectionsMap);
                        };
                    };
                    if (v1 instanceof PSD3_AST.Join) {
                        return renderNodeHelper(dictOrd)(v)(v1);
                    };
                    if (v1 instanceof PSD3_AST.NestedJoin) {
                        return renderNodeHelper(dictOrd)(v)(v1);
                    };
                    if (v1 instanceof PSD3_AST.UpdateJoin) {
                        return renderNodeHelper(dictOrd)(v)(v1);
                    };
                    if (v1 instanceof PSD3_AST.UpdateNestedJoin) {
                        return renderNodeHelper(dictOrd)(v)(v1);
                    };
                    if (v1 instanceof PSD3_AST.LocalCoordSpace) {
                        return renderNodeHelper(dictOrd)(v)(v1);
                    };
                    if (v1 instanceof PSD3_AST.ConditionalRender && v2 instanceof Data_Maybe.Just) {
                        var v4 = Data_Array.find(function (c) {
                            return c.predicate(v2.value0);
                        })(v1.value0.cases);
                        if (v4 instanceof Data_Maybe.Just) {
                            var chosenTree = v4.value0.spec(v2.value0);
                            return renderNodeHelperWithDatum(dictOrd)(v)(chosenTree)(new Data_Maybe.Just(v2.value0))(v3);
                        };
                        if (v4 instanceof Data_Maybe.Nothing) {
                            var doc = (function () {
                                if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                                    return v.value0.document;
                                };
                                if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                                    return v.value0.document;
                                };
                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1406, column 33 - line 1406, column 80): " + [ v.constructor.name ]);
                            })();
                            return function __do() {
                                var dummyElement = createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                                return new Data_Tuple.Tuple(dummyElement, Data_Map_Internal.empty);
                            };
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1396, column 3 - line 1408, column 42): " + [ v4.constructor.name ]);
                    };
                    if (v1 instanceof PSD3_AST.ConditionalRender && v2 instanceof Data_Maybe.Nothing) {
                        return renderNodeHelper(dictOrd)(v)(new PSD3_AST.ConditionalRender({
                            cases: [  ]
                        }));
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1348, column 1 - line 1355, column 74): " + [ v.constructor.name, v1.constructor.name, v2.constructor.name, v3.constructor.name ]);
                };
            };
        };
    };
};
var renderNodeHelper = function (dictOrd) {
    var joinData2 = joinData1(dictOrd);
    var renderTemplatesForBoundSelection1 = renderTemplatesForBoundSelection(dictOrd);
    return function (v) {
        return function (v1) {
            if (v1 instanceof PSD3_AST.Node) {
                return renderNodeHelperWithDatum(dictOrd)(v)(new PSD3_AST.Node(v1.value0))(Data_Maybe.Nothing.value)(0);
            };
            if (v1 instanceof PSD3_AST.Join) {
                return function __do() {
                    var v2 = joinData2(v1.value0.joinData)(v1.value0.key)(v)();
                    remove1(v2.value0.exit)();
                    var enterElementsAndMaps = renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v2.value0.enter)();
                    var enterElements = map(Data_Tuple.fst)(enterElementsAndMaps);
                    var enterChildMaps = map(Data_Tuple.snd)(enterElementsAndMaps);
                    var updateElements = renderTemplatesForBoundSelection1(v1.value0.template)(v2.value0.update)();
                    var allElements = append1(enterElements)(updateElements);
                    var combinedChildMap = Data_Array.foldl(union)(Data_Map_Internal.empty)(enterChildMaps);
                    var doc = (function () {
                        if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                            return v2.value0.enter.value0.document;
                        };
                        if (v2.value0.update instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                            return v2.value0.update.value0.document;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1477, column 12 - line 1478, column 43): " + [ v2.value0.update.constructor.name ]);
                    })();
                    var allData = (function () {
                        if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                            return v2.value0.enter.value0.pendingData;
                        };
                        return [  ];
                    })();
                    var updateData = (function () {
                        if (v2.value0.update instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                            return v2.value0.update.value0.data;
                        };
                        return [  ];
                    })();
                    var boundSel = new PSD3_Internal_Selection_Types.BoundSelection({
                        elements: allElements,
                        data: append1(allData)(updateData),
                        indices: new Data_Maybe.Just(Data_Array.range(0)(Data_Array.length(allElements) - 1 | 0)),
                        document: doc
                    });
                    var selectionsMap = insert(v1.value0.name)(boundSel)(combinedChildMap);
                    var firstElement = (function () {
                        var v3 = Data_Array.head(allElements);
                        if (v3 instanceof Data_Maybe.Just) {
                            return v3.value0;
                        };
                        if (v3 instanceof Data_Maybe.Nothing) {
                            return createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1503, column 19 - line 1505, column 45): " + [ v3.constructor.name ]);
                    })();
                    return new Data_Tuple.Tuple(firstElement, selectionsMap);
                };
            };
            if (v1 instanceof PSD3_AST.NestedJoin) {
                return function __do() {
                    var v2 = joinData2(v1.value0.joinData)(v1.value0.key)(v)();
                    var elementsAndMaps = renderNestedTemplatesForPendingSelection(dictOrd)(v1.value0.decompose)(v1.value0.template)(stringToElementType(v1.value0.key))(v2.value0.enter)();
                    var elements = map(Data_Tuple.fst)(elementsAndMaps);
                    var childMaps = map(Data_Tuple.snd)(elementsAndMaps);
                    var combinedChildMap = Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps);
                    var v3 = (function () {
                        if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                            return v2.value0.enter.value0;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1529, column 52 - line 1530, column 34): " + [ v2.value0.enter.constructor.name ]);
                    })();
                    var boundSel = new PSD3_Internal_Selection_Types.BoundSelection({
                        elements: elements,
                        data: v3.pendingData,
                        indices: new Data_Maybe.Just(Data_Array.range(0)(Data_Array.length(elements) - 1 | 0)),
                        document: v3.document
                    });
                    var selectionsMap = insert(v1.value0.name)(boundSel)(combinedChildMap);
                    var firstElement = (function () {
                        var v4 = Data_Array.head(elements);
                        if (v4 instanceof Data_Maybe.Just) {
                            return v4.value0;
                        };
                        if (v4 instanceof Data_Maybe.Nothing) {
                            return createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(v3.document)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1545, column 19 - line 1547, column 45): " + [ v4.constructor.name ]);
                    })();
                    return new Data_Tuple.Tuple(firstElement, selectionsMap);
                };
            };
            if (v1 instanceof PSD3_AST.UpdateJoin) {
                return function __do() {
                    var v2 = (function () {
                        if (v1.value0.keyFn instanceof Data_Maybe.Just) {
                            return joinDataWithKey1(v1.value0.joinData)(v1.value0.keyFn.value0)(v1.value0.key)(v)();
                        };
                        if (v1.value0.keyFn instanceof Data_Maybe.Nothing) {
                            return joinData2(v1.value0.joinData)(v1.value0.key)(v)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1557, column 5 - line 1559, column 67): " + [ v1.value0.keyFn.constructor.name ]);
                    })();
                    liftEffect((function () {
                        var enterCount = (function () {
                            if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                                return Data_Array.length(v2.value0.enter.value0.pendingData);
                            };
                            return 0;
                        })();
                        var updateCount = (function () {
                            if (v2.value0.update instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                                return Data_Array.length(v2.value0.update.value0.data);
                            };
                            return 0;
                        })();
                        var exitCount = (function () {
                            if (v2.value0.exit instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                                return Data_Array.length(v2.value0.exit.value0.data);
                            };
                            if (v2.value0.exit instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
                                return Data_Array.length(v2.value0.exit.value0.data);
                            };
                            return 0;
                        })();
                        return log("Tree API UpdateJoin '" + (v1.value0.name + ("': enter=" + (show2(enterCount) + (", update=" + (show2(updateCount) + (", exit=" + show2(exitCount))))))));
                    })())();
                    (function () {
                        if (v1.value0.behaviors.exit instanceof Data_Maybe.Just) {
                            if (v1.value0.behaviors.exit.value0.transition instanceof Data_Maybe.Just) {
                                var pairs = getExitingElementDatumPairs(v2.value0.exit);
                                return liftEffect(applyExitTransitionToElements(v1.value0.behaviors.exit.value0.transition.value0)(pairs)(v1.value0.behaviors.exit.value0.attrs))();
                            };
                            if (v1.value0.behaviors.exit.value0.transition instanceof Data_Maybe.Nothing) {
                                setAttrsExit1(v1.value0.behaviors.exit.value0.attrs)(v2.value0.exit)();
                                remove1(v2.value0.exit)();
                                return Data_Unit.unit;
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1591, column 7 - line 1599, column 20): " + [ v1.value0.behaviors.exit.value0.transition.constructor.name ]);
                        };
                        if (v1.value0.behaviors.exit instanceof Data_Maybe.Nothing) {
                            remove1(v2.value0.exit)();
                            return Data_Unit.unit;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1589, column 3 - line 1603, column 16): " + [ v1.value0.behaviors.exit.constructor.name ]);
                    })();
                    var enterElementsAndMaps = (function () {
                        if (v1.value0.behaviors.enter instanceof Data_Maybe.Just) {
                            var modifiedTemplate = function (datum) {
                                var v3 = v1.value0.template(datum);
                                if (v3 instanceof PSD3_AST.Node) {
                                    return new PSD3_AST.Node({
                                        name: v3.value0.name,
                                        elemType: v3.value0.elemType,
                                        behaviors: v3.value0.behaviors,
                                        children: v3.value0.children,
                                        attrs: append1(v3.value0.attrs)(v1.value0.behaviors.enter.value0.attrs)
                                    });
                                };
                                return v3;
                            };
                            var rendered = renderTemplatesForPendingSelection(dictOrd)(modifiedTemplate)(v2.value0.enter)();
                            (function () {
                                if (v1.value0.behaviors.enter.value0.transition instanceof Data_Maybe.Just) {
                                    var enterElements = map(Data_Tuple.fst)(rendered);
                                    var pendingData = (function () {
                                        if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                                            return v2.value0.enter.value0.pendingData;
                                        };
                                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1632, column 41 - line 1633, column 54): " + [ v2.value0.enter.constructor.name ]);
                                    })();
                                    var pairs = Data_Array.zipWith(Data_Tuple.Tuple.create)(enterElements)(pendingData);
                                    return liftEffect(traverseWithIndex_(function (index) {
                                        return function (v3) {
                                            var finalAttrs = (function () {
                                                var v4 = v1.value0.template(v3.value1);
                                                if (v4 instanceof PSD3_AST.Node) {
                                                    return v4.value0.attrs;
                                                };
                                                return [  ];
                                            })();
                                            return applyTransitionToSingleElement(v1.value0.behaviors.enter.value0.transition.value0)(index)(v3.value0)(v3.value1)(finalAttrs);
                                        };
                                    })(pairs))();
                                };
                                if (v1.value0.behaviors.enter.value0.transition instanceof Data_Maybe.Nothing) {
                                    return Data_Unit.unit;
                                };
                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1627, column 7 - line 1643, column 29): " + [ v1.value0.behaviors.enter.value0.transition.constructor.name ]);
                            })();
                            return rendered;
                        };
                        if (v1.value0.behaviors.enter instanceof Data_Maybe.Nothing) {
                            return renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v2.value0.enter)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1614, column 27 - line 1648, column 68): " + [ v1.value0.behaviors.enter.constructor.name ]);
                    })();
                    var enterElements = map(Data_Tuple.fst)(enterElementsAndMaps);
                    var enterChildMaps = map(Data_Tuple.snd)(enterElementsAndMaps);
                    var updateElements = (function () {
                        if (v1.value0.behaviors.update instanceof Data_Maybe.Just) {
                            if (v1.value0.behaviors.update.value0.transition instanceof Data_Maybe.Just) {
                                var pairs = getBoundElementDatumPairs(v2.value0.update);
                                liftEffect(traverseWithIndex_(function (index) {
                                    return function (v3) {
                                        return applyTransitionToSingleElement(v1.value0.behaviors.update.value0.transition.value0)(index)(v3.value0)(v3.value1)(v1.value0.behaviors.update.value0.attrs);
                                    };
                                })(pairs))();
                                return getElementsFromBoundSelection(v2.value0.update);
                            };
                            if (v1.value0.behaviors.update.value0.transition instanceof Data_Maybe.Nothing) {
                                setAttrs1(v1.value0.behaviors.update.value0.attrs)(v2.value0.update)();
                                return renderTemplatesForBoundSelection1(v1.value0.template)(v2.value0.update)();
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1657, column 7 - line 1673, column 71): " + [ v1.value0.behaviors.update.value0.transition.constructor.name ]);
                        };
                        if (v1.value0.behaviors.update instanceof Data_Maybe.Nothing) {
                            return renderTemplatesForBoundSelection1(v1.value0.template)(v2.value0.update)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1654, column 21 - line 1676, column 67): " + [ v1.value0.behaviors.update.constructor.name ]);
                    })();
                    var allElements = append1(enterElements)(updateElements);
                    var combinedChildMap = Data_Array.foldl(union)(Data_Map_Internal.empty)(enterChildMaps);
                    var doc = (function () {
                        if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                            return v2.value0.enter.value0.document;
                        };
                        if (v2.value0.update instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                            return v2.value0.update.value0.document;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1690, column 12 - line 1691, column 43): " + [ v2.value0.update.constructor.name ]);
                    })();
                    var allData = (function () {
                        if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                            return v2.value0.enter.value0.pendingData;
                        };
                        return [  ];
                    })();
                    var updateData = (function () {
                        if (v2.value0.update instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                            return v2.value0.update.value0.data;
                        };
                        return [  ];
                    })();
                    var boundSel = new PSD3_Internal_Selection_Types.BoundSelection({
                        elements: allElements,
                        data: append1(allData)(updateData),
                        indices: new Data_Maybe.Just(Data_Array.range(0)(Data_Array.length(allElements) - 1 | 0)),
                        document: doc
                    });
                    var selectionsMap = insert(v1.value0.name)(boundSel)(combinedChildMap);
                    var firstElement = (function () {
                        var v3 = Data_Array.head(allElements);
                        if (v3 instanceof Data_Maybe.Just) {
                            return v3.value0;
                        };
                        if (v3 instanceof Data_Maybe.Nothing) {
                            return createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1715, column 19 - line 1717, column 45): " + [ v3.constructor.name ]);
                    })();
                    return new Data_Tuple.Tuple(firstElement, selectionsMap);
                };
            };
            if (v1 instanceof PSD3_AST.UpdateNestedJoin) {
                var innerData = join(map(v1.value0.decompose)(v1.value0.joinData));
                return function __do() {
                    var v2 = joinDataWithKey1(innerData)($foreign.jsonStringify_)(v1.value0.key)(v)();
                    (function () {
                        if (v1.value0.behaviors.exit instanceof Data_Maybe.Just) {
                            if (v1.value0.behaviors.exit.value0.transition instanceof Data_Maybe.Just) {
                                var pairs = getExitingElementDatumPairs(v2.value0.exit);
                                return liftEffect(applyExitTransitionToElements(v1.value0.behaviors.exit.value0.transition.value0)(pairs)(v1.value0.behaviors.exit.value0.attrs))();
                            };
                            if (v1.value0.behaviors.exit.value0.transition instanceof Data_Maybe.Nothing) {
                                setAttrsExit1(v1.value0.behaviors.exit.value0.attrs)(v2.value0.exit)();
                                remove1(v2.value0.exit)();
                                return Data_Unit.unit;
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1768, column 7 - line 1776, column 20): " + [ v1.value0.behaviors.exit.value0.transition.constructor.name ]);
                        };
                        if (v1.value0.behaviors.exit instanceof Data_Maybe.Nothing) {
                            remove1(v2.value0.exit)();
                            return Data_Unit.unit;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1766, column 3 - line 1779, column 16): " + [ v1.value0.behaviors.exit.constructor.name ]);
                    })();
                    var enterElementsAndMaps = (function () {
                        if (v1.value0.behaviors.enter instanceof Data_Maybe.Just) {
                            var modifiedTemplate = function (datum) {
                                var v3 = v1.value0.template(datum);
                                if (v3 instanceof PSD3_AST.Node) {
                                    return new PSD3_AST.Node({
                                        name: v3.value0.name,
                                        elemType: v3.value0.elemType,
                                        behaviors: v3.value0.behaviors,
                                        children: v3.value0.children,
                                        attrs: append1(v3.value0.attrs)(v1.value0.behaviors.enter.value0.attrs)
                                    });
                                };
                                return v3;
                            };
                            var rendered = renderTemplatesForPendingSelection(dictOrd)(modifiedTemplate)(v2.value0.enter)();
                            (function () {
                                if (v1.value0.behaviors.enter.value0.transition instanceof Data_Maybe.Just) {
                                    var enterElements = map(Data_Tuple.fst)(rendered);
                                    var pendingData = (function () {
                                        if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                                            return v2.value0.enter.value0.pendingData;
                                        };
                                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1812, column 41 - line 1813, column 54): " + [ v2.value0.enter.constructor.name ]);
                                    })();
                                    var pairs = Data_Array.zipWith(Data_Tuple.Tuple.create)(enterElements)(pendingData);
                                    return liftEffect(traverseWithIndex_(function (index) {
                                        return function (v4) {
                                            var finalAttrs = (function () {
                                                var v5 = v1.value0.template(v4.value1);
                                                if (v5 instanceof PSD3_AST.Node) {
                                                    return v5.value0.attrs;
                                                };
                                                return [  ];
                                            })();
                                            return applyTransitionToSingleElement(v1.value0.behaviors.enter.value0.transition.value0)(index)(v4.value0)(v4.value1)(finalAttrs);
                                        };
                                    })(pairs))();
                                };
                                if (v1.value0.behaviors.enter.value0.transition instanceof Data_Maybe.Nothing) {
                                    return Data_Unit.unit;
                                };
                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1807, column 7 - line 1823, column 29): " + [ v1.value0.behaviors.enter.value0.transition.constructor.name ]);
                            })();
                            return rendered;
                        };
                        if (v1.value0.behaviors.enter instanceof Data_Maybe.Nothing) {
                            return renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v2.value0.enter)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1796, column 27 - line 1826, column 92): " + [ v1.value0.behaviors.enter.constructor.name ]);
                    })();
                    var updateElements = (function () {
                        if (v1.value0.behaviors.update instanceof Data_Maybe.Just) {
                            if (v1.value0.behaviors.update.value0.transition instanceof Data_Maybe.Just) {
                                var pairs = getBoundElementDatumPairs(v2.value0.update);
                                liftEffect(traverseWithIndex_(function (index) {
                                    return function (v4) {
                                        return applyTransitionToSingleElement(v1.value0.behaviors.update.value0.transition.value0)(index)(v4.value0)(v4.value1)(v1.value0.behaviors.update.value0.attrs);
                                    };
                                })(pairs))();
                                return getElementsFromBoundSelection(v2.value0.update);
                            };
                            if (v1.value0.behaviors.update.value0.transition instanceof Data_Maybe.Nothing) {
                                setAttrs1(v1.value0.behaviors.update.value0.attrs)(v2.value0.update)();
                                return renderTemplatesForBoundSelection1(v1.value0.template)(v2.value0.update)();
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1832, column 7 - line 1845, column 86): " + [ v1.value0.behaviors.update.value0.transition.constructor.name ]);
                        };
                        if (v1.value0.behaviors.update instanceof Data_Maybe.Nothing) {
                            return renderTemplatesForBoundSelection1(v1.value0.template)(v2.value0.update)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1829, column 21 - line 1846, column 91): " + [ v1.value0.behaviors.update.constructor.name ]);
                    })();
                    var enterElements = map(Data_Tuple.fst)(enterElementsAndMaps);
                    var allElements = append1(enterElements)(updateElements);
                    var enterChildMaps = map(Data_Tuple.snd)(enterElementsAndMaps);
                    var combinedChildMap = Data_Array.foldl(union)(Data_Map_Internal.empty)(enterChildMaps);
                    var doc = (function () {
                        if (v2.value0.enter instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                            return v2.value0.enter.value0.document;
                        };
                        if (v2.value0.update instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                            return v2.value0.update.value0.document;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1865, column 12 - line 1866, column 43): " + [ v2.value0.update.constructor.name ]);
                    })();
                    var boundSel = new PSD3_Internal_Selection_Types.BoundSelection({
                        elements: allElements,
                        data: innerData,
                        indices: new Data_Maybe.Just(Data_Array.range(0)(Data_Array.length(allElements) - 1 | 0)),
                        document: doc
                    });
                    var selectionsMap = insert(v1.value0.name)(boundSel)(combinedChildMap);
                    var firstElement = (function () {
                        var v5 = Data_Array.head(allElements);
                        if (v5 instanceof Data_Maybe.Just) {
                            return v5.value0;
                        };
                        if (v5 instanceof Data_Maybe.Nothing) {
                            return createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1880, column 19 - line 1882, column 45): " + [ v5.constructor.name ]);
                    })();
                    return new Data_Tuple.Tuple(firstElement, selectionsMap);
                };
            };
            if (v1 instanceof PSD3_AST.ConditionalRender) {
                var doc = (function () {
                    if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                        return v.value0.document;
                    };
                    if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                        return v.value0.document;
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1896, column 29 - line 1896, column 76): " + [ v.constructor.name ]);
                })();
                return function __do() {
                    var dummyElement = createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                    return new Data_Tuple.Tuple(dummyElement, Data_Map_Internal.empty);
                };
            };
            if (v1 instanceof PSD3_AST.LocalCoordSpace) {
                return renderNodeHelper(dictOrd)(v)(v1.value0.child);
            };
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1416, column 1 - line 1421, column 74): " + [ v.constructor.name, v1.constructor.name ]);
        };
    };
};
var renderNestedTemplatesForPendingSelection = function (dictOrd) {
    return function (decomposer) {
        return function (templateFn) {
            return function (wrapperType) {
                return function (pendingSel) {
                    var v = (function () {
                        if (pendingSel instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                            return pendingSel.value0;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1928, column 68 - line 1929, column 34): " + [ pendingSel.constructor.name ]);
                    })();
                    return traverseWithIndex(function (idx) {
                        return function (outerDatum) {
                            var parentIdx = mod(idx)(Data_Array.length(v.parentElements));
                            var v1 = Data_Array.index(v.parentElements)(parentIdx);
                            if (v1 instanceof Data_Maybe.Nothing) {
                                return Partial_Unsafe.unsafeCrashWith("renderNestedTemplatesForPendingSelection: no parent elements");
                            };
                            if (v1 instanceof Data_Maybe.Just) {
                                return function __do() {
                                    var wrapperElement = createElementWithNS(wrapperType)(v.document)();
                                    var wrapperNode = Web_DOM_Element.toNode(wrapperElement);
                                    var parentNode = Web_DOM_Element.toNode(v1.value0);
                                    Web_DOM_Node.appendChild(wrapperNode)(parentNode)();
                                    var innerDataArray = decomposer(outerDatum);
                                    var innerMaps = traverseWithIndex(function (innerIdx) {
                                        return function (innerDatumErased) {
                                            var tree = templateFn(innerDatumErased);
                                            var singleParentSel = new PSD3_Internal_Selection_Types.EmptySelection({
                                                parentElements: [ wrapperElement ],
                                                document: v.document
                                            });
                                            return function __do() {
                                                var v2 = renderNodeHelperWithDatum(dictOrd)(singleParentSel)(tree)(new Data_Maybe.Just(innerDatumErased))(innerIdx)();
                                                return v2.value1;
                                            };
                                        };
                                    })(innerDataArray)();
                                    var combinedInnerMap = Data_Array.foldl(union)(Data_Map_Internal.empty)(innerMaps);
                                    return new Data_Tuple.Tuple(wrapperElement, combinedInnerMap);
                                };
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1934, column 9 - line 1966, column 57): " + [ v1.constructor.name ]);
                        };
                    })(v.pendingData);
                };
            };
        };
    };
};
var appendChildrenFromNestedTemplate = function (dictOrd) {
    var renderNodeHelperWithDatum1 = renderNodeHelperWithDatum(dictOrd);
    return function (decomposer) {
        return function (templateFn) {
            return function (boundSel) {
                var v = (function () {
                    if (boundSel instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                        return boundSel.value0;
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2139, column 71 - line 2140, column 32): " + [ boundSel.constructor.name ]);
                })();
                return function __do() {
                    var childMaps = traverseWithIndex(function (idx) {
                        return function (outerDatum) {
                            var v1 = Data_Array.index(v.elements)(idx);
                            if (v1 instanceof Data_Maybe.Nothing) {
                                return pure(Data_Map_Internal.empty);
                            };
                            if (v1 instanceof Data_Maybe.Just) {
                                var innerDataArray = decomposer(outerDatum);
                                return function __do() {
                                    var innerMaps = traverseWithIndex(function (innerIdx) {
                                        return function (innerDatum) {
                                            var childTree = templateFn(innerDatum);
                                            var singleParentSel = new PSD3_Internal_Selection_Types.EmptySelection({
                                                parentElements: [ v1.value0 ],
                                                document: v.document
                                            });
                                            return function __do() {
                                                var v2 = renderNodeHelperWithDatum1(singleParentSel)(childTree)(new Data_Maybe.Just(innerDatum))(innerIdx)();
                                                return v2.value1;
                                            };
                                        };
                                    })(innerDataArray)();
                                    return Data_Array.foldl(union)(Data_Map_Internal.empty)(innerMaps);
                                };
                            };
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2146, column 9 - line 2172, column 61): " + [ v1.constructor.name ]);
                        };
                    })(v.data)();
                    return Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps);
                };
            };
        };
    };
};
var appendChildrenFromTemplate = function (dictOrd) {
    var renderNodeHelperWithDatum1 = renderNodeHelperWithDatum(dictOrd);
    return function (templateFn) {
        return function (boundSel) {
            var v = (function () {
                if (boundSel instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                    return boundSel.value0;
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2091, column 66 - line 2092, column 32): " + [ boundSel.constructor.name ]);
            })();
            return function __do() {
                var childMaps = traverseWithIndex(function (idx) {
                    return function (datum) {
                        var v1 = Data_Array.index(v.elements)(idx);
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return pure(Data_Map_Internal.empty);
                        };
                        if (v1 instanceof Data_Maybe.Just) {
                            var childTree = templateFn(datum);
                            var singleParentSel = new PSD3_Internal_Selection_Types.EmptySelection({
                                parentElements: [ v1.value0 ],
                                document: v.document
                            });
                            return function __do() {
                                var v2 = renderNodeHelperWithDatum1(singleParentSel)(childTree)(new Data_Maybe.Just(datum))(idx)();
                                return v2.value1;
                            };
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2098, column 9 - line 2113, column 33): " + [ v1.constructor.name ]);
                    };
                })(v.data)();
                return Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps);
            };
        };
    };
};
var renderTree = function (dictOrd) {
    var renderNodeHelper1 = renderNodeHelper(dictOrd);
    return function (parent) {
        return function (tree) {
            return function __do() {
                var v = renderNodeHelper1(parent)(tree)();
                return v.value1;
            };
        };
    };
};
var renderTree1 = /* #__PURE__ */ renderTree(ordOrdWrapper);
var renderTreeKeyed = function (parent) {
    return function (tree) {
        return function __do() {
            var result = renderTree1(parent)(tree)();
            return result;
        };
    };
};
var appendChildInheriting = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (elemType) {
        return function (attrs) {
            return function (v) {
                return liftEffect1((function () {
                    var v1 = (function () {
                        if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                            return v.value0;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 520, column 82 - line 521, column 28): " + [ v.constructor.name ]);
                    })();
                    return function __do() {
                        var childElements = traverseWithIndex(function (idx) {
                            return function (v2) {
                                return function __do() {
                                    var child = createElementWithNS(elemType)(v1.document)();
                                    $foreign.setElementData_(v2.value1)(child)();
                                    applyAttributes(child)(v2.value1)(idx)(attrs)();
                                    var childNode = Web_DOM_Element.toNode(child);
                                    var parentNode = Web_DOM_Element.toNode(v2.value0);
                                    Web_DOM_Node.appendChild(childNode)(parentNode)();
                                    return child;
                                };
                            };
                        })(Data_Array.zipWith(Data_Tuple.Tuple.create)(v1.elements)(v1.data))();
                        return new PSD3_Internal_Selection_Types.BoundSelection({
                            elements: childElements,
                            data: v1.data,
                            indices: Data_Maybe.Nothing.value,
                            document: v1.document
                        });
                    };
                })());
            };
        };
    };
};
var appendChild = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (elemType) {
        return function (attrs) {
            return function (v) {
                return liftEffect1((function () {
                    var v1 = (function () {
                        if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                            return v.value0;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 427, column 55 - line 428, column 28): " + [ v.constructor.name ]);
                    })();
                    return function __do() {
                        var elements = traverse(function (parent) {
                            return function __do() {
                                var element = createElementWithNS(elemType)(v1.document)();
                                applyAttributes(element)(Data_Unit.unit)(0)(attrs)();
                                var elementNode = Web_DOM_Element.toNode(element);
                                var parentNode = Web_DOM_Element.toNode(parent);
                                Web_DOM_Node.appendChild(elementNode)(parentNode)();
                                return element;
                            };
                        })(v1.parentElements)();
                        return new PSD3_Internal_Selection_Types.EmptySelection({
                            parentElements: elements,
                            document: v1.document
                        });
                    };
                })());
            };
        };
    };
};
var append = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (elemType) {
        return function (attrs) {
            return function (v) {
                return liftEffect1((function () {
                    var v1 = (function () {
                        if (v instanceof PSD3_Internal_Selection_Types.PendingSelection) {
                            return v.value0;
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 232, column 77 - line 233, column 30): " + [ v.constructor.name ]);
                    })();
                    var parent = (function () {
                        var v2 = Data_Array.head(v1.parentElements);
                        if (v2 instanceof Data_Maybe.Just) {
                            return v2.value0;
                        };
                        if (v2 instanceof Data_Maybe.Nothing) {
                            return unsafeIndex(v1.parentElements)(0);
                        };
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 238, column 14 - line 240, column 68): " + [ v2.constructor.name ]);
                    })();
                    return function __do() {
                        var elements = traverseWithIndex(function (arrayIndex) {
                            return function (datum) {
                                var logicalIndex = (function () {
                                    if (v1.indices instanceof Data_Maybe.Just) {
                                        return unsafeIndex(v1.indices.value0)(arrayIndex);
                                    };
                                    if (v1.indices instanceof Data_Maybe.Nothing) {
                                        return arrayIndex;
                                    };
                                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 245, column 22 - line 247, column 30): " + [ v1.indices.constructor.name ]);
                                })();
                                return function __do() {
                                    var element = createElementWithNS(elemType)(v1.document)();
                                    applyAttributes(element)(datum)(logicalIndex)(attrs)();
                                    $foreign.setElementData_(datum)(element)();
                                    var elementNode = Web_DOM_Element.toNode(element);
                                    var parentNode = Web_DOM_Element.toNode(parent);
                                    Web_DOM_Node.appendChild(elementNode)(parentNode)();
                                    return element;
                                };
                            };
                        })(v1.pendingData)();
                        return new PSD3_Internal_Selection_Types.BoundSelection({
                            elements: elements,
                            data: v1.pendingData,
                            indices: v1.indices,
                            document: v1.document
                        });
                    };
                })());
            };
        };
    };
};
var append3 = /* #__PURE__ */ append(Effect_Class.monadEffectEffect);
var appendData = function (dictMonadEffect) {
    var liftEffect1 = Effect_Class.liftEffect(dictMonadEffect);
    return function (dictFoldable) {
        var fromFoldable = Data_Array.fromFoldable(dictFoldable);
        return function (elemType) {
            return function (foldableData) {
                return function (attrs) {
                    return function (emptySelection) {
                        return liftEffect1((function () {
                            var v = (function () {
                                if (emptySelection instanceof PSD3_Internal_Selection_Types.EmptySelection) {
                                    return emptySelection.value0;
                                };
                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 883, column 55 - line 884, column 28): " + [ emptySelection.constructor.name ]);
                            })();
                            var dataArray = fromFoldable(foldableData);
                            var pendingSelection = new PSD3_Internal_Selection_Types.PendingSelection({
                                parentElements: v.parentElements,
                                pendingData: dataArray,
                                indices: new Data_Maybe.Just(Data_Array.range(0)(Data_Array.length(dataArray) - 1 | 0)),
                                document: v.document
                            });
                            return append3(elemType)(attrs)(pendingSelection);
                        })());
                    };
                };
            };
        };
    };
};
var renderData = function (dictMonadEffect) {
    var Monad0 = dictMonadEffect.Monad0();
    var Bind1 = Monad0.Bind1();
    var bind1 = Control_Bind.bind(Bind1);
    var joinData2 = joinData(dictMonadEffect);
    var append4 = append(dictMonadEffect);
    var pure1 = Control_Applicative.pure(Monad0.Applicative0());
    var applyPerDatumAttrs1 = applyPerDatumAttrs(dictMonadEffect);
    var discard2 = discard(Bind1);
    var remove2 = remove(dictMonadEffect);
    var merge1 = merge(dictMonadEffect);
    return function (dictFoldable) {
        var joinData3 = joinData2(dictFoldable);
        return function (dictOrd) {
            var joinData4 = joinData3(dictOrd);
            return function (elemType) {
                return function (foldableData) {
                    return function (selector) {
                        return function (emptySelection) {
                            return function (enterAttrs) {
                                return function (updateAttrs) {
                                    return function (exitAttrs) {
                                        return bind1(joinData4(foldableData)(selector)(emptySelection))(function (v) {
                                            return bind1(bind1(append4(elemType)([  ])(v.value0.enter))(function (bound) {
                                                if (enterAttrs instanceof Data_Maybe.Nothing) {
                                                    return pure1(bound);
                                                };
                                                if (enterAttrs instanceof Data_Maybe.Just) {
                                                    return applyPerDatumAttrs1(enterAttrs.value0)(bound);
                                                };
                                                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 836, column 5 - line 838, column 55): " + [ enterAttrs.constructor.name ]);
                                            }))(function (enterBound) {
                                                return bind1((function () {
                                                    if (updateAttrs instanceof Data_Maybe.Nothing) {
                                                        return pure1(v.value0.update);
                                                    };
                                                    if (updateAttrs instanceof Data_Maybe.Just) {
                                                        return applyPerDatumAttrs1(updateAttrs.value0)(v.value0.update);
                                                    };
                                                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 841, column 18 - line 843, column 54): " + [ updateAttrs.constructor.name ]);
                                                })())(function (updateBound) {
                                                    return discard2((function () {
                                                        if (exitAttrs instanceof Data_Maybe.Nothing) {
                                                            return remove2(v.value0.exit);
                                                        };
                                                        if (exitAttrs instanceof Data_Maybe.Just) {
                                                            return bind1(applyPerDatumAttrs1(exitAttrs.value0)(v.value0.exit))(function () {
                                                                return remove2(v.value0.exit);
                                                            });
                                                        };
                                                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 846, column 3 - line 850, column 18): " + [ exitAttrs.constructor.name ]);
                                                    })())(function () {
                                                        return merge1(enterBound)(updateBound);
                                                    });
                                                });
                                            });
                                        });
                                    };
                                };
                            };
                        };
                    };
                };
            };
        };
    };
};
export {
    select,
    selectElement,
    selectAll,
    selectAllWithData,
    selectChildInheriting,
    append,
    appendChild,
    appendChildInheriting,
    setAttrs,
    setAttrsExit,
    remove,
    clear,
    syncDOMToData,
    merge,
    joinData,
    joinDataWithKey,
    renderData,
    appendData,
    on,
    renderTree,
    renderTreeKeyed,
    reselect,
    elementTypeToString,
    createElementWithNS,
    getDocument
};
//# sourceMappingURL=index.js.map
