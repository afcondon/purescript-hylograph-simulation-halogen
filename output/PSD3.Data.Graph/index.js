// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Graph from "../Data.Graph/index.js";
import * as Data_List from "../Data.List/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Ord.ordInt);
var fromFoldable = /* #__PURE__ */ Data_List.fromFoldable(Data_Foldable.foldableArray);
var fromFoldable1 = /* #__PURE__ */ Data_Map_Internal.fromFoldable(Data_Ord.ordInt)(Data_Foldable.foldableArray);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var fromFoldable2 = /* #__PURE__ */ Data_Set.fromFoldable(Data_Foldable.foldableArray)(Data_Ord.ordInt);
var alter = /* #__PURE__ */ Data_Map_Internal.alter(Data_Ord.ordInt);
var insert = /* #__PURE__ */ Data_Map_Internal.insert(Data_Ord.ordInt);
var insert1 = /* #__PURE__ */ Data_Set.insert(Data_Ord.ordInt);
var getNodesByIds = function (ids) {
    return function (model) {
        return Data_Array.catMaybes(map(function (id) {
            return lookup(id)(model.maps.nodeById);
        })(ids));
    };
};
var getNode = function (nodeId) {
    return function (model) {
        return lookup(nodeId)(model.maps.nodeById);
    };
};
var getLinksTo = function (nodeId) {
    return function (model) {
        var v = lookup(nodeId)(model.maps.linksByTarget);
        if (v instanceof Data_Maybe.Nothing) {
            return [  ];
        };
        if (v instanceof Data_Maybe.Just) {
            return v.value0;
        };
        throw new Error("Failed pattern match at PSD3.Data.Graph (line 206, column 3 - line 208, column 24): " + [ v.constructor.name ]);
    };
};
var getLinksFrom = function (nodeId) {
    return function (model) {
        var v = lookup(nodeId)(model.maps.linksBySource);
        if (v instanceof Data_Maybe.Nothing) {
            return [  ];
        };
        if (v instanceof Data_Maybe.Just) {
            return v.value0;
        };
        throw new Error("Failed pattern match at PSD3.Data.Graph (line 196, column 3 - line 198, column 24): " + [ v.constructor.name ]);
    };
};
var toDataGraph = function (config) {
    return function (model) {
        var buildEntry = function (node) {
            var nodeId = config.getNodeId(node);
            var links = getLinksFrom(nodeId)(model);
            var targets = fromFoldable(map(config.getLinkTarget)(links));
            return new Data_Tuple.Tuple(nodeId, new Data_Tuple.Tuple(node, targets));
        };
        var entries = map(buildEntry)(model.nodes);
        var graphMap = fromFoldable1(entries);
        return Data_Graph.fromMap(graphMap);
    };
};
var getAllNodes = function (v) {
    return v.nodes;
};
var getAllLinks = function (v) {
    return v.links;
};
var emptyGraphModel = {
    nodes: [  ],
    links: [  ],
    maps: {
        nodeById: Data_Map_Internal.empty,
        linksBySource: Data_Map_Internal.empty,
        linksByTarget: Data_Map_Internal.empty,
        nodeIds: Data_Set.empty
    }
};
var buildGraphModel = function (config) {
    return function (nodes) {
        return function (links) {
            var addToArray = function (v) {
                return function (v1) {
                    if (v1 instanceof Data_Maybe.Nothing) {
                        return new Data_Maybe.Just([ v ]);
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        return new Data_Maybe.Just(append(v1.value0)([ v ]));
                    };
                    throw new Error("Failed pattern match at PSD3.Data.Graph (line 112, column 5 - line 112, column 68): " + [ v.constructor.name, v1.constructor.name ]);
                };
            };
            var nodeIds = fromFoldable2(map(config.getNodeId)(nodes));
            var nodeById = fromFoldable1(map(function (n) {
                return new Data_Tuple.Tuple(config.getNodeId(n), n);
            })(nodes));
            var linksByTarget = Data_Array.foldl(function (acc) {
                return function (link) {
                    var targetId = config.getLinkTarget(link);
                    return alter(addToArray(link))(targetId)(acc);
                };
            })(Data_Map_Internal.empty)(links);
            var linksBySource = Data_Array.foldl(function (acc) {
                return function (link) {
                    var sourceId = config.getLinkSource(link);
                    return alter(addToArray(link))(sourceId)(acc);
                };
            })(Data_Map_Internal.empty)(links);
            var maps = {
                nodeById: nodeById,
                linksBySource: linksBySource,
                linksByTarget: linksByTarget,
                nodeIds: nodeIds
            };
            return {
                nodes: nodes,
                links: links,
                maps: maps
            };
        };
    };
};
var addNode = function (config) {
    return function (node) {
        return function (model) {
            var nodeId = config.getNodeId(node);
            var newNodes = append(model.nodes)([ node ]);
            var newMaps = {
                linksBySource: model.maps.linksBySource,
                linksByTarget: model.maps.linksByTarget,
                nodeById: insert(nodeId)(node)(model.maps.nodeById),
                nodeIds: insert1(nodeId)(model.maps.nodeIds)
            };
            return {
                links: model.links,
                nodes: newNodes,
                maps: newMaps
            };
        };
    };
};
var addLink = function (config) {
    return function (link) {
        return function (model) {
            var addToArray = function (v) {
                return function (v1) {
                    if (v1 instanceof Data_Maybe.Nothing) {
                        return new Data_Maybe.Just([ v ]);
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        return new Data_Maybe.Just(append(v1.value0)([ v ]));
                    };
                    throw new Error("Failed pattern match at PSD3.Data.Graph (line 170, column 5 - line 170, column 68): " + [ v.constructor.name, v1.constructor.name ]);
                };
            };
            var targetId = config.getLinkTarget(link);
            var sourceId = config.getLinkSource(link);
            var newLinksByTarget = alter(addToArray(link))(targetId)(model.maps.linksByTarget);
            var newLinksBySource = alter(addToArray(link))(sourceId)(model.maps.linksBySource);
            var newMaps = {
                nodeById: model.maps.nodeById,
                nodeIds: model.maps.nodeIds,
                linksBySource: newLinksBySource,
                linksByTarget: newLinksByTarget
            };
            var newLinks = append(model.links)([ link ]);
            return {
                nodes: model.nodes,
                links: newLinks,
                maps: newMaps
            };
        };
    };
};
export {
    buildGraphModel,
    emptyGraphModel,
    addNode,
    addLink,
    getNode,
    getNodesByIds,
    getLinksFrom,
    getLinksTo,
    getAllNodes,
    getAllLinks,
    toDataGraph
};
//# sourceMappingURL=index.js.map
