// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Nullable from "../Data.Nullable/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect from "../Effect/index.js";
import * as Effect_Console from "../Effect.Console/index.js";
import * as Effect_Ref from "../Effect.Ref/index.js";
import * as PSD3_ForceEngine_Core from "../PSD3.ForceEngine.Core/index.js";
import * as PSD3_ForceEngine_Simulation from "../PSD3.ForceEngine.Simulation/index.js";
import * as PSD3_ForceEngine_Types from "../PSD3.ForceEngine.Types/index.js";
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var div = /* #__PURE__ */ Data_EuclideanRing.div(Data_EuclideanRing.euclideanRingInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var when = /* #__PURE__ */ Control_Applicative.when(Effect.applicativeEffect);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var createNodes = function (count) {
    var makeNode = function (i) {
        return {
            id: i,
            x: Data_Int.toNumber(mod(i)(5)) * 50.0 - 100.0,
            y: Data_Int.toNumber(div(i)(5)) * 50.0 - 100.0,
            vx: 0.0,
            vy: 0.0,
            fx: Data_Nullable["null"],
            fy: Data_Nullable["null"],
            index: i
        };
    };
    return map(makeNode)(Data_Array.range(0)(count - 1 | 0));
};
var createLinks = function (nodeCount) {
    var makeLink = function (i) {
        return {
            source: i,
            target: i + 1 | 0
        };
    };
    return map(makeLink)(Data_Array.range(0)(nodeCount - 2 | 0));
};
var runDemo = function __do() {
    Effect_Console.log("[ForceEngine Demo] Starting...")();
    var nodes = createNodes(10);
    var links = createLinks(10);
    var stateRef = Effect_Ref["new"]({
        nodes: nodes,
        links: links,
        tickCount: 0
    })();
    var sim = PSD3_ForceEngine_Simulation.create(PSD3_ForceEngine_Simulation.defaultConfig)();
    PSD3_ForceEngine_Simulation.setNodes(nodes)(sim)();
    PSD3_ForceEngine_Simulation.setLinks(links)(sim)();
    PSD3_ForceEngine_Simulation.addForce(new PSD3_ForceEngine_Types.ManyBody("charge", {
        theta: PSD3_ForceEngine_Types.defaultManyBody.theta,
        distanceMin: PSD3_ForceEngine_Types.defaultManyBody.distanceMin,
        distanceMax: PSD3_ForceEngine_Types.defaultManyBody.distanceMax,
        strength: -50.0
    }))(sim)();
    PSD3_ForceEngine_Simulation.addForce(new PSD3_ForceEngine_Types.Collide("collide", {
        strength: PSD3_ForceEngine_Types.defaultCollide.strength,
        iterations: PSD3_ForceEngine_Types.defaultCollide.iterations,
        radius: 20.0
    }))(sim)();
    PSD3_ForceEngine_Simulation.addForce(new PSD3_ForceEngine_Types.Link("links", {
        strength: PSD3_ForceEngine_Types.defaultLink.strength,
        iterations: PSD3_ForceEngine_Types.defaultLink.iterations,
        distance: 50.0
    }))(sim)();
    PSD3_ForceEngine_Simulation.addForce(new PSD3_ForceEngine_Types.Center("center", PSD3_ForceEngine_Types.defaultCenter))(sim)();
    PSD3_ForceEngine_Simulation.onTick(function __do() {
        var currentNodes = PSD3_ForceEngine_Simulation.getNodes(sim)();
        var alpha = PSD3_ForceEngine_Simulation.getAlpha(sim)();
        Effect_Ref.modify_(function (s) {
            return {
                links: s.links,
                nodes: currentNodes,
                tickCount: s.tickCount + 1 | 0
            };
        })(stateRef)();
        var state = Effect_Ref.read(stateRef)();
        return when(mod(state.tickCount)(50) === 0)(function __do() {
            Effect_Console.log("[ForceEngine Demo] Tick " + (show(state.tickCount) + (", alpha=" + show1(alpha))))();
            return PSD3_ForceEngine_Core.logNodes("Nodes")(currentNodes)();
        })();
    })(sim)();
    Effect_Console.log("[ForceEngine Demo] Starting simulation...")();
    PSD3_ForceEngine_Simulation.start(sim)();
    return stateRef;
};
export {
    runDemo
};
//# sourceMappingURL=index.js.map
