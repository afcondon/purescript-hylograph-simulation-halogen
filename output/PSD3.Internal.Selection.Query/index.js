// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Category from "../Control.Category/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_List_Types from "../Data.List.Types/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Traversable from "../Data.Traversable/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as Effect from "../Effect/index.js";
import * as PSD3_Internal_Selection_Types from "../PSD3.Internal.Selection.Types/index.js";
import * as Unsafe_Reference from "../Unsafe.Reference/index.js";
import * as Web_DOM_DOMTokenList from "../Web.DOM.DOMTokenList/index.js";
import * as Web_DOM_Element from "../Web.DOM.Element/index.js";
import * as Web_DOM_Node from "../Web.DOM.Node/index.js";
import * as Web_DOM_NodeList from "../Web.DOM.NodeList/index.js";
import * as Web_DOM_ParentNode from "../Web.DOM.ParentNode/index.js";
import * as Web_HTML from "../Web.HTML/index.js";
import * as Web_HTML_HTMLDocument from "../Web.HTML.HTMLDocument/index.js";
import * as Web_HTML_Window from "../Web.HTML.Window/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Effect.bindEffect);
var traverse = /* #__PURE__ */ Data_Traversable.traverse(Data_Traversable.traversableArray)(Effect.applicativeEffect);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect.applicativeEffect);
var identity = /* #__PURE__ */ Control_Category.identity(Control_Category.categoryFn);
var mapFlipped = /* #__PURE__ */ Data_Functor.mapFlipped(Effect.functorEffect);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var filterA = /* #__PURE__ */ Data_Array.filterA(Effect.applicativeEffect);
var eq = /* #__PURE__ */ Data_Eq.eq(/* #__PURE__ */ Data_Maybe.eqMaybe(Data_Eq.eqString));
var mapFlipped1 = /* #__PURE__ */ Data_Functor.mapFlipped(Data_Maybe.functorMaybe);
var composeKleisliFlipped = /* #__PURE__ */ Control_Bind.composeKleisliFlipped(Data_Maybe.bindMaybe);
var fromFoldable = /* #__PURE__ */ Data_Array.fromFoldable(Data_List_Types.foldableList);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Ord.ordString);
var bind1 = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var querySelectorFirstElement = function (selector) {
    return function (parents) {
        var tryParent = function (parent) {
            var parentNode = Web_DOM_Element.toParentNode(parent);
            return Web_DOM_ParentNode.querySelector(selector)(parentNode);
        };
        return function __do() {
            var results = traverse(tryParent)(parents)();
            return Data_Array.head(Data_Array.mapMaybe(identity)(results));
        };
    };
};
var querySelectorAllElements = function (selector) {
    return function (parents) {
        return function __do() {
            var nodeArrays = traverse(function (parent) {
                var parentNode = Web_DOM_Element.toParentNode(parent);
                return function __do() {
                    var nodeList = Web_DOM_ParentNode.querySelectorAll(selector)(parentNode)();
                    var nodes = Web_DOM_NodeList.toArray(nodeList)();
                    return Data_Array.mapMaybe(Web_DOM_Element.fromNode)(nodes);
                };
            })(parents)();
            return Data_Array.concat(nodeArrays);
        };
    };
};
var nubElements = function (arr) {
    var go = function ($copy_acc) {
        return function ($copy_remaining) {
            var $tco_var_acc = $copy_acc;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(acc, remaining) {
                var v = Data_Array.uncons(remaining);
                if (v instanceof Data_Maybe.Nothing) {
                    $tco_done = true;
                    return acc;
                };
                if (v instanceof Data_Maybe.Just) {
                    var alreadySeen = Data_Array.any(function (elem) {
                        return Unsafe_Reference.unsafeRefEq(elem)(v.value0.head);
                    })(acc);
                    if (alreadySeen) {
                        $tco_var_acc = acc;
                        $copy_remaining = v.value0.tail;
                        return;
                    };
                    $tco_var_acc = Data_Array.snoc(acc)(v.value0.head);
                    $copy_remaining = v.value0.tail;
                    return;
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 166, column 5 - line 173, column 40): " + [ v.constructor.name ]);
            };
            while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_acc, $copy_remaining);
            };
            return $tco_result;
        };
    };
    return go([  ])(arr);
};
var getElements = function (v) {
    if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
        return v.value0.parentElements;
    };
    if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
        return v.value0.elements;
    };
    if (v instanceof PSD3_Internal_Selection_Types.PendingSelection) {
        return v.value0.parentElements;
    };
    if (v instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
        return v.value0.elements;
    };
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 146, column 46 - line 150, column 35): " + [ v.constructor.name ]);
};
var hasAttribute = function (attrName) {
    return function (selection) {
        var elements = getElements(selection);
        return function __do() {
            var results = traverse(function (element) {
                return mapFlipped(Web_DOM_Element.getAttribute(attrName)(element))(Data_Maybe.isJust);
            })(elements)();
            return Data_Array.any(identity)(results);
        };
    };
};
var hasClass = function (className) {
    return function (selection) {
        var elements = getElements(selection);
        return function __do() {
            var results = traverse(function (element) {
                return function __do() {
                    var classes = Web_DOM_Element.classList(element)();
                    return Web_DOM_DOMTokenList.contains(classes)(className)();
                };
            })(elements)();
            return Data_Array.any(identity)(results);
        };
    };
};
var isEmpty = function (selection) {
    return Data_Array["null"](getElements(selection));
};
var size = function (selection) {
    return Data_Array.length(getElements(selection));
};
var toArray = getElements;
var getDocument = function (v) {
    if (v instanceof PSD3_Internal_Selection_Types.EmptySelection) {
        return pure(v.value0.document);
    };
    if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
        return pure(v.value0.document);
    };
    if (v instanceof PSD3_Internal_Selection_Types.PendingSelection) {
        return pure(v.value0.document);
    };
    if (v instanceof PSD3_Internal_Selection_Types.ExitingSelection) {
        return pure(v.value0.document);
    };
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 154, column 32 - line 158, column 40): " + [ v.constructor.name ]);
};
var findByData = function (predicate) {
    return function (v) {
        var v1 = (function () {
            if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                return v.value0;
            };
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 424, column 75 - line 425, column 28): " + [ v.constructor.name ]);
        })();
        var zipped = Data_Array.zipWith(Data_Tuple.Tuple.create)(v1.elements)(v1.data);
        var maybeMatch = Data_Array.find(function (v2) {
            return predicate(v2.value1);
        })(zipped);
        if (maybeMatch instanceof Data_Maybe.Nothing) {
            return pure(PSD3_Internal_Selection_Types.mkBoundSelection([  ])([  ])(v1.indices)(v1.document));
        };
        if (maybeMatch instanceof Data_Maybe.Just) {
            return pure(PSD3_Internal_Selection_Types.mkBoundSelection([ maybeMatch.value0.value0 ])([ maybeMatch.value0.value1 ])(v1.indices)(v1.document));
        };
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 430, column 3 - line 432, column 86): " + [ maybeMatch.constructor.name ]);
    };
};
var filterByData = function (predicate) {
    return function (v) {
        var v1 = (function () {
            if (v instanceof PSD3_Internal_Selection_Types.BoundSelection) {
                return v.value0;
            };
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 396, column 75 - line 397, column 28): " + [ v.constructor.name ]);
        })();
        var filtered = Data_Array.filter(function (v2) {
            return predicate(v2.value1);
        })(Data_Array.zipWith(Data_Tuple.Tuple.create)(v1.elements)(v1.data));
        var filteredElements = map(function (v2) {
            return v2.value0;
        })(filtered);
        var filteredData = map(function (v2) {
            return v2.value1;
        })(filtered);
        return pure(PSD3_Internal_Selection_Types.mkBoundSelection(filteredElements)(filteredData)(v1.indices)(v1.document));
    };
};
var emptySelectionFromElements = function (elements) {
    return function __do() {
        var doc = mapFlipped(bind(Web_HTML.window)(Web_HTML_Window.document))(Web_HTML_HTMLDocument.toDocument)();
        return new PSD3_Internal_Selection_Types.EmptySelection({
            parentElements: elements,
            document: doc
        });
    };
};
var filterByAttribute = function (attrName) {
    return function (attrValue) {
        return function (selection) {
            var elements = getElements(selection);
            return function __do() {
                var filtered = filterA(function (element) {
                    return function __do() {
                        var maybeValue = Web_DOM_Element.getAttribute(attrName)(element)();
                        return eq(maybeValue)(new Data_Maybe.Just(attrValue));
                    };
                })(elements)();
                return emptySelectionFromElements(filtered)();
            };
        };
    };
};
var filterByClass = function (className) {
    return function (selection) {
        var elements = getElements(selection);
        return function __do() {
            var filtered = filterA(function (element) {
                return function __do() {
                    var classes = Web_DOM_Element.classList(element)();
                    return Web_DOM_DOMTokenList.contains(classes)(className)();
                };
            })(elements)();
            return emptySelectionFromElements(filtered)();
        };
    };
};
var first = function (selection) {
    var elements = getElements(selection);
    return emptySelectionFromElements(Data_Maybe.fromMaybe([  ])(mapFlipped1(Data_Array.head(elements))(Data_Array.singleton)));
};
var intersect = function (sel1) {
    return function (sel2) {
        var elements1 = getElements(sel1);
        var elements2 = getElements(sel2);
        var isInElements2 = function (elem1) {
            return Data_Array.any(function (elem2) {
                return Unsafe_Reference.unsafeRefEq(elem1)(elem2);
            })(elements2);
        };
        var intersection = Data_Array.filter(isInElements2)(elements1);
        return emptySelectionFromElements(intersection);
    };
};
var last = function (selection) {
    var elements = getElements(selection);
    return emptySelectionFromElements(Data_Maybe.fromMaybe([  ])(mapFlipped1(Data_Array.last(elements))(Data_Array.singleton)));
};
var nth = function (index) {
    return function (selection) {
        var elements = getElements(selection);
        return emptySelectionFromElements(Data_Maybe.fromMaybe([  ])(mapFlipped1(Data_Array.index(elements)(index))(Data_Array.singleton)));
    };
};
var parentElements = function (selection) {
    var elements = getElements(selection);
    return function __do() {
        var parents = traverse(function ($91) {
            return Web_DOM_Node.parentNode(Web_DOM_Element.toNode($91));
        })(elements)();
        var uniqueParents = nubElements(Data_Array.mapMaybe(composeKleisliFlipped(Web_DOM_Element.fromNode)(identity))(parents));
        return emptySelectionFromElements(uniqueParents)();
    };
};
var queryAll = function (selector) {
    return function (selectionsMap) {
        var allSelections = fromFoldable(Data_Map_Internal.values(selectionsMap));
        var allElements = Data_Array.concat(map(getElements)(allSelections));
        return function __do() {
            var matches = querySelectorAllElements(selector)(allElements)();
            var uniqueMatches = nubElements(matches);
            return emptySelectionFromElements(uniqueMatches)();
        };
    };
};
var queryFirst = function (name) {
    return function (selector) {
        return function (selectionsMap) {
            var v = lookup(name)(selectionsMap);
            if (v instanceof Data_Maybe.Nothing) {
                return emptySelectionFromElements([  ]);
            };
            if (v instanceof Data_Maybe.Just) {
                var elements = getElements(v.value0);
                return function __do() {
                    var maybeMatch = querySelectorFirstElement(selector)(elements)();
                    return emptySelectionFromElements(Data_Maybe.fromMaybe([  ])(mapFlipped1(maybeMatch)(Data_Array.singleton)))();
                };
            };
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 270, column 3 - line 275, column 81): " + [ v.constructor.name ]);
        };
    };
};
var queryIn = function (name) {
    return function (selector) {
        return function (selectionsMap) {
            var v = lookup(name)(selectionsMap);
            if (v instanceof Data_Maybe.Nothing) {
                return emptySelectionFromElements([  ]);
            };
            if (v instanceof Data_Maybe.Just) {
                var elements = getElements(v.value0);
                return function __do() {
                    var matches = querySelectorAllElements(selector)(elements)();
                    return emptySelectionFromElements(matches)();
                };
            };
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 225, column 3 - line 230, column 41): " + [ v.constructor.name ]);
        };
    };
};
var queryInBound = function (selector) {
    return function (selection) {
        var elements = getElements(selection);
        return function __do() {
            var matches = querySelectorAllElements(selector)(elements)();
            return emptySelectionFromElements(matches)();
        };
    };
};
var siblings = function (selection) {
    var elements = getElements(selection);
    var isOriginal = function (elem) {
        return Data_Array.any(function (orig) {
            return Unsafe_Reference.unsafeRefEq(elem)(orig);
        })(elements);
    };
    return function __do() {
        var siblingArrays = traverse(function (element) {
            return function __do() {
                var maybeParent = Web_DOM_Node.parentNode(Web_DOM_Element.toNode(element))();
                if (maybeParent instanceof Data_Maybe.Nothing) {
                    return [  ];
                };
                if (maybeParent instanceof Data_Maybe.Just) {
                    var nodeList = Web_DOM_Node.childNodes(maybeParent.value0)();
                    var nodes = Web_DOM_NodeList.toArray(nodeList)();
                    return Data_Array.mapMaybe(Web_DOM_Element.fromNode)(nodes);
                };
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 514, column 5 - line 519, column 45): " + [ maybeParent.constructor.name ]);
            };
        })(elements)();
        var allSiblings = Data_Array.concat(siblingArrays);
        var uniqueSiblings = nubElements(allSiblings);
        var filteredSiblings = Data_Array.filter(function ($92) {
            return !isOriginal($92);
        })(uniqueSiblings);
        return emptySelectionFromElements(filteredSiblings)();
    };
};
var union = function (selections) {
    var allElements = Data_Array.concat(map(getElements)(selections));
    var uniqueElements = nubElements(allElements);
    return emptySelectionFromElements(uniqueElements);
};
var difference = function (sel1) {
    return function (sel2) {
        var elements1 = getElements(sel1);
        var elements2 = getElements(sel2);
        var isInElements2 = function (elem1) {
            return Data_Array.any(function (elem2) {
                return Unsafe_Reference.unsafeRefEq(elem1)(elem2);
            })(elements2);
        };
        var diff = Data_Array.filter(function ($93) {
            return !isInElements2($93);
        })(elements1);
        return emptySelectionFromElements(diff);
    };
};
var descendants = function (selector) {
    return function (selection) {
        var elements = getElements(selection);
        return function __do() {
            var matches = querySelectorAllElements(selector)(elements)();
            return emptySelectionFromElements(matches)();
        };
    };
};
var children = function (selection) {
    var elements = getElements(selection);
    return function __do() {
        var childArrays = traverse(function (element) {
            return function __do() {
                var nodeList = Web_DOM_Node.childNodes(Web_DOM_Element.toNode(element))();
                var nodes = Web_DOM_NodeList.toArray(nodeList)();
                return Data_Array.mapMaybe(Web_DOM_Element.fromNode)(nodes);
            };
        })(elements)();
        return emptySelectionFromElements(Data_Array.concat(childArrays))();
    };
};
var ancestors = function (selection) {
    var elements = getElements(selection);
    return function __do() {
        var ancestorArrays = traverse(function (element) {
            var walkUp = function (elem) {
                return function __do() {
                    var maybeParent = Web_DOM_Node.parentNode(Web_DOM_Element.toNode(elem))();
                    var v = bind1(maybeParent)(Web_DOM_Element.fromNode);
                    if (v instanceof Data_Maybe.Nothing) {
                        return [  ];
                    };
                    if (v instanceof Data_Maybe.Just) {
                        var rest = walkUp(v.value0)();
                        return Data_Array.cons(v.value0)(rest);
                    };
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Query (line 550, column 9 - line 554, column 42): " + [ v.constructor.name ]);
                };
            };
            return walkUp(element);
        })(elements)();
        return emptySelectionFromElements(nubElements(Data_Array.concat(ancestorArrays)))();
    };
};
export {
    queryIn,
    queryAll,
    queryFirst,
    queryInBound,
    filterByClass,
    filterByAttribute,
    hasClass,
    hasAttribute,
    filterByData,
    findByData,
    parentElements,
    children,
    descendants,
    siblings,
    ancestors,
    union,
    intersect,
    difference,
    isEmpty,
    size,
    first,
    last,
    nth,
    toArray
};
//# sourceMappingURL=index.js.map
