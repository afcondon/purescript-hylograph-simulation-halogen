// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as DataViz_Layout_Hierarchy_EdgeBundle_Bilink from "../DataViz.Layout.Hierarchy.EdgeBundle.Bilink/index.js";
import * as DataViz_Layout_Hierarchy_EdgeBundle_BundleCurve from "../DataViz.Layout.Hierarchy.EdgeBundle.BundleCurve/index.js";
import * as DataViz_Layout_Hierarchy_EdgeBundle_Hierarchy from "../DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy/index.js";
import * as DataViz_Layout_Hierarchy_EdgeBundle_RadialCluster from "../DataViz.Layout.Hierarchy.EdgeBundle.RadialCluster/index.js";
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var getRadialShortName = function (v) {
    return v.value0.name;
};
var getRadialRadius = function (v) {
    return v.value0.y;
};
var getRadialFullName = function (v) {
    return v.value0.fullName;
};
var getRadialData = function (v) {
    return v.value0.data_;
};
var getRadialChildren = function (v) {
    return v.value0.children;
};
var getRadialAngle = function (v) {
    return v.value0.x;
};
var getAllRadialNodes = function (v) {
    return append([ v ])(Data_Array.concatMap(getAllRadialNodes)(v.value0.children));
};
var getAllBilinkedNodes = function (v) {
    return append([ v ])(Data_Array.concatMap(getAllBilinkedNodes)(v.value0.children));
};
var generateBundledLinks = function (tension) {
    return function (tree) {
        return function (radialTree) {
            return function (bilinked) {
                var radialNodes = getAllRadialNodes(radialTree);
                var allLinks = DataViz_Layout_Hierarchy_EdgeBundle_Bilink.getLinks(bilinked);
                var bundled = Data_Array.mapMaybe(function (v) {
                    var v1 = DataViz_Layout_Hierarchy_EdgeBundle_Hierarchy.findNode(v.target)(tree);
                    var v2 = DataViz_Layout_Hierarchy_EdgeBundle_Hierarchy.findNode(v.source)(tree);
                    if (v2 instanceof Data_Maybe.Just && v1 instanceof Data_Maybe.Just) {
                        var pathNodes = DataViz_Layout_Hierarchy_EdgeBundle_Hierarchy.pathBetween(tree)(v2.value0)(v1.value0);
                        var radialPath = Data_Array.mapMaybe(function (pathNode) {
                            var name = DataViz_Layout_Hierarchy_EdgeBundle_Hierarchy.getFullName(pathNode);
                            return Data_Array.find(function (r) {
                                return getRadialFullName(r) === name;
                            })(radialNodes);
                        })(pathNodes);
                        var radialPoints = map(function (r) {
                            return {
                                angle: getRadialAngle(r),
                                radius: getRadialRadius(r)
                            };
                        })(radialPath);
                        var svgPath = DataViz_Layout_Hierarchy_EdgeBundle_BundleCurve.bundlePathRadial(tension)(radialPoints);
                        return new Data_Maybe.Just({
                            source: v.source,
                            target: v.target,
                            path: svgPath
                        });
                    };
                    return Data_Maybe.Nothing.value;
                })(allLinks);
                return bundled;
            };
        };
    };
};
var extractPositionedNodes = function (bilinked) {
    return function (radial) {
        var allRadial = getAllRadialNodes(radial);
        var allBilinked = getAllBilinkedNodes(bilinked);
        var merged = Data_Array.mapMaybe(function (rNode) {
            var name = getRadialFullName(rNode);
            var maybeBilinked = Data_Array.find(function (b) {
                return DataViz_Layout_Hierarchy_EdgeBundle_Bilink.getBilinkedFullName(b) === name;
            })(allBilinked);
            var cart = DataViz_Layout_Hierarchy_EdgeBundle_RadialCluster.toCartesian(rNode);
            return new Data_Maybe.Just({
                fullName: name,
                shortName: getRadialShortName(rNode),
                x: getRadialAngle(rNode),
                y: getRadialRadius(rNode),
                cartX: cart.x,
                cartY: cart.y,
                data_: getRadialData(rNode),
                isLeaf: Data_Array["null"](getRadialChildren(rNode)),
                outgoingCount: (function () {
                    if (maybeBilinked instanceof Data_Maybe.Just) {
                        return Data_Array.length(DataViz_Layout_Hierarchy_EdgeBundle_Bilink.getOutgoing(maybeBilinked.value0));
                    };
                    if (maybeBilinked instanceof Data_Maybe.Nothing) {
                        return 0;
                    };
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle (line 166, column 32 - line 168, column 31): " + [ maybeBilinked.constructor.name ]);
                })(),
                incomingCount: (function () {
                    if (maybeBilinked instanceof Data_Maybe.Just) {
                        return Data_Array.length(DataViz_Layout_Hierarchy_EdgeBundle_Bilink.getIncoming(maybeBilinked.value0));
                    };
                    if (maybeBilinked instanceof Data_Maybe.Nothing) {
                        return 0;
                    };
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle (line 169, column 32 - line 171, column 31): " + [ maybeBilinked.constructor.name ]);
                })()
            });
        })(allRadial);
        return merged;
    };
};
var edgeBundle = function (config) {
    return function (inputNodes) {
        var tree = DataViz_Layout_Hierarchy_EdgeBundle_Hierarchy.buildHierarchy({
            getName: config.getName
        })(inputNodes);
        var radialConfig = {
            innerRadius: config.innerRadius,
            outerRadius: config.outerRadius,
            startAngle: 0.0,
            endAngle: 2.0 * Data_Number.pi
        };
        var radialTree = DataViz_Layout_Hierarchy_EdgeBundle_RadialCluster.radialCluster(radialConfig)(tree);
        var bilinked = DataViz_Layout_Hierarchy_EdgeBundle_Bilink.bilink(config.getImports)(tree);
        var bundledLinks = generateBundledLinks(config.beta)(tree)(radialTree)(bilinked);
        var positionedNodes = extractPositionedNodes(bilinked)(radialTree);
        return {
            nodes: positionedNodes,
            links: bundledLinks
        };
    };
};
export {
    edgeBundle
};
export {
    BilinkedNode,
    Link,
    allBilinkedLeaves,
    allBilinkedNodes,
    bilink,
    getBilinkedChildren,
    getBilinkedData,
    getBilinkedFullName,
    getIncoming,
    getLinks,
    getOutgoing
} from "../DataViz.Layout.Hierarchy.EdgeBundle.Bilink/index.js";
export {
    beta,
    bundlePath,
    bundlePathCartesian,
    bundlePathRadial
} from "../DataViz.Layout.Hierarchy.EdgeBundle.BundleCurve/index.js";
export {
    TreeNode,
    buildHierarchy,
    descendants,
    findNode,
    getAncestors,
    getFullName,
    getTreeNodeChildren,
    getTreeNodeData,
    getTreeNodeName,
    isLeaf,
    leaves,
    pathBetween
} from "../DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy/index.js";
export {
    RadialNode,
    defaultRadialConfig,
    radialCluster,
    radialClusterFromTree,
    toCartesian
} from "../DataViz.Layout.Hierarchy.EdgeBundle.RadialCluster/index.js";
//# sourceMappingURL=index.js.map
