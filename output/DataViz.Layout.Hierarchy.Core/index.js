// Generated by purs version 0.15.15
import * as Control_Category from "../Control.Category/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as DataViz_Layout_Hierarchy_Types from "../DataViz.Layout.Hierarchy.Types/index.js";
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var maximum = /* #__PURE__ */ Data_Foldable.maximum(Data_Ord.ordInt)(Data_Foldable.foldableArray);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var foldr = /* #__PURE__ */ Data_Foldable.foldr(Data_Foldable.foldableArray);
var identity = /* #__PURE__ */ Control_Category.identity(Control_Category.categoryFn);
var sum = function (v) {
    return function (valueAccessor) {
        var $22 = Data_Array["null"](v.value0.children);
        if ($22) {
            return new DataViz_Layout_Hierarchy_Types.VNode({
                data_: v.value0.data_,
                depth: v.value0.depth,
                height: v.value0.height,
                parent: Data_Maybe.Nothing.value,
                children: [  ],
                value: valueAccessor(v.value0.data_)
            });
        };
        var ownValue = valueAccessor(v.value0.data_);
        var childrenValued = map(function (child) {
            return sum(child)(valueAccessor);
        })(v.value0.children);
        var childrenSum = foldl(function (acc) {
            return function (child) {
                return acc + DataViz_Layout_Hierarchy_Types.getValue(child);
            };
        })(0.0)(childrenValued);
        var totalValue = ownValue + childrenSum;
        return new DataViz_Layout_Hierarchy_Types.VNode({
            data_: v.value0.data_,
            depth: v.value0.depth,
            height: v.value0.height,
            parent: Data_Maybe.Nothing.value,
            children: childrenValued,
            value: totalValue
        });
    };
};
var sortHierarchy = function (comparator) {
    return function (v) {
        var $26 = Data_Array["null"](v.value0.children);
        if ($26) {
            return new DataViz_Layout_Hierarchy_Types.HNode(v.value0);
        };
        var sortedGrandchildren = map(sortHierarchy(comparator))(v.value0.children);
        var sortedChildren = Data_Array.sortBy(comparator)(sortedGrandchildren);
        return new DataViz_Layout_Hierarchy_Types.HNode({
            data_: v.value0.data_,
            depth: v.value0.depth,
            height: v.value0.height,
            parent: v.value0.parent,
            children: sortedChildren
        });
    };
};
var getHeight = function (v) {
    return v.value0.height;
};
var hierarchy = function (rootData) {
    return function (childrenAccessor) {
        var computeHeights = function (v) {
            var $31 = Data_Array["null"](v.value0.children);
            if ($31) {
                return new DataViz_Layout_Hierarchy_Types.HNode({
                    data_: v.value0.data_,
                    depth: v.value0.depth,
                    parent: v.value0.parent,
                    children: v.value0.children,
                    height: 0
                });
            };
            var childrenWithHeights = map(computeHeights)(v.value0.children);
            var childHeights = map(getHeight)(childrenWithHeights);
            var maxChildHeight = Data_Maybe.fromMaybe(0)(maximum(childHeights));
            return new DataViz_Layout_Hierarchy_Types.HNode({
                data_: v.value0.data_,
                depth: v.value0.depth,
                parent: v.value0.parent,
                children: childrenWithHeights,
                height: maxChildHeight + 1 | 0
            });
        };
        var buildNode = function (parentRef) {
            return function (currentDepth) {
                return function (nodeData) {
                    var v = childrenAccessor(nodeData);
                    if (v instanceof Data_Maybe.Nothing) {
                        return new DataViz_Layout_Hierarchy_Types.HNode({
                            data_: nodeData,
                            depth: currentDepth,
                            height: 0,
                            parent: parentRef,
                            children: [  ]
                        });
                    };
                    if (v instanceof Data_Maybe.Just) {
                        var thisNode = new DataViz_Layout_Hierarchy_Types.HNode({
                            data_: nodeData,
                            depth: currentDepth,
                            height: 0,
                            parent: parentRef,
                            children: [  ]
                        });
                        var builtChildren = map(buildNode(new Data_Maybe.Just(thisNode))(currentDepth + 1 | 0))(v.value0);
                        var nodeWithChildren = new DataViz_Layout_Hierarchy_Types.HNode({
                            data_: nodeData,
                            depth: currentDepth,
                            height: 0,
                            parent: parentRef,
                            children: builtChildren
                        });
                        return nodeWithChildren;
                    };
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Core (line 35, column 5 - line 70, column 27): " + [ v.constructor.name ]);
                };
            };
        };
        return computeHeights(buildNode(Data_Maybe.Nothing.value)(0)(rootData));
    };
};
var eachBefore = function (callback) {
    return function (root) {
        var go = function ($copy_stack) {
            return function ($copy_acc) {
                var $tco_var_stack = $copy_stack;
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(stack, acc) {
                    var v = Data_Array.uncons(stack);
                    if (v instanceof Data_Maybe.Nothing) {
                        $tco_done = true;
                        return acc;
                    };
                    if (v instanceof Data_Maybe.Just) {
                        var result = callback(v.value0.head);
                        var newStack = append(Data_Array.reverse(v.value0.head.value0.children))(v.value0.tail);
                        $tco_var_stack = newStack;
                        $copy_acc = Data_Array.snoc(acc)(result);
                        return;
                    };
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Core (line 174, column 18 - line 182, column 44): " + [ v.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($tco_var_stack, $copy_acc);
                };
                return $tco_result;
            };
        };
        return go([ root ])([  ]);
    };
};
var eachAfter = function (callback) {
    return function (v) {
        var thisResult = callback(new DataViz_Layout_Hierarchy_Types.HNode(v.value0));
        var childResults = foldr(function (child) {
            return function (acc) {
                return append(eachAfter(callback)(child))(acc);
            };
        })([  ])(v.value0.children);
        return append(childResults)([ thisResult ]);
    };
};
var descendants = function (root) {
    return eachBefore(identity)(root);
};
var leaves = function (root) {
    return Data_Array.filter(function (node) {
        return Data_Array["null"](DataViz_Layout_Hierarchy_Types.getChildren(node));
    })(descendants(root));
};
var count = function (v) {
    var $44 = Data_Array["null"](v.value0.children);
    if ($44) {
        return new DataViz_Layout_Hierarchy_Types.VNode({
            data_: v.value0.data_,
            depth: v.value0.depth,
            height: v.value0.height,
            parent: Data_Maybe.Nothing.value,
            children: [  ],
            value: 1.0
        });
    };
    var childrenCounted = map(count)(v.value0.children);
    var totalCount = foldl(function (acc) {
        return function (child) {
            return acc + DataViz_Layout_Hierarchy_Types.getValue(child);
        };
    })(0.0)(childrenCounted);
    return new DataViz_Layout_Hierarchy_Types.VNode({
        data_: v.value0.data_,
        depth: v.value0.depth,
        height: v.value0.height,
        parent: Data_Maybe.Nothing.value,
        children: childrenCounted,
        value: totalCount
    });
};
export {
    hierarchy,
    getHeight,
    sum,
    count,
    eachBefore,
    eachAfter,
    descendants,
    leaves,
    sortHierarchy
};
//# sourceMappingURL=index.js.map
