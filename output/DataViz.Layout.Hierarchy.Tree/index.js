// Generated by purs version 0.15.15
import * as Control_Comonad_Cofree from "../Control.Comonad.Cofree/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_List from "../Data.List/index.js";
import * as Data_List_Types from "../Data.List.Types/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semiring from "../Data.Semiring/index.js";
import * as Data_Traversable from "../Data.Traversable/index.js";
import * as Data_Tree from "../Data.Tree/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
var compare = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_List_Types.functorList);
var fromFoldable = /* #__PURE__ */ Data_Array.fromFoldable(Data_List_Types.foldableList);
var fromFoldable1 = /* #__PURE__ */ Data_List.fromFoldable(Data_Foldable.foldableArray);
var add = /* #__PURE__ */ Data_Semiring.add(Data_Semiring.semiringNumber);
var fromFoldable2 = /* #__PURE__ */ Data_Array.fromFoldable(/* #__PURE__ */ Control_Comonad_Cofree.foldableCofree(Data_List_Types.foldableList));
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var maximum = /* #__PURE__ */ Data_Foldable.maximum(Data_Ord.ordNumber)(Data_Foldable.foldableArray);
var minimum = /* #__PURE__ */ Data_Foldable.minimum(Data_Ord.ordNumber)(Data_Foldable.foldableArray);
var maximum1 = /* #__PURE__ */ Data_Foldable.maximum(Data_Ord.ordInt)(Data_Foldable.foldableArray);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Ord.ordInt);
var insert = /* #__PURE__ */ Data_Map_Internal.insert(Data_Ord.ordInt);
var scanl = /* #__PURE__ */ Data_Traversable.scanl(Data_List_Types.traversableList);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var Contours = /* #__PURE__ */ (function () {
    function Contours(value0) {
        this.value0 = value0;
    };
    Contours.create = function (value0) {
        return new Contours(value0);
    };
    return Contours;
})();
var withSeparation = function (sep) {
    return function (config) {
        return {
            size: config.size,
            minSeparation: config.minSeparation,
            layerScale: config.layerScale,
            layerSeparation: config.layerSeparation,
            separation: new Data_Maybe.Just(sep)
        };
    };
};
var withLayerSeparation = function (sep) {
    return function (config) {
        return {
            size: config.size,
            minSeparation: config.minSeparation,
            separation: config.separation,
            layerScale: config.layerScale,
            layerSeparation: new Data_Maybe.Just(sep)
        };
    };
};
var withLayerScale = function (scale) {
    return function (config) {
        return {
            size: config.size,
            minSeparation: config.minSeparation,
            separation: config.separation,
            layerSeparation: config.layerSeparation,
            layerScale: new Data_Maybe.Just(scale)
        };
    };
};
var sortByHeight = function (t) {
    var compareByHeight = function (t1) {
        return function (t2) {
            return compare((Control_Comonad_Cofree.head(t2)).height)((Control_Comonad_Cofree.head(t1)).height);
        };
    };
    var val = Control_Comonad_Cofree.head(t);
    var children = Control_Comonad_Cofree.tail(t);
    var sortedGrandchildren = map(sortByHeight)(children);
    var childArray = fromFoldable(sortedGrandchildren);
    var sortedArray = Data_Array.sortBy(compareByHeight)(childArray);
    var sortedChildrenList = fromFoldable1(sortedArray);
    return Data_Tree.mkTree(val)(sortedChildrenList);
};
var sizedContours = function (width) {
    return new Contours({
        left: new Data_List_Types.Cons(-(width / 2.0), Data_List_Types.Nil.value),
        right: new Data_List_Types.Cons(width / 2.0, Data_List_Types.Nil.value)
    });
};
var singletonContours = /* #__PURE__ */ (function () {
    return new Contours({
        left: new Data_List_Types.Cons(0.0, Data_List_Types.Nil.value),
        right: new Data_List_Types.Cons(0.0, Data_List_Types.Nil.value)
    });
})();
var scanContoursWithBase = function (baseSep) {
    return function (v) {
        return function (v1) {
            var go = function ($copy_v2) {
                return function ($copy_v3) {
                    return function ($copy_v4) {
                        return function ($copy_v5) {
                            return function ($copy_v6) {
                                var $tco_var_v2 = $copy_v2;
                                var $tco_var_v3 = $copy_v3;
                                var $tco_var_v4 = $copy_v4;
                                var $tco_var_v5 = $copy_v5;
                                var $tco_done = false;
                                var $tco_result;
                                function $tco_loop(v2, v3, v4, v5, v6) {
                                    if (v5 instanceof Data_List_Types.Nil && v6 instanceof Data_List_Types.Nil) {
                                        $tco_done = true;
                                        return v2;
                                    };
                                    if (v5 instanceof Data_List_Types.Nil && v6 instanceof Data_List_Types.Cons) {
                                        var actualSep = (v2 + v6.value0) - v3;
                                        var neededSep = (function () {
                                            var $96 = actualSep < baseSep;
                                            if ($96) {
                                                return v2 + (baseSep - actualSep);
                                            };
                                            return v2;
                                        })();
                                        $tco_var_v2 = neededSep;
                                        $tco_var_v3 = v3;
                                        $tco_var_v4 = v6.value0;
                                        $tco_var_v5 = Data_List_Types.Nil.value;
                                        $copy_v6 = v6.value1;
                                        return;
                                    };
                                    if (v5 instanceof Data_List_Types.Cons && v6 instanceof Data_List_Types.Nil) {
                                        var actualSep = (v2 + v4) - v5.value0;
                                        var neededSep = (function () {
                                            var $99 = actualSep < baseSep;
                                            if ($99) {
                                                return v2 + (baseSep - actualSep);
                                            };
                                            return v2;
                                        })();
                                        $tco_var_v2 = neededSep;
                                        $tco_var_v3 = v5.value0;
                                        $tco_var_v4 = v4;
                                        $tco_var_v5 = v5.value1;
                                        $copy_v6 = Data_List_Types.Nil.value;
                                        return;
                                    };
                                    if (v5 instanceof Data_List_Types.Cons && v6 instanceof Data_List_Types.Cons) {
                                        var actualSep = (v2 + v6.value0) - v5.value0;
                                        var neededSep = (function () {
                                            var $102 = actualSep < baseSep;
                                            if ($102) {
                                                return v2 + (baseSep - actualSep);
                                            };
                                            return v2;
                                        })();
                                        $tco_var_v2 = neededSep;
                                        $tco_var_v3 = v5.value0;
                                        $tco_var_v4 = v6.value0;
                                        $tco_var_v5 = v5.value1;
                                        $copy_v6 = v6.value1;
                                        return;
                                    };
                                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 313, column 3 - line 313, column 67): " + [ v2.constructor.name, v3.constructor.name, v4.constructor.name, v5.constructor.name, v6.constructor.name ]);
                                };
                                while (!$tco_done) {
                                    $tco_result = $tco_loop($tco_var_v2, $tco_var_v3, $tco_var_v4, $tco_var_v5, $copy_v6);
                                };
                                return $tco_result;
                            };
                        };
                    };
                };
            };
            return go(baseSep)(0.0)(0.0)(v.value0.right)(v1.value0.left);
        };
    };
};
var scanContours = function (minSep) {
    return function (v) {
        return function (v1) {
            var go = function ($copy_v2) {
                return function ($copy_v3) {
                    return function ($copy_v4) {
                        return function ($copy_v5) {
                            return function ($copy_v6) {
                                var $tco_var_v2 = $copy_v2;
                                var $tco_var_v3 = $copy_v3;
                                var $tco_var_v4 = $copy_v4;
                                var $tco_var_v5 = $copy_v5;
                                var $tco_done = false;
                                var $tco_result;
                                function $tco_loop(v2, v3, v4, v5, v6) {
                                    if (v5 instanceof Data_List_Types.Nil && v6 instanceof Data_List_Types.Nil) {
                                        $tco_done = true;
                                        return v2;
                                    };
                                    if (v5 instanceof Data_List_Types.Nil && v6 instanceof Data_List_Types.Cons) {
                                        var actualSep = (v2 + v6.value0) - v3;
                                        var neededSep = (function () {
                                            var $117 = actualSep < minSep;
                                            if ($117) {
                                                return v2 + (minSep - actualSep);
                                            };
                                            return v2;
                                        })();
                                        $tco_var_v2 = neededSep;
                                        $tco_var_v3 = v3;
                                        $tco_var_v4 = v6.value0;
                                        $tco_var_v5 = Data_List_Types.Nil.value;
                                        $copy_v6 = v6.value1;
                                        return;
                                    };
                                    if (v5 instanceof Data_List_Types.Cons && v6 instanceof Data_List_Types.Nil) {
                                        var actualSep = (v2 + v4) - v5.value0;
                                        var neededSep = (function () {
                                            var $120 = actualSep < minSep;
                                            if ($120) {
                                                return v2 + (minSep - actualSep);
                                            };
                                            return v2;
                                        })();
                                        $tco_var_v2 = neededSep;
                                        $tco_var_v3 = v5.value0;
                                        $tco_var_v4 = v4;
                                        $tco_var_v5 = v5.value1;
                                        $copy_v6 = Data_List_Types.Nil.value;
                                        return;
                                    };
                                    if (v5 instanceof Data_List_Types.Cons && v6 instanceof Data_List_Types.Cons) {
                                        var actualSep = (v2 + v6.value0) - v5.value0;
                                        var neededSep = (function () {
                                            var $123 = actualSep < minSep;
                                            if ($123) {
                                                return v2 + (minSep - actualSep);
                                            };
                                            return v2;
                                        })();
                                        $tco_var_v2 = neededSep;
                                        $tco_var_v3 = v5.value0;
                                        $tco_var_v4 = v6.value0;
                                        $tco_var_v5 = v5.value1;
                                        $copy_v6 = v6.value1;
                                        return;
                                    };
                                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 353, column 3 - line 353, column 67): " + [ v2.constructor.name, v3.constructor.name, v4.constructor.name, v5.constructor.name, v6.constructor.name ]);
                                };
                                while (!$tco_done) {
                                    $tco_result = $tco_loop($tco_var_v2, $tco_var_v3, $tco_var_v4, $tco_var_v5, $copy_v6);
                                };
                                return $tco_result;
                            };
                        };
                    };
                };
            };
            return go(minSep)(0.0)(0.0)(v.value0.right)(v1.value0.left);
        };
    };
};
var scaleToPixelsSized = function (config) {
    return function (_getSize) {
        return function (maxHeights) {
            return function (inputTree) {
                var layerGap = Data_Maybe.fromMaybe(20.0)(config.layerSeparation);
                var allNodes = fromFoldable2(inputTree);
                var allX = map1(function (n) {
                    return n.x;
                })(allNodes);
                var maxX = Data_Maybe.fromMaybe(1.0)(maximum(allX));
                var minX = Data_Maybe.fromMaybe(0.0)(minimum(allX));
                var xRange = (function () {
                    var $130 = maxX - minX === 0.0;
                    if ($130) {
                        return 1.0;
                    };
                    return maxX - minX;
                })();
                var scaleX = function (x) {
                    return ((x - minX) / xRange - 0.5) * config.size.width;
                };
                var maxDepth = Data_Maybe.fromMaybe(0)(maximum1(map1(function (v) {
                    return v.depth;
                })(allNodes)));
                var cumulativeY = Data_Array.foldl(function (acc) {
                    return function (d) {
                        var prevY = Data_Maybe.fromMaybe(0.0)(lookup(d - 1 | 0)(acc));
                        var prevHeight = Data_Maybe.fromMaybe(0.0)(lookup(d - 1 | 0)(maxHeights));
                        var thisY = (function () {
                            var $131 = d === 0;
                            if ($131) {
                                return 0.0;
                            };
                            return prevY + prevHeight + layerGap;
                        })();
                        return insert(d)(thisY)(acc);
                    };
                })(Data_Map_Internal.empty)(Data_Array.range(0)(maxDepth));
                var getY = function (depth) {
                    return Data_Maybe.fromMaybe(0.0)(lookup(depth)(cumulativeY));
                };
                var go = function (tr) {
                    var val = Control_Comonad_Cofree.head(tr);
                    var cs = Control_Comonad_Cofree.tail(tr);
                    return Data_Tree.mkTree((function () {
                        var $132 = {};
                        for (var $133 in val) {
                            if ({}.hasOwnProperty.call(val, $133)) {
                                $132[$133] = val[$133];
                            };
                        };
                        $132.x = scaleX(val.x);
                        $132.y = getY(val.depth);
                        return $132;
                    })())(map(go)(cs));
                };
                return go(inputTree);
            };
        };
    };
};
var scaleToPixels = function (config) {
    return function (inputTree) {
        var layerScaleFn = Data_Maybe.fromMaybe(Data_Int.toNumber)(config.layerScale);
        var allNodes = fromFoldable2(inputTree);
        var allX = map1(function (n) {
            return n.x;
        })(allNodes);
        var maxX = Data_Maybe.fromMaybe(1.0)(maximum(allX));
        var minX = Data_Maybe.fromMaybe(0.0)(minimum(allX));
        var xRange = (function () {
            var $135 = maxX - minX === 0.0;
            if ($135) {
                return 1.0;
            };
            return maxX - minX;
        })();
        var scaleX = function (x) {
            return ((x - minX) / xRange) * config.size.width;
        };
        var scaledDepths = map1(function (n) {
            return layerScaleFn(n.depth);
        })(allNodes);
        var maxScaledDepth = Data_Maybe.fromMaybe(1.0)(maximum(scaledDepths));
        var scaleY = function (depth) {
            if (config.layerSeparation instanceof Data_Maybe.Just) {
                return Data_Int.toNumber(depth) * config.layerSeparation.value0;
            };
            if (config.layerSeparation instanceof Data_Maybe.Nothing) {
                var scaledDepth = layerScaleFn(depth);
                return (scaledDepth / maxScaledDepth) * config.size.height;
            };
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 526, column 20 - line 532, column 63): " + [ config.layerSeparation.constructor.name ]);
        };
        var go = function (tr) {
            var val = Control_Comonad_Cofree.head(tr);
            var cs = Control_Comonad_Cofree.tail(tr);
            return Data_Tree.mkTree((function () {
                var $138 = {};
                for (var $139 in val) {
                    if ({}.hasOwnProperty.call(val, $139)) {
                        $138[$139] = val[$139];
                    };
                };
                $138.x = scaleX(val.x);
                $138.y = scaleY(val.depth);
                return $138;
            })())(map(go)(cs));
        };
        return go(inputTree);
    };
};
var petrify = function (parentX) {
    return function (t) {
        var v = Control_Comonad_Cofree.head(t);
        var nodeY = Data_Int.toNumber(v.value1.depth);
        var nodeX = parentX + v.value0.offset;
        var children = Control_Comonad_Cofree.tail(t);
        var childrenWithCoords = map(petrify(nodeX))(children);
        return Data_Tree.mkTree((function () {
            var $142 = {};
            for (var $143 in v.value1) {
                if ({}.hasOwnProperty.call(v.value1, $143)) {
                    $142[$143] = v["value1"][$143];
                };
            };
            $142.x = nodeX;
            $142.y = nodeY;
            return $142;
        })())(childrenWithCoords);
    };
};
var mergeContoursRight = function (contours) {
    var mergeLevel = function (cs) {
        var currentLevels = Data_Array.mapMaybe(function (c) {
            if (c instanceof Data_List_Types.Cons) {
                return new Data_Maybe.Just(c.value0);
            };
            if (c instanceof Data_List_Types.Nil) {
                return Data_Maybe.Nothing.value;
            };
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 458, column 17 - line 460, column 27): " + [ c.constructor.name ]);
        })(cs);
        var v = Data_Array.head(currentLevels);
        if (v instanceof Data_Maybe.Nothing) {
            return Data_List_Types.Nil.value;
        };
        if (v instanceof Data_Maybe.Just) {
            var restContours = Data_Array.mapMaybe(function (c) {
                if (c instanceof Data_List_Types.Cons) {
                    return new Data_Maybe.Just(c.value1);
                };
                if (c instanceof Data_List_Types.Nil) {
                    return Data_Maybe.Nothing.value;
                };
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 471, column 23 - line 473, column 33): " + [ c.constructor.name ]);
            })(cs);
            var maxVal = Data_Maybe.fromMaybe(0.0)(maximum(currentLevels));
            return new Data_List_Types.Cons(maxVal, mergeLevel(restContours));
        };
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 464, column 7 - line 477, column 50): " + [ v.constructor.name ]);
    };
    if (contours.length === 0) {
        return Data_List_Types.Nil.value;
    };
    return mergeLevel(contours);
};
var mergeContoursLeft = function (contours) {
    var mergeLevel = function (cs) {
        var currentLevels = Data_Array.mapMaybe(function (c) {
            if (c instanceof Data_List_Types.Cons) {
                return new Data_Maybe.Just(c.value0);
            };
            if (c instanceof Data_List_Types.Nil) {
                return Data_Maybe.Nothing.value;
            };
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 425, column 17 - line 427, column 27): " + [ c.constructor.name ]);
        })(cs);
        var v = Data_Array.head(currentLevels);
        if (v instanceof Data_Maybe.Nothing) {
            return Data_List_Types.Nil.value;
        };
        if (v instanceof Data_Maybe.Just) {
            var restContours = Data_Array.mapMaybe(function (c) {
                if (c instanceof Data_List_Types.Cons) {
                    return new Data_Maybe.Just(c.value1);
                };
                if (c instanceof Data_List_Types.Nil) {
                    return Data_Maybe.Nothing.value;
                };
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 438, column 23 - line 440, column 33): " + [ c.constructor.name ]);
            })(cs);
            var minVal = Data_Maybe.fromMaybe(0.0)(minimum(currentLevels));
            return new Data_List_Types.Cons(minVal, mergeLevel(restContours));
        };
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 431, column 7 - line 444, column 50): " + [ v.constructor.name ]);
    };
    if (contours.length === 0) {
        return Data_List_Types.Nil.value;
    };
    return mergeLevel(contours);
};
var spliceContours = function (offsets) {
    return function (contours) {
        var v = fromFoldable(Data_List.zipWith(Data_Tuple.Tuple.create)(offsets)(contours));
        if (v.length === 0) {
            return singletonContours;
        };
        if (v.length === 1) {
            return new Contours({
                left: new Data_List_Types.Cons(0.0, map(function (x) {
                    return x + v[0].value0;
                })(v[0].value1.value0.left)),
                right: new Data_List_Types.Cons(0.0, map(function (x) {
                    return x + v[0].value0;
                })(v[0].value1.value0.right))
            });
        };
        var shiftedContours = map1(function (v1) {
            return new Contours({
                left: map(function (x) {
                    return x + v1.value0;
                })(v1.value1.value0.left),
                right: map(function (x) {
                    return x + v1.value0;
                })(v1.value1.value0.right)
            });
        })(v);
        var mergedRight = mergeContoursRight(map1(function (v1) {
            return v1.value0.right;
        })(shiftedContours));
        var mergedLeft = mergeContoursLeft(map1(function (v1) {
            return v1.value0.left;
        })(shiftedContours));
        return new Contours({
            left: new Data_List_Types.Cons(0.0, mergedLeft),
            right: new Data_List_Types.Cons(0.0, mergedRight)
        });
    };
};
var spliceContoursSized = function (parentWidth) {
    return function (offsets) {
        return function (contours) {
            var v = fromFoldable(Data_List.zipWith(Data_Tuple.Tuple.create)(offsets)(contours));
            if (v.length === 0) {
                return sizedContours(parentWidth);
            };
            if (v.length === 1) {
                return new Contours({
                    left: new Data_List_Types.Cons(-(parentWidth / 2.0), map(function (x) {
                        return x + v[0].value0;
                    })(v[0].value1.value0.left)),
                    right: new Data_List_Types.Cons(parentWidth / 2.0, map(function (x) {
                        return x + v[0].value0;
                    })(v[0].value1.value0.right))
                });
            };
            var shiftedContours = map1(function (v1) {
                return new Contours({
                    left: map(function (x) {
                        return x + v1.value0;
                    })(v1.value1.value0.left),
                    right: map(function (x) {
                        return x + v1.value0;
                    })(v1.value1.value0.right)
                });
            })(v);
            var mergedRight = mergeContoursRight(map1(function (v1) {
                return v1.value0.right;
            })(shiftedContours));
            var mergedLeft = mergeContoursLeft(map1(function (v1) {
                return v1.value0.left;
            })(shiftedContours));
            return new Contours({
                left: new Data_List_Types.Cons(-(parentWidth / 2.0), mergedLeft),
                right: new Data_List_Types.Cons(parentWidth / 2.0, mergedRight)
            });
        };
    };
};
var getRootData = function (t) {
    var v = Control_Comonad_Cofree.head(t);
    return v.value1;
};
var defaultTreeConfig = /* #__PURE__ */ (function () {
    return {
        size: {
            width: 800.0,
            height: 600.0
        },
        minSeparation: 1.0,
        separation: Data_Maybe.Nothing.value,
        layerScale: Data_Maybe.Nothing.value,
        layerSeparation: Data_Maybe.Nothing.value
    };
})();
var computeSeparationsWithBase = function (baseSeps) {
    return function (contours) {
        var tailSafe = function (v) {
            if (v instanceof Data_List_Types.Nil) {
                return Data_List_Types.Nil.value;
            };
            if (v instanceof Data_List_Types.Cons) {
                return v.value1;
            };
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 301, column 3 - line 301, column 41): " + [ v.constructor.name ]);
        };
        var applyBase = function (base) {
            return function (v) {
                return scanContoursWithBase(base)(v.value0)(v.value1);
            };
        };
        var v = new Data_Tuple.Tuple(baseSeps, contours);
        if (v.value0 instanceof Data_List_Types.Nil) {
            return Data_List_Types.Nil.value;
        };
        if (v.value1 instanceof Data_List_Types.Nil) {
            return Data_List_Types.Nil.value;
        };
        if (v.value1 instanceof Data_List_Types.Cons && v.value1.value1 instanceof Data_List_Types.Nil) {
            return Data_List_Types.Nil.value;
        };
        var contourPairs = Data_List.zipWith(Data_Tuple.Tuple.create)(contours)(tailSafe(contours));
        return Data_List.zipWith(applyBase)(baseSeps)(contourPairs);
    };
};
var computeSeparationsSized = function (minSep) {
    return function (contours) {
        var tailList = function (v) {
            if (v instanceof Data_List_Types.Nil) {
                return Data_List_Types.Nil.value;
            };
            if (v instanceof Data_List_Types.Cons) {
                return v.value1;
            };
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 721, column 3 - line 721, column 41): " + [ v.constructor.name ]);
        };
        var scanContoursSized = function (gap) {
            return function (v) {
                var go = function ($copy_v1) {
                    return function ($copy_v2) {
                        return function ($copy_v3) {
                            return function ($copy_v4) {
                                return function ($copy_v5) {
                                    var $tco_var_v1 = $copy_v1;
                                    var $tco_var_v2 = $copy_v2;
                                    var $tco_var_v3 = $copy_v3;
                                    var $tco_var_v4 = $copy_v4;
                                    var $tco_done = false;
                                    var $tco_result;
                                    function $tco_loop(v1, v2, v3, v4, v5) {
                                        if (v4 instanceof Data_List_Types.Nil && v5 instanceof Data_List_Types.Nil) {
                                            $tco_done = true;
                                            return v1;
                                        };
                                        if (v4 instanceof Data_List_Types.Nil && v5 instanceof Data_List_Types.Cons) {
                                            var actualSep = (v1 + v5.value0) - v2;
                                            var neededSep = (function () {
                                                var $220 = actualSep < gap;
                                                if ($220) {
                                                    return v1 + (gap - actualSep);
                                                };
                                                return v1;
                                            })();
                                            $tco_var_v1 = neededSep;
                                            $tco_var_v2 = v2;
                                            $tco_var_v3 = v5.value0;
                                            $tco_var_v4 = Data_List_Types.Nil.value;
                                            $copy_v5 = v5.value1;
                                            return;
                                        };
                                        if (v4 instanceof Data_List_Types.Cons && v5 instanceof Data_List_Types.Nil) {
                                            var actualSep = (v1 + v3) - v4.value0;
                                            var neededSep = (function () {
                                                var $223 = actualSep < gap;
                                                if ($223) {
                                                    return v1 + (gap - actualSep);
                                                };
                                                return v1;
                                            })();
                                            $tco_var_v1 = neededSep;
                                            $tco_var_v2 = v4.value0;
                                            $tco_var_v3 = v3;
                                            $tco_var_v4 = v4.value1;
                                            $copy_v5 = Data_List_Types.Nil.value;
                                            return;
                                        };
                                        if (v4 instanceof Data_List_Types.Cons && v5 instanceof Data_List_Types.Cons) {
                                            var actualSep = (v1 + v5.value0) - v4.value0;
                                            var neededSep = (function () {
                                                var $226 = actualSep < gap;
                                                if ($226) {
                                                    return v1 + (gap - actualSep);
                                                };
                                                return v1;
                                            })();
                                            $tco_var_v1 = neededSep;
                                            $tco_var_v2 = v4.value0;
                                            $tco_var_v3 = v5.value0;
                                            $tco_var_v4 = v4.value1;
                                            $copy_v5 = v5.value1;
                                            return;
                                        };
                                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 729, column 5 - line 729, column 69): " + [ v1.constructor.name, v2.constructor.name, v3.constructor.name, v4.constructor.name, v5.constructor.name ]);
                                    };
                                    while (!$tco_done) {
                                        $tco_result = $tco_loop($tco_var_v1, $tco_var_v2, $tco_var_v3, $tco_var_v4, $copy_v5);
                                    };
                                    return $tco_result;
                                };
                            };
                        };
                    };
                };
                return go(gap)(0.0)(0.0)(v.value0.value0.right)(v.value1.value0.left);
            };
        };
        if (contours instanceof Data_List_Types.Nil) {
            return Data_List_Types.Nil.value;
        };
        if (contours instanceof Data_List_Types.Cons && contours.value1 instanceof Data_List_Types.Nil) {
            return Data_List_Types.Nil.value;
        };
        var contourPairs = Data_List.zipWith(Data_Tuple.Tuple.create)(contours)(tailList(contours));
        return map(scanContoursSized(minSep))(contourPairs);
    };
};
var renderSized = function (minSep) {
    return function (getSize) {
        return function (inputTree) {
            var updateOffsetSized = function (tr) {
                return function (newOffset) {
                    var v = Control_Comonad_Cofree.head(tr);
                    var cs = Control_Comonad_Cofree.tail(tr);
                    return Data_Tree.mkTree(new Data_Tuple.Tuple({
                        offset: newOffset
                    }, v.value1))(cs);
                };
            };
            var renderWithContours = function (t) {
                var val = Control_Comonad_Cofree.head(t);
                var size = getSize(val);
                var children = Control_Comonad_Cofree.tail(t);
                var childCount = Data_List.length(children);
                if (childCount === 0) {
                    return new Data_Tuple.Tuple(Data_Tree.mkTree(new Data_Tuple.Tuple({
                        offset: 0.0
                    }, val))(Data_List_Types.Nil.value), sizedContours(size.width));
                };
                var childResults = map(renderWithContours)(children);
                var childTrees = map(function (v) {
                    return v.value0;
                })(childResults);
                var childContours = map(function (v) {
                    return v.value1;
                })(childResults);
                var separations = computeSeparationsSized(minSep)(childContours);
                var childAbsoluteOffsets = new Data_List_Types.Cons(0.0, scanl(add)(0.0)(separations));
                var leftmostOffset = Data_Maybe.fromMaybe(0.0)(Data_Array.head(fromFoldable(childAbsoluteOffsets)));
                var rightmostOffset = Data_Maybe.fromMaybe(0.0)(Data_Array.last(fromFoldable(childAbsoluteOffsets)));
                var parentOffset = (leftmostOffset + rightmostOffset) / 2.0;
                var childRelativeOffsets = map(function (absOffset) {
                    return absOffset - parentOffset;
                })(childAbsoluteOffsets);
                var childrenWithOffsets = Data_List.zipWith(updateOffsetSized)(childTrees)(childRelativeOffsets);
                var parentContours = spliceContoursSized(size.width)(childRelativeOffsets)(childContours);
                var resultTree = Data_Tree.mkTree(new Data_Tuple.Tuple({
                    offset: parentOffset
                }, val))(childrenWithOffsets);
                return new Data_Tuple.Tuple(resultTree, parentContours);
            };
            var v = renderWithContours(inputTree);
            return v.value0;
        };
    };
};
var computeMaxHeights = function (getSize) {
    return function (t) {
        var go = function (acc) {
            return function (subtree) {
                var val = Control_Comonad_Cofree.head(subtree);
                var size = getSize(val);
                var currentMax = Data_Maybe.fromMaybe(0.0)(lookup(val.depth)(acc));
                var newMax = max(currentMax)(size.height);
                var updatedAcc = insert(val.depth)(newMax)(acc);
                var children = Control_Comonad_Cofree.tail(subtree);
                return Data_Array.foldl(go)(updatedAcc)(fromFoldable(children));
            };
        };
        return go(Data_Map_Internal.empty)(t);
    };
};
var computeBaseSeparations = function (minSep) {
    return function (separationFn) {
        return function (nodes) {
            var tailSafe = function (v) {
                if (v instanceof Data_List_Types.Nil) {
                    return Data_List_Types.Nil.value;
                };
                if (v instanceof Data_List_Types.Cons) {
                    return v.value1;
                };
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 279, column 3 - line 279, column 41): " + [ v.constructor.name ]);
            };
            var getSep = function (v) {
                return function (v1) {
                    return function (v2) {
                        return function (v3) {
                            if (v instanceof Data_Maybe.Nothing) {
                                return v1;
                            };
                            if (v instanceof Data_Maybe.Just) {
                                return v.value0(v2)(v3) + v1;
                            };
                            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 275, column 3 - line 275, column 67): " + [ v.constructor.name, v1.constructor.name, v2.constructor.name, v3.constructor.name ]);
                        };
                    };
                };
            };
            if (nodes instanceof Data_List_Types.Nil) {
                return Data_List_Types.Nil.value;
            };
            if (nodes instanceof Data_List_Types.Cons && nodes.value1 instanceof Data_List_Types.Nil) {
                return Data_List_Types.Nil.value;
            };
            return Data_List.zipWith(getSep(separationFn)(minSep))(nodes)(tailSafe(nodes));
        };
    };
};
var render = function (minSep) {
    return function (separationFn) {
        return function (inputTree) {
            var updateOffset = function (tr) {
                return function (newOffset) {
                    var v = Control_Comonad_Cofree.head(tr);
                    var children = Control_Comonad_Cofree.tail(tr);
                    return Data_Tree.mkTree(new Data_Tuple.Tuple({
                        offset: newOffset
                    }, v.value1))(children);
                };
            };
            var renderWithContours = function (t) {
                var val = Control_Comonad_Cofree.head(t);
                var children = Control_Comonad_Cofree.tail(t);
                var childCount = Data_List.length(children);
                if (childCount === 0) {
                    return new Data_Tuple.Tuple(Data_Tree.mkTree(new Data_Tuple.Tuple({
                        offset: 0.0
                    }, val))(Data_List_Types.Nil.value), singletonContours);
                };
                var childResults = map(renderWithContours)(children);
                var childTrees = map(function (v) {
                    return v.value0;
                })(childResults);
                var childRootData = map(getRootData)(childTrees);
                var childContours = map(function (v) {
                    return v.value1;
                })(childResults);
                var baseSeparations = computeBaseSeparations(minSep)(separationFn)(childRootData);
                var separations = computeSeparationsWithBase(baseSeparations)(childContours);
                var childAbsoluteOffsets = new Data_List_Types.Cons(0.0, scanl(add)(0.0)(separations));
                var leftmostOffset = Data_Maybe.fromMaybe(0.0)(Data_Array.head(fromFoldable(childAbsoluteOffsets)));
                var rightmostOffset = Data_Maybe.fromMaybe(0.0)(Data_Array.last(fromFoldable(childAbsoluteOffsets)));
                var parentOffset = (leftmostOffset + rightmostOffset) / 2.0;
                var childRelativeOffsets = map(function (absOffset) {
                    return absOffset - parentOffset;
                })(childAbsoluteOffsets);
                var childrenWithOffsets = Data_List.zipWith(updateOffset)(childTrees)(childRelativeOffsets);
                var parentContours = spliceContours(childRelativeOffsets)(childContours);
                var resultTree = Data_Tree.mkTree(new Data_Tuple.Tuple({
                    offset: parentOffset
                }, val))(childrenWithOffsets);
                return new Data_Tuple.Tuple(resultTree, parentContours);
            };
            var v = renderWithContours(inputTree);
            return v.value0;
        };
    };
};
var addHeightField = function (t) {
    var val = Control_Comonad_Cofree.head(t);
    var children = Control_Comonad_Cofree.tail(t);
    var childrenWithHeight = map(addHeightField)(children);
    var nodeHeight = (function () {
        var v = fromFoldable(childrenWithHeight);
        if (v.length === 0) {
            return 0;
        };
        var childHeights = map1(function (c) {
            return (Control_Comonad_Cofree.head(c)).height;
        })(v);
        var maxChildHeight = Data_Maybe.fromMaybe(0)(maximum1(childHeights));
        return maxChildHeight + 1 | 0;
    })();
    return Data_Tree.mkTree((function () {
        var $276 = {};
        for (var $277 in val) {
            if ({}.hasOwnProperty.call(val, $277)) {
                $276[$277] = val[$277];
            };
        };
        $276.height = nodeHeight;
        return $276;
    })())(childrenWithHeight);
};
var addDepth = function (currentDepth) {
    return function (t) {
        var val = Control_Comonad_Cofree.head(t);
        var children = Control_Comonad_Cofree.tail(t);
        return Data_Tree.mkTree((function () {
            var $279 = {};
            for (var $280 in val) {
                if ({}.hasOwnProperty.call(val, $280)) {
                    $279[$280] = val[$280];
                };
            };
            $279.depth = currentDepth;
            return $279;
        })())(map(addDepth(currentDepth + 1 | 0))(children));
    };
};
var tree = function (config) {
    return function (inputTree) {
        var withDepth = addDepth(0)(inputTree);
        var rendered = render(config.minSeparation)(config.separation)(withDepth);
        var withCoords = petrify(0.0)(rendered);
        var scaled = scaleToPixels(config)(withCoords);
        return scaled;
    };
};
var treeSized = function (config) {
    return function (getSize) {
        return function (inputTree) {
            var withDepth = addDepth(0)(inputTree);
            var rendered = renderSized(config.minSeparation)(getSize)(withDepth);
            var withCoords = petrify(0.0)(rendered);
            var maxHeights = computeMaxHeights(getSize)(withCoords);
            var scaled = scaleToPixelsSized(config)(getSize)(maxHeights)(withCoords);
            return scaled;
        };
    };
};
var treeWithSorting = function (config) {
    return function (inputTree) {
        var withDepth = addDepth(0)(inputTree);
        var withHeight = addHeightField(withDepth);
        var sorted = sortByHeight(withHeight);
        var rendered = render(config.minSeparation)(config.separation)(sorted);
        var withCoords = petrify(0.0)(rendered);
        var scaled = scaleToPixels(config)(withCoords);
        return scaled;
    };
};
export {
    defaultTreeConfig,
    withLayerScale,
    withLayerSeparation,
    withSeparation,
    Contours,
    tree,
    treeWithSorting,
    treeSized
};
//# sourceMappingURL=index.js.map
