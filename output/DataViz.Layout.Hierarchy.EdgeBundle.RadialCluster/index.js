// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Semiring from "../Data.Semiring/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as DataViz_Layout_Hierarchy_EdgeBundle_Hierarchy from "../DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var add1 = /* #__PURE__ */ Data_Semiring.add(Data_Semiring.semiringNumber);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var RadialNode = /* #__PURE__ */ (function () {
    function RadialNode(value0) {
        this.value0 = value0;
    };
    RadialNode.create = function (value0) {
        return new RadialNode(value0);
    };
    return RadialNode;
})();
var toCartesian = function (v) {
    return {
        x: v.value0.y * Data_Number.cos(v.value0.x),
        y: v.value0.y * Data_Number.sin(v.value0.x)
    };
};
var showRadialNode = function (dictShow) {
    return {
        show: function (v) {
            return "RadialNode { fullName: " + (v.value0.fullName + (", x: " + (show(v.value0.x) + (", y: " + (show(v.value0.y) + " }")))));
        }
    };
};
var layoutNode = function (config) {
    return function (maxHeight) {
        return function (angleStep) {
            return function (state) {
                return function (v) {
                    var $24 = Data_Array["null"](v.value0.children);
                    if ($24) {
                        var newState = {
                            currentIndex: state.currentIndex + 1 | 0
                        };
                        var angle = config.startAngle + (Data_Int.toNumber(state.currentIndex) + 0.5) * angleStep;
                        return {
                            node: new RadialNode({
                                name: v.value0.name,
                                fullName: v.value0.fullName,
                                children: [  ],
                                data_: v.value0.data_,
                                depth: v.value0.depth,
                                height: v.value0.height,
                                x: angle,
                                y: config.outerRadius
                            }),
                            state: newState
                        };
                    };
                    var heightRatio = Data_Int.toNumber(v.value0.height) / Data_Int.toNumber(maxHeight);
                    var radius = config.innerRadius + (config.outerRadius - config.innerRadius) * (1.0 - heightRatio);
                    var childResults = foldl(function (acc) {
                        return function (child) {
                            var result = layoutNode(config)(maxHeight)(angleStep)(acc.state)(child);
                            return {
                                children: Data_Array.snoc(acc.children)(result.node),
                                state: result.state
                            };
                        };
                    })({
                        children: [  ],
                        state: state
                    })(v.value0.children);
                    var childAngles = map(function (v1) {
                        return v1.value0.x;
                    })(childResults.children);
                    var meanAngle = (function () {
                        if (childAngles.length === 0) {
                            return 0.0;
                        };
                        return foldl(add1)(0.0)(childAngles) / Data_Int.toNumber(Data_Array.length(childAngles));
                    })();
                    return {
                        node: new RadialNode({
                            name: v.value0.name,
                            fullName: v.value0.fullName,
                            children: childResults.children,
                            data_: v.value0.data_,
                            depth: v.value0.depth,
                            height: v.value0.height,
                            x: meanAngle,
                            y: radius
                        }),
                        state: childResults.state
                    };
                };
            };
        };
    };
};
var getMaxHeight = function (v) {
    return v.value0.height;
};
var radialCluster = function (config) {
    return function (tree) {
        var maxHeight = getMaxHeight(tree);
        var leafNodes = DataViz_Layout_Hierarchy_EdgeBundle_Hierarchy.leaves(tree);
        var numLeaves = Data_Array.length(leafNodes);
        var angleStep = (config.endAngle - config.startAngle) / Data_Int.toNumber(numLeaves);
        var result = layoutNode(config)(maxHeight)(angleStep)({
            currentIndex: 0
        })(tree);
        return result.node;
    };
};
var defaultRadialConfig = /* #__PURE__ */ (function () {
    return {
        innerRadius: 100.0,
        outerRadius: 400.0,
        startAngle: 0.0,
        endAngle: 2.0 * Data_Number.pi
    };
})();
var radialClusterFromTree = /* #__PURE__ */ radialCluster(defaultRadialConfig);
export {
    defaultRadialConfig,
    RadialNode,
    radialCluster,
    toCartesian,
    radialClusterFromTree,
    showRadialNode
};
//# sourceMappingURL=index.js.map
