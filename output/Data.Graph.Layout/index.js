// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_List_Types from "../Data.List.Types/index.js";
import * as Data_Map from "../Data.Map/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Ordering from "../Data.Ordering/index.js";
import * as Data_Semiring from "../Data.Semiring/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as Data_Unfoldable from "../Data.Unfoldable/index.js";
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var alter = /* #__PURE__ */ Data_Map_Internal.alter(Data_Ord.ordInt);
var add = /* #__PURE__ */ Data_Semiring.add(Data_Semiring.semiringNumber);
var toUnfoldable = /* #__PURE__ */ Data_Map_Internal.toUnfoldable(Data_Unfoldable.unfoldableArray);
var mapFlipped = /* #__PURE__ */ Data_Functor.mapFlipped(Data_Functor.functorArray);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var add1 = /* #__PURE__ */ Data_Semiring.add(Data_Semiring.semiringInt);
var toUnfoldable1 = /* #__PURE__ */ Data_Set.toUnfoldable(Data_Unfoldable.unfoldableArray);
var maximum = /* #__PURE__ */ Data_Foldable.maximum(Data_Ord.ordInt)(Data_Set.foldableSet);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Ord.ordInt);
var sortWith = /* #__PURE__ */ Data_Array.sortWith(Data_Ord.ordNumber);
var insert = /* #__PURE__ */ Data_Map_Internal.insert(Data_Ord.ordInt);
var foldl1 = /* #__PURE__ */ Data_Foldable.foldl(Data_List_Types.foldableList);
var Radial = /* #__PURE__ */ (function () {
    function Radial() {

    };
    Radial.value = new Radial();
    return Radial;
})();
var Horizontal = /* #__PURE__ */ (function () {
    function Horizontal() {

    };
    Horizontal.value = new Horizontal();
    return Horizontal;
})();
var Vertical = /* #__PURE__ */ (function () {
    function Vertical() {

    };
    Vertical.value = new Vertical();
    return Vertical;
})();
var toNumber = Data_Int.toNumber;
var snd = function (v) {
    return v.value1;
};
var showTreeLayout = {
    show: function (v) {
        if (v instanceof Radial) {
            return "Radial";
        };
        if (v instanceof Horizontal) {
            return "Horizontal";
        };
        if (v instanceof Vertical) {
            return "Vertical";
        };
        throw new Error("Failed pattern match at Data.Graph.Layout (line 42, column 1 - line 45, column 29): " + [ v.constructor.name ]);
    }
};
var layeredTreeLayout = function (dictOrd) {
    var insert1 = Data_Map_Internal.insert(dictOrd);
    var lookup1 = Data_Map_Internal.lookup(dictOrd);
    return function (config) {
        return function (nodes) {
            var layerGroups = foldl(function (acc) {
                return function (n) {
                    return alter((function () {
                        var $133 = Data_Array.cons(n.id);
                        var $134 = Data_Maybe.fromMaybe([  ]);
                        return function ($135) {
                            return Data_Maybe.Just.create($133($134($135)));
                        };
                    })())(n.layer)(acc);
                };
            })(Data_Map_Internal.empty)(nodes);
            var positions = foldl(function (acc) {
                return function (v) {
                    var count = Data_Array.length(v.value1);
                    var startX = -((toNumber(count - 1 | 0) * config.nodeWidth) / 2.0);
                    return foldl(function (a) {
                        return function (v1) {
                            var y = toNumber(v.value0) * config.nodeHeight;
                            var x = startX + toNumber(v1.value0) * config.nodeWidth;
                            return insert1(v1.value1)({
                                x: x,
                                y: y,
                                layer: v.value0
                            })(a);
                        };
                    })(acc)(Data_Array.mapWithIndex(function (i) {
                        return function (n) {
                            return new Data_Tuple.Tuple(i, n);
                        };
                    })(v.value1));
                };
            })(Data_Map_Internal.empty)(toUnfoldable(layerGroups));
            return mapFlipped(nodes)(function (n) {
                var v = lookup1(n.id)(positions);
                if (v instanceof Data_Maybe.Nothing) {
                    return {
                        id: n.id,
                        x: 0.0,
                        y: 0.0,
                        layer: n.layer
                    };
                };
                if (v instanceof Data_Maybe.Just) {
                    return {
                        id: n.id,
                        x: v.value0.x,
                        y: v.value0.y,
                        layer: v.value0.layer
                    };
                };
                throw new Error("Failed pattern match at Data.Graph.Layout (line 185, column 7 - line 187, column 71): " + [ v.constructor.name ]);
            });
        };
    };
};
var groupByLayer = function (dictOrd) {
    var lookup1 = Data_Map_Internal.lookup(dictOrd);
    return function (nodes) {
        return function (layers) {
            return foldl(function (acc) {
                return function (node) {
                    var layer = Data_Maybe.fromMaybe(0)(lookup1(node)(layers));
                    return alter((function () {
                        var $136 = Data_Array.cons(node);
                        var $137 = Data_Maybe.fromMaybe([  ]);
                        return function ($138) {
                            return Data_Maybe.Just.create($136($137($138)));
                        };
                    })())(layer)(acc);
                };
            })(Data_Map_Internal.empty)(nodes);
        };
    };
};
var fst = function (v) {
    return v.value0;
};
var eqTreeLayout = {
    eq: function (x) {
        return function (y) {
            if (x instanceof Radial && y instanceof Radial) {
                return true;
            };
            if (x instanceof Horizontal && y instanceof Horizontal) {
                return true;
            };
            if (x instanceof Vertical && y instanceof Vertical) {
                return true;
            };
            return false;
        };
    }
};
var ordTreeLayout = {
    compare: function (x) {
        return function (y) {
            if (x instanceof Radial && y instanceof Radial) {
                return Data_Ordering.EQ.value;
            };
            if (x instanceof Radial) {
                return Data_Ordering.LT.value;
            };
            if (y instanceof Radial) {
                return Data_Ordering.GT.value;
            };
            if (x instanceof Horizontal && y instanceof Horizontal) {
                return Data_Ordering.EQ.value;
            };
            if (x instanceof Horizontal) {
                return Data_Ordering.LT.value;
            };
            if (y instanceof Horizontal) {
                return Data_Ordering.GT.value;
            };
            if (x instanceof Vertical && y instanceof Vertical) {
                return Data_Ordering.EQ.value;
            };
            throw new Error("Failed pattern match at Data.Graph.Layout (line 0, column 0 - line 0, column 0): " + [ x.constructor.name, y.constructor.name ]);
        };
    },
    Eq0: function () {
        return eqTreeLayout;
    }
};
var defaultLayoutConfig = /* #__PURE__ */ (function () {
    return {
        nodeWidth: 100.0,
        nodeHeight: 80.0,
        orientation: Vertical.value
    };
})();
var computeWidths = function (dictOrd) {
    var lookup1 = Data_Map_Internal.lookup(dictOrd);
    var union = Data_Map_Internal.union(dictOrd);
    var insert1 = Data_Map_Internal.insert(dictOrd);
    return function (root) {
        return function (adj) {
            var go = function (node) {
                var v = lookup1(node)(adj);
                if (v instanceof Data_Maybe.Nothing) {
                    return new Data_Tuple.Tuple(1, Data_Map_Internal.singleton(node)(1));
                };
                if (v instanceof Data_Maybe.Just && v.value0.length === 0) {
                    return new Data_Tuple.Tuple(1, Data_Map_Internal.singleton(node)(1));
                };
                if (v instanceof Data_Maybe.Just) {
                    var childResults = mapFlipped(v.value0)(go);
                    var childWidths = mapFlipped(childResults)(fst);
                    var totalWidth = max(1)(foldl(add1)(0)(childWidths));
                    var childMaps = mapFlipped(childResults)(snd);
                    var mergedMaps = foldl(union)(Data_Map_Internal.empty)(childMaps);
                    return new Data_Tuple.Tuple(totalWidth, insert1(node)(totalWidth)(mergedMaps));
                };
                throw new Error("Failed pattern match at Data.Graph.Layout (line 103, column 5 - line 112, column 68): " + [ v.constructor.name ]);
            };
            return snd(go(root));
        };
    };
};
var computePositions = function (dictOrd) {
    var lookup1 = Data_Map_Internal.lookup(dictOrd);
    var union = Data_Map_Internal.union(dictOrd);
    var insert1 = Data_Map_Internal.insert(dictOrd);
    return function (config) {
        return function (widths) {
            return function (depth) {
                return function (leftOffset) {
                    return function (node) {
                        return function (adj) {
                            var nodeWidth = Data_Maybe.fromMaybe(1)(lookup1(node)(widths));
                            var myY = toNumber(depth) * config.nodeHeight;
                            var myX = leftOffset + (toNumber(nodeWidth) * config.nodeWidth) / 2.0;
                            var myPos = (function () {
                                if (config.orientation instanceof Horizontal) {
                                    return {
                                        x: myY,
                                        y: myX,
                                        layer: depth
                                    };
                                };
                                if (config.orientation instanceof Vertical) {
                                    return {
                                        x: myX,
                                        y: myY,
                                        layer: depth
                                    };
                                };
                                if (config.orientation instanceof Radial) {
                                    return {
                                        x: myX,
                                        y: myY,
                                        layer: depth
                                    };
                                };
                                throw new Error("Failed pattern match at Data.Graph.Layout (line 129, column 13 - line 132, column 49): " + [ config.orientation.constructor.name ]);
                            })();
                            var children = Data_Maybe.fromMaybe([  ])(lookup1(node)(adj));
                            var result = foldl(function (v) {
                                return function (child) {
                                    var childWidth = Data_Maybe.fromMaybe(1)(lookup1(child)(widths));
                                    var childPositions = computePositions(dictOrd)(config)(widths)(depth + 1 | 0)(v.offset)(child)(adj);
                                    return {
                                        offset: v.offset + toNumber(childWidth) * config.nodeWidth,
                                        positions: union(v.positions)(childPositions)
                                    };
                                };
                            })({
                                offset: leftOffset,
                                positions: Data_Map_Internal.empty
                            })(children);
                            return insert1(node)(myPos)(result.positions);
                        };
                    };
                };
            };
        };
    };
};
var treeLayout = function (dictOrd) {
    var computeWidths1 = computeWidths(dictOrd);
    var computePositions1 = computePositions(dictOrd);
    return function (config) {
        return function (root) {
            return function (adj) {
                var widths = computeWidths1(root)(adj);
                var positions = computePositions1(config)(widths)(0)(0.0)(root)(adj);
                return mapFlipped(toUnfoldable(positions))(function (v) {
                    return {
                        id: v.value0,
                        x: v.value1.x,
                        y: v.value1.y,
                        layer: v.value1.layer
                    };
                });
            };
        };
    };
};
var buildReverseEdges$prime = function (dictOrd) {
    var alter1 = Data_Map_Internal.alter(dictOrd);
    var insert1 = Data_Set.insert(dictOrd);
    return function (edges) {
        return foldl(function (acc) {
            return function (v) {
                return foldl(function (a) {
                    return function (target) {
                        return alter1((function () {
                            var $139 = insert1(v.value0);
                            var $140 = Data_Maybe.fromMaybe(Data_Set.empty);
                            return function ($141) {
                                return Data_Maybe.Just.create($139($140($141)));
                            };
                        })())(target)(a);
                    };
                })(acc)(toUnfoldable1(v.value1));
            };
        })(Data_Map_Internal.empty)(toUnfoldable(edges));
    };
};
var orderLayers = function (dictOrd) {
    var buildReverseEdges$prime1 = buildReverseEdges$prime(dictOrd);
    var fromFoldable = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    var lookup1 = Data_Map_Internal.lookup(dictOrd);
    return function (layerGroups) {
        return function (edges) {
            var reverseEdges = buildReverseEdges$prime1(edges);
            var numLayers = Data_Maybe.fromMaybe(0)(maximum(Data_Map.keys(layerGroups)));
            var go = function ($copy_layer) {
                return function ($copy_groups) {
                    var $tco_var_layer = $copy_layer;
                    var $tco_done = false;
                    var $tco_result;
                    function $tco_loop(layer, groups) {
                        if (layer > numLayers) {
                            $tco_done = true;
                            return groups;
                        };
                        if (Data_Boolean.otherwise) {
                            var prevLayerNodes = Data_Maybe.fromMaybe([  ])(lookup(layer - 1 | 0)(groups));
                            var prevPositions = fromFoldable(Data_Array.mapWithIndex(function (i) {
                                return function (n) {
                                    return new Data_Tuple.Tuple(n, toNumber(i));
                                };
                            })(prevLayerNodes));
                            var currentNodes = Data_Maybe.fromMaybe([  ])(lookup(layer)(groups));
                            var barycenters = mapFlipped(currentNodes)(function (node) {
                                var parents = Data_Maybe.fromMaybe(Data_Set.empty)(lookup1(node)(reverseEdges));
                                var parentPositions = Data_Array.mapMaybe(function (p) {
                                    return lookup1(p)(prevPositions);
                                })(toUnfoldable1(parents));
                                var avg = (function () {
                                    var $119 = Data_Array.length(parentPositions) === 0;
                                    if ($119) {
                                        return 0.0;
                                    };
                                    return foldl(add)(0.0)(parentPositions) / toNumber(Data_Array.length(parentPositions));
                                })();
                                return new Data_Tuple.Tuple(avg, node);
                            });
                            var sorted = mapFlipped(sortWith(fst)(barycenters))(snd);
                            var groups$prime = insert(layer)(sorted)(groups);
                            $tco_var_layer = layer + 1 | 0;
                            $copy_groups = groups$prime;
                            return;
                        };
                        throw new Error("Failed pattern match at Data.Graph.Layout (line 299, column 5 - line 299, column 62): " + [ layer.constructor.name, groups.constructor.name ]);
                    };
                    while (!$tco_done) {
                        $tco_result = $tco_loop($tco_var_layer, $copy_groups);
                    };
                    return $tco_result;
                };
            };
            return go(1)(layerGroups);
        };
    };
};
var assignLayers = function (dictOrd) {
    var nub = Data_Array.nub(dictOrd);
    var lookup1 = Data_Map_Internal.lookup(dictOrd);
    var insert1 = Data_Map_Internal.insert(dictOrd);
    var union = Data_Set.union(dictOrd);
    var member = Data_Set.member(dictOrd);
    var fromFoldable = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    return function (nodes) {
        return function (edges) {
            var go = function ($copy_v) {
                return function ($copy_v1) {
                    return function ($copy_v2) {
                        var $tco_var_v = $copy_v;
                        var $tco_var_v1 = $copy_v1;
                        var $tco_done = false;
                        var $tco_result;
                        function $tco_loop(v, v1, v2) {
                            if (v.length === 0) {
                                $tco_done = true;
                                return v2;
                            };
                            var nextFrontier = nub(Data_Array.concatMap(function (n) {
                                var v3 = lookup1(n)(edges);
                                if (v3 instanceof Data_Maybe.Nothing) {
                                    return [  ];
                                };
                                if (v3 instanceof Data_Maybe.Just) {
                                    return toUnfoldable1(v3.value0);
                                };
                                throw new Error("Failed pattern match at Data.Graph.Layout (line 261, column 11 - line 263, column 53): " + [ v3.constructor.name ]);
                            })(v));
                            var layers$prime = foldl(function (acc) {
                                return function (n) {
                                    var currentLayer = Data_Maybe.fromMaybe(0)(lookup1(n)(acc));
                                    return insert1(n)(max(currentLayer)(v1))(acc);
                                };
                            })(v2)(v);
                            $tco_var_v = nextFrontier;
                            $tco_var_v1 = v1 + 1 | 0;
                            $copy_v2 = layers$prime;
                            return;
                        };
                        while (!$tco_done) {
                            $tco_result = $tco_loop($tco_var_v, $tco_var_v1, $copy_v2);
                        };
                        return $tco_result;
                    };
                };
            };
            var allTargets = foldl1(function (acc) {
                return function (targets) {
                    return union(acc)(targets);
                };
            })(Data_Set.empty)(Data_Map_Internal.values(edges));
            var sources = Data_Array.filter(function (n) {
                return !member(n)(allTargets);
            })(nodes);
            var initialLayers = fromFoldable(mapFlipped(sources)(function (n) {
                return new Data_Tuple.Tuple(n, 0);
            }));
            return go(sources)(0)(initialLayers);
        };
    };
};
var assignCoordinates = function (dictOrd) {
    var insert1 = Data_Map_Internal.insert(dictOrd);
    return function (config) {
        return function (layerGroups) {
            return foldl(function (acc) {
                return function (v) {
                    var y = toNumber(v.value0) * config.nodeHeight;
                    var count = Data_Array.length(v.value1);
                    var startX = -((toNumber(count - 1 | 0) * config.nodeWidth) / 2.0);
                    return foldl(function (a) {
                        return function (v1) {
                            var x = startX + toNumber(v1.value0) * config.nodeWidth;
                            return insert1(v1.value1)({
                                x: x,
                                y: y,
                                layer: v.value0
                            })(a);
                        };
                    })(acc)(Data_Array.mapWithIndex(function (i) {
                        return function (n) {
                            return new Data_Tuple.Tuple(i, n);
                        };
                    })(v.value1));
                };
            })(Data_Map_Internal.empty)(toUnfoldable(layerGroups));
        };
    };
};
var sugiyamaLayout = function (dictOrd) {
    var assignLayers1 = assignLayers(dictOrd);
    var groupByLayer1 = groupByLayer(dictOrd);
    var orderLayers1 = orderLayers(dictOrd);
    var assignCoordinates1 = assignCoordinates(dictOrd);
    var lookup1 = Data_Map_Internal.lookup(dictOrd);
    return function (config) {
        return function (nodes) {
            return function (edges) {
                var layers = assignLayers1(nodes)(edges);
                var layerGroups = groupByLayer1(nodes)(layers);
                var orderedLayers = orderLayers1(layerGroups)(edges);
                var positions = assignCoordinates1(config)(orderedLayers);
                return Data_Array.mapMaybe(function (node) {
                    var v = lookup1(node)(positions);
                    if (v instanceof Data_Maybe.Nothing) {
                        return Data_Maybe.Nothing.value;
                    };
                    if (v instanceof Data_Maybe.Just) {
                        return new Data_Maybe.Just({
                            id: node,
                            x: v.value0.x,
                            y: v.value0.y,
                            layer: v.value0.layer
                        });
                    };
                    throw new Error("Failed pattern match at Data.Graph.Layout (line 235, column 7 - line 237, column 76): " + [ v.constructor.name ]);
                })(nodes);
            };
        };
    };
};
var dagLayout = function (dictOrd) {
    return sugiyamaLayout(dictOrd);
};
export {
    Radial,
    Horizontal,
    Vertical,
    treeLayout,
    layeredTreeLayout,
    defaultLayoutConfig,
    dagLayout,
    sugiyamaLayout,
    eqTreeLayout,
    ordTreeLayout,
    showTreeLayout
};
//# sourceMappingURL=index.js.map
