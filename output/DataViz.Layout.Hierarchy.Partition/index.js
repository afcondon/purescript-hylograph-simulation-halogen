// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Ordering from "../Data.Ordering/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Semiring from "../Data.Semiring/index.js";
import * as Data_Show from "../Data.Show/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var compare = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordInt);
var compare1 = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordNumber);
var add = /* #__PURE__ */ Data_Semiring.add(Data_Semiring.semiringNumber);
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Maybe.functorMaybe);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var bind = /* #__PURE__ */ Control_Bind.bind(Control_Bind.bindArray);
var PartNode = /* #__PURE__ */ (function () {
    function PartNode(value0) {
        this.value0 = value0;
    };
    PartNode.create = function (value0) {
        return new PartNode(value0);
    };
    return PartNode;
})();
var HierarchyData = function (x) {
    return x;
};
var showPartitionNode = function (dictShow) {
    var show2 = Data_Show.show(dictShow);
    return {
        show: function (v) {
            return "PartNode { data_: " + (show2(v.value0.data_) + (", depth: " + (show(v.value0.depth) + (", height: " + (show(v.value0.height) + (", value: " + (show1(v.value0.value) + (", children: [" + (show(Data_Array.length(v.value0.children)) + (" items]" + (", x0: " + (show1(v.value0.x0) + (", y0: " + (show1(v.value0.y0) + (", x1: " + (show1(v.value0.x1) + (", y1: " + (show1(v.value0.y1) + " }"))))))))))))))))));
        }
    };
};
var functorPartitionNode = {
    map: function (f) {
        return function (m) {
            return new PartNode({
                depth: m.value0.depth,
                height: m.value0.height,
                value: m.value0.value,
                x0: m.value0.x0,
                y0: m.value0.y0,
                x1: m.value0.x1,
                y1: m.value0.y1,
                children: map(Data_Functor.map(functorPartitionNode)(f))(m.value0.children),
                data_: f(m.value0.data_)
            });
        };
    }
};
var eqPartitionNode = function (dictEq) {
    var eq2 = Data_Eq.eq(dictEq);
    return {
        eq: function (x) {
            return function (y) {
                return Data_Eq.eq(Data_Eq.eqArray(eqPartitionNode(dictEq)))(x.value0.children)(y.value0.children) && eq2(x.value0.data_)(y.value0.data_) && x.value0.depth === y.value0.depth && x.value0.height === y.value0.height && x.value0.value === y.value0.value && x.value0.x0 === y.value0.x0 && x.value0.x1 === y.value0.x1 && x.value0.y0 === y.value0.y0 && x.value0.y1 === y.value0.y1;
            };
        }
    };
};
var ordPartitionNode = function (dictOrd) {
    var compare2 = Data_Ord.compare(dictOrd);
    var eqPartitionNode1 = eqPartitionNode(dictOrd.Eq0());
    return {
        compare: function (x) {
            return function (y) {
                var v = Data_Ord.compare(Data_Ord.ordArray(ordPartitionNode(dictOrd)))(x.value0.children)(y.value0.children);
                if (v instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v1 = compare2(x.value0.data_)(y.value0.data_);
                if (v1 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v1 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v2 = compare(x.value0.depth)(y.value0.depth);
                if (v2 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v2 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v3 = compare(x.value0.height)(y.value0.height);
                if (v3 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v3 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v4 = compare1(x.value0.value)(y.value0.value);
                if (v4 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v4 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v5 = compare1(x.value0.x0)(y.value0.x0);
                if (v5 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v5 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v6 = compare1(x.value0.x1)(y.value0.x1);
                if (v6 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v6 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v7 = compare1(x.value0.y0)(y.value0.y0);
                if (v7 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v7 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                return compare1(x.value0.y1)(y.value0.y1);
            };
        },
        Eq0: function () {
            return eqPartitionNode1;
        }
    };
};
var sunburstArcPath = function (x0_) {
    return function (y0_) {
        return function (x1_) {
            return function (y1_) {
                return function (radius) {
                    var outerRadius = y1_ * radius;
                    var innerRadius = y0_ * radius;
                    var arcSpan = x1_ - x0_;
                    var $96 = arcSpan > 0.99;
                    if ($96) {
                        var topOuterY = -outerRadius;
                        var topInnerY = -innerRadius;
                        return "M" + (show1(0.0) + ("," + (show1(topOuterY) + ("A" + (show1(outerRadius) + ("," + (show1(outerRadius) + (" 0 0 1 " + (show1(0.0) + ("," + (show1(outerRadius) + ("A" + (show1(outerRadius) + ("," + (show1(outerRadius) + (" 0 0 1 " + (show1(0.0) + ("," + (show1(topOuterY) + ("M" + (show1(0.0) + ("," + (show1(topInnerY) + ("A" + (show1(innerRadius) + ("," + (show1(innerRadius) + (" 0 0 0 " + (show1(0.0) + ("," + (show1(innerRadius) + ("A" + (show1(innerRadius) + ("," + (show1(innerRadius) + (" 0 0 0 " + (show1(0.0) + ("," + (show1(topInnerY) + "Z")))))))))))))))))))))))))))))))))))))));
                    };
                    var startAngle = x0_ * 2.0 * Data_Number.pi - Data_Number.pi / 2.0;
                    var x00 = Data_Number.cos(startAngle) * innerRadius;
                    var x10 = Data_Number.cos(startAngle) * outerRadius;
                    var y00 = Data_Number.sin(startAngle) * innerRadius;
                    var y10 = Data_Number.sin(startAngle) * outerRadius;
                    var endAngle = x1_ * 2.0 * Data_Number.pi - Data_Number.pi / 2.0;
                    var largeArc = (function () {
                        var $97 = endAngle - startAngle > Data_Number.pi;
                        if ($97) {
                            return 1;
                        };
                        return 0;
                    })();
                    var x01 = Data_Number.cos(endAngle) * innerRadius;
                    var x11 = Data_Number.cos(endAngle) * outerRadius;
                    var y01 = Data_Number.sin(endAngle) * innerRadius;
                    var y11 = Data_Number.sin(endAngle) * outerRadius;
                    return "M" + (show1(x10) + ("," + (show1(y10) + ("A" + (show1(outerRadius) + ("," + (show1(outerRadius) + (" 0 " + (show(largeArc) + (" 1 " + (show1(x11) + ("," + (show1(y11) + ("L" + (show1(x01) + ("," + (show1(y01) + ("A" + (show1(innerRadius) + ("," + (show1(innerRadius) + (" 0 " + (show(largeArc) + (" 0 " + (show1(x00) + ("," + (show1(y00) + "Z")))))))))))))))))))))))))));
                };
            };
        };
    };
};
var roundNode = function (v) {
    return new PartNode({
        data_: v.value0.data_,
        depth: v.value0.depth,
        height: v.value0.height,
        value: v.value0.value,
        x0: Data_Number.floor(v.value0.x0),
        y0: Data_Number.floor(v.value0.y0),
        x1: Data_Number.ceil(v.value0.x1),
        y1: Data_Number.ceil(v.value0.y1),
        children: map(roundNode)(v.value0.children)
    });
};
var positionChild = function (k) {
    return function (y0) {
        return function (y1) {
            return function (acc) {
                return function (v) {
                    var x1$prime = acc.currentX + v.value0.value * k;
                    var positioned = new PartNode({
                        data_: v.value0.data_,
                        depth: v.value0.depth,
                        height: v.value0.height,
                        value: v.value0.value,
                        children: v.value0.children,
                        x0: acc.currentX,
                        y0: y0,
                        x1: x1$prime,
                        y1: y1
                    });
                    return {
                        positioned: Data_Array.snoc(acc.positioned)(positioned),
                        currentX: x1$prime
                    };
                };
            };
        };
    };
};
var hierarchy = /* #__PURE__ */ (function () {
    var go = function (depth) {
        return function (v) {
            var kids = Data_Maybe.fromMaybe([  ])(map1(map(go(depth + 1 | 0)))(v.children));
            var childValues = map(function (v1) {
                return v1.value0.value;
            })(kids);
            var sumChildValues = Data_Array.foldl(add)(0.0)(childValues);
            var nodeValue = (function () {
                if (v.value instanceof Data_Maybe.Just) {
                    return v.value.value0;
                };
                if (v.value instanceof Data_Maybe.Nothing) {
                    var $112 = Data_Array["null"](kids);
                    if ($112) {
                        return 0.0;
                    };
                    return sumChildValues;
                };
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Partition (line 110, column 19 - line 112, column 67): " + [ v.value.constructor.name ]);
            })();
            var childHeights = map(function (v1) {
                return v1.value0.height;
            })(kids);
            var maxChildHeight = Data_Array.foldl(max)(0)(childHeights);
            var nodeHeight = (function () {
                var $115 = Data_Array["null"](kids);
                if ($115) {
                    return 0;
                };
                return maxChildHeight + 1 | 0;
            })();
            return new PartNode({
                data_: v.data_,
                depth: depth,
                height: nodeHeight,
                value: nodeValue,
                children: kids,
                x0: 0.0,
                y0: 0.0,
                x1: 0.0,
                y1: 0.0
            });
        };
    };
    return go(0);
})();
var flattenPartition = function (v) {
    var $117 = Data_Array["null"](v.value0.children);
    if ($117) {
        return [ v ];
    };
    return append1([ v ])(bind(v.value0.children)(flattenPartition));
};
var fixParallelLayout = function (isParallel) {
    return function (v) {
        var adjustDescendant = function (newParentX0) {
            return function (newParentX1) {
                return function (newParentY0) {
                    return function (newParentY1) {
                        return function (oldParentX0) {
                            return function (oldParentX1) {
                                return function (oldParentY0) {
                                    return function (oldParentY1) {
                                        return function (v1) {
                                            var oldYHeight = oldParentY1 - oldParentY0;
                                            var relativeY0 = (function () {
                                                var $130 = oldYHeight > 0.0;
                                                if ($130) {
                                                    return (v1.value0.y0 - oldParentY0) / oldYHeight;
                                                };
                                                return 0.0;
                                            })();
                                            var relativeY1 = (function () {
                                                var $131 = oldYHeight > 0.0;
                                                if ($131) {
                                                    return (v1.value0.y1 - oldParentY0) / oldYHeight;
                                                };
                                                return 1.0;
                                            })();
                                            var oldXWidth = oldParentX1 - oldParentX0;
                                            var relativeX0 = (function () {
                                                var $132 = oldXWidth > 0.0;
                                                if ($132) {
                                                    return (v1.value0.x0 - oldParentX0) / oldXWidth;
                                                };
                                                return 0.0;
                                            })();
                                            var relativeX1 = (function () {
                                                var $133 = oldXWidth > 0.0;
                                                if ($133) {
                                                    return (v1.value0.x1 - oldParentX0) / oldXWidth;
                                                };
                                                return 1.0;
                                            })();
                                            var newYHeight = newParentY1 - newParentY0;
                                            var newY1 = newParentY0 + relativeY1 * newYHeight;
                                            var newY0 = newParentY0 + relativeY0 * newYHeight;
                                            var newXWidth = newParentX1 - newParentX0;
                                            var newX1 = newParentX0 + relativeX1 * newXWidth;
                                            var newX0 = newParentX0 + relativeX0 * newXWidth;
                                            var adjustedChildren = map(adjustDescendant(newX0)(newX1)(newY0)(newY1)(v1.value0.x0)(v1.value0.x1)(v1.value0.y0)(v1.value0.y1))(v1.value0.children);
                                            return new PartNode({
                                                data_: v1.value0.data_,
                                                depth: v1.value0.depth,
                                                height: v1.value0.height,
                                                value: v1.value0.value,
                                                x0: newX0,
                                                x1: newX1,
                                                y0: newY0,
                                                y1: newY1,
                                                children: adjustedChildren
                                            });
                                        };
                                    };
                                };
                            };
                        };
                    };
                };
            };
        };
        var stackChild = function (parentX0) {
            return function (parentX1) {
                return function (baseY0) {
                    return function (radialSlice) {
                        return function (idx) {
                            return function (v1) {
                                var newY0 = baseY0 + Data_Int.toNumber(idx) * radialSlice;
                                var newY1 = newY0 + radialSlice;
                                var adjustedDescendants = map(adjustDescendant(parentX0)(parentX1)(newY0)(newY1)(v1.value0.x0)(v1.value0.x1)(v1.value0.y0)(v1.value0.y1))(v1.value0.children);
                                return new PartNode({
                                    data_: v1.value0.data_,
                                    depth: v1.value0.depth,
                                    height: v1.value0.height,
                                    value: v1.value0.value,
                                    x0: parentX0,
                                    x1: parentX1,
                                    y0: newY0,
                                    y1: newY1,
                                    children: adjustedDescendants
                                });
                            };
                        };
                    };
                };
            };
        };
        var stackRadially = function (parentX0) {
            return function (parentX1) {
                return function (_parentY1) {
                    return function (children) {
                        var numChildren = Data_Array.length(children);
                        var maxY1 = (function () {
                            var v1 = Data_Array.head(children);
                            if (v1 instanceof Data_Maybe.Just) {
                                return v1.value0.value0.y1;
                            };
                            if (v1 instanceof Data_Maybe.Nothing) {
                                return 1.0;
                            };
                            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Partition (line 390, column 15 - line 392, column 23): " + [ v1.constructor.name ]);
                        })();
                        var baseY0 = (function () {
                            var v1 = Data_Array.head(children);
                            if (v1 instanceof Data_Maybe.Just) {
                                return v1.value0.value0.y0;
                            };
                            if (v1 instanceof Data_Maybe.Nothing) {
                                return 0.0;
                            };
                            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Partition (line 387, column 16 - line 389, column 23): " + [ v1.constructor.name ]);
                        })();
                        var totalRadialSpace = maxY1 - baseY0;
                        var radialSlice = (function () {
                            var $148 = numChildren > 0;
                            if ($148) {
                                return totalRadialSpace / Data_Int.toNumber(numChildren);
                            };
                            return 0.0;
                        })();
                        return Data_Array.mapWithIndex(stackChild(parentX0)(parentX1)(baseY0)(radialSlice))(children);
                    };
                };
            };
        };
        var fixedChildren = map(fixParallelLayout(isParallel))(v.value0.children);
        var adjustedChildren = (function () {
            var $149 = isParallel(v.value0.data_);
            if ($149) {
                return stackRadially(v.value0.x0)(v.value0.x1)(v.value0.y1)(fixedChildren);
            };
            return fixedChildren;
        })();
        return new PartNode({
            data_: v.value0.data_,
            depth: v.value0.depth,
            height: v.value0.height,
            value: v.value0.value,
            x0: v.value0.x0,
            y0: v.value0.y0,
            x1: v.value0.x1,
            y1: v.value0.y1,
            children: adjustedChildren
        });
    };
};
var dice = function (children) {
    return function (x0) {
        return function (y0) {
            return function (x1) {
                return function (y1) {
                    var totalValue = Data_Array.foldl(function (acc) {
                        return function (v) {
                            return acc + v.value0.value;
                        };
                    })(0.0)(children);
                    var k = (function () {
                        var $153 = totalValue > 0.0;
                        if ($153) {
                            return (x1 - x0) / totalValue;
                        };
                        return 0.0;
                    })();
                    var result = Data_Array.foldl(positionChild(k)(y0)(y1))({
                        positioned: [  ],
                        currentX: x0
                    })(children);
                    return result.positioned;
                };
            };
        };
    };
};
var positionNode = function (config) {
    return function (dy) {
        return function (n) {
            return function (v) {
                var y1$prime = v.value0.y1 - config.padding;
                var x1$prime = v.value0.x1 - config.padding;
                var positionedChildren = (function () {
                    var $158 = Data_Array["null"](v.value0.children);
                    if ($158) {
                        return v.value0.children;
                    };
                    var childY1 = (dy * Data_Int.toNumber(v.value0.depth + 2 | 0)) / Data_Int.toNumber(n);
                    var childY0 = (dy * Data_Int.toNumber(v.value0.depth + 1 | 0)) / Data_Int.toNumber(n);
                    var dicedChildren = dice(v.value0.children)(v.value0.x0)(childY0)(v.value0.x1)(childY1);
                    var recursed = map(positionNode(config)(dy)(n))(dicedChildren);
                    return recursed;
                })();
                var v1 = (function () {
                    var $159 = x1$prime < v.value0.x0;
                    if ($159) {
                        return {
                            x0: (v.value0.x0 + x1$prime) / 2.0,
                            x1: (v.value0.x0 + x1$prime) / 2.0
                        };
                    };
                    return {
                        x0: v.value0.x0,
                        x1: x1$prime
                    };
                })();
                var v2 = (function () {
                    var $161 = y1$prime < v.value0.y0;
                    if ($161) {
                        return {
                            y0: (v.value0.y0 + y1$prime) / 2.0,
                            y1: (v.value0.y0 + y1$prime) / 2.0
                        };
                    };
                    return {
                        y0: v.value0.y0,
                        y1: y1$prime
                    };
                })();
                return new PartNode({
                    data_: v.value0.data_,
                    depth: v.value0.depth,
                    height: v.value0.height,
                    value: v.value0.value,
                    children: positionedChildren,
                    x0: v1.x0,
                    y0: v2.y0,
                    x1: v1.x1,
                    y1: v2.y1
                });
            };
        };
    };
};
var partition = function (config) {
    return function (root) {
        var n = root.value0.height + 1 | 0;
        var initialRoot = new PartNode({
            data_: root.value0.data_,
            depth: root.value0.depth,
            height: root.value0.height,
            value: root.value0.value,
            children: root.value0.children,
            x0: config.padding,
            y0: config.padding,
            x1: config.size.width,
            y1: config.size.height / Data_Int.toNumber(n)
        });
        var positioned = positionNode(config)(config.size.height)(n)(initialRoot);
        var rounded = (function () {
            if (config.round) {
                return roundNode(positioned);
            };
            return positioned;
        })();
        return rounded;
    };
};
var defaultPartitionConfig = {
    size: {
        width: 1.0,
        height: 1.0
    },
    padding: 0.0,
    round: false
};
export {
    PartNode,
    defaultPartitionConfig,
    partition,
    HierarchyData,
    hierarchy,
    sunburstArcPath,
    flattenPartition,
    fixParallelLayout,
    eqPartitionNode,
    ordPartitionNode,
    functorPartitionNode,
    showPartitionNode
};
//# sourceMappingURL=index.js.map
