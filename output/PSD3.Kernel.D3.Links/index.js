// Generated by purs version 0.15.15
import * as $foreign from "./foreign.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Partial_Unsafe from "../Partial.Unsafe/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var pure = /* #__PURE__ */ Control_Applicative.pure(Data_Maybe.applicativeMaybe);
var unsafeArrayIndex = function (arr) {
    return function (i) {
        var v = Data_Array.index(arr)(i);
        if (v instanceof Data_Maybe.Just) {
            return v.value0;
        };
        if (v instanceof Data_Maybe.Nothing) {
            return Partial_Unsafe.unsafeCrashWith("swizzleLinks: Array index out of bounds: " + show(i));
        };
        throw new Error("Failed pattern match at PSD3.Kernel.D3.Links (line 115, column 26 - line 117, column 85): " + [ v.constructor.name ]);
    };
};
var swizzleLinks = function (nodes) {
    return function (links) {
        return function (transform) {
            var swizzle = function (i) {
                return function (link) {
                    var tgt = unsafeArrayIndex(nodes)(link.target);
                    var src = unsafeArrayIndex(nodes)(link.source);
                    return transform(src)(tgt)(i)(link);
                };
            };
            return Data_Array.mapWithIndex(swizzle)(links);
        };
    };
};
var intMapLookup = function (key) {
    return function (m) {
        var result = $foreign.intMapLookup_(key)(m);
        var $10 = $foreign.isNull(result);
        if ($10) {
            return Data_Maybe.Nothing.value;
        };
        return new Data_Maybe.Just(result);
    };
};
var filterLinksToSubset = function (getIndex) {
    return function (nodes) {
        return function (links) {
            var nodeIndices = $foreign.buildIntSet(map(getIndex)(nodes));
            return Data_Array.filter(function (l) {
                return $foreign.intSetMember(l.source)(nodeIndices) && $foreign.intSetMember(l.target)(nodeIndices);
            })(links);
        };
    };
};
var buildIntMap = function (getIndex) {
    return function (nodes) {
        return $foreign.buildIntMap_(map(function (n) {
            return {
                key: getIndex(n),
                value: n
            };
        })(nodes));
    };
};
var swizzleLinksByIndex = function (getIndex) {
    return function (nodes) {
        return function (links) {
            return function (transform) {
                var swizzle = function (nodeMap) {
                    return function (link) {
                        return bind(intMapLookup(link.source)(nodeMap))(function (srcNode) {
                            return bind(intMapLookup(link.target)(nodeMap))(function (tgtNode) {
                                return pure({
                                    src: srcNode,
                                    tgt: tgtNode,
                                    link: link
                                });
                            });
                        });
                    };
                };
                var reindex = function (i) {
                    return function (v) {
                        return transform(v.src)(v.tgt)(i)(v.link);
                    };
                };
                var nodeMap = buildIntMap(getIndex)(nodes);
                return Data_Array.mapWithIndex(reindex)(Data_Array.mapMaybe(swizzle(nodeMap))(links));
            };
        };
    };
};
export {
    buildIntSet,
    intSetMember,
    buildStringSet,
    stringSetMember
} from "./foreign.js";
export {
    swizzleLinks,
    swizzleLinksByIndex,
    filterLinksToSubset,
    buildIntMap,
    intMapLookup
};
//# sourceMappingURL=index.js.map
