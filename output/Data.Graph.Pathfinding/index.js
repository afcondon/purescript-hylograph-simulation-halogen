// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Graph_Types from "../Data.Graph.Types/index.js";
import * as Data_List from "../Data.List/index.js";
import * as Data_List_Types from "../Data.List.Types/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Unfoldable from "../Data.Unfoldable/index.js";
var eq = /* #__PURE__ */ Data_Eq.eq(Data_Graph_Types.eqNodeId);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Graph_Types.ordNodeId);
var insert = /* #__PURE__ */ Data_Set.insert(Data_Graph_Types.ordNodeId);
var insert1 = /* #__PURE__ */ Data_Map_Internal.insert(Data_Graph_Types.ordNodeId);
var toUnfoldable = /* #__PURE__ */ Data_Set.toUnfoldable(Data_Unfoldable.unfoldableArray);
var minimumBy = /* #__PURE__ */ Data_Foldable.minimumBy(Data_Foldable.foldableArray);
var comparing = /* #__PURE__ */ Data_Ord.comparing(Data_Ord.ordNumber);
var $$delete = /* #__PURE__ */ Data_Set["delete"](Data_Graph_Types.ordNodeId);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var member = /* #__PURE__ */ Data_Map_Internal.member(Data_Graph_Types.ordNodeId);
var elem = /* #__PURE__ */ Data_Array.elem(Data_Graph_Types.eqNodeId);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_List_Types.semigroupList);
var fromFoldable = /* #__PURE__ */ Data_List.fromFoldable(Data_Foldable.foldableArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var PathFound = /* #__PURE__ */ (function () {
    function PathFound(value0) {
        this.value0 = value0;
    };
    PathFound.create = function (value0) {
        return new PathFound(value0);
    };
    return PathFound;
})();
var NoPath = /* #__PURE__ */ (function () {
    function NoPath() {

    };
    NoPath.value = new NoPath();
    return NoPath;
})();
var SameNode = /* #__PURE__ */ (function () {
    function SameNode() {

    };
    SameNode.value = new SameNode();
    return SameNode;
})();
var unsafeHead = function ($copy_arr) {
    var $tco_done = false;
    var $tco_result;
    function $tco_loop(arr) {
        var v = Data_Array.head(arr);
        if (v instanceof Data_Maybe.Just) {
            $tco_done = true;
            return v.value0;
        };
        if (v instanceof Data_Maybe.Nothing) {
            $copy_arr = arr;
            return;
        };
        throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 302, column 18 - line 304, column 28): " + [ v.constructor.name ]);
    };
    while (!$tco_done) {
        $tco_result = $tco_loop($copy_arr);
    };
    return $tco_result;
};
var reconstructPath = function (parents) {
    return function (start) {
        return function (goal) {
            var go = function ($copy_path) {
                return function ($copy_node) {
                    var $tco_var_path = $copy_path;
                    var $tco_done = false;
                    var $tco_result;
                    function $tco_loop(path, node) {
                        if (eq(node)(start)) {
                            $tco_done = true;
                            return path;
                        };
                        if (Data_Boolean.otherwise) {
                            var v = lookup(node)(parents);
                            if (v instanceof Data_Maybe.Nothing) {
                                $tco_done = true;
                                return path;
                            };
                            if (v instanceof Data_Maybe.Just) {
                                $tco_var_path = Data_Array.cons(v.value0)(path);
                                $copy_node = v.value0;
                                return;
                            };
                            throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 296, column 19 - line 298, column 58): " + [ v.constructor.name ]);
                        };
                        throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 294, column 3 - line 298, column 58): " + [ path.constructor.name, node.constructor.name ]);
                    };
                    while (!$tco_done) {
                        $tco_result = $tco_loop($tco_var_path, $copy_node);
                    };
                    return $tco_result;
                };
            };
            return go([ goal ])(goal);
        };
    };
};
var infinity = 1.0e308;
var dijkstraTo = function (start) {
    return function (goal) {
        return function (graph) {
            var toResult = function (state) {
                return {
                    distances: state.distances,
                    parents: state.parents,
                    visited: state.visited
                };
            };
            var initialState = {
                openSet: Data_Set.singleton(start),
                distances: Data_Map_Internal.singleton(start)(0.0),
                parents: Data_Map_Internal.empty,
                visited: [  ]
            };
            var getDistance = function (node) {
                return function (distances) {
                    return Data_Maybe.fromMaybe(infinity)(lookup(node)(distances));
                };
            };
            var relaxNeighbor = function (current) {
                return function (state) {
                    return function (v) {
                        var oldDist = getDistance(v.neighbor)(state.distances);
                        var currentDist = getDistance(current)(state.distances);
                        var newDist = currentDist + v.weight;
                        var $42 = newDist < oldDist;
                        if ($42) {
                            return {
                                visited: state.visited,
                                openSet: insert(v.neighbor)(state.openSet),
                                distances: insert1(v.neighbor)(newDist)(state.distances),
                                parents: insert1(v.neighbor)(current)(state.parents)
                            };
                        };
                        return state;
                    };
                };
            };
            var findMinDistance = function (openSet) {
                return function (distances) {
                    return Data_Maybe.fromMaybe(unsafeHead(toUnfoldable(openSet)))(minimumBy(comparing(Data_Function.flip(getDistance)(distances)))(toUnfoldable(openSet)));
                };
            };
            var search = function ($copy_state) {
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(state) {
                    if (Data_Set.isEmpty(state.openSet)) {
                        $tco_done = true;
                        return toResult(state);
                    };
                    if (Data_Boolean.otherwise) {
                        var current = findMinDistance(state.openSet)(state.distances);
                        var $46 = eq(current)(goal);
                        if ($46) {
                            $tco_done = true;
                            return toResult({
                                distances: state.distances,
                                parents: state.parents,
                                openSet: state.openSet,
                                visited: Data_Array.snoc(state.visited)(current)
                            });
                        };
                        var visited$prime = Data_Array.snoc(state.visited)(current);
                        var openSet$prime = $$delete(current)(state.openSet);
                        var state$prime = foldl(relaxNeighbor(current))({
                            distances: state.distances,
                            parents: state.parents,
                            openSet: openSet$prime,
                            visited: visited$prime
                        })(Data_Graph_Types.neighbors(current)(graph));
                        $copy_state = state$prime;
                        return;
                    };
                    throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 148, column 3 - line 148, column 42): " + [ state.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($copy_state);
                };
                return $tco_result;
            };
            return search(initialState);
        };
    };
};
var shortestPath = function (start) {
    return function (goal) {
        return function (graph) {
            if (eq(start)(goal)) {
                return SameNode.value;
            };
            if (Data_Boolean.otherwise) {
                var result = dijkstraTo(start)(goal)(graph);
                var v = lookup(goal)(result.distances);
                if (v instanceof Data_Maybe.Nothing) {
                    return NoPath.value;
                };
                if (v instanceof Data_Maybe.Just) {
                    return new PathFound({
                        path: reconstructPath(result.parents)(start)(goal),
                        cost: v.value0
                    });
                };
                throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 130, column 10 - line 135, column 15): " + [ v.constructor.name ]);
            };
            throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 125, column 1 - line 125, column 56): " + [ start.constructor.name, goal.constructor.name, graph.constructor.name ]);
        };
    };
};
var findPath = shortestPath;
var dijkstra = function (start) {
    return function (graph) {
        var initialState = {
            openSet: Data_Set.singleton(start),
            distances: Data_Map_Internal.singleton(start)(0.0),
            parents: Data_Map_Internal.empty,
            visited: [  ]
        };
        var getDistance = function (node) {
            return function (distances) {
                return Data_Maybe.fromMaybe(infinity)(lookup(node)(distances));
            };
        };
        var relaxNeighbor = function (current) {
            return function (state) {
                return function (v) {
                    var oldDist = getDistance(v.neighbor)(state.distances);
                    var currentDist = getDistance(current)(state.distances);
                    var newDist = currentDist + v.weight;
                    var $55 = newDist < oldDist;
                    if ($55) {
                        return {
                            visited: state.visited,
                            openSet: insert(v.neighbor)(state.openSet),
                            distances: insert1(v.neighbor)(newDist)(state.distances),
                            parents: insert1(v.neighbor)(current)(state.parents)
                        };
                    };
                    return state;
                };
            };
        };
        var findMinDistance = function (openSet) {
            return function (distances) {
                return Data_Maybe.fromMaybe(unsafeHead(toUnfoldable(openSet)))(minimumBy(comparing(Data_Function.flip(getDistance)(distances)))(toUnfoldable(openSet)));
            };
        };
        var search = function ($copy_state) {
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(state) {
                if (Data_Set.isEmpty(state.openSet)) {
                    $tco_done = true;
                    return {
                        distances: state.distances,
                        parents: state.parents,
                        visited: state.visited
                    };
                };
                if (Data_Boolean.otherwise) {
                    var current = findMinDistance(state.openSet)(state.distances);
                    var openSet$prime = $$delete(current)(state.openSet);
                    var visited$prime = Data_Array.snoc(state.visited)(current);
                    var state$prime = foldl(relaxNeighbor(current))({
                        distances: state.distances,
                        parents: state.parents,
                        openSet: openSet$prime,
                        visited: visited$prime
                    })(Data_Graph_Types.neighbors(current)(graph));
                    $copy_state = state$prime;
                    return;
                };
                throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 77, column 3 - line 77, column 42): " + [ state.constructor.name ]);
            };
            while (!$tco_done) {
                $tco_result = $tco_loop($copy_state);
            };
            return $tco_result;
        };
        return search(initialState);
    };
};
var dfs = function (start) {
    return function (graph) {
        var search = function (state) {
            return function (node) {
                if (member(node)(state.distances)) {
                    return state;
                };
                if (Data_Boolean.otherwise) {
                    var time$prime = state.time + 1.0;
                    var state$prime = {
                        parents: state.parents,
                        distances: insert1(node)(time$prime)(state.distances),
                        visited: Data_Array.snoc(state.visited)(node),
                        time: time$prime
                    };
                    var neighborNodes = Data_Graph_Types.neighbors(node)(graph);
                    return foldl(function (s) {
                        return function (n) {
                            var $61 = member(n.neighbor)(s.distances);
                            if ($61) {
                                return s;
                            };
                            return search({
                                distances: s.distances,
                                visited: s.visited,
                                time: s.time,
                                parents: insert1(n.neighbor)(node)(s.parents)
                            })(n.neighbor);
                        };
                    })(state$prime)(neighborNodes);
                };
                throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 255, column 3 - line 255, column 43): " + [ state.constructor.name, node.constructor.name ]);
            };
        };
        var result = search({
            distances: Data_Map_Internal.empty,
            parents: Data_Map_Internal.empty,
            visited: [  ],
            time: 0.0
        })(start);
        return {
            distances: result.distances,
            parents: result.parents,
            visited: result.visited
        };
    };
};
var dfsFrom = function (start) {
    return function (graph) {
        return (dfs(start)(graph)).visited;
    };
};
var bfs = function (start) {
    return function (graph) {
        var search = function ($copy_v) {
            return function ($copy_v1) {
                var $tco_var_v = $copy_v;
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(v, v1) {
                    if (v1 instanceof Data_List_Types.Nil) {
                        $tco_done = true;
                        return {
                            distances: v.distances,
                            parents: v.parents,
                            visited: v.visited
                        };
                    };
                    var v2 = Data_List.uncons(v1);
                    if (v2 instanceof Data_Maybe.Nothing) {
                        $tco_done = true;
                        return {
                            distances: v.distances,
                            parents: v.parents,
                            visited: v.visited
                        };
                    };
                    if (v2 instanceof Data_Maybe.Just) {
                        var $65 = elem(v2.value0.head)(v.visited);
                        if ($65) {
                            $tco_var_v = v;
                            $copy_v1 = v2.value0.tail;
                            return;
                        };
                        var visited$prime = Data_Array.snoc(v.visited)(v2.value0.head);
                        var neighborNodes = Data_Graph_Types.neighbors(v2.value0.head)(graph);
                        var unvisited = Data_Array.filter(function (n) {
                            return !member(n.neighbor)(v.distances);
                        })(neighborNodes);
                        var newParents = foldl(function (m) {
                            return function (n) {
                                return insert1(n.neighbor)(v2.value0.head)(m);
                            };
                        })(v.parents)(unvisited);
                        var newQueue = append(v2.value0.tail)(fromFoldable(map(function (v3) {
                            return v3.neighbor;
                        })(unvisited)));
                        var currentDepth = Data_Maybe.fromMaybe(0.0)(lookup(v2.value0.head)(v.distances));
                        var newDistances = foldl(function (m) {
                            return function (n) {
                                return insert1(n.neighbor)(currentDepth + 1.0)(m);
                            };
                        })(v.distances)(unvisited);
                        $tco_var_v = {
                            distances: newDistances,
                            parents: newParents,
                            visited: visited$prime
                        };
                        $copy_v1 = newQueue;
                        return;
                    };
                    throw new Error("Failed pattern match at Data.Graph.Pathfinding (line 212, column 5 - line 231, column 97): " + [ v2.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($tco_var_v, $copy_v1);
                };
                return $tco_result;
            };
        };
        var initialState = {
            distances: Data_Map_Internal.singleton(start)(0.0),
            parents: Data_Map_Internal.empty,
            visited: [  ]
        };
        return search(initialState)(Data_List.singleton(start));
    };
};
var bfsFrom = function (start) {
    return function (graph) {
        return (bfs(start)(graph)).visited;
    };
};
export {
    PathFound,
    NoPath,
    SameNode,
    dijkstra,
    shortestPath,
    findPath,
    bfs,
    dfs,
    bfsFrom,
    dfsFrom
};
//# sourceMappingURL=index.js.map
