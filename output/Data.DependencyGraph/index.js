// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Graph from "../Data.Graph/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var mapFlipped = /* #__PURE__ */ Data_Functor.mapFlipped(Data_Functor.functorArray);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var getReachableNodes = function (dictOrd) {
    var lookup = Data_Graph.lookup(dictOrd);
    var elem = Data_Array.elem(dictOrd.Eq0());
    return function (id) {
        return function (graph) {
            var processNextOpenDepPath = function (searchRecord) {
                return bind(Data_Array.uncons(searchRecord.openDepPaths))(function (x) {
                    return bind(Data_Array.head(x.head))(function (firstID) {
                        return bind(lookup(firstID)(graph))(function (firstNode) {
                            var newDeps = Data_Array.partition(function (d) {
                                return !elem(d)(searchRecord.nodes);
                            })(firstNode.links.targets);
                            var newOpenDepPaths = mapFlipped(newDeps.yes)(function (d) {
                                return Data_Array.cons(d)(x.head);
                            });
                            var prunedLinks = mapFlipped(newDeps.no)(function (d) {
                                return new Data_Tuple.Tuple(firstID, d);
                            });
                            var $12 = Data_Array["null"](newOpenDepPaths);
                            if ($12) {
                                return new Data_Maybe.Just({
                                    dependencyTree: searchRecord.dependencyTree,
                                    nodes: searchRecord.nodes,
                                    openDepPaths: x.tail,
                                    closedDepPaths: Data_Array.cons(x.head)(searchRecord.closedDepPaths),
                                    redundantLinks: append(searchRecord.redundantLinks)(prunedLinks)
                                });
                            };
                            return new Data_Maybe.Just({
                                closedDepPaths: searchRecord.closedDepPaths,
                                dependencyTree: searchRecord.dependencyTree,
                                openDepPaths: append(x.tail)(newOpenDepPaths),
                                nodes: append(searchRecord.nodes)(newDeps.yes),
                                redundantLinks: append(searchRecord.redundantLinks)(prunedLinks)
                            });
                        });
                    });
                });
            };
            var go = function ($copy_v) {
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(v) {
                    if (v.openDepPaths.length === 0) {
                        $tco_done = true;
                        return v;
                    };
                    var v1 = processNextOpenDepPath(v);
                    if (v1 instanceof Data_Maybe.Nothing) {
                        $tco_done = true;
                        return v;
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        $copy_v = v1.value0;
                        return;
                    };
                    throw new Error("Failed pattern match at Data.DependencyGraph (line 30, column 7 - line 32, column 49): " + [ v1.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($copy_v);
                };
                return $tco_result;
            };
            return go({
                nodes: [  ],
                openDepPaths: [ [ id ] ],
                closedDepPaths: [  ],
                redundantLinks: [  ],
                dependencyTree: Data_Maybe.Nothing.value
            });
        };
    };
};
export {
    getReachableNodes
};
//# sourceMappingURL=index.js.map
