// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Graph_Pathfinding from "../Data.Graph.Pathfinding/index.js";
import * as Data_Graph_Types from "../Data.Graph.Types/index.js";
import * as Data_List from "../Data.List/index.js";
import * as Data_List_Types from "../Data.List.Types/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unfoldable from "../Data.Unfoldable/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Graph_Types.showNodeId);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var eq = /* #__PURE__ */ Data_Eq.eq(Data_Graph_Types.eqNodeId);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Graph_Types.ordNodeId);
var insert = /* #__PURE__ */ Data_Set.insert(Data_Graph_Types.ordNodeId);
var insert1 = /* #__PURE__ */ Data_Map_Internal.insert(Data_Graph_Types.ordNodeId);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var toUnfoldable = /* #__PURE__ */ Data_Set.toUnfoldable(Data_Unfoldable.unfoldableArray);
var minimumBy = /* #__PURE__ */ Data_Foldable.minimumBy(Data_Foldable.foldableArray);
var comparing = /* #__PURE__ */ Data_Ord.comparing(Data_Ord.ordNumber);
var fromFoldable = /* #__PURE__ */ Data_Set.fromFoldable(Data_Foldable.foldableArray)(Data_Graph_Types.ordNodeId);
var $$delete = /* #__PURE__ */ Data_Set["delete"](Data_Graph_Types.ordNodeId);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var member = /* #__PURE__ */ Data_Map_Internal.member(Data_Graph_Types.ordNodeId);
var elem = /* #__PURE__ */ Data_Array.elem(Data_Graph_Types.eqNodeId);
var append2 = /* #__PURE__ */ Data_Semigroup.append(Data_List_Types.semigroupList);
var fromFoldable1 = /* #__PURE__ */ Data_List.fromFoldable(Data_Foldable.foldableArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var Visit = /* #__PURE__ */ (function () {
    function Visit(value0) {
        this.value0 = value0;
    };
    Visit.create = function (value0) {
        return new Visit(value0);
    };
    return Visit;
})();
var Explore = /* #__PURE__ */ (function () {
    function Explore(value0, value1, value2) {
        this.value0 = value0;
        this.value1 = value1;
        this.value2 = value2;
    };
    Explore.create = function (value0) {
        return function (value1) {
            return function (value2) {
                return new Explore(value0, value1, value2);
            };
        };
    };
    return Explore;
})();
var UpdateDistance = /* #__PURE__ */ (function () {
    function UpdateDistance(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    UpdateDistance.create = function (value0) {
        return function (value1) {
            return new UpdateDistance(value0, value1);
        };
    };
    return UpdateDistance;
})();
var Backtrack = /* #__PURE__ */ (function () {
    function Backtrack(value0) {
        this.value0 = value0;
    };
    Backtrack.create = function (value0) {
        return new Backtrack(value0);
    };
    return Backtrack;
})();
var FoundGoal = /* #__PURE__ */ (function () {
    function FoundGoal(value0) {
        this.value0 = value0;
    };
    FoundGoal.create = function (value0) {
        return new FoundGoal(value0);
    };
    return FoundGoal;
})();
var unsafeHead = function ($copy_arr) {
    var $tco_done = false;
    var $tco_result;
    function $tco_loop(arr) {
        var v = Data_Array.head(arr);
        if (v instanceof Data_Maybe.Just) {
            $tco_done = true;
            return v.value0;
        };
        if (v instanceof Data_Maybe.Nothing) {
            $copy_arr = arr;
            return;
        };
        throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 348, column 18 - line 350, column 28): " + [ v.constructor.name ]);
    };
    while (!$tco_done) {
        $tco_result = $tco_loop($copy_arr);
    };
    return $tco_result;
};
var showSearchStep = {
    show: function (v) {
        if (v instanceof Visit) {
            return "Visit " + show(v.value0);
        };
        if (v instanceof Explore) {
            return "Explore " + (show(v.value0) + (" -> " + (show(v.value1) + (" (" + (show1(v.value2) + ")")))));
        };
        if (v instanceof UpdateDistance) {
            return "UpdateDistance " + (show(v.value0) + (" = " + show1(v.value1)));
        };
        if (v instanceof Backtrack) {
            return "Backtrack " + show(v.value0);
        };
        if (v instanceof FoundGoal) {
            return "FoundGoal " + show(v.value0);
        };
        throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 52, column 1 - line 57, column 46): " + [ v.constructor.name ]);
    }
};
var reconstructPath = function (parents) {
    return function (start) {
        return function (goal) {
            var go = function ($copy_path) {
                return function ($copy_node) {
                    var $tco_var_path = $copy_path;
                    var $tco_done = false;
                    var $tco_result;
                    function $tco_loop(path, node) {
                        if (eq(node)(start)) {
                            $tco_done = true;
                            return path;
                        };
                        if (Data_Boolean.otherwise) {
                            var v = lookup(node)(parents);
                            if (v instanceof Data_Maybe.Nothing) {
                                $tco_done = true;
                                return path;
                            };
                            if (v instanceof Data_Maybe.Just) {
                                $tco_var_path = Data_Array.cons(v.value0)(path);
                                $copy_node = v.value0;
                                return;
                            };
                            throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 343, column 19 - line 345, column 58): " + [ v.constructor.name ]);
                        };
                        throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 341, column 3 - line 345, column 58): " + [ path.constructor.name, node.constructor.name ]);
                    };
                    while (!$tco_done) {
                        $tco_result = $tco_loop($tco_var_path, $copy_node);
                    };
                    return $tco_result;
                };
            };
            return go([ goal ])(goal);
        };
    };
};
var infinity = 1.0e308;
var eqSearchStep = {
    eq: function (x) {
        return function (y) {
            if (x instanceof Visit && y instanceof Visit) {
                return eq(x.value0)(y.value0);
            };
            if (x instanceof Explore && y instanceof Explore) {
                return eq(x.value0)(y.value0) && eq(x.value1)(y.value1) && x.value2 === y.value2;
            };
            if (x instanceof UpdateDistance && y instanceof UpdateDistance) {
                return eq(x.value0)(y.value0) && x.value1 === y.value1;
            };
            if (x instanceof Backtrack && y instanceof Backtrack) {
                return eq(x.value0)(y.value0);
            };
            if (x instanceof FoundGoal && y instanceof FoundGoal) {
                return eq(x.value0)(y.value0);
            };
            return false;
        };
    }
};
var dijkstraTraced = function (start) {
    return function (graph) {
        var initialState = {
            openSet: Data_Set.singleton(start),
            distances: Data_Map_Internal.singleton(start)(0.0),
            parents: Data_Map_Internal.empty,
            visited: [  ],
            steps: [  ]
        };
        var getDistance = function (node) {
            return function (distances) {
                return Data_Maybe.fromMaybe(infinity)(lookup(node)(distances));
            };
        };
        var relaxNeighborTraced = function (current) {
            return function (state) {
                return function (v) {
                    var oldDist = getDistance(v.neighbor)(state.distances);
                    var exploreStep = new Explore(current, v.neighbor, v.weight);
                    var currentDist = getDistance(current)(state.distances);
                    var newDist = currentDist + v.weight;
                    var $99 = newDist < oldDist;
                    if ($99) {
                        return {
                            visited: state.visited,
                            openSet: insert(v.neighbor)(state.openSet),
                            distances: insert1(v.neighbor)(newDist)(state.distances),
                            parents: insert1(v.neighbor)(current)(state.parents),
                            steps: append1(state.steps)([ exploreStep, new UpdateDistance(v.neighbor, newDist) ])
                        };
                    };
                    return {
                        distances: state.distances,
                        openSet: state.openSet,
                        parents: state.parents,
                        visited: state.visited,
                        steps: Data_Array.snoc(state.steps)(exploreStep)
                    };
                };
            };
        };
        var findMinDistance = function (openSet) {
            return function (distances) {
                return Data_Maybe.fromMaybe(unsafeHead(toUnfoldable(openSet)))(minimumBy(comparing(Data_Function.flip(getDistance)(distances)))(toUnfoldable(openSet)));
            };
        };
        var search = function ($copy_state) {
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(state) {
                if (Data_Set.isEmpty(state.openSet)) {
                    $tco_done = true;
                    return {
                        result: {
                            distances: state.distances,
                            parents: state.parents,
                            visited: state.visited
                        },
                        steps: state.steps,
                        explored: fromFoldable(state.visited)
                    };
                };
                if (Data_Boolean.otherwise) {
                    var current = findMinDistance(state.openSet)(state.distances);
                    var openSet$prime = $$delete(current)(state.openSet);
                    var steps$prime = Data_Array.snoc(state.steps)(new Visit(current));
                    var visited$prime = Data_Array.snoc(state.visited)(current);
                    var state$prime = foldl(relaxNeighborTraced(current))({
                        distances: state.distances,
                        parents: state.parents,
                        openSet: openSet$prime,
                        visited: visited$prime,
                        steps: steps$prime
                    })(Data_Graph_Types.neighbors(current)(graph));
                    $copy_state = state$prime;
                    return;
                };
                throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 84, column 3 - line 84, column 61): " + [ state.constructor.name ]);
            };
            while (!$tco_done) {
                $tco_result = $tco_loop($copy_state);
            };
            return $tco_result;
        };
        return search(initialState);
    };
};
var dijkstraToTraced = function (start) {
    return function (goal) {
        return function (graph) {
            var toResult = function (state) {
                return {
                    result: {
                        distances: state.distances,
                        parents: state.parents,
                        visited: state.visited
                    },
                    steps: state.steps,
                    explored: fromFoldable(state.visited)
                };
            };
            var initialState = {
                openSet: Data_Set.singleton(start),
                distances: Data_Map_Internal.singleton(start)(0.0),
                parents: Data_Map_Internal.empty,
                visited: [  ],
                steps: [  ]
            };
            var getDistance = function (node) {
                return function (distances) {
                    return Data_Maybe.fromMaybe(infinity)(lookup(node)(distances));
                };
            };
            var relaxNeighborTraced = function (current) {
                return function (state) {
                    return function (v) {
                        var oldDist = getDistance(v.neighbor)(state.distances);
                        var exploreStep = new Explore(current, v.neighbor, v.weight);
                        var currentDist = getDistance(current)(state.distances);
                        var newDist = currentDist + v.weight;
                        var $106 = newDist < oldDist;
                        if ($106) {
                            return {
                                visited: state.visited,
                                openSet: insert(v.neighbor)(state.openSet),
                                distances: insert1(v.neighbor)(newDist)(state.distances),
                                parents: insert1(v.neighbor)(current)(state.parents),
                                steps: append1(state.steps)([ exploreStep, new UpdateDistance(v.neighbor, newDist) ])
                            };
                        };
                        return {
                            distances: state.distances,
                            openSet: state.openSet,
                            parents: state.parents,
                            visited: state.visited,
                            steps: Data_Array.snoc(state.steps)(exploreStep)
                        };
                    };
                };
            };
            var findMinDistance = function (openSet) {
                return function (distances) {
                    return Data_Maybe.fromMaybe(unsafeHead(toUnfoldable(openSet)))(minimumBy(comparing(Data_Function.flip(getDistance)(distances)))(toUnfoldable(openSet)));
                };
            };
            var search = function ($copy_state) {
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(state) {
                    if (Data_Set.isEmpty(state.openSet)) {
                        $tco_done = true;
                        return toResult(state);
                    };
                    if (Data_Boolean.otherwise) {
                        var current = findMinDistance(state.openSet)(state.distances);
                        var visitStep = new Visit(current);
                        var $110 = eq(current)(goal);
                        if ($110) {
                            $tco_done = true;
                            return toResult({
                                distances: state.distances,
                                parents: state.parents,
                                openSet: state.openSet,
                                visited: Data_Array.snoc(state.visited)(current),
                                steps: Data_Array.snoc(state.steps)(visitStep)
                            });
                        };
                        var visited$prime = Data_Array.snoc(state.visited)(current);
                        var steps$prime = Data_Array.snoc(state.steps)(visitStep);
                        var openSet$prime = $$delete(current)(state.openSet);
                        var state$prime = foldl(relaxNeighborTraced(current))({
                            distances: state.distances,
                            parents: state.parents,
                            openSet: openSet$prime,
                            visited: visited$prime,
                            steps: steps$prime
                        })(Data_Graph_Types.neighbors(current)(graph));
                        $copy_state = state$prime;
                        return;
                    };
                    throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 171, column 3 - line 188, column 30): " + [ state.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($copy_state);
                };
                return $tco_result;
            };
            return search(initialState);
        };
    };
};
var shortestPathTraced = function (start) {
    return function (goal) {
        return function (graph) {
            if (eq(start)(goal)) {
                return {
                    result: Data_Graph_Pathfinding.SameNode.value,
                    steps: [  ],
                    explored: Data_Set.singleton(start)
                };
            };
            if (Data_Boolean.otherwise) {
                var traced = dijkstraToTraced(start)(goal)(graph);
                var v = lookup(goal)(traced.result.distances);
                if (v instanceof Data_Maybe.Nothing) {
                    return {
                        result: Data_Graph_Pathfinding.NoPath.value,
                        steps: traced.steps,
                        explored: traced.explored
                    };
                };
                if (v instanceof Data_Maybe.Just) {
                    return {
                        result: new Data_Graph_Pathfinding.PathFound({
                            path: reconstructPath(traced.result.parents)(start)(goal),
                            cost: v.value0
                        }),
                        steps: append1(traced.steps)([ new FoundGoal(goal) ]),
                        explored: traced.explored
                    };
                };
                throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 144, column 10 - line 157, column 15): " + [ v.constructor.name ]);
            };
            throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 135, column 1 - line 135, column 75): " + [ start.constructor.name, goal.constructor.name, graph.constructor.name ]);
        };
    };
};
var dfsTraced = function (start) {
    return function (graph) {
        var search = function (state) {
            return function (node) {
                if (member(node)(state.distances)) {
                    return state;
                };
                if (Data_Boolean.otherwise) {
                    var visitStep = new Visit(node);
                    var time$prime = state.time + 1.0;
                    var state$prime = {
                        parents: state.parents,
                        distances: insert1(node)(time$prime)(state.distances),
                        visited: Data_Array.snoc(state.visited)(node),
                        steps: Data_Array.snoc(state.steps)(visitStep),
                        time: time$prime
                    };
                    var neighborNodes = Data_Graph_Types.neighbors(node)(graph);
                    var finalState = foldl(function (s) {
                        return function (n) {
                            var $118 = member(n.neighbor)(s.distances);
                            if ($118) {
                                return s;
                            };
                            var exploreStep = new Explore(node, n.neighbor, s.time);
                            var s$prime = {
                                distances: s.distances,
                                time: s.time,
                                visited: s.visited,
                                steps: Data_Array.snoc(s.steps)(exploreStep),
                                parents: insert1(n.neighbor)(node)(s.parents)
                            };
                            return search(s$prime)(n.neighbor);
                        };
                    })(state$prime)(neighborNodes);
                    var backtrackStep = new Backtrack(node);
                    return {
                        distances: finalState.distances,
                        parents: finalState.parents,
                        visited: finalState.visited,
                        time: finalState.time,
                        steps: Data_Array.snoc(finalState.steps)(backtrackStep)
                    };
                };
                throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 296, column 3 - line 296, column 55): " + [ state.constructor.name, node.constructor.name ]);
            };
        };
        var result = search({
            distances: Data_Map_Internal.empty,
            parents: Data_Map_Internal.empty,
            visited: [  ],
            steps: [  ],
            time: 0.0
        })(start);
        return {
            result: {
                distances: result.distances,
                parents: result.parents,
                visited: result.visited
            },
            steps: result.steps,
            explored: fromFoldable(result.visited)
        };
    };
};
var bfsTraced = function (start) {
    return function (graph) {
        var toResult = function (state) {
            return {
                result: {
                    distances: state.distances,
                    parents: state.parents,
                    visited: state.visited
                },
                steps: state.steps,
                explored: fromFoldable(state.visited)
            };
        };
        var search = function ($copy_v) {
            return function ($copy_v1) {
                var $tco_var_v = $copy_v;
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(v, v1) {
                    if (v1 instanceof Data_List_Types.Nil) {
                        $tco_done = true;
                        return toResult(v);
                    };
                    var v2 = Data_List.uncons(v1);
                    if (v2 instanceof Data_Maybe.Nothing) {
                        $tco_done = true;
                        return toResult(v);
                    };
                    if (v2 instanceof Data_Maybe.Just) {
                        var $122 = elem(v2.value0.head)(v.visited);
                        if ($122) {
                            $tco_var_v = v;
                            $copy_v1 = v2.value0.tail;
                            return;
                        };
                        var visited$prime = Data_Array.snoc(v.visited)(v2.value0.head);
                        var steps$prime = Data_Array.snoc(v.steps)(new Visit(v2.value0.head));
                        var neighborNodes = Data_Graph_Types.neighbors(v2.value0.head)(graph);
                        var unvisited = Data_Array.filter(function (n) {
                            return !member(n.neighbor)(v.distances);
                        })(neighborNodes);
                        var newParents = foldl(function (m) {
                            return function (n) {
                                return insert1(n.neighbor)(v2.value0.head)(m);
                            };
                        })(v.parents)(unvisited);
                        var newQueue = append2(v2.value0.tail)(fromFoldable1(map(function (v3) {
                            return v3.neighbor;
                        })(unvisited)));
                        var currentDepth = Data_Maybe.fromMaybe(0.0)(lookup(v2.value0.head)(v.distances));
                        var exploreSteps = map(function (n) {
                            return new Explore(v2.value0.head, n.neighbor, currentDepth + 1.0);
                        })(unvisited);
                        var newDistances = foldl(function (m) {
                            return function (n) {
                                return insert1(n.neighbor)(currentDepth + 1.0)(m);
                            };
                        })(v.distances)(unvisited);
                        $tco_var_v = {
                            distances: newDistances,
                            parents: newParents,
                            visited: visited$prime,
                            steps: append1(steps$prime)(exploreSteps)
                        };
                        $copy_v1 = newQueue;
                        return;
                    };
                    throw new Error("Failed pattern match at Data.Graph.Pathfinding.Traced (line 238, column 5 - line 261, column 24): " + [ v2.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($tco_var_v, $copy_v1);
                };
                return $tco_result;
            };
        };
        var initialState = {
            distances: Data_Map_Internal.singleton(start)(0.0),
            parents: Data_Map_Internal.empty,
            visited: [  ],
            steps: [  ]
        };
        return search(initialState)(Data_List.singleton(start));
    };
};
export {
    Visit,
    Explore,
    UpdateDistance,
    Backtrack,
    FoundGoal,
    shortestPathTraced,
    dijkstraTraced,
    bfsTraced,
    dfsTraced,
    eqSearchStep,
    showSearchStep
};
//# sourceMappingURL=index.js.map
