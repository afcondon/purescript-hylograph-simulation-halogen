// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Graph from "../Data.Graph/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_List from "../Data.List/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as Data_Unfoldable from "../Data.Unfoldable/index.js";
var mapFlipped = /* #__PURE__ */ Data_Functor.mapFlipped(Data_Functor.functorArray);
var fromFoldable = /* #__PURE__ */ Data_Set.fromFoldable(Data_Foldable.foldableArray);
var toUnfoldable = /* #__PURE__ */ Data_Set.toUnfoldable(Data_Unfoldable.unfoldableArray);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var unions = /* #__PURE__ */ Data_Set.unions(Data_Foldable.foldableArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var toUnfoldable1 = /* #__PURE__ */ Data_Map_Internal.toUnfoldable(Data_Unfoldable.unfoldableArray);
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Maybe.functorMaybe);
var map2 = /* #__PURE__ */ Data_Functor.map(Data_Map_Internal.functorMap);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var fromFoldable1 = /* #__PURE__ */ Data_List.fromFoldable(Data_Foldable.foldableArray);
var maximum = /* #__PURE__ */ Data_Foldable.maximum(Data_Ord.ordInt)(Data_Foldable.foldableArray);
var toUnfoldable2 = /* #__PURE__ */ Data_List.toUnfoldable(Data_Unfoldable.unfoldableArray);
var toNumber = Data_Int.toNumber;
var taskNodesToSimpleGraph = function (dictOrd) {
    var fromFoldable2 = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    var fromFoldable3 = fromFoldable(dictOrd);
    return function (tasks) {
        return {
            nodes: mapFlipped(tasks)(function (v) {
                return v.id;
            }),
            edges: fromFoldable2(mapFlipped(tasks)(function (task) {
                return new Data_Tuple.Tuple(task.id, fromFoldable3(task.depends));
            }))
        };
    };
};
var stronglyConnectedComponents = function (dictOrd) {
    var insert = Data_Set.insert(dictOrd);
    var eq2 = Data_Eq.eq(dictOrd.Eq0());
    var $$delete = Data_Set["delete"](dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    var insert1 = Data_Map_Internal.insert(dictOrd);
    var member = Data_Set.member(dictOrd);
    var member1 = Data_Map_Internal.member(dictOrd);
    return function (graph) {
        var popUntil = function ($copy_stack) {
            return function ($copy_target) {
                return function ($copy_acc) {
                    var $tco_var_stack = $copy_stack;
                    var $tco_var_target = $copy_target;
                    var $tco_done = false;
                    var $tco_result;
                    function $tco_loop(stack, target, acc) {
                        var v = Data_Array.uncons(stack);
                        if (v instanceof Data_Maybe.Nothing) {
                            $tco_done = true;
                            return {
                                scc: acc,
                                remaining: [  ]
                            };
                        };
                        if (v instanceof Data_Maybe.Just) {
                            var acc$prime = insert(v.value0.head)(acc);
                            var $192 = eq2(v.value0.head)(target);
                            if ($192) {
                                $tco_done = true;
                                return {
                                    scc: acc$prime,
                                    remaining: v.value0.tail
                                };
                            };
                            $tco_var_stack = v.value0.tail;
                            $tco_var_target = target;
                            $copy_acc = acc$prime;
                            return;
                        };
                        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 590, column 5 - line 596, column 42): " + [ v.constructor.name ]);
                    };
                    while (!$tco_done) {
                        $tco_result = $tco_loop($tco_var_stack, $tco_var_target, $copy_acc);
                    };
                    return $tco_result;
                };
            };
        };
        var popSCC = function (state) {
            return function (v) {
                var result = popUntil(state.stack)(v)(Data_Set.empty);
                return {
                    index: state.index,
                    indices: state.indices,
                    lowlinks: state.lowlinks,
                    stack: result.remaining,
                    onStack: Data_Array.foldl(Data_Function.flip($$delete))(state.onStack)(toUnfoldable(result.scc)),
                    sccs: Data_Array.snoc(state.sccs)(result.scc)
                };
            };
        };
        var tarjanDFS = function (state) {
            return function (v) {
                var successors = (function () {
                    var v1 = lookup(v)(graph.edges);
                    if (v1 instanceof Data_Maybe.Nothing) {
                        return [  ];
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        return toUnfoldable(v1.value0);
                    };
                    throw new Error("Failed pattern match at Data.Graph.Algorithms (line 544, column 20 - line 546, column 63): " + [ v1.constructor.name ]);
                })();
                var state$prime = {
                    sccs: state.sccs,
                    index: state.index + 1 | 0,
                    stack: Data_Array.cons(v)(state.stack),
                    onStack: insert(v)(state.onStack),
                    indices: insert1(v)(state.index)(state.indices),
                    lowlinks: insert1(v)(state.index)(state.lowlinks)
                };
                var state$prime$prime = Data_Array.foldl(processSuccessor(v))(state$prime)(successors);
                var vIndex = Data_Maybe.fromMaybe(0)(lookup(v)(state$prime$prime.indices));
                var vLowlink = Data_Maybe.fromMaybe(0)(lookup(v)(state$prime$prime.lowlinks));
                var $198 = vLowlink === vIndex;
                if ($198) {
                    return popSCC(state$prime$prime)(v);
                };
                return state$prime$prime;
            };
        };
        var processSuccessor = function (v) {
            return function (state) {
                return function (w) {
                    var v1 = lookup(w)(state.indices);
                    if (v1 instanceof Data_Maybe.Nothing) {
                        var state$prime = tarjanDFS(state)(w);
                        var vLowlink = Data_Maybe.fromMaybe(0)(lookup(v)(state$prime.lowlinks));
                        var wLowlink = Data_Maybe.fromMaybe(0)(lookup(w)(state$prime.lowlinks));
                        return {
                            index: state$prime.index,
                            stack: state$prime.stack,
                            onStack: state$prime.onStack,
                            indices: state$prime.indices,
                            sccs: state$prime.sccs,
                            lowlinks: insert1(v)(min(vLowlink)(wLowlink))(state$prime.lowlinks)
                        };
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        var $200 = member(w)(state.onStack);
                        if ($200) {
                            var vLowlink = Data_Maybe.fromMaybe(0)(lookup(v)(state.lowlinks));
                            return {
                                index: state.index,
                                stack: state.stack,
                                onStack: state.onStack,
                                indices: state.indices,
                                sccs: state.sccs,
                                lowlinks: insert1(v)(min(vLowlink)(v1.value0))(state.lowlinks)
                            };
                        };
                        return state;
                    };
                    throw new Error("Failed pattern match at Data.Graph.Algorithms (line 561, column 5 - line 575, column 19): " + [ v1.constructor.name ]);
                };
            };
        };
        var initialState = {
            index: 0,
            stack: [  ],
            onStack: Data_Set.empty,
            indices: Data_Map_Internal.empty,
            lowlinks: Data_Map_Internal.empty,
            sccs: [  ]
        };
        var result = Data_Array.foldl(function (state) {
            return function (node) {
                var $202 = member1(node)(state.indices);
                if ($202) {
                    return state;
                };
                return tarjanDFS(state)(node);
            };
        })(initialState)(graph.nodes);
        return result.sccs;
    };
};
var simpleGraphToTaskNodes = function (dictOrd) {
    var lookup = Data_Map_Internal.lookup(dictOrd);
    return function (graph) {
        return mapFlipped(graph.nodes)(function (node) {
            return {
                id: node,
                depends: (function () {
                    var v = lookup(node)(graph.edges);
                    if (v instanceof Data_Maybe.Nothing) {
                        return [  ];
                    };
                    if (v instanceof Data_Maybe.Just) {
                        return toUnfoldable(v.value0);
                    };
                    throw new Error("Failed pattern match at Data.Graph.Algorithms (line 246, column 16 - line 248, column 49): " + [ v.constructor.name ]);
                })()
            };
        });
    };
};
var reachableFrom = function (dictOrd) {
    var unions1 = unions(dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    var difference = Data_Set.difference(dictOrd);
    var union = Data_Set.union(dictOrd);
    return function (start) {
        return function (graph) {
            var go = function ($copy_visited) {
                return function ($copy_frontier) {
                    var $tco_var_visited = $copy_visited;
                    var $tco_done = false;
                    var $tco_result;
                    function $tco_loop(visited, frontier) {
                        if (Data_Set.isEmpty(frontier)) {
                            $tco_done = true;
                            return visited;
                        };
                        if (Data_Boolean.otherwise) {
                            var neighbors = unions1(Data_Array.catMaybes(mapFlipped(toUnfoldable(frontier))(function (n) {
                                return lookup(n)(graph.edges);
                            })));
                            var newNodes = difference(neighbors)(visited);
                            $tco_var_visited = union(visited)(frontier);
                            $copy_frontier = newNodes;
                            return;
                        };
                        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 88, column 5 - line 88, column 43): " + [ visited.constructor.name, frontier.constructor.name ]);
                    };
                    while (!$tco_done) {
                        $tco_result = $tco_loop($tco_var_visited, $copy_frontier);
                    };
                    return $tco_result;
                };
            };
            return go(Data_Set.empty)(Data_Set.singleton(start));
        };
    };
};
var transitiveReduction = function (dictOrd) {
    var $$delete = Data_Set["delete"](dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    var member = Data_Set.member(dictOrd);
    var reachableFrom1 = reachableFrom(dictOrd);
    var filter = Data_Set.filter(dictOrd);
    var fromFoldable2 = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    return function (graph) {
        var isTransitive = function (source) {
            return function (target) {
                var intermediates = $$delete(target)(Data_Maybe.fromMaybe(Data_Set.empty)(lookup(source)(graph.edges)));
                var reachableThroughIntermediate = Data_Array.any(function (intermediate) {
                    return member(target)(reachableFrom1(intermediate)(graph));
                })(toUnfoldable(intermediates));
                return reachableThroughIntermediate;
            };
        };
        var reduceEdge = function (v) {
            return new Data_Tuple.Tuple(v.value0, filter((function () {
                var $290 = isTransitive(v.value0);
                return function ($291) {
                    return !$290($291);
                };
            })())(v.value1));
        };
        return {
            nodes: graph.nodes,
            edges: fromFoldable2(map(reduceEdge)(toUnfoldable1(graph.edges)))
        };
    };
};
var outDegreeCentrality = function (dictOrd) {
    var fromFoldable2 = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    return function (graph) {
        var n = Data_Array.length(graph.nodes);
        var normalizer = (function () {
            var $210 = n <= 1;
            if ($210) {
                return 1.0;
            };
            return toNumber(n - 1 | 0);
        })();
        return fromFoldable2(mapFlipped(graph.nodes)(function (node) {
            var outDeg = (function () {
                var v = lookup(node)(graph.edges);
                if (v instanceof Data_Maybe.Nothing) {
                    return 0;
                };
                if (v instanceof Data_Maybe.Just) {
                    return Data_Set.size(v.value0);
                };
                throw new Error("Failed pattern match at Data.Graph.Algorithms (line 437, column 20 - line 439, column 45): " + [ v.constructor.name ]);
            })();
            return new Data_Tuple.Tuple(node, toNumber(outDeg) / normalizer);
        }));
    };
};
var labelPropagation = function (dictOrd) {
    var alter = Data_Map_Internal.alter(dictOrd);
    var union = Data_Set.union(dictOrd);
    var insert = Data_Set.insert(dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    var insert1 = Data_Map_Internal.insert(dictOrd);
    var Eq0 = dictOrd.Eq0();
    var eq2 = Data_Eq.eq(Data_Map_Internal.eqMap(Eq0)(Eq0));
    var fromFoldable2 = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    return function (graph) {
        var findMostCommon = function (labels) {
            var counts = Data_Array.foldl(function (acc) {
                return function (l) {
                    return alter((function () {
                        var $292 = Data_Maybe.fromMaybe(0);
                        return function ($293) {
                            return Data_Maybe.Just.create((function (v) {
                                return v + 1 | 0;
                            })($292($293)));
                        };
                    })())(l)(acc);
                };
            })(Data_Map_Internal.empty)(labels);
            var maxEntry = Data_Array.foldl(function (best) {
                return function (v) {
                    if (best instanceof Data_Maybe.Nothing) {
                        return new Data_Maybe.Just(new Data_Tuple.Tuple(v.value0, v.value1));
                    };
                    if (best instanceof Data_Maybe.Just) {
                        var $215 = v.value1 > best.value0.value1;
                        if ($215) {
                            return new Data_Maybe.Just(new Data_Tuple.Tuple(v.value0, v.value1));
                        };
                        return best;
                    };
                    throw new Error("Failed pattern match at Data.Graph.Algorithms (line 764, column 11 - line 769, column 24): " + [ best.constructor.name ]);
                };
            })(Data_Maybe.Nothing.value)(toUnfoldable1(counts));
            return map1(function (v) {
                return v.value0;
            })(maxEntry);
        };
        var buildUndirectedNeighbors = function (g) {
            return Data_Array.foldl(function (acc) {
                return function (v) {
                    var acc$prime = alter((function () {
                        var $294 = union(v.value1);
                        var $295 = Data_Maybe.fromMaybe(Data_Set.empty);
                        return function ($296) {
                            return Data_Maybe.Just.create($294($295($296)));
                        };
                    })())(v.value0)(acc);
                    var acc$prime$prime = Data_Array.foldl(function (a) {
                        return function (tgt) {
                            return alter((function () {
                                var $297 = insert(v.value0);
                                var $298 = Data_Maybe.fromMaybe(Data_Set.empty);
                                return function ($299) {
                                    return Data_Maybe.Just.create($297($298($299)));
                                };
                            })())(tgt)(a);
                        };
                    })(acc$prime)(toUnfoldable(v.value1));
                    return acc$prime$prime;
                };
            })(Data_Map_Internal.empty)(toUnfoldable1(g.edges));
        };
        var undirectedNeighbors = buildUndirectedNeighbors(graph);
        var propagateOnce = function (labels) {
            return Data_Array.foldl(function (acc) {
                return function (node) {
                    var neighbors = Data_Maybe.fromMaybe(Data_Set.empty)(lookup(node)(undirectedNeighbors));
                    var neighborLabels = Data_Array.catMaybes(mapFlipped(toUnfoldable(neighbors))(function (n) {
                        return lookup(n)(acc);
                    }));
                    var mostCommon = findMostCommon(neighborLabels);
                    var newLabel = (function () {
                        if (mostCommon instanceof Data_Maybe.Nothing) {
                            return node;
                        };
                        if (mostCommon instanceof Data_Maybe.Just) {
                            return mostCommon.value0;
                        };
                        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 739, column 24 - line 741, column 26): " + [ mostCommon.constructor.name ]);
                    })();
                    return insert1(node)(newLabel)(acc);
                };
            })(labels)(graph.nodes);
        };
        var iterate = function ($copy_remaining) {
            return function ($copy_labels) {
                var $tco_var_remaining = $copy_remaining;
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(remaining, labels) {
                    if (remaining <= 0) {
                        $tco_done = true;
                        return labels;
                    };
                    if (Data_Boolean.otherwise) {
                        var newLabels = propagateOnce(labels);
                        var $231 = eq2(labels)(newLabels);
                        if ($231) {
                            $tco_done = true;
                            return labels;
                        };
                        $tco_var_remaining = remaining - 1 | 0;
                        $copy_labels = newLabels;
                        return;
                    };
                    throw new Error("Failed pattern match at Data.Graph.Algorithms (line 722, column 5 - line 722, column 53): " + [ remaining.constructor.name, labels.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($tco_var_remaining, $copy_labels);
                };
                return $tco_result;
            };
        };
        var initialLabels = fromFoldable2(mapFlipped(graph.nodes)(function (n) {
            return new Data_Tuple.Tuple(n, n);
        }));
        return iterate(100)(initialLabels);
    };
};
var isSCC = function (dictOrd) {
    var stronglyConnectedComponents1 = stronglyConnectedComponents(dictOrd);
    return function (graph) {
        var components = stronglyConnectedComponents1(graph);
        return Data_Array.length(components) === 1;
    };
};
var inDegreeCentrality = function (dictOrd) {
    var alter = Data_Map_Internal.alter(dictOrd);
    var fromFoldable2 = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    return function (graph) {
        var n = Data_Array.length(graph.nodes);
        var normalizer = (function () {
            var $232 = n <= 1;
            if ($232) {
                return 1.0;
            };
            return toNumber(n - 1 | 0);
        })();
        var inDegrees = Data_Array.foldl(function (acc) {
            return function (v) {
                return Data_Array.foldl(function (a) {
                    return function (tgt) {
                        return alter((function () {
                            var $300 = Data_Maybe.fromMaybe(0);
                            return function ($301) {
                                return Data_Maybe.Just.create((function (v1) {
                                    return v1 + 1 | 0;
                                })($300($301)));
                            };
                        })())(tgt)(a);
                    };
                })(acc)(toUnfoldable(v.value1));
            };
        })(fromFoldable2(mapFlipped(graph.nodes)(function (n$prime) {
            return new Data_Tuple.Tuple(n$prime, 0);
        })))(toUnfoldable1(graph.edges));
        return map2(function (deg) {
            return toNumber(deg) / normalizer;
        })(inDegrees);
    };
};
var getAllEdges = function (dictOrd) {
    var lookup = Data_Map_Internal.lookup(dictOrd);
    return function (graph) {
        return Data_Array.concat(mapFlipped(graph.nodes)(function (source) {
            var v = lookup(source)(graph.edges);
            if (v instanceof Data_Maybe.Nothing) {
                return [  ];
            };
            if (v instanceof Data_Maybe.Just) {
                return mapFlipped(toUnfoldable(v.value0))(function (target) {
                    return new Data_Tuple.Tuple(source, target);
                });
            };
            throw new Error("Failed pattern match at Data.Graph.Algorithms (line 224, column 5 - line 227, column 28): " + [ v.constructor.name ]);
        }));
    };
};
var getRemovedEdges = function (dictOrd) {
    var getAllEdges1 = getAllEdges(dictOrd);
    var Eq0 = dictOrd.Eq0();
    var difference = Data_Array.difference(Data_Tuple.eqTuple(Eq0)(Eq0));
    return function (original) {
        return function (reduced) {
            var reducedEdges = getAllEdges1(reduced);
            var originalEdges = getAllEdges1(original);
            return difference(originalEdges)(reducedEdges);
        };
    };
};
var modularity = function (dictOrd) {
    var member = Data_Set.member(dictOrd);
    var getAllEdges1 = getAllEdges(dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    var eq2 = Data_Eq.eq(Data_Maybe.eqMaybe(dictOrd.Eq0()));
    return function (graph) {
        return function (communities) {
            var countInDegree = function (n) {
                return Data_Array.foldl(function (acc) {
                    return function (v) {
                        var $239 = member(n)(v.value1);
                        if ($239) {
                            return acc + 1 | 0;
                        };
                        return acc;
                    };
                })(0)(toUnfoldable1(graph.edges));
            };
            var m = toNumber(Data_Array.length(getAllEdges1(graph)));
            var twoM = 2.0 * m;
            var result = Data_Array.foldl(function (acc) {
                return function (v) {
                    var sourceOutDeg = Data_Set.size(v.value1);
                    var sourceInDeg = countInDegree(v.value0);
                    var sourceCommunity = lookup(v.value0)(communities);
                    return Data_Array.foldl(function (a) {
                        return function (target) {
                            var targetOutDeg = (function () {
                                var v1 = lookup(target)(graph.edges);
                                if (v1 instanceof Data_Maybe.Nothing) {
                                    return 0;
                                };
                                if (v1 instanceof Data_Maybe.Just) {
                                    return Data_Set.size(v1.value0);
                                };
                                throw new Error("Failed pattern match at Data.Graph.Algorithms (line 791, column 29 - line 793, column 36): " + [ v1.constructor.name ]);
                            })();
                            var targetInDeg = countInDegree(target);
                            var targetCommunity = lookup(target)(communities);
                            var sameComm = (function () {
                                var $245 = eq2(sourceCommunity)(targetCommunity);
                                if ($245) {
                                    return 1.0;
                                };
                                return 0.0;
                            })();
                            var expected = (toNumber(sourceOutDeg + sourceInDeg | 0) * toNumber(targetOutDeg + targetInDeg | 0)) / twoM;
                            return (a + sameComm) - expected;
                        };
                    })(acc)(toUnfoldable(v.value1));
                };
            })(0.0)(toUnfoldable1(graph.edges));
            var $248 = m === 0.0;
            if ($248) {
                return 0.0;
            };
            return result / twoM;
        };
    };
};
var findCycle = function (dictOrd) {
    var member = Data_Set.member(dictOrd);
    var eq2 = Data_Eq.eq(dictOrd.Eq0());
    var $$delete = Data_Set["delete"](dictOrd);
    var insert = Data_Set.insert(dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    var fromFoldable2 = fromFoldable(dictOrd);
    return function (graph) {
        var dfs = function (state) {
            return function (node) {
                if (member(node)(state.gray)) {
                    var cycleStart = Data_Array.findIndex(function (v) {
                        return eq2(v)(node);
                    })(state.path);
                    if (cycleStart instanceof Data_Maybe.Just) {
                        return {
                            gray: state.gray,
                            path: state.path,
                            black: state.black,
                            white: state.white,
                            cycle: new Data_Maybe.Just(append(Data_Array.drop(cycleStart.value0)(state.path))([ node ]))
                        };
                    };
                    if (cycleStart instanceof Data_Maybe.Nothing) {
                        return {
                            gray: state.gray,
                            path: state.path,
                            black: state.black,
                            white: state.white,
                            cycle: new Data_Maybe.Just([ node ])
                        };
                    };
                    throw new Error("Failed pattern match at Data.Graph.Algorithms (line 292, column 12 - line 294, column 54): " + [ cycleStart.constructor.name ]);
                };
                if (member(node)(state.black)) {
                    return state;
                };
                if (Data_Boolean.otherwise) {
                    var state$prime = {
                        black: state.black,
                        cycle: state.cycle,
                        white: $$delete(node)(state.white),
                        gray: insert(node)(state.gray),
                        path: Data_Array.snoc(state.path)(node)
                    };
                    var neighbors = (function () {
                        var v = lookup(node)(graph.edges);
                        if (v instanceof Data_Maybe.Nothing) {
                            return [  ];
                        };
                        if (v instanceof Data_Maybe.Just) {
                            return toUnfoldable(v.value0);
                        };
                        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 305, column 23 - line 307, column 53): " + [ v.constructor.name ]);
                    })();
                    var state$prime$prime = Data_Array.foldl(dfs)(state$prime)(neighbors);
                    if (state$prime$prime.cycle instanceof Data_Maybe.Just) {
                        return state$prime$prime;
                    };
                    if (state$prime$prime.cycle instanceof Data_Maybe.Nothing) {
                        return {
                            cycle: state$prime$prime.cycle,
                            white: state$prime$prime.white,
                            gray: $$delete(node)(state$prime$prime.gray),
                            black: insert(node)(state$prime$prime.black),
                            path: Data_Maybe.fromMaybe([  ])(Data_Array.init(state$prime$prime.path))
                        };
                    };
                    throw new Error("Failed pattern match at Data.Graph.Algorithms (line 310, column 11 - line 318, column 18): " + [ state$prime$prime.cycle.constructor.name ]);
                };
                throw new Error("Failed pattern match at Data.Graph.Algorithms (line 287, column 3 - line 318, column 18): " + [ state.constructor.name, node.constructor.name ]);
            };
        };
        var initialState = {
            white: fromFoldable2(graph.nodes),
            gray: Data_Set.empty,
            black: Data_Set.empty,
            path: [  ],
            cycle: Data_Maybe.Nothing.value
        };
        var result = Data_Array.foldl(function (state) {
            return function (node) {
                if (state.cycle instanceof Data_Maybe.Just) {
                    return state;
                };
                if (state.cycle instanceof Data_Maybe.Nothing) {
                    var $259 = member(node)(state.white);
                    if ($259) {
                        return dfs(state)(node);
                    };
                    return state;
                };
                throw new Error("Failed pattern match at Data.Graph.Algorithms (line 278, column 7 - line 283, column 21): " + [ state.cycle.constructor.name ]);
            };
        })(initialState)(graph.nodes);
        return result.cycle;
    };
};
var hasCycle = function (dictOrd) {
    var findCycle1 = findCycle(dictOrd);
    return function (graph) {
        var v = findCycle1(graph);
        if (v instanceof Data_Maybe.Nothing) {
            return false;
        };
        if (v instanceof Data_Maybe.Just) {
            return true;
        };
        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 264, column 18 - line 266, column 17): " + [ v.constructor.name ]);
    };
};
var isDAG = function (dictOrd) {
    var $302 = hasCycle(dictOrd);
    return function ($303) {
        return !$302($303);
    };
};
var density = function (dictOrd) {
    var getAllEdges1 = getAllEdges(dictOrd);
    return function (graph) {
        var n = Data_Array.length(graph.nodes);
        var maxEdges = n * (n - 1 | 0) | 0;
        var e = Data_Array.length(getAllEdges1(graph));
        var $262 = maxEdges === 0;
        if ($262) {
            return 0.0;
        };
        return toNumber(e) / toNumber(maxEdges);
    };
};
var degreeCentrality = function (dictOrd) {
    var outDegreeCentrality1 = outDegreeCentrality(dictOrd);
    var inDegreeCentrality1 = inDegreeCentrality(dictOrd);
    var fromFoldable2 = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    return function (graph) {
        var outDegrees = outDegreeCentrality1(graph);
        var n = Data_Array.length(graph.nodes);
        var normalizer = (function () {
            var $263 = n <= 1;
            if ($263) {
                return 1.0;
            };
            return toNumber(n - 1 | 0);
        })();
        var inDegrees = inDegreeCentrality1(graph);
        return fromFoldable2(mapFlipped(graph.nodes)(function (node) {
            var outDeg = Data_Maybe.fromMaybe(0.0)(lookup(node)(outDegrees));
            var inDeg = Data_Maybe.fromMaybe(0.0)(lookup(node)(inDegrees));
            return new Data_Tuple.Tuple(node, ((inDeg + outDeg) * toNumber(n - 1 | 0)) / normalizer);
        }));
    };
};
var defaultPageRankConfig = {
    dampingFactor: 0.85,
    iterations: 100,
    tolerance: 1.0e-6
};
var connectedComponents = function (dictOrd) {
    var alter = Data_Map_Internal.alter(dictOrd);
    var union = Data_Set.union(dictOrd);
    var insert = Data_Set.insert(dictOrd);
    var unions1 = unions(dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    var difference = Data_Set.difference(dictOrd);
    var member = Data_Set.member(dictOrd);
    return function (graph) {
        var buildUndirectedEdges = function (g) {
            return Data_Array.foldl(function (acc) {
                return function (v) {
                    var acc$prime = alter((function () {
                        var $304 = union(v.value1);
                        var $305 = Data_Maybe.fromMaybe(Data_Set.empty);
                        return function ($306) {
                            return Data_Maybe.Just.create($304($305($306)));
                        };
                    })())(v.value0)(acc);
                    var acc$prime$prime = Data_Array.foldl(function (a) {
                        return function (tgt) {
                            return alter((function () {
                                var $307 = insert(v.value0);
                                var $308 = Data_Maybe.fromMaybe(Data_Set.empty);
                                return function ($309) {
                                    return Data_Maybe.Just.create($307($308($309)));
                                };
                            })())(tgt)(a);
                        };
                    })(acc$prime)(toUnfoldable(v.value1));
                    return acc$prime$prime;
                };
            })(Data_Map_Internal.empty)(toUnfoldable1(g.edges));
        };
        var bfsComponent = function (start) {
            return function (edges) {
                return function (visited) {
                    var go = function ($copy_component) {
                        return function ($copy_frontier) {
                            var $tco_var_component = $copy_component;
                            var $tco_done = false;
                            var $tco_result;
                            function $tco_loop(component, frontier) {
                                if (Data_Set.isEmpty(frontier)) {
                                    $tco_done = true;
                                    return component;
                                };
                                if (Data_Boolean.otherwise) {
                                    var neighbors = unions1(Data_Array.catMaybes(mapFlipped(toUnfoldable(frontier))(function (n) {
                                        return lookup(n)(edges);
                                    })));
                                    var newNodes = difference(neighbors)(component);
                                    var newNodes$prime = difference(newNodes)(visited);
                                    $tco_var_component = union(component)(newNodes$prime);
                                    $copy_frontier = newNodes$prime;
                                    return;
                                };
                                throw new Error("Failed pattern match at Data.Graph.Algorithms (line 367, column 5 - line 375, column 58): " + [ component.constructor.name, frontier.constructor.name ]);
                            };
                            while (!$tco_done) {
                                $tco_result = $tco_loop($tco_var_component, $copy_frontier);
                            };
                            return $tco_result;
                        };
                    };
                    return go(Data_Set.singleton(start))(Data_Set.singleton(start));
                };
            };
        };
        var undirectedEdges = buildUndirectedEdges(graph);
        var result = Data_Array.foldl(function (v) {
            return function (node) {
                var $270 = member(node)(v.visited);
                if ($270) {
                    return {
                        visited: v.visited,
                        components: v.components
                    };
                };
                var component = bfsComponent(node)(undirectedEdges)(v.visited);
                return {
                    visited: union(v.visited)(component),
                    components: Data_Array.snoc(v.components)(component)
                };
            };
        })({
            visited: Data_Set.empty,
            components: [  ]
        })(graph.nodes);
        return result.components;
    };
};
var isConnected = function (dictOrd) {
    var connectedComponents1 = connectedComponents(dictOrd);
    return function (graph) {
        var v = Data_Array.head(graph.nodes);
        if (v instanceof Data_Maybe.Nothing) {
            return true;
        };
        if (v instanceof Data_Maybe.Just) {
            var components = connectedComponents1(graph);
            return Data_Array.length(components) <= 1;
        };
        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 380, column 3 - line 384, column 38): " + [ v.constructor.name ]);
    };
};
var buildReverseEdges = function (dictOrd) {
    var alter = Data_Map_Internal.alter(dictOrd);
    var insert = Data_Set.insert(dictOrd);
    return function (graph) {
        return Data_Array.foldl(function (acc) {
            return function (v) {
                return Data_Array.foldl(function (a) {
                    return function (target) {
                        return alter((function () {
                            var $310 = insert(v.value0);
                            var $311 = Data_Maybe.fromMaybe(Data_Set.empty);
                            return function ($312) {
                                return Data_Maybe.Just.create($310($311($312)));
                            };
                        })())(target)(a);
                    };
                })(acc)(toUnfoldable(v.value1));
            };
        })(Data_Map_Internal.empty)(toUnfoldable1(graph.edges));
    };
};
var pageRankWithConfig = function (dictOrd) {
    var buildReverseEdges1 = buildReverseEdges(dictOrd);
    var fromFoldable2 = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    return function (config) {
        return function (graph) {
            var reverseEdges = buildReverseEdges1(graph);
            var outDegrees = fromFoldable2(mapFlipped(graph.nodes)(function (node) {
                return new Data_Tuple.Tuple(node, (function () {
                    var v = lookup(node)(graph.edges);
                    if (v instanceof Data_Maybe.Nothing) {
                        return 0;
                    };
                    if (v instanceof Data_Maybe.Just) {
                        return Data_Set.size(v.value0);
                    };
                    throw new Error("Failed pattern match at Data.Graph.Algorithms (line 648, column 20 - line 650, column 41): " + [ v.constructor.name ]);
                })());
            }));
            var n = Data_Array.length(graph.nodes);
            var initialScore = (function () {
                var $280 = n === 0;
                if ($280) {
                    return 0.0;
                };
                return 1.0 / toNumber(n);
            })();
            var initialRanks = fromFoldable2(mapFlipped(graph.nodes)(function (node) {
                return new Data_Tuple.Tuple(node, initialScore);
            }));
            var hasConverged = function (old) {
                return function ($$new) {
                    var diff = Data_Array.foldl(function (acc) {
                        return function (node) {
                            var oldVal = Data_Maybe.fromMaybe(0.0)(lookup(node)(old));
                            var newVal = Data_Maybe.fromMaybe(0.0)(lookup(node)($$new));
                            return acc + Data_Number.abs(newVal - oldVal);
                        };
                    })(0.0)(graph.nodes);
                    return diff < config.tolerance;
                };
            };
            var computeNewRanks = function (ranks) {
                return fromFoldable2(mapFlipped(graph.nodes)(function (node) {
                    var inLinks = Data_Maybe.fromMaybe(Data_Set.empty)(lookup(node)(reverseEdges));
                    var contribution = Data_Array.foldl(function (acc) {
                        return function (source) {
                            var sourceRank = Data_Maybe.fromMaybe(0.0)(lookup(source)(ranks));
                            var sourceOutDeg = Data_Maybe.fromMaybe(1)(lookup(source)(outDegrees));
                            return acc + sourceRank / toNumber(max(1)(sourceOutDeg));
                        };
                    })(0.0)(toUnfoldable(inLinks));
                    var newRank = (1.0 - config.dampingFactor) / toNumber(n) + config.dampingFactor * contribution;
                    return new Data_Tuple.Tuple(node, newRank);
                }));
            };
            var iterate = function ($copy_remaining) {
                return function ($copy_ranks) {
                    var $tco_var_remaining = $copy_remaining;
                    var $tco_done = false;
                    var $tco_result;
                    function $tco_loop(remaining, ranks) {
                        if (remaining <= 0) {
                            $tco_done = true;
                            return ranks;
                        };
                        if (Data_Boolean.otherwise) {
                            var newRanks = computeNewRanks(ranks);
                            var converged = hasConverged(ranks)(newRanks);
                            if (converged) {
                                $tco_done = true;
                                return newRanks;
                            };
                            $tco_var_remaining = remaining - 1 | 0;
                            $copy_ranks = newRanks;
                            return;
                        };
                        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 655, column 5 - line 655, column 57): " + [ remaining.constructor.name, ranks.constructor.name ]);
                    };
                    while (!$tco_done) {
                        $tco_result = $tco_loop($tco_var_remaining, $copy_ranks);
                    };
                    return $tco_result;
                };
            };
            return iterate(config.iterations)(initialRanks);
        };
    };
};
var pageRank = function (dictOrd) {
    return pageRankWithConfig(dictOrd)(defaultPageRankConfig);
};
var buildGraph = function (dictOrd) {
    var insert = Data_Map_Internal.insert(dictOrd);
    return function (tasks) {
        var addTask = function (acc) {
            return function (task) {
                return insert(task.id)(new Data_Tuple.Tuple(task, fromFoldable1(task.depends)))(acc);
            };
        };
        var graphMap = Data_Array.foldl(addTask)(Data_Map_Internal.empty)(tasks);
        return Data_Graph.fromMap(graphMap);
    };
};
var getTopologicalOrder = function (dictOrd) {
    var buildGraph1 = buildGraph(dictOrd);
    var topologicalSort = Data_Graph.topologicalSort(dictOrd);
    return function (tasks) {
        var graph = buildGraph1(tasks);
        return topologicalSort(graph);
    };
};
var computeLayers = function (dictOrd) {
    var fromFoldable2 = Data_Map_Internal.fromFoldable(dictOrd)(Data_Foldable.foldableArray);
    var getTopologicalOrder1 = getTopologicalOrder(dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    var insert = Data_Map_Internal.insert(dictOrd);
    return function (tasks) {
        var taskMap = fromFoldable2(mapFlipped(tasks)(function (t) {
            return new Data_Tuple.Tuple(t.id, t);
        }));
        var sortedIds = Data_List.reverse(getTopologicalOrder1(tasks));
        var processTask = function (accLayers) {
            return function (taskId) {
                var v = lookup(taskId)(taskMap);
                if (v instanceof Data_Maybe.Nothing) {
                    return accLayers;
                };
                if (v instanceof Data_Maybe.Just) {
                    var layer = (function () {
                        var $285 = Data_Array["null"](v.value0.depends);
                        if ($285) {
                            return 0;
                        };
                        var depLayers = mapFlipped(v.value0.depends)(function (depId) {
                            return Data_Maybe.fromMaybe(0)(lookup(depId)(accLayers));
                        });
                        var v1 = maximum(depLayers);
                        if (v1 instanceof Data_Maybe.Just) {
                            return v1.value0 + 1 | 0;
                        };
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return 0;
                        };
                        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 163, column 22 - line 165, column 36): " + [ v1.constructor.name ]);
                    })();
                    return insert(taskId)(layer)(accLayers);
                };
                throw new Error("Failed pattern match at Data.Graph.Algorithms (line 152, column 7 - line 166, column 47): " + [ v.constructor.name ]);
            };
        };
        return Data_Array.foldl(processTask)(Data_Map_Internal.empty)(toUnfoldable2(sortedIds));
    };
};
var averageDegree = function (dictOrd) {
    var getAllEdges1 = getAllEdges(dictOrd);
    return function (graph) {
        var n = Data_Array.length(graph.nodes);
        var e = Data_Array.length(getAllEdges1(graph));
        var $289 = n === 0;
        if ($289) {
            return 0.0;
        };
        return toNumber(2 * e | 0) / toNumber(n);
    };
};
var graphMetrics = function (dictOrd) {
    var getAllEdges1 = getAllEdges(dictOrd);
    var connectedComponents1 = connectedComponents(dictOrd);
    var density1 = density(dictOrd);
    var averageDegree1 = averageDegree(dictOrd);
    var isDAG1 = isDAG(dictOrd);
    return function (graph) {
        var nodeCount = Data_Array.length(graph.nodes);
        var edgeCount = Data_Array.length(getAllEdges1(graph));
        var components = connectedComponents1(graph);
        return {
            nodeCount: nodeCount,
            edgeCount: edgeCount,
            density: density1(graph),
            averageDegree: averageDegree1(graph),
            isConnected: Data_Array.length(components) <= 1,
            isDAG: isDAG1(graph),
            componentCount: Data_Array.length(components)
        };
    };
};
var addLayers = function (dictOrd) {
    var computeLayers1 = computeLayers(dictOrd);
    var lookup = Data_Map_Internal.lookup(dictOrd);
    return function (tasks) {
        var layers = computeLayers1(tasks);
        return mapFlipped(tasks)(function (t) {
            return {
                id: t.id,
                layer: Data_Maybe.fromMaybe(0)(lookup(t.id)(layers)),
                depends: t.depends
            };
        });
    };
};
export {
    reachableFrom,
    buildGraph,
    getTopologicalOrder,
    computeLayers,
    addLayers,
    transitiveReduction,
    getRemovedEdges,
    getAllEdges,
    hasCycle,
    findCycle,
    isDAG,
    connectedComponents,
    isConnected,
    degreeCentrality,
    inDegreeCentrality,
    outDegreeCentrality,
    graphMetrics,
    density,
    averageDegree,
    stronglyConnectedComponents,
    isSCC,
    pageRank,
    pageRankWithConfig,
    labelPropagation,
    modularity,
    taskNodesToSimpleGraph,
    simpleGraphToTaskNodes
};
//# sourceMappingURL=index.js.map
