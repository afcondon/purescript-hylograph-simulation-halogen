// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Ordering from "../Data.Ordering/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var compare = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordInt);
var compare1 = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordNumber);
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var TNode = /* #__PURE__ */ (function () {
    function TNode(value0) {
        this.value0 = value0;
    };
    TNode.create = function (value0) {
        return new TNode(value0);
    };
    return TNode;
})();
var toTreemapNode = function (v) {
    return new TNode({
        data_: v.value0.data_,
        depth: v.value0.depth,
        height: v.value0.height,
        value: v.value0.value,
        children: map(toTreemapNode)(v.value0.children),
        x0: 0.0,
        y0: 0.0,
        x1: 0.0,
        y1: 0.0
    });
};
var slice = function (v) {
    return function (x0) {
        return function (y0) {
            return function (x1) {
                return function (y1) {
                    var k = (function () {
                        var $91 = v.value0.value !== 0.0;
                        if ($91) {
                            return (y1 - y0) / v.value0.value;
                        };
                        return 0.0;
                    })();
                    var positioned = foldl(function (acc) {
                        return function (child) {
                            var height = child.value0.value * k;
                            var positionedChild = new TNode({
                                data_: child.value0.data_,
                                depth: child.value0.depth,
                                height: child.value0.height,
                                value: child.value0.value,
                                children: child.value0.children,
                                x0: x0,
                                x1: x1,
                                y0: acc.y,
                                y1: acc.y + height
                            });
                            return {
                                children: Data_Array.snoc(acc.children)(positionedChild),
                                y: acc.y + height
                            };
                        };
                    })({
                        children: [  ],
                        y: y0
                    })(v.value0.children);
                    return new TNode({
                        data_: v.value0.data_,
                        depth: v.value0.depth,
                        height: v.value0.height,
                        value: v.value0.value,
                        x0: v.value0.x0,
                        y0: v.value0.y0,
                        x1: v.value0.x1,
                        y1: v.value0.y1,
                        children: positioned.children
                    });
                };
            };
        };
    };
};
var showTreemapNode = function (dictShow) {
    var show1 = Data_Show.show(dictShow);
    return {
        show: function (v) {
            return "TNode { data_: " + (show1(v.value0.data_) + (", bounds: [" + (show(v.value0.x0) + ("," + (show(v.value0.y0) + ("," + (show(v.value0.x1) + ("," + (show(v.value0.y1) + "] }")))))))));
        }
    };
};
var positionTree = function (config) {
    return function (v) {
        return function (paddingStack) {
            var p = (function () {
                var v1 = Data_Array.index(paddingStack)(v.value0.depth);
                if (v1 instanceof Data_Maybe.Just) {
                    return v1.value0;
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return 0.0;
                };
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 125, column 9 - line 127, column 21): " + [ v1.constructor.name ]);
            })();
            var x0 = v.value0.x0 + p;
            var x1 = v.value0.x1 - p;
            var x0$prime = (function () {
                var $102 = x1 < x0;
                if ($102) {
                    return (x0 + x1) / 2.0;
                };
                return x0;
            })();
            var x1$prime = (function () {
                var $103 = x1 < x0;
                if ($103) {
                    return (x0 + x1) / 2.0;
                };
                return x1;
            })();
            var y0 = v.value0.y0 + p;
            var y1 = v.value0.y1 - p;
            var y0$prime = (function () {
                var $104 = y1 < y0;
                if ($104) {
                    return (y0 + y1) / 2.0;
                };
                return y0;
            })();
            var y1$prime = (function () {
                var $105 = y1 < y0;
                if ($105) {
                    return (y0 + y1) / 2.0;
                };
                return y1;
            })();
            var nodeWithPadding = new TNode({
                data_: v.value0.data_,
                depth: v.value0.depth,
                height: v.value0.height,
                value: v.value0.value,
                children: v.value0.children,
                x0: x0$prime,
                y0: y0$prime,
                x1: x1$prime,
                y1: y1$prime
            });
            var $106 = Data_Array["null"](v.value0.children);
            if ($106) {
                return nodeWithPadding;
            };
            var innerPad = config.paddingInner / 2.0;
            var newPaddingStack = append1(paddingStack)([ innerPad ]);
            var childY1 = (y1$prime - config.paddingBottom) + innerPad;
            var childY0 = (y0$prime + config.paddingTop) - innerPad;
            var childY0$prime = (function () {
                var $107 = childY1 < childY0;
                if ($107) {
                    return (childY0 + childY1) / 2.0;
                };
                return childY0;
            })();
            var childY1$prime = (function () {
                var $108 = childY1 < childY0;
                if ($108) {
                    return (childY0 + childY1) / 2.0;
                };
                return childY1;
            })();
            var childX1 = (x1$prime - config.paddingRight) + innerPad;
            var childX0 = (x0$prime + config.paddingLeft) - innerPad;
            var childX0$prime = (function () {
                var $109 = childX1 < childX0;
                if ($109) {
                    return (childX0 + childX1) / 2.0;
                };
                return childX0;
            })();
            var childX1$prime = (function () {
                var $110 = childX1 < childX0;
                if ($110) {
                    return (childX0 + childX1) / 2.0;
                };
                return childX1;
            })();
            var nodeWithTiledChildren = config.tile(nodeWithPadding)(childX0$prime)(childY0$prime)(childX1$prime)(childY1$prime);
            var finalChildren = map(function (child) {
                return positionTree(config)(child)(newPaddingStack);
            })(nodeWithTiledChildren.value0.children);
            return new TNode({
                data_: nodeWithTiledChildren.value0.data_,
                depth: nodeWithTiledChildren.value0.depth,
                height: nodeWithTiledChildren.value0.height,
                value: nodeWithTiledChildren.value0.value,
                x0: nodeWithTiledChildren.value0.x0,
                y0: nodeWithTiledChildren.value0.y0,
                x1: nodeWithTiledChildren.value0.x1,
                y1: nodeWithTiledChildren.value0.y1,
                children: finalChildren
            });
        };
    };
};
var treemap = function (config) {
    return function (valuedRoot) {
        var root = toTreemapNode(valuedRoot);
        var rootWithBounds = new TNode({
            data_: root.value0.data_,
            depth: root.value0.depth,
            height: root.value0.height,
            value: root.value0.value,
            children: root.value0.children,
            x0: 0.0,
            y0: 0.0,
            x1: config.size.width,
            y1: config.size.height
        });
        var positioned = positionTree(config)(rootWithBounds)([  ]);
        return positioned;
    };
};
var phi = /* #__PURE__ */ (function () {
    return (1.0 + Data_Number.sqrt(5.0)) / 2.0;
})();
var eqTreemapNode = function (dictEq) {
    var eq2 = Data_Eq.eq(dictEq);
    return {
        eq: function (x) {
            return function (y) {
                return Data_Eq.eq(Data_Eq.eqArray(eqTreemapNode(dictEq)))(x.value0.children)(y.value0.children) && eq2(x.value0.data_)(y.value0.data_) && x.value0.depth === y.value0.depth && x.value0.height === y.value0.height && x.value0.value === y.value0.value && x.value0.x0 === y.value0.x0 && x.value0.x1 === y.value0.x1 && x.value0.y0 === y.value0.y0 && x.value0.y1 === y.value0.y1;
            };
        }
    };
};
var ordTreemapNode = function (dictOrd) {
    var compare2 = Data_Ord.compare(dictOrd);
    var eqTreemapNode1 = eqTreemapNode(dictOrd.Eq0());
    return {
        compare: function (x) {
            return function (y) {
                var v = Data_Ord.compare(Data_Ord.ordArray(ordTreemapNode(dictOrd)))(x.value0.children)(y.value0.children);
                if (v instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v1 = compare2(x.value0.data_)(y.value0.data_);
                if (v1 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v1 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v2 = compare(x.value0.depth)(y.value0.depth);
                if (v2 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v2 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v3 = compare(x.value0.height)(y.value0.height);
                if (v3 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v3 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v4 = compare1(x.value0.value)(y.value0.value);
                if (v4 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v4 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v5 = compare1(x.value0.x0)(y.value0.x0);
                if (v5 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v5 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v6 = compare1(x.value0.x1)(y.value0.x1);
                if (v6 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v6 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v7 = compare1(x.value0.y0)(y.value0.y0);
                if (v7 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v7 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                return compare1(x.value0.y1)(y.value0.y1);
            };
        },
        Eq0: function () {
            return eqTreemapNode1;
        }
    };
};
var dice = function (v) {
    return function (x0) {
        return function (y0) {
            return function (x1) {
                return function (y1) {
                    var k = (function () {
                        var $137 = v.value0.value !== 0.0;
                        if ($137) {
                            return (x1 - x0) / v.value0.value;
                        };
                        return 0.0;
                    })();
                    var positioned = foldl(function (acc) {
                        return function (child) {
                            var width = child.value0.value * k;
                            var positionedChild = new TNode({
                                data_: child.value0.data_,
                                depth: child.value0.depth,
                                height: child.value0.height,
                                value: child.value0.value,
                                children: child.value0.children,
                                x0: acc.x,
                                x1: acc.x + width,
                                y0: y0,
                                y1: y1
                            });
                            return {
                                children: Data_Array.snoc(acc.children)(positionedChild),
                                x: acc.x + width
                            };
                        };
                    })({
                        children: [  ],
                        x: x0
                    })(v.value0.children);
                    return new TNode({
                        data_: v.value0.data_,
                        depth: v.value0.depth,
                        height: v.value0.height,
                        value: v.value0.value,
                        x0: v.value0.x0,
                        y0: v.value0.y0,
                        x1: v.value0.x1,
                        y1: v.value0.y1,
                        children: positioned.children
                    });
                };
            };
        };
    };
};
var sliceDice = function (parent) {
    return function (x0) {
        return function (y0) {
            return function (x1) {
                return function (y1) {
                    var $142 = mod(parent.value0.depth)(2) === 0;
                    if ($142) {
                        return slice(parent)(x0)(y0)(x1)(y1);
                    };
                    return dice(parent)(x0)(y0)(x1)(y1);
                };
            };
        };
    };
};
var squarifyRatio = function (ratio) {
    return function (v) {
        return function (initX0) {
            return function (initY0) {
                return function (initX1) {
                    return function (initY1) {
                        var n = Data_Array.length(v.value0.children);
                        var go = function ($copy_i0) {
                            return function ($copy_i1) {
                                return function ($copy_x0) {
                                    return function ($copy_y0) {
                                        return function ($copy_x1) {
                                            return function ($copy_y1) {
                                                return function ($copy_remainingValue) {
                                                    return function ($copy_acc) {
                                                        var $tco_var_i0 = $copy_i0;
                                                        var $tco_var_i1 = $copy_i1;
                                                        var $tco_var_x0 = $copy_x0;
                                                        var $tco_var_y0 = $copy_y0;
                                                        var $tco_var_x1 = $copy_x1;
                                                        var $tco_var_y1 = $copy_y1;
                                                        var $tco_var_remainingValue = $copy_remainingValue;
                                                        var $tco_done = false;
                                                        var $tco_result;
                                                        function $tco_loop(i0, i1, x0, y0, x1, y1, remainingValue, acc) {
                                                            var $150 = i0 >= n;
                                                            if ($150) {
                                                                $tco_done = true;
                                                                return acc;
                                                            };
                                                            var findNonEmpty = function ($copy_idx) {
                                                                return function ($copy_sv) {
                                                                    var $tco_var_idx = $copy_idx;
                                                                    var $tco_done1 = false;
                                                                    var $tco_result;
                                                                    function $tco_loop(idx, sv) {
                                                                        var $151 = idx >= n;
                                                                        if ($151) {
                                                                            $tco_done1 = true;
                                                                            return {
                                                                                i1: idx,
                                                                                sumValue: sv
                                                                            };
                                                                        };
                                                                        var v1 = (function () {
                                                                            var v2 = Data_Array.index(v.value0.children)(idx);
                                                                            if (v2 instanceof Data_Maybe.Just) {
                                                                                return v2.value0;
                                                                            };
                                                                            if (v2 instanceof Data_Maybe.Nothing) {
                                                                                return new TNode(v.value0);
                                                                            };
                                                                            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 360, column 31 - line 362, column 42): " + [ v2.constructor.name ]);
                                                                        })();
                                                                        var $155 = v1.value0.value !== 0.0;
                                                                        if ($155) {
                                                                            $tco_done1 = true;
                                                                            return {
                                                                                i1: idx + 1 | 0,
                                                                                sumValue: v1.value0.value
                                                                            };
                                                                        };
                                                                        $tco_var_idx = idx + 1 | 0;
                                                                        $copy_sv = sv;
                                                                        return;
                                                                    };
                                                                    while (!$tco_done1) {
                                                                        $tco_result = $tco_loop($tco_var_idx, $copy_sv);
                                                                    };
                                                                    return $tco_result;
                                                                };
                                                            };
                                                            var firstNode = findNonEmpty(i1)(0.0);
                                                            var dy = y1 - y0;
                                                            var dx = x1 - x0;
                                                            var alpha = max(dy / dx)(dx / dy) / (remainingValue * ratio);
                                                            var beta0 = firstNode.sumValue * firstNode.sumValue * alpha;
                                                            var tryAdd = function ($copy_idx) {
                                                                return function ($copy_sumVal) {
                                                                    return function ($copy_minVal) {
                                                                        return function ($copy_maxVal) {
                                                                            return function ($copy_minRat) {
                                                                                var $tco_var_idx = $copy_idx;
                                                                                var $tco_var_sumVal = $copy_sumVal;
                                                                                var $tco_var_minVal = $copy_minVal;
                                                                                var $tco_var_maxVal = $copy_maxVal;
                                                                                var $tco_done2 = false;
                                                                                var $tco_result;
                                                                                function $tco_loop(idx, sumVal, minVal, maxVal, minRat) {
                                                                                    var $157 = idx >= n;
                                                                                    if ($157) {
                                                                                        $tco_done2 = true;
                                                                                        return {
                                                                                            i1: idx,
                                                                                            sumValue: sumVal,
                                                                                            minRatio: minRat
                                                                                        };
                                                                                    };
                                                                                    var v1 = (function () {
                                                                                        var v2 = Data_Array.index(v.value0.children)(idx);
                                                                                        if (v2 instanceof Data_Maybe.Just) {
                                                                                            return v2.value0;
                                                                                        };
                                                                                        if (v2 instanceof Data_Maybe.Nothing) {
                                                                                            return new TNode(v.value0);
                                                                                        };
                                                                                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 386, column 31 - line 388, column 42): " + [ v2.constructor.name ]);
                                                                                    })();
                                                                                    var newSum = sumVal + v1.value0.value;
                                                                                    var newMin = min(minVal)(v1.value0.value);
                                                                                    var newMax = max(maxVal)(v1.value0.value);
                                                                                    var newBeta = newSum * newSum * alpha;
                                                                                    var newRatio = max(newMax / newBeta)(newBeta / newMin);
                                                                                    var $161 = newRatio > minRat;
                                                                                    if ($161) {
                                                                                        $tco_done2 = true;
                                                                                        return {
                                                                                            i1: idx,
                                                                                            sumValue: sumVal,
                                                                                            minRatio: minRat
                                                                                        };
                                                                                    };
                                                                                    $tco_var_idx = idx + 1 | 0;
                                                                                    $tco_var_sumVal = newSum;
                                                                                    $tco_var_minVal = newMin;
                                                                                    $tco_var_maxVal = newMax;
                                                                                    $copy_minRat = newRatio;
                                                                                    return;
                                                                                };
                                                                                while (!$tco_done2) {
                                                                                    $tco_result = $tco_loop($tco_var_idx, $tco_var_sumVal, $tco_var_minVal, $tco_var_maxVal, $copy_minRat);
                                                                                };
                                                                                return $tco_result;
                                                                            };
                                                                        };
                                                                    };
                                                                };
                                                            };
                                                            var v1 = (function () {
                                                                var v2 = Data_Array.index(v.value0.children)(firstNode.i1 - 1 | 0);
                                                                if (v2 instanceof Data_Maybe.Just) {
                                                                    return v2.value0;
                                                                };
                                                                if (v2 instanceof Data_Maybe.Nothing) {
                                                                    return new TNode(v.value0);
                                                                };
                                                                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 399, column 30 - line 401, column 36): " + [ v2.constructor.name ]);
                                                            })();
                                                            var isDice = dx < dy;
                                                            var initial = tryAdd(firstNode.i1)(firstNode.sumValue)(v1.value0.value)(v1.value0.value)(max(v1.value0.value / beta0)(beta0 / v1.value0.value));
                                                            var rowChildren = Data_Array.slice(i0)(initial.i1)(v.value0.children);
                                                            var rowNode = new TNode({
                                                                data_: v.value0.data_,
                                                                depth: v.value0.depth,
                                                                height: v.value0.height,
                                                                x0: v.value0.x0,
                                                                y0: v.value0.y0,
                                                                x1: v.value0.x1,
                                                                y1: v.value0.y1,
                                                                children: rowChildren,
                                                                value: initial.sumValue
                                                            });
                                                            var positioned = (function () {
                                                                if (isDice) {
                                                                    var newY0 = (function () {
                                                                        var $167 = remainingValue !== 0.0;
                                                                        if ($167) {
                                                                            return y0 + (dy * initial.sumValue) / remainingValue;
                                                                        };
                                                                        return y1;
                                                                    })();
                                                                    var v2 = dice(rowNode)(x0)(y0)(x1)(newY0);
                                                                    return {
                                                                        children: v2.value0.children,
                                                                        nextX0: x0,
                                                                        nextY0: newY0,
                                                                        nextX1: x1,
                                                                        nextY1: y1
                                                                    };
                                                                };
                                                                var newX0 = (function () {
                                                                    var $170 = remainingValue !== 0.0;
                                                                    if ($170) {
                                                                        return x0 + (dx * initial.sumValue) / remainingValue;
                                                                    };
                                                                    return x1;
                                                                })();
                                                                var v2 = slice(rowNode)(x0)(y0)(newX0)(y1);
                                                                return {
                                                                    children: v2.value0.children,
                                                                    nextX0: newX0,
                                                                    nextY0: y0,
                                                                    nextX1: x1,
                                                                    nextY1: y1
                                                                };
                                                            })();
                                                            $tco_var_i0 = initial.i1;
                                                            $tco_var_i1 = initial.i1;
                                                            $tco_var_x0 = positioned.nextX0;
                                                            $tco_var_y0 = positioned.nextY0;
                                                            $tco_var_x1 = positioned.nextX1;
                                                            $tco_var_y1 = positioned.nextY1;
                                                            $tco_var_remainingValue = remainingValue - initial.sumValue;
                                                            $copy_acc = append1(acc)(positioned.children);
                                                            return;
                                                        };
                                                        while (!$tco_done) {
                                                            $tco_result = $tco_loop($tco_var_i0, $tco_var_i1, $tco_var_x0, $tco_var_y0, $tco_var_x1, $tco_var_y1, $tco_var_remainingValue, $copy_acc);
                                                        };
                                                        return $tco_result;
                                                    };
                                                };
                                            };
                                        };
                                    };
                                };
                            };
                        };
                        return {
                            children: go(0)(0)(initX0)(initY0)(initX1)(initY1)(v.value0.value)([  ]),
                            x0: initX0,
                            y0: initY0
                        };
                    };
                };
            };
        };
    };
};
var squarify = function (ratio) {
    return function (v) {
        return function (x0) {
            return function (y0) {
                return function (x1) {
                    return function (y1) {
                        var result = squarifyRatio(ratio)(new TNode(v.value0))(x0)(y0)(x1)(y1);
                        return new TNode({
                            data_: v.value0.data_,
                            depth: v.value0.depth,
                            height: v.value0.height,
                            value: v.value0.value,
                            x0: v.value0.x0,
                            y0: v.value0.y0,
                            x1: v.value0.x1,
                            y1: v.value0.y1,
                            children: result.children
                        });
                    };
                };
            };
        };
    };
};
var defaultTreemapConfig = {
    size: {
        width: 1.0,
        height: 1.0
    },
    tile: /* #__PURE__ */ squarify(phi),
    round: false,
    paddingInner: 0.0,
    paddingOuter: 0.0,
    paddingTop: 0.0,
    paddingRight: 0.0,
    paddingBottom: 0.0,
    paddingLeft: 0.0
};
var binary = function (v) {
    return function (x0) {
        return function (y0) {
            return function (x1) {
                return function (y1) {
                    var n = Data_Array.length(v.value0.children);
                    var $187 = n === 0;
                    if ($187) {
                        return new TNode(v.value0);
                    };
                    var $188 = n === 1;
                    if ($188) {
                        var v1 = Data_Array.index(v.value0.children)(0);
                        if (v1 instanceof Data_Maybe.Just) {
                            return new TNode({
                                data_: v.value0.data_,
                                depth: v.value0.depth,
                                height: v.value0.height,
                                value: v.value0.value,
                                x0: v.value0.x0,
                                y0: v.value0.y0,
                                x1: v.value0.x1,
                                y1: v.value0.y1,
                                children: [ new TNode({
                                    data_: v1.value0.value0.data_,
                                    depth: v1.value0.value0.depth,
                                    height: v1.value0.value0.height,
                                    value: v1.value0.value0.value,
                                    children: v1.value0.value0.children,
                                    x0: x0,
                                    y0: y0,
                                    x1: x1,
                                    y1: y1
                                }) ]
                            });
                        };
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return new TNode(v.value0);
                        };
                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 267, column 7 - line 270, column 32): " + [ v1.constructor.name ]);
                    };
                    var halfValue = v.value0.value / 2.0;
                    var findSplitIndex = function ($copy_accValue) {
                        return function ($copy_idx) {
                            var $tco_var_accValue = $copy_accValue;
                            var $tco_done = false;
                            var $tco_result;
                            function $tco_loop(accValue, idx) {
                                var $192 = idx >= (n - 1 | 0);
                                if ($192) {
                                    $tco_done = true;
                                    return idx;
                                };
                                var v1 = Data_Array.index(v.value0.children)(idx);
                                if (v1 instanceof Data_Maybe.Just) {
                                    var newAccValue = accValue + v1.value0.value0.value;
                                    var $194 = newAccValue >= halfValue;
                                    if ($194) {
                                        $tco_done = true;
                                        return idx;
                                    };
                                    $tco_var_accValue = newAccValue;
                                    $copy_idx = idx + 1 | 0;
                                    return;
                                };
                                if (v1 instanceof Data_Maybe.Nothing) {
                                    $tco_var_accValue = accValue;
                                    $copy_idx = idx + 1 | 0;
                                    return;
                                };
                                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 289, column 13 - line 296, column 59): " + [ v1.constructor.name ]);
                            };
                            while (!$tco_done) {
                                $tco_result = $tco_loop($tco_var_accValue, $copy_idx);
                            };
                            return $tco_result;
                        };
                    };
                    var splitIdx = findSplitIndex(0.0)(0);
                    var leftChildren = Data_Array.slice(0)(splitIdx + 1 | 0)(v.value0.children);
                    var leftValue = foldl(function (sum) {
                        return function (v1) {
                            return sum + v1.value0.value;
                        };
                    })(0.0)(leftChildren);
                    var splitPos = (function () {
                        var $199 = v.value0.value > 0.0;
                        if ($199) {
                            return leftValue / v.value0.value;
                        };
                        return 0.5;
                    })();
                    var rightChildren = Data_Array.slice(splitIdx + 1 | 0)(n)(v.value0.children);
                    var dy = y1 - y0;
                    var dx = x1 - x0;
                    var splitVertically = dx > dy;
                    var leftPositioned = (function () {
                        if (splitVertically) {
                            return dice(new TNode({
                                data_: v.value0.data_,
                                depth: v.value0.depth,
                                height: v.value0.height,
                                x0: v.value0.x0,
                                y0: v.value0.y0,
                                x1: v.value0.x1,
                                y1: v.value0.y1,
                                children: leftChildren,
                                value: leftValue
                            }))(x0)(y0)(x0 + dx * splitPos)(y1);
                        };
                        return slice(new TNode({
                            data_: v.value0.data_,
                            depth: v.value0.depth,
                            height: v.value0.height,
                            x0: v.value0.x0,
                            y0: v.value0.y0,
                            x1: v.value0.x1,
                            y1: v.value0.y1,
                            children: leftChildren,
                            value: leftValue
                        }))(x0)(y0)(x1)(y0 + dy * splitPos);
                    })();
                    var rightPositioned = (function () {
                        if (splitVertically) {
                            return dice(new TNode({
                                data_: v.value0.data_,
                                depth: v.value0.depth,
                                height: v.value0.height,
                                x0: v.value0.x0,
                                y0: v.value0.y0,
                                x1: v.value0.x1,
                                y1: v.value0.y1,
                                children: rightChildren,
                                value: v.value0.value - leftValue
                            }))(x0 + dx * splitPos)(y0)(x1)(y1);
                        };
                        return slice(new TNode({
                            data_: v.value0.data_,
                            depth: v.value0.depth,
                            height: v.value0.height,
                            x0: v.value0.x0,
                            y0: v.value0.y0,
                            x1: v.value0.x1,
                            y1: v.value0.y1,
                            children: rightChildren,
                            value: v.value0.value - leftValue
                        }))(x0)(y0 + dy * splitPos)(x1)(y1);
                    })();
                    return new TNode({
                        data_: v.value0.data_,
                        depth: v.value0.depth,
                        height: v.value0.height,
                        value: v.value0.value,
                        x0: v.value0.x0,
                        y0: v.value0.y0,
                        x1: v.value0.x1,
                        y1: v.value0.y1,
                        children: append1(leftPositioned.value0.children)(rightPositioned.value0.children)
                    });
                };
            };
        };
    };
};
export {
    TNode,
    phi,
    defaultTreemapConfig,
    toTreemapNode,
    treemap,
    dice,
    slice,
    sliceDice,
    binary,
    squarify,
    eqTreemapNode,
    ordTreemapNode,
    showTreemapNode
};
//# sourceMappingURL=index.js.map
