// Generated by purs version 0.15.15
import * as $foreign from "./foreign.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Traversable from "../Data.Traversable/index.js";
import * as Data_TraversableWithIndex from "../Data.TraversableWithIndex/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect from "../Effect/index.js";
import * as PSD3_HATS from "../PSD3.HATS/index.js";
import * as PSD3_Internal_Attribute from "../PSD3.Internal.Attribute/index.js";
import * as PSD3_Internal_Behavior_Types from "../PSD3.Internal.Behavior.Types/index.js";
import * as PSD3_Internal_Selection_Operations from "../PSD3.Internal.Selection.Operations/index.js";
import * as PSD3_Internal_Selection_Types from "../PSD3.Internal.Selection.Types/index.js";
import * as Web_DOM_Element from "../Web.DOM.Element/index.js";
import * as Web_DOM_Node from "../Web.DOM.Node/index.js";
import * as Web_HTML from "../Web.HTML/index.js";
import * as Web_HTML_HTMLDocument from "../Web.HTML.HTMLDocument/index.js";
import * as Web_HTML_Window from "../Web.HTML.Window/index.js";
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var bind = /* #__PURE__ */ Control_Bind.bind(Effect.bindEffect);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect.applicativeEffect);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var traverse = /* #__PURE__ */ Data_Traversable.traverse(Data_Traversable.traversableArray)(Effect.applicativeEffect);
var traverseWithIndex = /* #__PURE__ */ Data_TraversableWithIndex.traverseWithIndex(Data_TraversableWithIndex.traversableWithIndexArray)(Effect.applicativeEffect);
var union = /* #__PURE__ */ Data_Map_Internal.union(Data_Ord.ordString);
var insert = /* #__PURE__ */ Data_Map_Internal.insert(Data_Ord.ordString);
var fromFoldable = /* #__PURE__ */ Data_Set.fromFoldable(Data_Foldable.foldableArray)(Data_Ord.ordString);
var difference = /* #__PURE__ */ Data_Set.difference(Data_Ord.ordString);
var intersection = /* #__PURE__ */ Data_Set.intersection(Data_Ord.ordString);
var member = /* #__PURE__ */ Data_Set.member(Data_Ord.ordString);
var enumerateDFS = function (root) {
    return function (getChildren) {
        return function (includeInternal) {
            var go = function (node) {
                var children = getChildren(node);
                var isLeaf = Data_Array["null"](children);
                var childResults = Data_Array.concatMap(go)(children);
                var $53 = isLeaf || includeInternal;
                if ($53) {
                    return append([ node ])(childResults);
                };
                return childResults;
            };
            return go(root);
        };
    };
};
var enumerateBFS = function (root) {
    return function (getChildren) {
        return function (includeInternal) {
            var go = function (queue) {
                var v = Data_Array.uncons(queue);
                if (v instanceof Data_Maybe.Nothing) {
                    return [  ];
                };
                if (v instanceof Data_Maybe.Just) {
                    var children = getChildren(v.value0.head);
                    var isLeaf = Data_Array["null"](children);
                    var include = isLeaf || includeInternal;
                    var thisNode = (function () {
                        if (include) {
                            return [ v.value0.head ];
                        };
                        return [  ];
                    })();
                    return append(thisNode)(go(append(v.value0.tail)(children)));
                };
                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 342, column 14 - line 349, column 43): " + [ v.constructor.name ]);
            };
            return go([ root ]);
        };
    };
};
var runEnumeration = function (v) {
    if (v instanceof PSD3_HATS.FromArray) {
        return v.value0;
    };
    if (v instanceof PSD3_HATS.FromTree) {
        if (v.value0.order instanceof PSD3_HATS.DepthFirst) {
            return enumerateDFS(v.value0.root)(v.value0.children)(v.value0.includeInternal);
        };
        if (v.value0.order instanceof PSD3_HATS.BreadthFirst) {
            return enumerateBFS(v.value0.root)(v.value0.children)(v.value0.includeInternal);
        };
        throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 320, column 5 - line 322, column 80): " + [ v.value0.order.constructor.name ]);
    };
    if (v instanceof PSD3_HATS.WithContext) {
        return map(function (v1) {
            return v1.datum;
        })(v.value0);
    };
    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 316, column 18 - line 324, column 41): " + [ v.constructor.name ]);
};
var appendTo = function (p) {
    return function (child) {
        return function __do() {
            Web_DOM_Node.appendChild(Web_DOM_Element.toNode(child))(Web_DOM_Element.toNode(p))();
            return Data_Unit.unit;
        };
    };
};
var interpretTree = function (doc) {
    return function (parent) {
        return function (tree) {
            var attrValueToString = function (v) {
                if (v instanceof PSD3_Internal_Attribute.StringValue) {
                    return v.value0;
                };
                if (v instanceof PSD3_Internal_Attribute.NumberValue) {
                    return show(v.value0);
                };
                if (v instanceof PSD3_Internal_Attribute.BooleanValue) {
                    if (v.value0) {
                        return "true";
                    };
                    return "false";
                };
                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 119, column 23 - line 122, column 52): " + [ v.constructor.name ]);
            };
            var applyBehaviorWithDatum = function (el) {
                return function (v) {
                    if (v instanceof PSD3_Internal_Behavior_Types.Click) {
                        return $foreign.attachClick(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.ClickWithDatum) {
                        return $foreign.attachClickWithDatum(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseEnter) {
                        return $foreign.attachMouseEnter(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseLeave) {
                        return $foreign.attachMouseLeave(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Highlight) {
                        return $foreign.attachHighlight(el)(v.value0.enter)(v.value0.leave);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Zoom) {
                        return $foreign.attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimpleDrag) {
                        return $foreign.attachSimpleDrag(el);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDrag) {
                        return $foreign.attachSimulationDragById(el)(v.value0.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDragNested) {
                        return $foreign.attachSimulationDragNestedById(el)(v.value0.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseDown) {
                        return $foreign.attachMouseDown(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.CoordinatedHighlight) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseMoveWithInfo) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseEnterWithInfo) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseLeaveWithInfo) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseDownWithInfo) {
                        return pure(Data_Unit.unit);
                    };
                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 158, column 31 - line 176, column 37): " + [ v.constructor.name ]);
                };
            };
            var applyBehaviorsWithDatum = function (el) {
                return function (behaviors) {
                    return function __do() {
                        traverse(applyBehaviorWithDatum(el))(behaviors)();
                        return Data_Unit.unit;
                    };
                };
            };
            var applyBehaviorStatic = function (el) {
                return function (v) {
                    if (v instanceof PSD3_Internal_Behavior_Types.Click) {
                        return $foreign.attachClick(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Zoom) {
                        return $foreign.attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimpleDrag) {
                        return $foreign.attachSimpleDrag(el);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDrag) {
                        return $foreign.attachSimulationDragById(el)(v.value0.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDragNested) {
                        return $foreign.attachSimulationDragNestedById(el)(v.value0.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.ClickWithDatum) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseEnter) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseLeave) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Highlight) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.CoordinatedHighlight) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseMoveWithInfo) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseEnterWithInfo) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseLeaveWithInfo) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseDown) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseDownWithInfo) {
                        return pure(Data_Unit.unit);
                    };
                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 131, column 28 - line 149, column 37): " + [ v.constructor.name ]);
                };
            };
            var applyBehaviorsStatic = function (el) {
                return function (behaviors) {
                    return function __do() {
                        traverse(applyBehaviorStatic(el))(behaviors)();
                        return Data_Unit.unit;
                    };
                };
            };
            var applyAttrWithDatum = function (el) {
                return function (datum) {
                    return function (idx) {
                        return function (v) {
                            if (v instanceof PSD3_Internal_Attribute.StaticAttr) {
                                return $foreign.setAttribute(el)(v.value0)(attrValueToString(v.value1));
                            };
                            if (v instanceof PSD3_Internal_Attribute.DataAttr) {
                                return $foreign.setAttribute(el)(v.value0)(attrValueToString(v.value2(datum)));
                            };
                            if (v instanceof PSD3_Internal_Attribute.IndexedAttr) {
                                return $foreign.setAttribute(el)(v.value0)(attrValueToString(v.value2(datum)(idx)));
                            };
                            if (v instanceof PSD3_Internal_Attribute.AnimatedAttr) {
                                return pure(Data_Unit.unit);
                            };
                            if (v instanceof PSD3_Internal_Attribute.AnimatedCompound) {
                                return pure(Data_Unit.unit);
                            };
                            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 103, column 37 - line 115, column 16): " + [ v.constructor.name ]);
                        };
                    };
                };
            };
            var applyAttrsWithDatum = function (el) {
                return function (attrs) {
                    return function (datum) {
                        return function (idx) {
                            return function __do() {
                                traverse(applyAttrWithDatum(el)(datum)(idx))(attrs)();
                                return Data_Unit.unit;
                            };
                        };
                    };
                };
            };
            var applyAttrStatic = function (el) {
                return function (v) {
                    if (v instanceof PSD3_Internal_Attribute.StaticAttr) {
                        return $foreign.setAttribute(el)(v.value0)(attrValueToString(v.value1));
                    };
                    if (v instanceof PSD3_Internal_Attribute.DataAttr) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Attribute.IndexedAttr) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Attribute.AnimatedAttr) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Attribute.AnimatedCompound) {
                        return pure(Data_Unit.unit);
                    };
                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 83, column 24 - line 94, column 16): " + [ v.constructor.name ]);
                };
            };
            var applyAttrsStatic = function (el) {
                return function (attrs) {
                    return function __do() {
                        traverse(applyAttrStatic(el))(attrs)();
                        return Data_Unit.unit;
                    };
                };
            };
            var renderSiblings = function (p) {
                return function (spec) {
                    return function (items) {
                        return function __do() {
                            var results = traverseWithIndex(renderItemWithKey(p)(spec.keyFn)(spec.template))(items)();
                            var elements = map(function (v) {
                                return v.element;
                            })(results);
                            var childMaps = Data_Array.foldl(union)(Data_Map_Internal.empty)(map(function (v) {
                                return v.childSelections;
                            })(results));
                            return insert(spec.name)(elements)(childMaps);
                        };
                    };
                };
            };
            var renderNested = function (p) {
                return function (spec) {
                    var goNested = function (parentEl) {
                        return function (node) {
                            return function (getChildren) {
                                return function (idx) {
                                    var itemTree = spec.template(node);
                                    return function __do() {
                                        var el = (function () {
                                            if (itemTree instanceof PSD3_HATS.Elem) {
                                                var e = PSD3_Internal_Selection_Operations.createElementWithNS(itemTree.value0.elemType)(doc)();
                                                appendTo(parentEl)(e)();
                                                $foreign.bindDatum(e)(node)();
                                                applyAttrsWithDatum(e)(itemTree.value0.attrs)(node)(idx)();
                                                applyBehaviorsWithDatum(e)(itemTree.value0.behaviors)();
                                                traverse(go(e))(itemTree.value0.children)();
                                                return e;
                                            };
                                            var e = PSD3_Internal_Selection_Operations.createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                                            appendTo(parentEl)(e)();
                                            $foreign.bindDatum(e)(node)();
                                            return e;
                                        })();
                                        var children = getChildren(node);
                                        var childElements = traverseWithIndex(function (i) {
                                            return function (child) {
                                                return goNested(el)(child)(getChildren)((idx + i | 0) + 1 | 0);
                                            };
                                        })(children)();
                                        return append([ el ])(Data_Array.concat(childElements));
                                    };
                                };
                            };
                        };
                    };
                    if (spec.enumerate instanceof PSD3_HATS.FromTree) {
                        return function __do() {
                            var allElements = goNested(p)(spec.enumerate.value0.root)(spec.enumerate.value0.children)(0)();
                            return Data_Map_Internal.singleton(spec.name)(allElements);
                        };
                    };
                    var items = runEnumeration(spec.enumerate);
                    return renderSiblings(p)(spec)(items);
                };
            };
            var renderItemWithKey = function (p) {
                return function (keyFn) {
                    return function (template) {
                        return function (idx) {
                            return function (datum) {
                                var itemTree = template(datum);
                                var key = keyFn(datum);
                                if (itemTree instanceof PSD3_HATS.Elem) {
                                    return function __do() {
                                        var el = PSD3_Internal_Selection_Operations.createElementWithNS(itemTree.value0.elemType)(doc)();
                                        appendTo(p)(el)();
                                        $foreign.setKey(el)(key)();
                                        $foreign.bindDatum(el)(datum)();
                                        applyAttrsWithDatum(el)(itemTree.value0.attrs)(datum)(idx)();
                                        applyBehaviorsWithDatum(el)(itemTree.value0.behaviors)();
                                        var childMaps = traverse(goWithDatum(el)(datum)(idx))(itemTree.value0.children)();
                                        return {
                                            element: el,
                                            childSelections: Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps)
                                        };
                                    };
                                };
                                if (itemTree instanceof PSD3_HATS.Fold) {
                                    return function __do() {
                                        var wrapper = PSD3_Internal_Selection_Operations.createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                                        appendTo(p)(wrapper)();
                                        $foreign.setKey(wrapper)(key)();
                                        $foreign.bindDatum(wrapper)(datum)();
                                        var innerMap = go(wrapper)(itemTree)();
                                        return {
                                            element: wrapper,
                                            childSelections: innerMap
                                        };
                                    };
                                };
                                if (itemTree instanceof PSD3_HATS.Empty) {
                                    return function __do() {
                                        var el = PSD3_Internal_Selection_Operations.createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                                        return {
                                            element: el,
                                            childSelections: Data_Map_Internal.empty
                                        };
                                    };
                                };
                                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 207, column 5 - line 235, column 57): " + [ itemTree.constructor.name ]);
                            };
                        };
                    };
                };
            };
            var goWithDatum = function (p) {
                return function (datum) {
                    return function (idx) {
                        return function (v) {
                            if (v instanceof PSD3_HATS.Empty) {
                                return pure(Data_Map_Internal.empty);
                            };
                            if (v instanceof PSD3_HATS.Elem) {
                                return function __do() {
                                    var el = PSD3_Internal_Selection_Operations.createElementWithNS(v.value0.elemType)(doc)();
                                    appendTo(p)(el)();
                                    $foreign.bindDatum(el)(datum)();
                                    applyAttrsWithDatum(el)(v.value0.attrs)(datum)(idx)();
                                    applyBehaviorsWithDatum(el)(v.value0.behaviors)();
                                    var childMaps = traverse(goWithDatum(el)(datum)(idx))(v.value0.children)();
                                    return Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps);
                                };
                            };
                            if (v instanceof PSD3_HATS.Fold) {
                                var items = runEnumeration(v.value0.enumerate);
                                if (v.value0.assemble instanceof PSD3_HATS.Siblings) {
                                    return renderSiblings(p)(v.value0)(items);
                                };
                                if (v.value0.assemble instanceof PSD3_HATS.Nested) {
                                    return renderNested(p)(v.value0);
                                };
                                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 259, column 7 - line 261, column 38): " + [ v.value0.assemble.constructor.name ]);
                            };
                            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 240, column 29 - line 261, column 38): " + [ v.constructor.name ]);
                        };
                    };
                };
            };
            var go = function (p) {
                return function (v) {
                    if (v instanceof PSD3_HATS.Empty) {
                        return pure(Data_Map_Internal.empty);
                    };
                    if (v instanceof PSD3_HATS.Elem) {
                        return function __do() {
                            var el = PSD3_Internal_Selection_Operations.createElementWithNS(v.value0.elemType)(doc)();
                            appendTo(p)(el)();
                            applyAttrsStatic(el)(v.value0.attrs)();
                            applyBehaviorsStatic(el)(v.value0.behaviors)();
                            var childMaps = traverse(go(el))(v.value0.children)();
                            return Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps);
                        };
                    };
                    if (v instanceof PSD3_HATS.Fold) {
                        var items = runEnumeration(v.value0.enumerate);
                        if (v.value0.assemble instanceof PSD3_HATS.Siblings) {
                            return renderSiblings(p)(v.value0)(items);
                        };
                        if (v.value0.assemble instanceof PSD3_HATS.Nested) {
                            return renderNested(p)(v.value0);
                        };
                        throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 72, column 7 - line 74, column 38): " + [ v.value0.assemble.constructor.name ]);
                    };
                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 57, column 10 - line 74, column 38): " + [ v.constructor.name ]);
                };
            };
            return go(parent)(tree);
        };
    };
};
var render = function (selector) {
    return function (tree) {
        return function __do() {
            var doc = (function __do() {
                var $239 = bind(Web_HTML.window)(Web_HTML_Window.document)();
                return Web_HTML_HTMLDocument.toDocument($239);
            })();
            var container = $foreign.selectElement(selector)(doc)();
            return interpretTree(doc)(container)(tree)();
        };
    };
};
var renderTo = function (container) {
    return function (tree) {
        return function __do() {
            var doc = (function __do() {
                var $240 = bind(Web_HTML.window)(Web_HTML_Window.document)();
                return Web_HTML_HTMLDocument.toDocument($240);
            })();
            return interpretTree(doc)(container)(tree)();
        };
    };
};
var rerenderTree = function (doc) {
    return function (parent) {
        return function (tree) {
            var attrValueToString = function (v) {
                if (v instanceof PSD3_Internal_Attribute.StringValue) {
                    return v.value0;
                };
                if (v instanceof PSD3_Internal_Attribute.NumberValue) {
                    return show(v.value0);
                };
                if (v instanceof PSD3_Internal_Attribute.BooleanValue) {
                    if (v.value0) {
                        return "true";
                    };
                    return "false";
                };
                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 573, column 23 - line 576, column 52): " + [ v.constructor.name ]);
            };
            var applyBehaviorWithDatum = function (el) {
                return function (v) {
                    if (v instanceof PSD3_Internal_Behavior_Types.Click) {
                        return $foreign.attachClick(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.ClickWithDatum) {
                        return $foreign.attachClickWithDatum(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseEnter) {
                        return $foreign.attachMouseEnter(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseLeave) {
                        return $foreign.attachMouseLeave(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Highlight) {
                        return $foreign.attachHighlight(el)(v.value0.enter)(v.value0.leave);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Zoom) {
                        return $foreign.attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimpleDrag) {
                        return $foreign.attachSimpleDrag(el);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDrag) {
                        return $foreign.attachSimulationDragById(el)(v.value0.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDragNested) {
                        return $foreign.attachSimulationDragNestedById(el)(v.value0.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.MouseDown) {
                        return $foreign.attachMouseDown(el)(v.value0);
                    };
                    return pure(Data_Unit.unit);
                };
            };
            var applyBehaviorsWithDatum = function (el) {
                return function (behaviors) {
                    return function __do() {
                        traverse(applyBehaviorWithDatum(el))(behaviors)();
                        return Data_Unit.unit;
                    };
                };
            };
            var applyBehaviorStatic = function (el) {
                return function (v) {
                    if (v instanceof PSD3_Internal_Behavior_Types.Click) {
                        return $foreign.attachClick(el)(v.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Zoom) {
                        return $foreign.attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimpleDrag) {
                        return $foreign.attachSimpleDrag(el);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDrag) {
                        return $foreign.attachSimulationDragById(el)(v.value0.value0);
                    };
                    if (v instanceof PSD3_Internal_Behavior_Types.Drag && v.value0 instanceof PSD3_Internal_Behavior_Types.SimulationDragNested) {
                        return $foreign.attachSimulationDragNestedById(el)(v.value0.value0);
                    };
                    return pure(Data_Unit.unit);
                };
            };
            var applyBehaviorsStatic = function (el) {
                return function (behaviors) {
                    return function __do() {
                        traverse(applyBehaviorStatic(el))(behaviors)();
                        return Data_Unit.unit;
                    };
                };
            };
            var applyAttrWithDatum = function (el) {
                return function (datum) {
                    return function (idx) {
                        return function (v) {
                            if (v instanceof PSD3_Internal_Attribute.StaticAttr) {
                                return $foreign.setAttribute(el)(v.value0)(attrValueToString(v.value1));
                            };
                            if (v instanceof PSD3_Internal_Attribute.DataAttr) {
                                return $foreign.setAttribute(el)(v.value0)(attrValueToString(v.value2(datum)));
                            };
                            if (v instanceof PSD3_Internal_Attribute.IndexedAttr) {
                                return $foreign.setAttribute(el)(v.value0)(attrValueToString(v.value2(datum)(idx)));
                            };
                            if (v instanceof PSD3_Internal_Attribute.AnimatedAttr) {
                                return pure(Data_Unit.unit);
                            };
                            if (v instanceof PSD3_Internal_Attribute.AnimatedCompound) {
                                return pure(Data_Unit.unit);
                            };
                            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 562, column 37 - line 570, column 36): " + [ v.constructor.name ]);
                        };
                    };
                };
            };
            var applyAttrsWithDatum = function (el) {
                return function (attrs) {
                    return function (datum) {
                        return function (idx) {
                            return function __do() {
                                traverse(applyAttrWithDatum(el)(datum)(idx))(attrs)();
                                return Data_Unit.unit;
                            };
                        };
                    };
                };
            };
            var applyAttrStatic = function (el) {
                return function (v) {
                    if (v instanceof PSD3_Internal_Attribute.StaticAttr) {
                        return $foreign.setAttribute(el)(v.value0)(attrValueToString(v.value1));
                    };
                    if (v instanceof PSD3_Internal_Attribute.DataAttr) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Attribute.IndexedAttr) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Attribute.AnimatedAttr) {
                        return pure(Data_Unit.unit);
                    };
                    if (v instanceof PSD3_Internal_Attribute.AnimatedCompound) {
                        return pure(Data_Unit.unit);
                    };
                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 547, column 24 - line 553, column 36): " + [ v.constructor.name ]);
                };
            };
            var applyAttrsStatic = function (el) {
                return function (attrs) {
                    return function __do() {
                        traverse(applyAttrStatic(el))(attrs)();
                        return Data_Unit.unit;
                    };
                };
            };
            var applyPhaseAttrs = function (el) {
                return function (attrs) {
                    return function __do() {
                        traverse(applyAttrStatic(el))(attrs)();
                        return Data_Unit.unit;
                    };
                };
            };
            var renderItemWithKeyAndPhase = function (p) {
                return function (keyFn) {
                    return function (template) {
                        return function (gupSpec) {
                            return function (idx) {
                                return function (datum) {
                                    var itemTree = template(datum);
                                    var key = keyFn(datum);
                                    if (itemTree instanceof PSD3_HATS.Elem) {
                                        return function __do() {
                                            var el = PSD3_Internal_Selection_Operations.createElementWithNS(itemTree.value0.elemType)(doc)();
                                            appendTo(p)(el)();
                                            $foreign.setKey(el)(key)();
                                            $foreign.bindDatum(el)(datum)();
                                            applyAttrsWithDatum(el)(itemTree.value0.attrs)(datum)(idx)();
                                            applyBehaviorsWithDatum(el)(itemTree.value0.behaviors)();
                                            (function () {
                                                if (gupSpec instanceof Data_Maybe.Just) {
                                                    if (gupSpec.value0.enter instanceof Data_Maybe.Just) {
                                                        return applyPhaseAttrs(el)(gupSpec.value0.enter.value0.attrs)();
                                                    };
                                                    if (gupSpec.value0.enter instanceof Data_Maybe.Nothing) {
                                                        return Data_Unit.unit;
                                                    };
                                                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 523, column 22 - line 525, column 33): " + [ gupSpec.value0.enter.constructor.name ]);
                                                };
                                                if (gupSpec instanceof Data_Maybe.Nothing) {
                                                    return Data_Unit.unit;
                                                };
                                                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 522, column 9 - line 526, column 31): " + [ gupSpec.constructor.name ]);
                                            })();
                                            var childMaps = traverse(goWithDatum(el)(datum)(idx))(itemTree.value0.children)();
                                            return {
                                                element: el,
                                                childSelections: Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps)
                                            };
                                        };
                                    };
                                    return function __do() {
                                        var el = PSD3_Internal_Selection_Operations.createElementWithNS(PSD3_Internal_Selection_Types.Group.value)(doc)();
                                        return {
                                            element: el,
                                            childSelections: Data_Map_Internal.empty
                                        };
                                    };
                                };
                            };
                        };
                    };
                };
            };
            var goWithDatum = function (p) {
                return function (datum) {
                    return function (idx) {
                        return function (v) {
                            if (v instanceof PSD3_HATS.Empty) {
                                return pure(Data_Map_Internal.empty);
                            };
                            if (v instanceof PSD3_HATS.Elem) {
                                return function __do() {
                                    var el = PSD3_Internal_Selection_Operations.createElementWithNS(v.value0.elemType)(doc)();
                                    appendTo(p)(el)();
                                    $foreign.bindDatum(el)(datum)();
                                    applyAttrsWithDatum(el)(v.value0.attrs)(datum)(idx)();
                                    applyBehaviorsWithDatum(el)(v.value0.behaviors)();
                                    var childMaps = traverse(goWithDatum(el)(datum)(idx))(v.value0.children)();
                                    return Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps);
                                };
                            };
                            if (v instanceof PSD3_HATS.Fold) {
                                var items = runEnumeration(v.value0.enumerate);
                                if (v.value0.assemble instanceof PSD3_HATS.Siblings) {
                                    return function __do() {
                                        var results = traverseWithIndex(renderItemWithKeyAndPhase(p)(v.value0.keyFn)(v.value0.template)(v.value0.gup))(items)();
                                        var elements = map(function (v1) {
                                            return v1.element;
                                        })(results);
                                        var childMaps = Data_Array.foldl(union)(Data_Map_Internal.empty)(map(function (v1) {
                                            return v1.childSelections;
                                        })(results));
                                        return insert(v.value0.name)(elements)(childMaps);
                                    };
                                };
                                if (v.value0.assemble instanceof PSD3_HATS.Nested) {
                                    return pure(Data_Map_Internal.empty);
                                };
                                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 630, column 7 - line 636, column 33): " + [ v.value0.assemble.constructor.name ]);
                            };
                            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 618, column 29 - line 636, column 33): " + [ v.constructor.name ]);
                        };
                    };
                };
            };
            var goWithIndex = function (p) {
                return function (childIdx) {
                    return function (v) {
                        if (v instanceof PSD3_HATS.Empty) {
                            return pure(Data_Map_Internal.empty);
                        };
                        if (v instanceof PSD3_HATS.Elem) {
                            return function __do() {
                                var existingChildren = $foreign.getChildElements(p)();
                                var el = (function () {
                                    var v1 = Data_Array.index(existingChildren)(childIdx);
                                    if (v1 instanceof Data_Maybe.Just) {
                                        applyAttrsStatic(v1.value0)(v.value0.attrs)();
                                        return v1.value0;
                                    };
                                    if (v1 instanceof Data_Maybe.Nothing) {
                                        var el = PSD3_Internal_Selection_Operations.createElementWithNS(v.value0.elemType)(doc)();
                                        appendTo(p)(el)();
                                        applyAttrsStatic(el)(v.value0.attrs)();
                                        applyBehaviorsStatic(el)(v.value0.behaviors)();
                                        return el;
                                    };
                                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 417, column 13 - line 428, column 18): " + [ v1.constructor.name ]);
                                })();
                                var childMaps = traverseWithIndex(function (i) {
                                    return function (child) {
                                        return goWithIndex(el)(i)(child);
                                    };
                                })(v.value0.children)();
                                return Data_Array.foldl(union)(Data_Map_Internal.empty)(childMaps);
                            };
                        };
                        if (v instanceof PSD3_HATS.Fold) {
                            var items = runEnumeration(v.value0.enumerate);
                            var newKeys = fromFoldable(map(v.value0.keyFn)(items));
                            return function __do() {
                                var existingEls = $foreign.getChildElements(p)();
                                var existingKeysAndEls = traverse(function (el) {
                                    return function __do() {
                                        var k = $foreign.getKey(el)();
                                        return {
                                            key: k,
                                            element: el
                                        };
                                    };
                                })(existingEls)();
                                var existingKeys = fromFoldable(map(function (v1) {
                                    return v1.key;
                                })(existingKeysAndEls));
                                var enterKeys = difference(newKeys)(existingKeys);
                                var updateKeys = intersection(newKeys)(existingKeys);
                                var exitKeys = difference(existingKeys)(newKeys);
                                traverse(function (v1) {
                                    var $217 = member(v1.key)(exitKeys);
                                    if ($217) {
                                        if (v.value0.gup instanceof Data_Maybe.Just) {
                                            if (v.value0.gup.value0.exit instanceof Data_Maybe.Just) {
                                                return function __do() {
                                                    applyPhaseAttrs(v1.element)(v.value0.gup.value0.exit.value0.attrs)();
                                                    return $foreign.removeElementDelayed(v1.element)(300)();
                                                };
                                            };
                                            if (v.value0.gup.value0.exit instanceof Data_Maybe.Nothing) {
                                                return $foreign.removeElement(v1.element);
                                            };
                                            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 457, column 31 - line 462, column 49): " + [ v.value0.gup.value0.exit.constructor.name ]);
                                        };
                                        if (v.value0.gup instanceof Data_Maybe.Nothing) {
                                            return $foreign.removeElement(v1.element);
                                        };
                                        throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 456, column 13 - line 463, column 47): " + [ v.value0.gup.constructor.name ]);
                                    };
                                    return pure(Data_Unit.unit);
                                })(existingKeysAndEls)();
                                traverse(function (v1) {
                                    var $225 = member(v1.key)(updateKeys);
                                    if ($225) {
                                        var v2 = Data_Array.find(function (d) {
                                            return v.value0.keyFn(d) === v1.key;
                                        })(items);
                                        if (v2 instanceof Data_Maybe.Just) {
                                            return function __do() {
                                                $foreign.bindDatum(v1.element)(v2.value0)();
                                                (function () {
                                                    var v3 = v.value0.template(v2.value0);
                                                    if (v3 instanceof PSD3_HATS.Elem) {
                                                        return applyAttrsWithDatum(v1.element)(v3.value0.attrs)(v2.value0)(0)();
                                                    };
                                                    return Data_Unit.unit;
                                                })();
                                                if (v.value0.gup instanceof Data_Maybe.Just) {
                                                    if (v.value0.gup.value0.update instanceof Data_Maybe.Just) {
                                                        return applyPhaseAttrs(v1.element)(v.value0.gup.value0.update.value0.attrs)();
                                                    };
                                                    if (v.value0.gup.value0.update instanceof Data_Maybe.Nothing) {
                                                        return Data_Unit.unit;
                                                    };
                                                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 481, column 35 - line 483, column 41): " + [ v.value0.gup.value0.update.constructor.name ]);
                                                };
                                                if (v.value0.gup instanceof Data_Maybe.Nothing) {
                                                    return Data_Unit.unit;
                                                };
                                                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 480, column 17 - line 484, column 39): " + [ v.value0.gup.constructor.name ]);
                                            };
                                        };
                                        if (v2 instanceof Data_Maybe.Nothing) {
                                            return pure(Data_Unit.unit);
                                        };
                                        throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 472, column 13 - line 485, column 35): " + [ v2.constructor.name ]);
                                    };
                                    return pure(Data_Unit.unit);
                                })(existingKeysAndEls)();
                                var enterItems = Data_Array.filter(function (d) {
                                    return member(v.value0.keyFn(d))(enterKeys);
                                })(items);
                                var enterResults = traverseWithIndex(renderItemWithKeyAndPhase(p)(v.value0.keyFn)(v.value0.template)(v.value0.gup))(enterItems)();
                                var updateElements = map(function (v1) {
                                    return v1.element;
                                })(Data_Array.filter(function (v1) {
                                    return member(v1.key)(updateKeys);
                                })(existingKeysAndEls));
                                var enterElements = map(function (v1) {
                                    return v1.element;
                                })(enterResults);
                                var allElements = append(updateElements)(enterElements);
                                var childMaps = Data_Array.foldl(union)(Data_Map_Internal.empty)(map(function (v1) {
                                    return v1.childSelections;
                                })(enterResults));
                                return insert(v.value0.name)(allElements)(childMaps);
                            };
                        };
                        throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 411, column 28 - line 499, column 56): " + [ v.constructor.name ]);
                    };
                };
            };
            return goWithIndex(parent)(0)(tree);
        };
    };
};
var rerender = function (selector) {
    return function (tree) {
        return function __do() {
            var doc = (function __do() {
                var $241 = bind(Web_HTML.window)(Web_HTML_Window.document)();
                return Web_HTML_HTMLDocument.toDocument($241);
            })();
            var container = $foreign.selectElement(selector)(doc)();
            return rerenderTree(doc)(container)(tree)();
        };
    };
};
export {
    render,
    renderTo,
    rerender
};
//# sourceMappingURL=index.js.map
