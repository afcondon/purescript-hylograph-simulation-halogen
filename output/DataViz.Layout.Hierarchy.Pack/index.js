// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Apply from "../Control.Apply/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Ordering from "../Data.Ordering/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var elemIndex = /* #__PURE__ */ Data_Array.elemIndex(Data_Eq.eqInt);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var insert = /* #__PURE__ */ Data_Map_Internal.insert(Data_Ord.ordInt);
var fromFoldable = /* #__PURE__ */ Data_Map_Internal.fromFoldable(Data_Ord.ordInt)(Data_Foldable.foldableArray);
var sortWith = /* #__PURE__ */ Data_Array.sortWith(Data_Ord.ordNumber);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var max1 = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var compare = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordInt);
var compare1 = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordNumber);
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Maybe.functorMaybe);
var apply = /* #__PURE__ */ Control_Apply.apply(Data_Maybe.applyMaybe);
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Ord.ordInt);
var pure = /* #__PURE__ */ Control_Applicative.pure(Data_Maybe.applicativeMaybe);
var minimumBy = /* #__PURE__ */ Data_Foldable.minimumBy(Data_Foldable.foldableArray);
var comparing = /* #__PURE__ */ Data_Ord.comparing(Data_Ord.ordNumber);
var PackNode = /* #__PURE__ */ (function () {
    function PackNode(value0) {
        this.value0 = value0;
    };
    PackNode.create = function (value0) {
        return new PackNode(value0);
    };
    return PackNode;
})();
var HierarchyData = function (x) {
    return x;
};
var NoCollision = /* #__PURE__ */ (function () {
    function NoCollision() {

    };
    NoCollision.value = new NoCollision();
    return NoCollision;
})();
var CollisionFromJ = /* #__PURE__ */ (function () {
    function CollisionFromJ(value0) {
        this.value0 = value0;
    };
    CollisionFromJ.create = function (value0) {
        return new CollisionFromJ(value0);
    };
    return CollisionFromJ;
})();
var CollisionFromK = /* #__PURE__ */ (function () {
    function CollisionFromK(value0) {
        this.value0 = value0;
    };
    CollisionFromK.create = function (value0) {
        return new CollisionFromK(value0);
    };
    return CollisionFromK;
})();
var showPackNode = function (dictShow) {
    var show2 = Data_Show.show(dictShow);
    return {
        show: function (v) {
            return "PackNode { data_: " + (show2(v.value0.data_) + (", depth: " + (show(v.value0.depth) + (", height: " + (show(v.value0.height) + (", value: " + (show1(v.value0.value) + (", x: " + (show1(v.value0.x) + (", y: " + (show1(v.value0.y) + (", r: " + (show1(v.value0.r) + (", children: [" + (show(Data_Array.length(v.value0.children)) + (" children]" + " }"))))))))))))))));
        }
    };
};
var shortenChainOnly = function (aId) {
    return function (jId) {
        return function (chain) {
            var v = elemIndex(jId)(chain);
            var v1 = elemIndex(aId)(chain);
            if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
                var $135 = v.value0 > v1.value0;
                if ($135) {
                    var before = Data_Array.take(v1.value0 + 1 | 0)(chain);
                    var after = Data_Array.drop(v.value0)(chain);
                    return append1(before)(after);
                };
                var $136 = v.value0 < v1.value0;
                if ($136) {
                    return Data_Array.slice(v.value0)(v1.value0 + 1 | 0)(chain);
                };
                return chain;
            };
            return chain;
        };
    };
};
var scaleToSize = function (config) {
    return function (v) {
        var scaleNode = function (scale) {
            return function (parentX) {
                return function (parentY) {
                    return function (v1) {
                        var scaledY = parentY + scale * v1.value0.y;
                        var scaledX = parentX + scale * v1.value0.x;
                        var scaledR = scale * v1.value0.r;
                        return new PackNode({
                            data_: v1.value0.data_,
                            depth: v1.value0.depth,
                            height: v1.value0.height,
                            value: v1.value0.value,
                            x: scaledX,
                            y: scaledY,
                            r: scaledR,
                            children: map(scaleNode(scale)(scaledX)(scaledY))(v1.value0.children)
                        });
                    };
                };
            };
        };
        var k = min(config.size.width)(config.size.height) / (2.0 * v.value0.r);
        var scaledRootR = k * v.value0.r;
        var centerY = config.size.height / 2.0;
        var centerX = config.size.width / 2.0;
        return new PackNode({
            data_: v.value0.data_,
            depth: v.value0.depth,
            height: v.value0.height,
            value: v.value0.value,
            x: centerX,
            y: centerY,
            r: scaledRootR,
            children: map(scaleNode(k)(centerX)(centerY))(v.value0.children)
        });
    };
};
var place = function (b) {
    return function (a) {
        return function (c) {
            var dy = b.y - a.y;
            var dx = b.x - a.x;
            var d2 = dx * dx + dy * dy;
            var $147 = d2 !== 0.0;
            if ($147) {
                var b2 = (b.r + c.r) * (b.r + c.r);
                var a2 = (a.r + c.r) * (a.r + c.r);
                var $148 = a2 > b2;
                if ($148) {
                    var x = ((d2 + b2) - a2) / (2.0 * d2);
                    var y = Data_Number.sqrt(max(0.0)(b2 / d2 - x * x));
                    return {
                        x: b.x - x * dx - y * dy,
                        y: (b.y - x * dy) + y * dx,
                        r: c.r
                    };
                };
                var x = ((d2 + a2) - b2) / (2.0 * d2);
                var y = Data_Number.sqrt(max(0.0)(a2 / d2 - x * x));
                return {
                    x: (a.x + x * dx) - y * dy,
                    y: a.y + x * dy + y * dx,
                    r: c.r
                };
            };
            return {
                x: a.x + c.r,
                y: a.y,
                r: c.r
            };
        };
    };
};
var insertInChain = function (aId) {
    return function (_bId) {
        return function (newId) {
            return function (chain) {
                var v = elemIndex(aId)(chain);
                if (v instanceof Data_Maybe.Nothing) {
                    return chain;
                };
                if (v instanceof Data_Maybe.Just) {
                    return Data_Maybe.fromMaybe(chain)(Data_Array.insertAt(v.value0 + 1 | 0)(newId)(chain));
                };
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 174, column 3 - line 178, column 62): " + [ v.constructor.name ]);
            };
        };
    };
};
var insertBetween = function (aId) {
    return function (bId) {
        return function (newCircle) {
            return function (state) {
                var newCircles = insert(state.nextId)(newCircle)(state.circles);
                var newChain = insertInChain(aId)(bId)(state.nextId)(state.frontChain);
                return {
                    circles: newCircles,
                    frontChain: newChain,
                    nextId: state.nextId + 1 | 0
                };
            };
        };
    };
};
var initState = function (c0) {
    return function (c1) {
        return function (c2) {
            var c1$prime = {
                r: c1.r,
                x: c0.r,
                y: 0.0
            };
            var c0$prime = {
                r: c0.r,
                x: -c1.r,
                y: 0.0
            };
            var c2$prime = place(c1$prime)(c0$prime)(c2);
            var circles = fromFoldable([ new Data_Tuple.Tuple(0, c0$prime), new Data_Tuple.Tuple(1, c1$prime), new Data_Tuple.Tuple(2, c2$prime) ]);
            return {
                circles: circles,
                frontChain: [ 0, 2, 1 ],
                nextId: 3
            };
        };
    };
};
var hierarchy = function (v) {
    var go = function (node) {
        return function (depth) {
            if (node.children instanceof Data_Maybe.Nothing) {
                return new PackNode({
                    data_: node.data_,
                    depth: depth,
                    height: 0,
                    value: Data_Maybe.fromMaybe(0.0)(node.value),
                    children: [  ],
                    x: 0.0,
                    y: 0.0,
                    r: 0.0
                });
            };
            if (node.children instanceof Data_Maybe.Just) {
                var childNodes = map(function (v1) {
                    return go(v1)(depth + 1 | 0);
                })(node.children.value0);
                var sortedChildren = sortWith(function (v1) {
                    return -v1.value0.value;
                })(childNodes);
                var sumValue = foldl(function (acc) {
                    return function (v1) {
                        return acc + v1.value0.value;
                    };
                })(0.0)(sortedChildren);
                var childHeights = map(function (v1) {
                    return v1.value0.height;
                })(sortedChildren);
                var maxChildHeight = foldl(max1)(0)(childHeights);
                return new PackNode({
                    data_: node.data_,
                    depth: depth,
                    height: maxChildHeight + 1 | 0,
                    value: sumValue,
                    children: sortedChildren,
                    x: 0.0,
                    y: 0.0,
                    r: 0.0
                });
            };
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 672, column 5 - line 704, column 14): " + [ node.children.constructor.name ]);
        };
    };
    return go(v)(0);
};
var getPrevInChain = function (nodeId) {
    return function (chain) {
        var v = elemIndex(nodeId)(chain);
        if (v instanceof Data_Maybe.Nothing) {
            return Data_Maybe.Nothing.value;
        };
        if (v instanceof Data_Maybe.Just) {
            var n = Data_Array.length(chain);
            var prevIdx = mod((v.value0 - 1 | 0) + n | 0)(n);
            return Data_Array.index(chain)(prevIdx);
        };
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 241, column 3 - line 248, column 34): " + [ v.constructor.name ]);
    };
};
var getNextInChain = function (nodeId) {
    return function (chain) {
        var v = elemIndex(nodeId)(chain);
        if (v instanceof Data_Maybe.Nothing) {
            return Data_Maybe.Nothing.value;
        };
        if (v instanceof Data_Maybe.Just) {
            var nextIdx = mod(v.value0 + 1 | 0)(Data_Array.length(chain));
            return Data_Array.index(chain)(nextIdx);
        };
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 230, column 3 - line 236, column 34): " + [ v.constructor.name ]);
    };
};
var getNextId = function (nodeId) {
    return function (chain) {
        var v = elemIndex(nodeId)(chain);
        if (v instanceof Data_Maybe.Nothing) {
            return Data_Maybe.Nothing.value;
        };
        if (v instanceof Data_Maybe.Just) {
            var nextIdx = mod(v.value0 + 1 | 0)(Data_Array.length(chain));
            return Data_Array.index(chain)(nextIdx);
        };
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 138, column 3 - line 144, column 34): " + [ v.constructor.name ]);
    };
};
var eqPackNode = function (dictEq) {
    var eq2 = Data_Eq.eq(dictEq);
    return {
        eq: function (x) {
            return function (y) {
                return Data_Eq.eq(Data_Eq.eqArray(eqPackNode(dictEq)))(x.value0.children)(y.value0.children) && eq2(x.value0.data_)(y.value0.data_) && x.value0.depth === y.value0.depth && x.value0.height === y.value0.height && x.value0.r === y.value0.r && x.value0.value === y.value0.value && x.value0.x === y.value0.x && x.value0.y === y.value0.y;
            };
        }
    };
};
var ordPackNode = function (dictOrd) {
    var compare2 = Data_Ord.compare(dictOrd);
    var eqPackNode1 = eqPackNode(dictOrd.Eq0());
    return {
        compare: function (x) {
            return function (y) {
                var v = Data_Ord.compare(Data_Ord.ordArray(ordPackNode(dictOrd)))(x.value0.children)(y.value0.children);
                if (v instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v1 = compare2(x.value0.data_)(y.value0.data_);
                if (v1 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v1 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v2 = compare(x.value0.depth)(y.value0.depth);
                if (v2 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v2 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v3 = compare(x.value0.height)(y.value0.height);
                if (v3 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v3 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v4 = compare1(x.value0.r)(y.value0.r);
                if (v4 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v4 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v5 = compare1(x.value0.value)(y.value0.value);
                if (v5 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v5 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                var v6 = compare1(x.value0.x)(y.value0.x);
                if (v6 instanceof Data_Ordering.LT) {
                    return Data_Ordering.LT.value;
                };
                if (v6 instanceof Data_Ordering.GT) {
                    return Data_Ordering.GT.value;
                };
                return compare1(x.value0.y)(y.value0.y);
            };
        },
        Eq0: function () {
            return eqPackNode1;
        }
    };
};
var epsilon6 = 1.0e-6;
var intersects = function (a) {
    return function (b) {
        var dy = b.y - a.y;
        var dx = b.x - a.x;
        var dr = (a.r + b.r) - epsilon6;
        return dr > 0.0 && dr * dr > dx * dx + dy * dy;
    };
};
var epsilon = 1.0e-9;
var enclosesWeak = function (a) {
    return function (b) {
        var dy = b.y - a.y;
        var dx = b.x - a.x;
        var dr = (a.r - b.r) + max(a.r)(max(b.r)(1.0)) * epsilon;
        return dr > 0.0 && dr * dr > dx * dx + dy * dy;
    };
};
var enclosesWeakAll = function (a) {
    return function (bs) {
        return Data_Array.all(enclosesWeak(a))(bs);
    };
};
var enclosesNot = function (a) {
    return function (b) {
        var dy = b.y - a.y;
        var dx = b.x - a.x;
        var dr = a.r - b.r;
        return dr < 0.0 || dr * dr < dx * dx + dy * dy;
    };
};
var encloseBasis3 = function (a) {
    return function (b) {
        return function (c) {
            var d1 = (a.x * a.x + a.y * a.y) - a.r * a.r;
            var d2 = (d1 - b.x * b.x - b.y * b.y) + b.r * b.r;
            var d3 = (d1 - c.x * c.x - c.y * c.y) + c.r * c.r;
            var c3 = c.r - a.r;
            var c2 = b.r - a.r;
            var b3 = a.y - c.y;
            var b2 = a.y - b.y;
            var a3 = a.x - c.x;
            var a2 = a.x - b.x;
            var ab = a3 * b2 - a2 * b3;
            var xa = (b2 * d3 - b3 * d2) / (ab * 2.0) - a.x;
            var xb = (b3 * c2 - b2 * c3) / ab;
            var ya = (a3 * d2 - a2 * d3) / (ab * 2.0) - a.y;
            var bigC = (xa * xa + ya * ya) - a.r * a.r;
            var yb = (a2 * c3 - a3 * c2) / ab;
            var bigA = (xb * xb + yb * yb) - 1.0;
            var bigB = 2.0 * (a.r + xa * xb + ya * yb);
            var r = (function () {
                var $182 = Data_Number.abs(bigA) > epsilon6;
                if ($182) {
                    return -(bigB + Data_Number.sqrt(bigB * bigB - 4.0 * bigA * bigC)) / (2.0 * bigA);
                };
                return -bigC / bigB;
            })();
            return {
                x: a.x + xa + xb * r,
                y: a.y + ya + yb * r,
                r: r
            };
        };
    };
};
var encloseBasis2 = function (a) {
    return function (b) {
        var y21 = b.y - a.y;
        var x21 = b.x - a.x;
        var r21 = b.r - a.r;
        var l = Data_Number.sqrt(x21 * x21 + y21 * y21);
        return {
            x: (a.x + b.x + (x21 / l) * r21) / 2.0,
            y: (a.y + b.y + (y21 / l) * r21) / 2.0,
            r: (l + a.r + b.r) / 2.0
        };
    };
};
var extendBasis = function (basis) {
    return function (p) {
        if (enclosesWeakAll(p)(basis)) {
            return [ p ];
        };
        if (Data_Boolean.otherwise) {
            var n = Data_Array.length(basis);
            var findTwoCircleBasis = function ($copy_i) {
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(i) {
                    if (i >= n) {
                        $tco_done = true;
                        return Data_Maybe.Nothing.value;
                    };
                    if (Data_Boolean.otherwise) {
                        var v = Data_Array.index(basis)(i);
                        if (v instanceof Data_Maybe.Just) {
                            var candidate = encloseBasis2(v.value0)(p);
                            var $187 = enclosesNot(p)(v.value0) && enclosesWeakAll(candidate)(basis);
                            if ($187) {
                                $tco_done = true;
                                return new Data_Maybe.Just([ v.value0, p ]);
                            };
                            $copy_i = i + 1 | 0;
                            return;
                        };
                        if (v instanceof Data_Maybe.Nothing) {
                            $copy_i = i + 1 | 0;
                            return;
                        };
                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 546, column 13 - line 553, column 52): " + [ v.constructor.name ]);
                    };
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 542, column 7 - line 542, column 56): " + [ i.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($copy_i);
                };
                return $tco_result;
            };
            var findInnerPair = function ($copy_i) {
                return function ($copy_j) {
                    var $tco_var_i = $copy_i;
                    var $tco_done1 = false;
                    var $tco_result;
                    function $tco_loop(i, j) {
                        if (j >= n) {
                            $tco_done1 = true;
                            return Data_Maybe.Nothing.value;
                        };
                        if (Data_Boolean.otherwise) {
                            var v = Data_Array.index(basis)(j);
                            var v1 = Data_Array.index(basis)(i);
                            if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
                                var cjp = encloseBasis2(v.value0)(p);
                                var cip = encloseBasis2(v1.value0)(p);
                                var cij = encloseBasis2(v1.value0)(v.value0);
                                var candidate = encloseBasis3(v1.value0)(v.value0)(p);
                                var $193 = enclosesNot(cij)(p) && (enclosesNot(cip)(v.value0) && (enclosesNot(cjp)(v1.value0) && enclosesWeakAll(candidate)(basis)));
                                if ($193) {
                                    $tco_done1 = true;
                                    return new Data_Maybe.Just([ v1.value0, v.value0, p ]);
                                };
                                $tco_var_i = i;
                                $copy_j = j + 1 | 0;
                                return;
                            };
                            $tco_var_i = i;
                            $copy_j = j + 1 | 0;
                            return;
                        };
                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 563, column 7 - line 563, column 58): " + [ i.constructor.name, j.constructor.name ]);
                    };
                    while (!$tco_done1) {
                        $tco_result = $tco_loop($tco_var_i, $copy_j);
                    };
                    return $tco_result;
                };
            };
            var findThreeCircleBasis = function ($copy_i) {
                var $tco_done2 = false;
                var $tco_result;
                function $tco_loop(i) {
                    if (i >= (n - 1 | 0)) {
                        $tco_done2 = true;
                        return Data_Maybe.Nothing.value;
                    };
                    if (Data_Boolean.otherwise) {
                        var v = findInnerPair(i)(i + 1 | 0);
                        if (v instanceof Data_Maybe.Just) {
                            $tco_done2 = true;
                            return new Data_Maybe.Just(v.value0);
                        };
                        if (v instanceof Data_Maybe.Nothing) {
                            $copy_i = i + 1 | 0;
                            return;
                        };
                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 559, column 13 - line 561, column 54): " + [ v.constructor.name ]);
                    };
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 555, column 7 - line 555, column 58): " + [ i.constructor.name ]);
                };
                while (!$tco_done2) {
                    $tco_result = $tco_loop($copy_i);
                };
                return $tco_result;
            };
            var v = findTwoCircleBasis(0);
            if (v instanceof Data_Maybe.Just) {
                return v.value0;
            };
            if (v instanceof Data_Maybe.Nothing) {
                var v1 = findThreeCircleBasis(0);
                if (v1 instanceof Data_Maybe.Just) {
                    return v1.value0;
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return basis;
                };
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 536, column 11 - line 538, column 29): " + [ v1.constructor.name ]);
            };
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 533, column 7 - line 538, column 29): " + [ v.constructor.name ]);
        };
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 529, column 1 - line 529, column 54): " + [ basis.constructor.name, p.constructor.name ]);
    };
};
var encloseBasis1 = function (a) {
    return {
        x: a.x,
        y: a.y,
        r: a.r
    };
};
var encloseBasis = function (basis) {
    var v = Data_Array.length(basis);
    if (v === 1) {
        return Data_Maybe.fromMaybe({
            x: 0.0,
            y: 0.0,
            r: 0.0
        })(map1(encloseBasis1)(Data_Array.index(basis)(0)));
    };
    if (v === 2) {
        return Data_Maybe.fromMaybe({
            x: 0.0,
            y: 0.0,
            r: 0.0
        })(apply(map1(encloseBasis2)(Data_Array.index(basis)(0)))(Data_Array.index(basis)(1)));
    };
    if (v === 3) {
        return Data_Maybe.fromMaybe({
            x: 0.0,
            y: 0.0,
            r: 0.0
        })(apply(apply(map1(encloseBasis3)(Data_Array.index(basis)(0)))(Data_Array.index(basis)(1)))(Data_Array.index(basis)(2)));
    };
    return {
        x: 0.0,
        y: 0.0,
        r: 0.0
    };
};
var packEnclose = function (circles) {
    var n = Data_Array.length(circles);
    var go = function ($copy_i) {
        return function ($copy_basis) {
            return function ($copy_maybeE) {
                var $tco_var_i = $copy_i;
                var $tco_var_basis = $copy_basis;
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(i, basis, maybeE) {
                    if (i >= n) {
                        if (maybeE instanceof Data_Maybe.Just) {
                            $tco_done = true;
                            return maybeE.value0;
                        };
                        if (maybeE instanceof Data_Maybe.Nothing) {
                            $tco_done = true;
                            return {
                                x: 0.0,
                                y: 0.0,
                                r: 0.0
                            };
                        };
                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 587, column 9 - line 589, column 48): " + [ maybeE.constructor.name ]);
                    };
                    if (Data_Boolean.otherwise) {
                        var v = Data_Array.index(circles)(i);
                        if (v instanceof Data_Maybe.Nothing) {
                            $tco_var_i = i + 1 | 0;
                            $tco_var_basis = basis;
                            $copy_maybeE = maybeE;
                            return;
                        };
                        if (v instanceof Data_Maybe.Just) {
                            if (maybeE instanceof Data_Maybe.Just && enclosesWeak(maybeE.value0)(v.value0)) {
                                $tco_var_i = i + 1 | 0;
                                $tco_var_basis = basis;
                                $copy_maybeE = maybeE;
                                return;
                            };
                            var newBasis = extendBasis(basis)(v.value0);
                            var newE = encloseBasis(newBasis);
                            $tco_var_i = 0;
                            $tco_var_basis = newBasis;
                            $copy_maybeE = new Data_Maybe.Just(newE);
                            return;
                        };
                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 591, column 9 - line 602, column 44): " + [ v.constructor.name ]);
                    };
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 584, column 3 - line 584, column 54): " + [ i.constructor.name, basis.constructor.name, maybeE.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($tco_var_i, $tco_var_basis, $copy_maybeE);
                };
                return $tco_result;
            };
        };
    };
    return go(0)([  ])(Data_Maybe.Nothing.value);
};
var defaultPackConfig = /* #__PURE__ */ (function () {
    return {
        size: {
            width: 1.0,
            height: 1.0
        },
        padding: 0.0,
        radius: Data_Maybe.Nothing.value
    };
})();
var calculateScore = function (a) {
    return function (b) {
        var ab = a.r + b.r;
        var dx = (a.x * b.r + b.x * a.r) / ab;
        var dy = (a.y * b.r + b.y * a.r) / ab;
        return dx * dx + dy * dy;
    };
};
var scoreNode = function (nodeId) {
    return function (state) {
        return bind(lookup(nodeId)(state.circles))(function (node) {
            return bind(getNextId(nodeId)(state.frontChain))(function (nextId) {
                return bind(lookup(nextId)(state.circles))(function (next) {
                    return pure({
                        nodeId: nodeId,
                        score: calculateScore(node)(next)
                    });
                });
            });
        });
    };
};
var findBestPair = function (state) {
    var scored = Data_Array.mapMaybe(function (nodeId) {
        return scoreNode(nodeId)(state);
    })(state.frontChain);
    var bestNode = minimumBy(comparing(function (v) {
        return v.score;
    }))(scored);
    if (bestNode instanceof Data_Maybe.Nothing) {
        return Data_Maybe.Nothing.value;
    };
    if (bestNode instanceof Data_Maybe.Just) {
        return bind(getNextId(bestNode.value0.nodeId)(state.frontChain))(function (nextId) {
            return pure(new Data_Tuple.Tuple(bestNode.value0.nodeId, nextId));
        });
    };
    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 165, column 5 - line 169, column 40): " + [ bestNode.constructor.name ]);
};
var bidirectionalCollisionSearch = function (aId) {
    return function (bId) {
        return function (newCircle) {
            return function (state) {
                var doWhileStep = function ($copy_j) {
                    return function ($copy_k) {
                        return function ($copy_sj) {
                            return function ($copy_sk) {
                                var $tco_var_j = $copy_j;
                                var $tco_var_k = $copy_k;
                                var $tco_var_sj = $copy_sj;
                                var $tco_done = false;
                                var $tco_result;
                                function $tco_loop(j, k, sj, sk) {
                                    var $215 = sj <= sk;
                                    if ($215) {
                                        var v = lookup(j)(state.circles);
                                        if (v instanceof Data_Maybe.Just) {
                                            var $217 = intersects(v.value0)(newCircle);
                                            if ($217) {
                                                $tco_done = true;
                                                return new CollisionFromJ(j);
                                            };
                                            var v1 = getNextInChain(j)(state.frontChain);
                                            if (v1 instanceof Data_Maybe.Just) {
                                                var v2 = getNextInChain(k)(state.frontChain);
                                                if (v2 instanceof Data_Maybe.Just && v1.value0 === v2.value0) {
                                                    $tco_done = true;
                                                    return NoCollision.value;
                                                };
                                                $tco_var_j = v1.value0;
                                                $tco_var_k = k;
                                                $tco_var_sj = sj + v.value0.r;
                                                $copy_sk = sk;
                                                return;
                                            };
                                            if (v1 instanceof Data_Maybe.Nothing) {
                                                $tco_done = true;
                                                return NoCollision.value;
                                            };
                                            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 280, column 13 - line 286, column 37): " + [ v1.constructor.name ]);
                                        };
                                        if (v instanceof Data_Maybe.Nothing) {
                                            $tco_done = true;
                                            return NoCollision.value;
                                        };
                                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 274, column 7 - line 287, column 31): " + [ v.constructor.name ]);
                                    };
                                    var v = lookup(k)(state.circles);
                                    if (v instanceof Data_Maybe.Just) {
                                        var $224 = intersects(v.value0)(newCircle);
                                        if ($224) {
                                            $tco_done = true;
                                            return new CollisionFromK(k);
                                        };
                                        var v1 = getPrevInChain(k)(state.frontChain);
                                        if (v1 instanceof Data_Maybe.Just) {
                                            var v2 = getNextInChain(v1.value0)(state.frontChain);
                                            if (v2 instanceof Data_Maybe.Just && j === v2.value0) {
                                                $tco_done = true;
                                                return NoCollision.value;
                                            };
                                            $tco_var_j = j;
                                            $tco_var_k = v1.value0;
                                            $tco_var_sj = sj;
                                            $copy_sk = sk + v.value0.r;
                                            return;
                                        };
                                        if (v1 instanceof Data_Maybe.Nothing) {
                                            $tco_done = true;
                                            return NoCollision.value;
                                        };
                                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 296, column 13 - line 302, column 37): " + [ v1.constructor.name ]);
                                    };
                                    if (v instanceof Data_Maybe.Nothing) {
                                        $tco_done = true;
                                        return NoCollision.value;
                                    };
                                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 290, column 7 - line 303, column 31): " + [ v.constructor.name ]);
                                };
                                while (!$tco_done) {
                                    $tco_result = $tco_loop($tco_var_j, $tco_var_k, $tco_var_sj, $copy_sk);
                                };
                                return $tco_result;
                            };
                        };
                    };
                };
                var v = lookup(bId)(state.circles);
                var v1 = lookup(aId)(state.circles);
                if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
                    var v2 = getPrevInChain(aId)(state.frontChain);
                    var v3 = getNextInChain(bId)(state.frontChain);
                    if (v3 instanceof Data_Maybe.Just && v2 instanceof Data_Maybe.Just) {
                        return doWhileStep(v3.value0)(v2.value0)(v.value0.r)(v1.value0.r);
                    };
                    return NoCollision.value;
                };
                return NoCollision.value;
            };
        };
    };
};
var tryPlaceCircleWithLimit = function ($copy_maxRetries) {
    return function ($copy_newCircle) {
        return function ($copy_aId) {
            return function ($copy_bId) {
                return function ($copy_state) {
                    var $tco_var_maxRetries = $copy_maxRetries;
                    var $tco_var_newCircle = $copy_newCircle;
                    var $tco_var_aId = $copy_aId;
                    var $tco_var_bId = $copy_bId;
                    var $tco_done = false;
                    var $tco_result;
                    function $tco_loop(maxRetries, newCircle, aId, bId, state) {
                        if (maxRetries <= 0) {
                            $tco_done = true;
                            return insertBetween(aId)(bId)(newCircle)(state);
                        };
                        if (Data_Boolean.otherwise) {
                            var v = lookup(bId)(state.circles);
                            var v1 = lookup(aId)(state.circles);
                            if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
                                var positioned = place(v.value0)(v1.value0)(newCircle);
                                var collisionResult = bidirectionalCollisionSearch(aId)(bId)(positioned)(state);
                                if (collisionResult instanceof NoCollision) {
                                    $tco_done = true;
                                    return insertBetween(aId)(bId)(positioned)(state);
                                };
                                if (collisionResult instanceof CollisionFromJ) {
                                    var shortenedChain = shortenChainOnly(aId)(collisionResult.value0)(state.frontChain);
                                    var stateWithShortenedChain = {
                                        circles: state.circles,
                                        nextId: state.nextId,
                                        frontChain: shortenedChain
                                    };
                                    $tco_var_maxRetries = maxRetries - 1 | 0;
                                    $tco_var_newCircle = newCircle;
                                    $tco_var_aId = aId;
                                    $tco_var_bId = collisionResult.value0;
                                    $copy_state = stateWithShortenedChain;
                                    return;
                                };
                                if (collisionResult instanceof CollisionFromK) {
                                    var shortenedChain = shortenChainOnly(collisionResult.value0)(bId)(state.frontChain);
                                    var stateWithShortenedChain = {
                                        circles: state.circles,
                                        nextId: state.nextId,
                                        frontChain: shortenedChain
                                    };
                                    $tco_var_maxRetries = maxRetries - 1 | 0;
                                    $tco_var_newCircle = newCircle;
                                    $tco_var_aId = collisionResult.value0;
                                    $tco_var_bId = bId;
                                    $copy_state = stateWithShortenedChain;
                                    return;
                                };
                                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 366, column 13 - line 382, column 101): " + [ collisionResult.constructor.name ]);
                            };
                            $tco_done = true;
                            return state;
                        };
                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 354, column 1 - line 354, column 91): " + [ maxRetries.constructor.name, newCircle.constructor.name, aId.constructor.name, bId.constructor.name, state.constructor.name ]);
                    };
                    while (!$tco_done) {
                        $tco_result = $tco_loop($tco_var_maxRetries, $tco_var_newCircle, $tco_var_aId, $tco_var_bId, $copy_state);
                    };
                    return $tco_result;
                };
            };
        };
    };
};
var tryPlaceCircle = /* #__PURE__ */ tryPlaceCircleWithLimit(100);
var assignRadii = function (config) {
    return function (v) {
        if (v.value0.children.length === 0) {
            var r = (function () {
                if (config.radius instanceof Data_Maybe.Just) {
                    return config.radius.value0(v.value0.data_);
                };
                if (config.radius instanceof Data_Maybe.Nothing) {
                    return Data_Number.sqrt(v.value0.value);
                };
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 739, column 13 - line 741, column 37): " + [ config.radius.constructor.name ]);
            })();
            return new PackNode({
                data_: v.value0.data_,
                depth: v.value0.depth,
                height: v.value0.height,
                value: v.value0.value,
                children: v.value0.children,
                x: v.value0.x,
                y: v.value0.y,
                r: max(0.0)(r)
            });
        };
        return new PackNode({
            data_: v.value0.data_,
            depth: v.value0.depth,
            height: v.value0.height,
            value: v.value0.value,
            x: v.value0.x,
            y: v.value0.y,
            r: v.value0.r,
            children: map(assignRadii(config))(v.value0.children)
        });
    };
};
var addCircle = function (newCircle) {
    return function (state) {
        var v = findBestPair(state);
        if (v instanceof Data_Maybe.Nothing) {
            return state;
        };
        if (v instanceof Data_Maybe.Just) {
            return tryPlaceCircle(newCircle)(v.value0.value0)(v.value0.value1)(state);
        };
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 390, column 3 - line 392, column 67): " + [ v.constructor.name ]);
    };
};
var packSiblingsMap = function (inputCircles) {
    var n = Data_Array.length(inputCircles);
    var $260 = n === 0;
    if ($260) {
        return {
            circles: [  ],
            radius: 0.0
        };
    };
    var $261 = n === 1;
    if ($261) {
        var v = Data_Array.index(inputCircles)(0);
        if (v instanceof Data_Maybe.Just) {
            return {
                circles: [ {
                    r: v.value0.r,
                    x: 0.0,
                    y: 0.0
                } ],
                radius: v.value0.r
            };
        };
        if (v instanceof Data_Maybe.Nothing) {
            return {
                circles: [  ],
                radius: 0.0
            };
        };
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 402, column 7 - line 404, column 48): " + [ v.constructor.name ]);
    };
    var $264 = n === 2;
    if ($264) {
        var v = Data_Array.index(inputCircles)(1);
        var v1 = Data_Array.index(inputCircles)(0);
        if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
            var c1$prime = {
                r: v.value0.r,
                x: v1.value0.r,
                y: 0.0
            };
            var c0$prime = {
                r: v1.value0.r,
                x: -v.value0.r,
                y: 0.0
            };
            return {
                circles: [ c0$prime, c1$prime ],
                radius: v1.value0.r + v.value0.r
            };
        };
        return {
            circles: [  ],
            radius: 0.0
        };
    };
    var v = Data_Array.index(inputCircles)(2);
    var v1 = Data_Array.index(inputCircles)(1);
    var v2 = Data_Array.index(inputCircles)(0);
    if (v2 instanceof Data_Maybe.Just && (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just)) {
        var remaining = Data_Array.drop(3)(inputCircles);
        var initialState = initState(v2.value0)(v1.value0)(v.value0);
        var finalState = foldl(Data_Function.flip(addCircle))(initialState)(remaining);
        var positioned = Data_Array.mapMaybe(function (i) {
            return lookup(i)(finalState.circles);
        })(Data_Array.range(0)(n - 1 | 0));
        var enclosing = packEnclose(positioned);
        var translated = map(function (c) {
            return {
                r: c.r,
                x: c.x - enclosing.x,
                y: c.y - enclosing.y
            };
        })(positioned);
        return {
            circles: translated,
            radius: enclosing.r
        };
    };
    return {
        circles: [  ],
        radius: 0.0
    };
};
var packChildren = function (k) {
    return function (config) {
        return function (v) {
            var updateNodePosition = function (v1) {
                return function (c) {
                    return new PackNode({
                        data_: v1.value0.data_,
                        depth: v1.value0.depth,
                        height: v1.value0.height,
                        value: v1.value0.value,
                        children: v1.value0.children,
                        r: v1.value0.r,
                        x: c.x,
                        y: c.y
                    });
                };
            };
            var removePadding = function (p) {
                return function (c) {
                    return {
                        x: c.x,
                        y: c.y,
                        r: c.r - p
                    };
                };
            };
            var nodeToCircle = function (v1) {
                return {
                    x: v1.value0.x,
                    y: v1.value0.y,
                    r: v1.value0.r
                };
            };
            var addPadding = function (p) {
                return function (c) {
                    return {
                        x: c.x,
                        y: c.y,
                        r: c.r + p
                    };
                };
            };
            if (v.value0.children.length === 0) {
                return new PackNode(v.value0);
            };
            var paddingScaled = config.padding * k;
            var packedKids = map(packChildren(k)(config))(v.value0.children);
            var inputCircles = map((function () {
                var $287 = addPadding(paddingScaled);
                return function ($288) {
                    return $287(nodeToCircle($288));
                };
            })())(packedKids);
            var packed = packSiblingsMap(inputCircles);
            var circlesWithoutPadding = map(removePadding(paddingScaled))(packed.circles);
            var updatedKids = Data_Array.zipWith(updateNodePosition)(packedKids)(circlesWithoutPadding);
            var nodeWithR = {
                data_: v.value0.data_,
                depth: v.value0.depth,
                height: v.value0.height,
                value: v.value0.value,
                x: v.value0.x,
                y: v.value0.y,
                r: packed.radius + paddingScaled,
                children: updatedKids
            };
            return new PackNode(nodeWithR);
        };
    };
};
var pack = function (config) {
    return function (root) {
        var withRadii = assignRadii(config)(root);
        var firstPack = packChildren(1.0)({
            size: config.size,
            radius: config.radius,
            padding: 0.0
        })(withRadii);
        var k = firstPack.value0.r / min(config.size.width)(config.size.height);
        var packed = packChildren(k)(config)(withRadii);
        var scaled = scaleToSize(config)(packed);
        return scaled;
    };
};
export {
    epsilon,
    epsilon6,
    enclosesWeak,
    intersects,
    place,
    packSiblingsMap,
    packEnclose,
    PackNode,
    defaultPackConfig,
    HierarchyData,
    hierarchy,
    pack,
    eqPackNode,
    ordPackNode,
    showPackNode
};
//# sourceMappingURL=index.js.map
