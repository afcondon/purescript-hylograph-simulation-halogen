// Generated by purs version 0.15.15
import * as $foreign from "./foreign.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_List_Types from "../Data.List.Types/index.js";
import * as Data_Map from "../Data.Map/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Traversable from "../Data.Traversable/index.js";
import * as Data_Unfoldable from "../Data.Unfoldable/index.js";
import * as Effect from "../Effect/index.js";
import * as Effect_Console from "../Effect.Console/index.js";
import * as Effect_Ref from "../Effect.Ref/index.js";
import * as Effect_Unsafe from "../Effect.Unsafe/index.js";
import * as PSD3_ForceEngine_Simulation from "../PSD3.ForceEngine.Simulation/index.js";
var $$void = /* #__PURE__ */ Data_Functor["void"](Effect.functorEffect);
var traverse = /* #__PURE__ */ Data_Traversable.traverse(Data_List_Types.traversableList)(Effect.applicativeEffect);
var $$delete = /* #__PURE__ */ Data_Map_Internal["delete"](Data_Ord.ordString);
var insert = /* #__PURE__ */ Data_Map_Internal.insert(Data_Ord.ordString);
var lookup1 = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Ord.ordString);
var fromFoldable = /* #__PURE__ */ Data_Array.fromFoldable(Data_Set.foldableSet);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var toUnfoldable = /* #__PURE__ */ Data_Map_Internal.toUnfoldable(Data_Unfoldable.unfoldableArray);
var traverse1 = /* #__PURE__ */ Data_Traversable.traverse(Data_Traversable.traversableArray)(Effect.applicativeEffect);
var registryRef = /* #__PURE__ */ Effect_Unsafe.unsafePerformEffect(/* #__PURE__ */ Effect_Ref["new"](Data_Map_Internal.empty));
var stopAll = function __do() {
    var registry = Effect_Ref.read(registryRef)();
    var sims = Data_Map_Internal.values(registry);
    return $$void(traverse(function (s) {
        return PSD3_ForceEngine_Simulation.stop($foreign.unsafeFromAny(s));
    })(sims))();
};
var unregister = function (name) {
    return Effect_Ref.modify_($$delete(name))(registryRef);
};
var register = function (name) {
    return function (sim) {
        return Effect_Ref.modify_(insert(name)($foreign.toAny(sim)))(registryRef);
    };
};
var lookup = function (name) {
    return function __do() {
        var registry = Effect_Ref.read(registryRef)();
        return lookup1(name)(registry);
    };
};
var listSimulations = function __do() {
    var registry = Effect_Ref.read(registryRef)();
    return fromFoldable(Data_Map.keys(registry));
};
var debugRegistry = /* #__PURE__ */ (function () {
    var debugEntry = function (v) {
        var sim = $foreign.unsafeFromAny(v.value1);
        return function __do() {
            var running = PSD3_ForceEngine_Simulation.isRunning(sim)();
            var alpha = PSD3_ForceEngine_Simulation.getAlpha(sim)();
            return Effect_Console.log("  " + (v.value0 + (": " + ((function () {
                if (running) {
                    return "RUNNING";
                };
                return "stopped";
            })() + (" (alpha=" + (show(alpha) + ")"))))))();
        };
    };
    return function __do() {
        var registry = Effect_Ref.read(registryRef)();
        Effect_Console.log("=== Simulation Registry ===")();
        (function () {
            var $21 = Data_Map_Internal.isEmpty(registry);
            if ($21) {
                return Effect_Console.log("  (empty)")();
            };
            var entries = toUnfoldable(registry);
            return $$void(traverse1(debugEntry)(entries))();
        })();
        return Effect_Console.log("==========================")();
    };
})();
var clearRegistry = /* #__PURE__ */ Effect_Ref.write(Data_Map_Internal.empty)(registryRef);
export {
    unsafeFromAny
} from "./foreign.js";
export {
    register,
    unregister,
    lookup,
    listSimulations,
    stopAll,
    clearRegistry,
    debugRegistry
};
//# sourceMappingURL=index.js.map
