// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_String_Common from "../Data.String.Common/index.js";
import * as PSD3_Interpreter_SemiQuine_Types from "../PSD3.Interpreter.SemiQuine.Types/index.js";
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var wrapInParens = function (lines) {
    var v = Data_Array.length(lines);
    if (v === 1) {
        return lines;
    };
    var v1 = Data_Array.last(lines);
    var v2 = Data_Array.head(lines);
    if (v2 instanceof Data_Maybe.Just && v1 instanceof Data_Maybe.Just) {
        return append([ "(" + v2.value0 ])(append(Data_Array.drop(1)(Data_Array.dropEnd(1)(lines)))([ v1.value0 + ")" ]));
    };
    return lines;
};
var spaces = function (n) {
    return Data_String_Common.joinWith("")(Data_Array.replicate(n)(" "));
};
var isStringAttr = function (v) {
    if (v === "fill") {
        return true;
    };
    if (v === "stroke") {
        return true;
    };
    if (v === "text") {
        return true;
    };
    if (v === "textContent") {
        return true;
    };
    if (v === "class") {
        return true;
    };
    if (v === "id") {
        return true;
    };
    if (v === "text-anchor") {
        return true;
    };
    if (v === "font-family") {
        return true;
    };
    return false;
};
var templateChoiceToV3Attr = function (attrName) {
    return function (v) {
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.ConstantNumber) {
            return "evalAttr \"" + (attrName + ("\" (lit " + (show(v.value0) + ")")));
        };
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.ConstantString) {
            return "evalAttrStr \"" + (attrName + ("\" (str \"" + (v.value0 + "\")")));
        };
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.FromField) {
            var $25 = isStringAttr(attrName);
            if ($25) {
                return "fnAttrStr \"" + (attrName + ("\" (_." + (v.value0 + " :: Datum -> String)")));
            };
            return "fnAttr \"" + (attrName + ("\" (_." + (v.value0 + " :: Datum -> Number)")));
        };
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.IndexBased) {
            return "fnAttr \"" + (attrName + "\" (\\d -> toNumber d.index)");
        };
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.Computed) {
            var $27 = isStringAttr(attrName);
            if ($27) {
                return "fnAttrStr \"" + (attrName + ("\" (\\d -> " + (v.value0 + ")")));
            };
            return "fnAttr \"" + (attrName + ("\" (\\d -> " + (v.value0 + ")")));
        };
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine (line 185, column 35 - line 199, column 67): " + [ v.constructor.name ]);
    };
};
var templateAttrCode = function (binding) {
    return templateChoiceToV3Attr(binding.attrName)(binding.choice);
};
var templateAttrsArray = function (attrs) {
    var $29 = Data_Array.length(attrs) <= 2;
    if ($29) {
        return "[ " + (Data_String_Common.joinWith(", ")(map(templateAttrCode)(attrs)) + " ]");
    };
    return "[ " + (Data_String_Common.joinWith("\x0a    , ")(map(templateAttrCode)(attrs)) + "\x0a    ]");
};
var indentLines = function (n) {
    return map(function (line) {
        var $30 = Data_String_Common["null"](line);
        if ($30) {
            return "";
        };
        return spaces(n) + line;
    });
};
var elementType = function (v) {
    if (v === "svg") {
        return "SVG";
    };
    if (v === "group") {
        return "Group";
    };
    if (v === "circle") {
        return "Circle";
    };
    if (v === "rect") {
        return "Rect";
    };
    if (v === "line") {
        return "Line";
    };
    if (v === "text") {
        return "Text";
    };
    if (v === "path") {
        return "Path";
    };
    return v;
};
var joinCode = function (join) {
    return [ "T.joinData \"" + (join.name + ("\" \"" + (join.elementType + "\" data_ $ \\d ->"))), "  T.elem " + elementType(join.elementType), "    " + templateAttrsArray(join.template.attributes) ];
};
var choiceToV3Attr = function (attrName) {
    return function (v) {
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.ConstantNumber) {
            return "evalAttr \"" + (attrName + ("\" (lit " + (show(v.value0) + ")")));
        };
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.ConstantString) {
            return "evalAttrStr \"" + (attrName + ("\" (str \"" + (v.value0 + "\")")));
        };
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.FromField) {
            var $35 = isStringAttr(attrName);
            if ($35) {
                return "fnAttrStr \"" + (attrName + ("\" (_." + (v.value0 + " :: Datum -> String)")));
            };
            return "fnAttr \"" + (attrName + ("\" (_." + (v.value0 + " :: Datum -> Number)")));
        };
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.IndexBased) {
            return "fnAttr \"" + (attrName + "\" (\\d -> toNumber d.index)");
        };
        if (v instanceof PSD3_Interpreter_SemiQuine_Types.Computed) {
            var $37 = isStringAttr(attrName);
            if ($37) {
                return "evalAttrStr \"" + (attrName + ("\" (str (" + (v.value0 + "))")));
            };
            return "evalAttr \"" + (attrName + ("\" (lit (" + (v.value0 + "))")));
        };
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine (line 166, column 27 - line 181, column 68): " + [ v.constructor.name ]);
    };
};
var attrCode = function (binding) {
    return choiceToV3Attr(binding.attrName)(binding.choice);
};
var attrsArray = function (attrs) {
    var $39 = Data_Array.length(attrs) <= 2;
    if ($39) {
        return "[ " + (Data_String_Common.joinWith(", ")(map(attrCode)(attrs)) + " ]");
    };
    return "[ " + (Data_String_Common.joinWith("\x0a  , ")(map(attrCode)(attrs)) + "\x0a  ]");
};
var elemLeafCode = function (node) {
    return [ "T.elem " + elementType(node.elementType), "  " + attrsArray(node.attributes) ];
};
var namedLeafCode = function (node) {
    return function (name) {
        return [ "T.named " + (elementType(node.elementType) + (" \"" + (name + "\""))), "  " + attrsArray(node.attributes) ];
    };
};
var nodeToCode = function (v) {
    if (v instanceof PSD3_Interpreter_SemiQuine_Types.BNode) {
        if (v.value0.name instanceof Data_Maybe.Just) {
            var $42 = Data_Array["null"](v.value1);
            if ($42) {
                return namedLeafCode(v.value0)(v.value0.name.value0);
            };
            return namedBranchCode(v.value0)(v.value0.name.value0)(v.value1);
        };
        if (v.value0.name instanceof Data_Maybe.Nothing) {
            var $44 = Data_Array["null"](v.value1);
            if ($44) {
                return elemLeafCode(v.value0);
            };
            return elemBranchCode(v.value0)(v.value1);
        };
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine (line 53, column 5 - line 63, column 44): " + [ v.value0.name.constructor.name ]);
    };
    if (v instanceof PSD3_Interpreter_SemiQuine_Types.BDataJoin) {
        return joinCode(v.value0);
    };
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine (line 51, column 14 - line 66, column 18): " + [ v.constructor.name ]);
};
var namedBranchCode = function (node) {
    return function (name) {
        return function (children) {
            return append([ "T.named " + (elementType(node.elementType) + (" \"" + (name + "\""))), "  " + attrsArray(node.attributes) ])(childrenCode(children));
        };
    };
};
var elemBranchCode = function (node) {
    return function (children) {
        return append([ "T.elem " + elementType(node.elementType), "  " + attrsArray(node.attributes) ])(childrenCode(children));
    };
};
var childrenCode = function (children) {
    var v = Data_Array.length(children);
    if (v === 1) {
        var v1 = Data_Array.head(children);
        if (v1 instanceof Data_Maybe.Just) {
            return append([ "  `T.withChild`" ])(indentLines(4)(wrapInParens(nodeToCode(v1.value0))));
        };
        if (v1 instanceof Data_Maybe.Nothing) {
            return [  ];
        };
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine (line 100, column 10 - line 104, column 20): " + [ v1.constructor.name ]);
    };
    return append([ "  `T.withChildren`" ])([ "    [ " + (Data_String_Common.joinWith("\x0a    , ")(map((function () {
        var $51 = Data_String_Common.joinWith(" ");
        return function ($52) {
            return $51(nodeToCode($52));
        };
    })())(children)) + "\x0a    ]") ]);
};
var treeToCode = function (tree) {
    return Data_String_Common.joinWith("\x0a")(append([ "-- Generated Tree API code (evalAttr)", "", "import PSD3.AST as T", "import PSD3.Internal.Selection.Types (ElementType(..))", "import PSD3.Expr.Integration (evalAttr, evalAttrStr, fnAttr, fnAttrStr)", "import PSD3.Expr.Expr (lit, str)", "", "tree :: T.Tree Datum", "tree =" ])(indentLines(2)(nodeToCode(tree))));
};
export {
    treeToCode
};
export {
    Computed,
    ConstantNumber,
    ConstantString,
    FromField,
    IndexBased,
    BDataJoin,
    BNode,
    defaultAttributesFor,
    emptyNode
} from "../PSD3.Interpreter.SemiQuine.Types/index.js";
//# sourceMappingURL=index.js.map
