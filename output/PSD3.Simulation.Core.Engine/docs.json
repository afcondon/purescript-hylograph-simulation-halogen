{"comments":"Scene Engine\n\nTick-based scene orchestration with adapter pattern.\n\nThe engine manages transitions between scenes using a three-phase lifecycle:\n1. Initialize: Apply init rules to prepare starting state\n2. Transition: Interpolate positions from start to target\n3. Finalize: Apply final rules and enter stable mode\n\nThe engine is generic over the node type. Apps provide an adapter\nrecord with functions that interact with their specific simulation kernel.\n\nExample usage:\n```purescript\n-- Create adapter for your kernel (D3, WASM, etc.)\nadapter = mkAdapter mySimulation\n\n-- Create engine\nengineRef <- createEngine adapter\n\n-- Transition to a scene\ntransitionTo treeFormScene engineRef\n\n-- Call tick from your simulation's tick handler\nSim.onTick (\\_ -> tick engineRef) mySimulation\n```\n","declarations":[{"children":[],"comments":"The scene engine, stored in a Ref for mutation across tick callbacks\n","info":{"arguments":[["node",null]],"declType":"typeSynonym","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect","Ref"],"Ref"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"EngineState"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[131,47],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[131,1]},"title":"SceneEngine"},{"children":[],"comments":"Internal engine state\n","info":{"arguments":[["node",null]],"declType":"typeSynonym","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Record"],"tag":"TypeConstructor"},{"annotation":[],"contents":["adapter",{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"EngineAdapter"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"},{"annotation":[],"contents":["currentScene",{"annotation":[],"contents":[{"annotation":[],"contents":[["Data","Maybe"],"Maybe"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"SceneConfig"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"},{"annotation":[],"contents":["transition",{"annotation":[],"contents":[{"annotation":[],"contents":[["Data","Maybe"],"Maybe"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"TransitionState"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"},{"annotation":[],"contents":["transitionDelta",{"annotation":[],"contents":[["PSD3","Simulation","Core","Tick"],"TickDelta"],"tag":"TypeConstructor"},{"annotation":[],"tag":"REmpty"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[128,4],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[123,1]},"title":"EngineState"},{"children":[],"comments":"Adapter functions that connect the engine to your simulation kernel.\n\nThe engine is generic - it doesn't know about D3 or WASM directly.\nInstead, you provide these adapter functions that do the actual work.\n\nEach kernel (D3, WASM, etc.) implements `mkAdapter` to create this record.\n\nExample adapter for D3:\n```purescript\nmkAdapter :: D3Simulation -> EngineAdapter SimNode\nmkAdapter sim =\n  { getNodes: Sim.getNodes sim\n  , capturePositions: \\nodes -> Object.fromFoldable $\n      map (\\n -> Tuple (show n.id) { x: n.x, y: n.y }) nodes\n  , interpolatePositions: \\start target progress ->\n      Sim.interpolatePositionsInPlace start target progress sim\n  , updatePositions: \\positions ->\n      Sim.updatePositionsInPlace positions sim\n  , applyRulesInPlace: \\rules ->\n      applyRulesInPlace_ rules sim.nodes\n  , reinitializeForces: reinitForcesFor sim\n  , reheat: Sim.reheat sim\n  }\n```\n","info":{"arguments":[["node",null]],"declType":"typeSynonym","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Record"],"tag":"TypeConstructor"},{"annotation":[],"contents":["getNodes",{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"},{"annotation":[],"contents":["capturePositions",{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"PositionMap"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":["interpolatePositions",{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"PositionMap"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"PositionMap"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":["updatePositions",{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"PositionMap"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":["applyRulesInPlace",{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"NodeRule"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":["reinitializeForces",{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":["reheat",{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"tag":"REmpty"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[116,4],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[92,1]},"title":"EngineAdapter"},{"children":[],"comments":"Create a new scene engine.\n\nThe engine starts with no active scene. Call `transitionTo` to\nbegin your first scene transition.\n\nUses default transition duration of ~2 seconds.\n","info":{"declType":"value","type":{"annotation":[],"contents":{"identifier":"node","kind":null,"skolem":null,"type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"EngineAdapter"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"SceneEngine"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"}],"tag":"TypeApp"},"visibility":"TypeVarInvisible"},"tag":"ForAll"}},"kind":null,"sourceSpan":{"end":[154,31],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[151,1]},"title":"createEngine"},{"children":[],"comments":"Start a transition to a new scene.\n\nIf a transition is already in progress, this is ignored.\n\nThe transition lifecycle:\n1. Apply scene's `initRules` to prepare starting state\n2. Capture current positions as start positions\n3. Calculate target positions via scene's `layout` function\n4. Begin interpolation (handled by `tick`)\n","info":{"declType":"value","type":{"annotation":[],"contents":{"identifier":"node","kind":null,"skolem":null,"type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"SceneConfig"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"SceneEngine"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"},"visibility":"TypeVarInvisible"},"tag":"ForAll"}},"kind":null,"sourceSpan":{"end":[179,17],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[175,1]},"title":"transitionTo"},{"children":[],"comments":"Advance the engine by one tick.\n\nCall this from your simulation's tick handler.\n\nReturns `true` if a transition is in progress, `false` if stable.\n","info":{"declType":"value","type":{"annotation":[],"contents":{"identifier":"node","kind":null,"skolem":null,"type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"SceneEngine"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Boolean"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"},"visibility":"TypeVarInvisible"},"tag":"ForAll"}},"kind":null,"sourceSpan":{"end":[221,20],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[218,1]},"title":"tick"},{"children":[],"comments":"Get the current scene configuration (if any).\n","info":{"declType":"value","type":{"annotation":[],"contents":{"identifier":"node","kind":null,"skolem":null,"type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"SceneEngine"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["Data","Maybe"],"Maybe"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"SceneConfig"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"}],"tag":"TypeApp"},"visibility":"TypeVarInvisible"},"tag":"ForAll"}},"kind":null,"sourceSpan":{"end":[317,45],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[314,1]},"title":"getCurrentScene"},{"children":[],"comments":"Check if a transition is in progress.\n","info":{"declType":"value","type":{"annotation":[],"contents":{"identifier":"node","kind":null,"skolem":null,"type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"SceneEngine"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Boolean"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"},"visibility":"TypeVarInvisible"},"tag":"ForAll"}},"kind":null,"sourceSpan":{"end":[326,20],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[323,1]},"title":"isTransitioning"},{"children":[],"comments":"Get the current transition progress (0.0 to 1.0).\n\nReturns `Nothing` if no transition is in progress.\n","info":{"declType":"value","type":{"annotation":[],"contents":{"identifier":"node","kind":null,"skolem":null,"type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"SceneEngine"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["Data","Maybe"],"Maybe"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"}],"tag":"TypeApp"},"visibility":"TypeVarInvisible"},"tag":"ForAll"}},"kind":null,"sourceSpan":{"end":[337,27],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[334,1]},"title":"getTransitionProgress"},{"children":[],"comments":"Set the current scene directly (without transition).\n\nUse this when the visualization is already in the target state\n(e.g., after initial rendering with pre-computed positions).\n","info":{"declType":"value","type":{"annotation":[],"contents":{"identifier":"node","kind":null,"skolem":null,"type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Types"],"SceneConfig"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[{"annotation":[],"contents":[["PSD3","Simulation","Core","Engine"],"SceneEngine"],"tag":"TypeConstructor"},{"annotation":[],"contents":"node","tag":"TypeVar"}],"tag":"TypeApp"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"},"visibility":"TypeVarInvisible"},"tag":"ForAll"}},"kind":null,"sourceSpan":{"end":[354,17],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[350,1]},"title":"setCurrentScene"},{"children":[],"comments":"Default transition delta: ~2 seconds at 60fps\n","info":{"declType":"value","type":{"annotation":[],"contents":[["PSD3","Simulation","Core","Tick"],"TickDelta"],"tag":"TypeConstructor"}},"kind":null,"sourceSpan":{"end":[138,41],"name":"../purescript-psd3-simulation-core/src/PSD3/Simulation/Core/Engine.purs","start":[138,1]},"title":"defaultTransitionDelta"}],"name":"PSD3.Simulation.Core.Engine","reExports":[]}