// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_String_Common from "../Data.String.Common/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as PSD3_AST from "../PSD3.AST/index.js";
import * as PSD3_Internal_Attribute from "../PSD3.Internal.Attribute/index.js";
import * as PSD3_Internal_Selection_Types from "../PSD3.Internal.Selection.Types/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showBoolean);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var show2 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var staticValueToCode = function (v) {
    if (v instanceof PSD3_Internal_Attribute.StringValue) {
        return "text \"" + (v.value0 + "\"");
    };
    if (v instanceof PSD3_Internal_Attribute.NumberValue) {
        return "num " + show(v.value0);
    };
    if (v instanceof PSD3_Internal_Attribute.BooleanValue) {
        return "bool " + show1(v.value0);
    };
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 214, column 21 - line 217, column 38): " + [ v.constructor.name ]);
};
var showElemType = function (v) {
    if (v instanceof PSD3_Internal_Selection_Types.SVG) {
        return "SVG";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Group) {
        return "Group";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Circle) {
        return "Circle";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Rect) {
        return "Rect";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Path) {
        return "Path";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Line) {
        return "Line";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Text) {
        return "Text";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Div) {
        return "Div";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Span) {
        return "Span";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Table) {
        return "Table";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Tbody) {
        return "Tbody";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Thead) {
        return "Thead";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Tr) {
        return "Tr";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Td) {
        return "Td";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Th) {
        return "Th";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Defs) {
        return "Defs";
    };
    if (v instanceof PSD3_Internal_Selection_Types.LinearGradient) {
        return "LinearGradient";
    };
    if (v instanceof PSD3_Internal_Selection_Types.Stop) {
        return "Stop";
    };
    if (v instanceof PSD3_Internal_Selection_Types.PatternFill) {
        return "PatternFill";
    };
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 249, column 16 - line 268, column 31): " + [ v.constructor.name ]);
};
var showAttrValue = function (v) {
    if (v instanceof PSD3_Internal_Attribute.StringValue) {
        return "\"" + (v.value0 + "\"");
    };
    if (v instanceof PSD3_Internal_Attribute.NumberValue) {
        return show(v.value0);
    };
    if (v instanceof PSD3_Internal_Attribute.BooleanValue) {
        return show1(v.value0);
    };
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 272, column 17 - line 275, column 27): " + [ v.constructor.name ]);
};
var indent = function (n) {
    return Data_String_Common.joinWith("")(Data_Array.replicate(n)("  "));
};
var attrSourceToCode = function (v) {
    if (v instanceof PSD3_Internal_Attribute.UnknownSource) {
        return "d.<?>";
    };
    if (v instanceof PSD3_Internal_Attribute.StaticSource) {
        return "num " + v.value0;
    };
    if (v instanceof PSD3_Internal_Attribute.FieldSource) {
        return "field @\"" + (v.value0 + "\"");
    };
    if (v instanceof PSD3_Internal_Attribute.ExprSource) {
        return v.value0;
    };
    if (v instanceof PSD3_Internal_Attribute.IndexSource) {
        return "index";
    };
    if (v instanceof PSD3_Internal_Attribute.OpaqueSource) {
        return "OPAQUE -- requires metadata";
    };
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 222, column 20 - line 228, column 48): " + [ v.constructor.name ]);
};
var attrFnName = function (v) {
    if (v === "stroke-width") {
        return "strokeWidth";
    };
    if (v === "fill-opacity") {
        return "fillOpacity";
    };
    if (v === "stroke-opacity") {
        return "strokeOpacity";
    };
    if (v === "stroke-dasharray") {
        return "strokeDasharray";
    };
    if (v === "font-size") {
        return "fontSize";
    };
    if (v === "font-family") {
        return "fontFamily";
    };
    if (v === "font-weight") {
        return "fontWeight";
    };
    if (v === "text-anchor") {
        return "textAnchor";
    };
    if (v === "dominant-baseline") {
        return "dominantBaseline";
    };
    if (v === "stop-color") {
        return "stopColor";
    };
    if (v === "gradientUnits") {
        return "gradientUnits";
    };
    return v;
};
var attrToCode = function (maybeSample) {
    return function (attr) {
        if (attr instanceof PSD3_Internal_Attribute.StaticAttr) {
            return attrFnName(attr.value0) + (" $ " + staticValueToCode(attr.value1));
        };
        if (attr instanceof PSD3_Internal_Attribute.DataAttr) {
            if (maybeSample instanceof Data_Maybe.Just) {
                var evaluated = attr.value2(maybeSample.value0);
                return attrFnName(attr.value0) + (" $ " + (attrSourceToCode(attr.value1) + (" {- \u2192 " + (showAttrValue(evaluated) + " -}"))));
            };
            if (maybeSample instanceof Data_Maybe.Nothing) {
                return attrFnName(attr.value0) + (" $ " + attrSourceToCode(attr.value1));
            };
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 196, column 5 - line 202, column 57): " + [ maybeSample.constructor.name ]);
        };
        if (attr instanceof PSD3_Internal_Attribute.IndexedAttr) {
            if (maybeSample instanceof Data_Maybe.Just) {
                var evaluated = attr.value2(maybeSample.value0)(0);
                return attrFnName(attr.value0) + (" $ " + (attrSourceToCode(attr.value1) + (" {- \u2192 " + (showAttrValue(evaluated) + " -}"))));
            };
            if (maybeSample instanceof Data_Maybe.Nothing) {
                return attrFnName(attr.value0) + (" $ " + attrSourceToCode(attr.value1));
            };
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 205, column 5 - line 210, column 57): " + [ maybeSample.constructor.name ]);
        };
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 190, column 31 - line 210, column 57): " + [ attr.constructor.name ]);
    };
};
var attrsInlineToCode = function (maybeSample) {
    return function (attrs) {
        return "[ " + (Data_String_Common.joinWith(", ")(map(attrToCode(maybeSample))(attrs)) + " ]");
    };
};
var phaseToCode = function (v) {
    return function (v1) {
        if (v1 instanceof Data_Maybe.Nothing) {
            return "Nothing";
        };
        if (v1 instanceof Data_Maybe.Just) {
            var $55 = Data_Array["null"](v1.value0.attrs);
            if ($55) {
                return "Nothing";
            };
            return "Just { attrs: " + (attrsInlineToCode(v)(v1.value0.attrs) + ", transition: Nothing }");
        };
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 291, column 1 - line 291, column 82): " + [ v.constructor.name, v1.constructor.name ]);
    };
};
var gupBehaviorsToLines = function (maybeSample) {
    return function (behaviors) {
        return function (ind) {
            return [ indent(ind) + ("{ enter: " + phaseToCode(maybeSample)(behaviors.enter)), indent(ind) + (", update: " + phaseToCode(maybeSample)(behaviors.update)), indent(ind) + (", exit: " + phaseToCode(maybeSample)(behaviors.exit)), indent(ind) + "}" ];
        };
    };
};
var attrsToLines = function (maybeSample) {
    return function (attrs) {
        return function (indentLevel) {
            var $57 = Data_Array["null"](attrs);
            if ($57) {
                return [ indent(indentLevel) + "[]" ];
            };
            var attrStrings = map(attrToCode(maybeSample))(attrs);
            var v = Data_Array.head(attrStrings);
            if (v instanceof Data_Maybe.Just) {
                return append1([ indent(indentLevel) + ("[ " + v.value0) ])(append1(map(function (a) {
                    return indent(indentLevel) + (", " + a);
                })(Data_Array.drop(1)(attrStrings)))([ indent(indentLevel) + "]" ]));
            };
            if (v instanceof Data_Maybe.Nothing) {
                return [ indent(indentLevel) + "[]" ];
            };
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 181, column 10 - line 186, column 50): " + [ v.constructor.name ]);
        };
    };
};
var treeLines = function (maybeSample) {
    return function (tree) {
        return function (indentLevel) {
            if (tree instanceof PSD3_AST.Node) {
                var elemCode = (function () {
                    if (tree.value0.name instanceof Data_Maybe.Just) {
                        return "T.named " + (showElemType(tree.value0.elemType) + (" \"" + (tree.value0.name.value0 + "\"")));
                    };
                    if (tree.value0.name instanceof Data_Maybe.Nothing) {
                        return "T.elem " + showElemType(tree.value0.elemType);
                    };
                    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 40, column 18 - line 42, column 59): " + [ tree.value0.name.constructor.name ]);
                })();
                var childrenCode = (function () {
                    var v = Data_Array.length(tree.value0.children);
                    if (v === 0) {
                        return [  ];
                    };
                    if (v === 1) {
                        var v1 = Data_Array.head(tree.value0.children);
                        if (v1 instanceof Data_Maybe.Just) {
                            return append1([ indent(indentLevel) + "`T.withChild`" ])(treeLines(maybeSample)(v1.value0)(indentLevel + 1 | 0));
                        };
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return [  ];
                        };
                        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 50, column 14 - line 54, column 24): " + [ v1.constructor.name ]);
                    };
                    return append1([ indent(indentLevel) + "`T.withChildren`", indent(indentLevel + 1 | 0) + "[" ])(append1(childrenWithCommas(maybeSample)(tree.value0.children)(indentLevel + 1 | 0))([ indent(indentLevel + 1 | 0) + "]" ]));
                })();
                var attrsLines = attrsToLines(maybeSample)(tree.value0.attrs)(indentLevel + 1 | 0);
                return append1([ indent(indentLevel) + elemCode ])(append1(attrsLines)(childrenCode));
            };
            if (tree instanceof PSD3_AST.Join) {
                var templateCode = (function () {
                    var v = Data_Array.head(tree.value0.joinData);
                    if (v instanceof Data_Maybe.Just) {
                        var templateTree = tree.value0.template(v.value0);
                        return treeLines(new Data_Maybe.Just(v.value0))(templateTree)(indentLevel + 1 | 0);
                    };
                    if (v instanceof Data_Maybe.Nothing) {
                        return [ indent(indentLevel + 1 | 0) + "-- (no data to evaluate template)" ];
                    };
                    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 69, column 22 - line 74, column 78): " + [ v.constructor.name ]);
                })();
                return append1([ indent(indentLevel) + ("T.joinData \"" + (tree.value0.name + ("\" \"" + (tree.value0.key + "\" data_ $ \\d ->")))) ])(templateCode);
            };
            if (tree instanceof PSD3_AST.NestedJoin) {
                var templateCode = (function () {
                    var v = Data_Array.head(tree.value0.joinData);
                    if (v instanceof Data_Maybe.Just) {
                        var innerData = tree.value0.decompose(v.value0);
                        var v1 = Data_Array.head(innerData);
                        if (v1 instanceof Data_Maybe.Just) {
                            var templateTree = tree.value0.template(v1.value0);
                            return treeLines(new Data_Maybe.Just(v1.value0))(templateTree)(indentLevel + 1 | 0);
                        };
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return [ indent(indentLevel + 1 | 0) + "-- (no inner data to evaluate template)" ];
                        };
                        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 84, column 14 - line 89, column 88): " + [ v1.constructor.name ]);
                    };
                    if (v instanceof Data_Maybe.Nothing) {
                        return [ indent(indentLevel + 1 | 0) + "-- (no data to evaluate template)" ];
                    };
                    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 81, column 22 - line 91, column 78): " + [ v.constructor.name ]);
                })();
                return append1([ indent(indentLevel) + ("T.nestedJoin \"" + (tree.value0.name + ("\" \"" + (tree.value0.key + "\" data_ decompose $ \\inner ->")))) ])(templateCode);
            };
            if (tree instanceof PSD3_AST.UpdateJoin) {
                var maybeDatum = Data_Array.head(tree.value0.joinData);
                var templateCode = (function () {
                    if (maybeDatum instanceof Data_Maybe.Just) {
                        var templateTree = tree.value0.template(maybeDatum.value0);
                        return treeLines(new Data_Maybe.Just(maybeDatum.value0))(templateTree)(indentLevel + 1 | 0);
                    };
                    if (maybeDatum instanceof Data_Maybe.Nothing) {
                        return [ indent(indentLevel + 1 | 0) + "-- (no data to evaluate template)" ];
                    };
                    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 100, column 22 - line 105, column 78): " + [ maybeDatum.constructor.name ]);
                })();
                var behaviorsCode = gupBehaviorsToLines(maybeDatum)(tree.value0.behaviors)(indentLevel + 1 | 0);
                return append1([ indent(indentLevel) + ("T.updateJoin \"" + (tree.value0.name + ("\" \"" + (tree.value0.key + "\" data_")))), indent(indentLevel) + "  (\\d ->" ])(append1(templateCode)(append1([ indent(indentLevel) + "  )" ])(behaviorsCode)));
            };
            if (tree instanceof PSD3_AST.UpdateNestedJoin) {
                var maybeDatum = (function () {
                    var v = Data_Array.head(tree.value0.joinData);
                    if (v instanceof Data_Maybe.Just) {
                        return Data_Array.head(tree.value0.decompose(v.value0));
                    };
                    if (v instanceof Data_Maybe.Nothing) {
                        return Data_Maybe.Nothing.value;
                    };
                    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 117, column 20 - line 119, column 27): " + [ v.constructor.name ]);
                })();
                var templateCode = (function () {
                    if (maybeDatum instanceof Data_Maybe.Just) {
                        var templateTree = tree.value0.template(maybeDatum.value0);
                        return treeLines(new Data_Maybe.Just(maybeDatum.value0))(templateTree)(indentLevel + 1 | 0);
                    };
                    if (maybeDatum instanceof Data_Maybe.Nothing) {
                        return [ indent(indentLevel + 1 | 0) + "-- (no data to evaluate template)" ];
                    };
                    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 121, column 22 - line 126, column 78): " + [ maybeDatum.constructor.name ]);
                })();
                var behaviorsCode = gupBehaviorsToLines(maybeDatum)(tree.value0.behaviors)(indentLevel + 1 | 0);
                return append1([ indent(indentLevel) + ("T.updateNestedJoin \"" + (tree.value0.name + ("\" \"" + (tree.value0.key + "\" data_ decompose")))), indent(indentLevel) + "  (\\inner ->" ])(append1(templateCode)(append1([ indent(indentLevel) + "  )" ])(behaviorsCode)));
            };
            if (tree instanceof PSD3_AST.ConditionalRender) {
                return [ indent(indentLevel) + "T.conditionalRender", indent(indentLevel + 1 | 0) + ("[ -- " + (show2(Data_Array.length(tree.value0.cases)) + " cases with predicates and specs")), indent(indentLevel + 1 | 0) + "  -- (predicates and specs are functions, not shown)", indent(indentLevel + 1 | 0) + "]" ];
            };
            if (tree instanceof PSD3_AST.LocalCoordSpace) {
                var childCode = treeLines(maybeSample)(tree.value0.child)(indentLevel + 1 | 0);
                return append1([ indent(indentLevel) + "T.localCoordSpace", indent(indentLevel + 1 | 0) + "{ scaleX: \\d -> -- (scale function)", indent(indentLevel + 1 | 0) + ", scaleY: \\d -> -- (scale function)", indent(indentLevel + 1 | 0) + "}" ])(childCode);
            };
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 35, column 42 - line 150, column 21): " + [ tree.constructor.name ]);
        };
    };
};
var childrenWithCommas = function (maybeSample) {
    return function (children) {
        return function (ind) {
            var indexedChildren = function (cs) {
                return Data_Array.mapWithIndex(function (i) {
                    return function (c) {
                        return {
                            idx: i,
                            child: c
                        };
                    };
                })(cs);
            };
            var dropFirst = function (arr) {
                var v = Data_Array.length(arr);
                if (v === 0) {
                    return [  ];
                };
                if (v === 1) {
                    return [  ];
                };
                return Data_Array.drop(1)(arr);
            };
            var renderChild = function (v) {
                return function (v1) {
                    var prefix = (function () {
                        var $92 = v1.idx === 0;
                        if ($92) {
                            return "  ";
                        };
                        return ", ";
                    })();
                    var childLines = treeLines(maybeSample)(v1.child)(0);
                    var v2 = Data_Array.head(childLines);
                    if (v2 instanceof Data_Maybe.Just) {
                        return append1([ indent(ind) + (prefix + v2.value0) ])(map(function (l) {
                            return indent(ind + 1 | 0) + l;
                        })(dropFirst(childLines)));
                    };
                    if (v2 instanceof Data_Maybe.Nothing) {
                        return [  ];
                    };
                    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 163, column 8 - line 167, column 20): " + [ v2.constructor.name ]);
                };
            };
            return Data_Array.concat(Data_Array.zipWith(renderChild)(Data_Array.replicate(Data_Array.length(children))(Data_Unit.unit))(indexedChildren(children)));
        };
    };
};
var treeToCode = function (tree) {
    return Data_String_Common.joinWith("\x0a")(treeLines(Data_Maybe.Nothing.value)(tree)(0));
};
var treeToCodeWithSample = function (sample) {
    return function (tree) {
        return Data_String_Common.joinWith("\x0a")(treeLines(new Data_Maybe.Just(sample))(tree)(0));
    };
};
export {
    treeToCode,
    treeToCodeWithSample
};
//# sourceMappingURL=index.js.map
