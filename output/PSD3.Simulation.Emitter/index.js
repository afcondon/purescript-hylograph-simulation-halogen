// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect from "../Effect/index.js";
import * as Effect_Ref from "../Effect.Ref/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var foldM = /* #__PURE__ */ Data_Array.foldM(Effect.monadEffect);
var Tick = /* #__PURE__ */ (function () {
    function Tick(value0) {
        this.value0 = value0;
    };
    Tick.create = function (value0) {
        return new Tick(value0);
    };
    return Tick;
})();
var Started = /* #__PURE__ */ (function () {
    function Started() {

    };
    Started.value = new Started();
    return Started;
})();
var Stopped = /* #__PURE__ */ (function () {
    function Stopped() {

    };
    Stopped.value = new Stopped();
    return Stopped;
})();
var Completed = /* #__PURE__ */ (function () {
    function Completed() {

    };
    Completed.value = new Completed();
    return Completed;
})();
var SimulationEmitter = function (x) {
    return x;
};
var EmitterHandle = function (x) {
    return x;
};
var subscribe = function (v) {
    return function (callback) {
        return function __do() {
            var listenerId = Effect_Ref.read(v.nextId)();
            Effect_Ref.modify_(function (v1) {
                return v1 + 1 | 0;
            })(v.nextId)();
            Effect_Ref.modify_(function (ls) {
                return Data_Array.snoc(ls)({
                    id: listenerId,
                    callback: callback
                });
            })(v.listeners)();
            return Effect_Ref.modify_(Data_Array.filter(function (l) {
                return l.id !== listenerId;
            }))(v.listeners);
        };
    };
};
var showSimulationEvent = {
    show: function (v) {
        if (v instanceof Tick) {
            return "Tick { alpha: " + (show(v.value0.alpha) + (", nodeCount: " + (show1(v.value0.nodeCount) + " }")));
        };
        if (v instanceof Started) {
            return "Started";
        };
        if (v instanceof Stopped) {
            return "Stopped";
        };
        if (v instanceof Completed) {
            return "Completed";
        };
        throw new Error("Failed pattern match at PSD3.Simulation.Emitter (line 94, column 1 - line 98, column 31): " + [ v.constructor.name ]);
    }
};
var eqSimulationEvent = {
    eq: function (x) {
        return function (y) {
            if (x instanceof Tick && y instanceof Tick) {
                return x.value0.alpha === y.value0.alpha && x.value0.nodeCount === y.value0.nodeCount;
            };
            if (x instanceof Started && y instanceof Started) {
                return true;
            };
            if (x instanceof Stopped && y instanceof Stopped) {
                return true;
            };
            if (x instanceof Completed && y instanceof Completed) {
                return true;
            };
            return false;
        };
    }
};
var emit = function (v) {
    return function (event) {
        return function __do() {
            var ls = Effect_Ref.read(v.emitter.listeners)();
            return foldM(function (v1) {
                return function (listener) {
                    return listener.callback(event);
                };
            })(Data_Unit.unit)(ls)();
        };
    };
};
var create = function __do() {
    var listeners = Effect_Ref["new"]([  ])();
    var nextId = Effect_Ref["new"](0)();
    var emitter = {
        listeners: listeners,
        nextId: nextId
    };
    return {
        emitter: emitter,
        handle: {
            emitter: emitter
        }
    };
};
export {
    Tick,
    Started,
    Stopped,
    Completed,
    create,
    subscribe,
    emit,
    eqSimulationEvent,
    showSimulationEvent
};
//# sourceMappingURL=index.js.map
