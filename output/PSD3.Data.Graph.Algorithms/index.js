// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_List from "../Data.List/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Tree from "../Data.Tree/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as PSD3_Data_Graph from "../PSD3.Data.Graph/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var member = /* #__PURE__ */ Data_Set.member(Data_Ord.ordInt);
var mapFlipped = /* #__PURE__ */ Data_Functor.mapFlipped(Data_Functor.functorArray);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var append1 = /* #__PURE__ */ Data_Semigroup.append(/* #__PURE__ */ Data_Set.semigroupSet(Data_Ord.ordInt));
var fromFoldable = /* #__PURE__ */ Data_Set.fromFoldable(Data_Foldable.foldableArray)(Data_Ord.ordInt);
var flap = /* #__PURE__ */ Data_Functor.flap(Data_Functor.functorArray);
var fromFoldable1 = /* #__PURE__ */ Data_List.fromFoldable(Data_Foldable.foldableArray);
var insert = /* #__PURE__ */ Data_Set.insert(Data_Ord.ordInt);
var getReachableNodes = function (config) {
    return function (rootId) {
        return function (graph) {
            var processNextPath = function (state) {
                return bind(Data_Array.uncons(state.openPaths))(function (x) {
                    return bind(Data_Array.head(x.head))(function (currentId) {
                        var links = PSD3_Data_Graph.getLinksFrom(currentId)(graph);
                        var targetIds = map(config.getLinkTarget)(links);
                        var newTargets = Data_Array.partition(function (targetId) {
                            return !member(targetId)(state.nodes);
                        })(targetIds);
                        var prunedEdges = mapFlipped(newTargets.no)(function (targetId) {
                            return new Data_Tuple.Tuple(currentId, targetId);
                        });
                        var newPaths = mapFlipped(newTargets.yes)(function (targetId) {
                            return Data_Array.cons(targetId)(x.head);
                        });
                        var $29 = Data_Array["null"](newPaths);
                        if ($29) {
                            return new Data_Maybe.Just({
                                nodes: state.nodes,
                                spanningTree: state.spanningTree,
                                openPaths: x.tail,
                                paths: Data_Array.cons(x.head)(state.paths),
                                redundantEdges: append(state.redundantEdges)(prunedEdges)
                            });
                        };
                        return new Data_Maybe.Just({
                            paths: state.paths,
                            openPaths: append(x.tail)(newPaths),
                            nodes: append1(state.nodes)(fromFoldable(newTargets.yes)),
                            spanningTree: append(state.spanningTree)(map(function (targetId) {
                                return new Data_Tuple.Tuple(currentId, targetId);
                            })(newTargets.yes)),
                            redundantEdges: append(state.redundantEdges)(prunedEdges)
                        });
                    });
                });
            };
            var go = function ($copy_state) {
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(state) {
                    if (Data_Array["null"](state.openPaths)) {
                        $tco_done = true;
                        return state;
                    };
                    if (Data_Boolean.otherwise) {
                        var v = processNextPath(state);
                        if (v instanceof Data_Maybe.Nothing) {
                            $tco_done = true;
                            return state;
                        };
                        if (v instanceof Data_Maybe.Just) {
                            $copy_state = v.value0;
                            return;
                        };
                        throw new Error("Failed pattern match at PSD3.Data.Graph.Algorithms (line 68, column 21 - line 70, column 35): " + [ v.constructor.name ]);
                    };
                    throw new Error("Failed pattern match at PSD3.Data.Graph.Algorithms (line 66, column 5 - line 70, column 35): " + [ state.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($copy_state);
                };
                return $tco_result;
            };
            var initialState = {
                nodes: Data_Set.empty,
                spanningTree: [  ],
                redundantEdges: [  ],
                paths: [  ],
                openPaths: [ [ rootId ] ]
            };
            var finalState = go(initialState);
            return {
                nodes: finalState.nodes,
                spanningTree: finalState.spanningTree,
                redundantEdges: finalState.redundantEdges,
                paths: finalState.paths
            };
        };
    };
};
var extractSpanningTree = function (rootId) {
    return function (result) {
        var buildTree = function (nodeId) {
            return function (edges) {
                var children = map(function (v) {
                    return v.value1;
                })(Data_Array.filter(function (v) {
                    return v.value0 === nodeId;
                })(edges));
                var childTrees = flap(map(buildTree)(children))(edges);
                return Data_Tree.mkTree(nodeId)(fromFoldable1(childTrees));
            };
        };
        return buildTree(rootId)(result.spanningTree);
    };
};
var depthFirstSearch = function (config) {
    return function (startId) {
        return function (graph) {
            return function (shouldVisit) {
                var find = function ($copy_v) {
                    return function ($copy_v1) {
                        var $tco_var_v = $copy_v;
                        var $tco_done = false;
                        var $tco_result;
                        function $tco_loop(v, v1) {
                            if (v1.length === 0) {
                                $tco_done = true;
                                return Data_Maybe.Nothing.value;
                            };
                            var v2 = Data_Array.uncons(v1);
                            if (v2 instanceof Data_Maybe.Nothing) {
                                $tco_done = true;
                                return Data_Maybe.Nothing.value;
                            };
                            if (v2 instanceof Data_Maybe.Just) {
                                var $42 = v(v2.value0.head);
                                if ($42) {
                                    $tco_done = true;
                                    return new Data_Maybe.Just(v2.value0.head);
                                };
                                $tco_var_v = v;
                                $copy_v1 = v2.value0.tail;
                                return;
                            };
                            throw new Error("Failed pattern match at PSD3.Data.Graph.Algorithms (line 162, column 21 - line 165, column 48): " + [ v2.constructor.name ]);
                        };
                        while (!$tco_done) {
                            $tco_result = $tco_loop($tco_var_v, $copy_v1);
                        };
                        return $tco_result;
                    };
                };
                var getNode = function (nodeId) {
                    return find(function (n) {
                        return config.getNodeId(n) === nodeId;
                    })(graph.nodes);
                };
                var go = function ($copy_stack) {
                    return function ($copy_visited) {
                        return function ($copy_result) {
                            var $tco_var_stack = $copy_stack;
                            var $tco_var_visited = $copy_visited;
                            var $tco_done1 = false;
                            var $tco_result;
                            function $tco_loop(stack, visited, result) {
                                var v = Data_Array.uncons(stack);
                                if (v instanceof Data_Maybe.Nothing) {
                                    $tco_done1 = true;
                                    return result;
                                };
                                if (v instanceof Data_Maybe.Just) {
                                    if (member(v.value0.head)(visited)) {
                                        $tco_var_stack = v.value0.tail;
                                        $tco_var_visited = visited;
                                        $copy_result = result;
                                        return;
                                    };
                                    if (Data_Boolean.otherwise) {
                                        var v1 = getNode(v.value0.head);
                                        if (v1 instanceof Data_Maybe.Nothing) {
                                            $tco_var_stack = v.value0.tail;
                                            $tco_var_visited = visited;
                                            $copy_result = result;
                                            return;
                                        };
                                        if (v1 instanceof Data_Maybe.Just) {
                                            var $48 = shouldVisit(v1.value0);
                                            if ($48) {
                                                var newVisited = insert(v.value0.head)(visited);
                                                var links = PSD3_Data_Graph.getLinksFrom(v.value0.head)(graph);
                                                var children = map(config.getLinkTarget)(links);
                                                var newStack = append(children)(v.value0.tail);
                                                $tco_var_stack = newStack;
                                                $tco_var_visited = newVisited;
                                                $copy_result = append(result)([ v.value0.head ]);
                                                return;
                                            };
                                            $tco_var_stack = v.value0.tail;
                                            $tco_var_visited = visited;
                                            $copy_result = result;
                                            return;
                                        };
                                        throw new Error("Failed pattern match at PSD3.Data.Graph.Algorithms (line 140, column 24 - line 154, column 41): " + [ v1.constructor.name ]);
                                    };
                                };
                                throw new Error("Failed pattern match at PSD3.Data.Graph.Algorithms (line 136, column 31 - line 154, column 41): " + [ v.constructor.name ]);
                            };
                            while (!$tco_done1) {
                                $tco_result = $tco_loop($tco_var_stack, $tco_var_visited, $copy_result);
                            };
                            return $tco_result;
                        };
                    };
                };
                return go([ startId ])(Data_Set.empty)([  ]);
            };
        };
    };
};
var breadthFirstSearch = function (config) {
    return function (startId) {
        return function (graph) {
            return function (shouldVisit) {
                var find = function ($copy_v) {
                    return function ($copy_v1) {
                        var $tco_var_v = $copy_v;
                        var $tco_done = false;
                        var $tco_result;
                        function $tco_loop(v, v1) {
                            if (v1.length === 0) {
                                $tco_done = true;
                                return Data_Maybe.Nothing.value;
                            };
                            var v2 = Data_Array.uncons(v1);
                            if (v2 instanceof Data_Maybe.Nothing) {
                                $tco_done = true;
                                return Data_Maybe.Nothing.value;
                            };
                            if (v2 instanceof Data_Maybe.Just) {
                                var $56 = v(v2.value0.head);
                                if ($56) {
                                    $tco_done = true;
                                    return new Data_Maybe.Just(v2.value0.head);
                                };
                                $tco_var_v = v;
                                $copy_v1 = v2.value0.tail;
                                return;
                            };
                            throw new Error("Failed pattern match at PSD3.Data.Graph.Algorithms (line 208, column 21 - line 211, column 48): " + [ v2.constructor.name ]);
                        };
                        while (!$tco_done) {
                            $tco_result = $tco_loop($tco_var_v, $copy_v1);
                        };
                        return $tco_result;
                    };
                };
                var getNode = function (nodeId) {
                    return find(function (n) {
                        return config.getNodeId(n) === nodeId;
                    })(graph.nodes);
                };
                var go = function ($copy_queue) {
                    return function ($copy_visited) {
                        return function ($copy_result) {
                            var $tco_var_queue = $copy_queue;
                            var $tco_var_visited = $copy_visited;
                            var $tco_done1 = false;
                            var $tco_result;
                            function $tco_loop(queue, visited, result) {
                                var v = Data_Array.uncons(queue);
                                if (v instanceof Data_Maybe.Nothing) {
                                    $tco_done1 = true;
                                    return result;
                                };
                                if (v instanceof Data_Maybe.Just) {
                                    if (member(v.value0.head)(visited)) {
                                        $tco_var_queue = v.value0.tail;
                                        $tco_var_visited = visited;
                                        $copy_result = result;
                                        return;
                                    };
                                    if (Data_Boolean.otherwise) {
                                        var v1 = getNode(v.value0.head);
                                        if (v1 instanceof Data_Maybe.Nothing) {
                                            $tco_var_queue = v.value0.tail;
                                            $tco_var_visited = visited;
                                            $copy_result = result;
                                            return;
                                        };
                                        if (v1 instanceof Data_Maybe.Just) {
                                            var $62 = shouldVisit(v1.value0);
                                            if ($62) {
                                                var newVisited = insert(v.value0.head)(visited);
                                                var links = PSD3_Data_Graph.getLinksFrom(v.value0.head)(graph);
                                                var children = map(config.getLinkTarget)(links);
                                                var newQueue = append(v.value0.tail)(children);
                                                $tco_var_queue = newQueue;
                                                $tco_var_visited = newVisited;
                                                $copy_result = append(result)([ v.value0.head ]);
                                                return;
                                            };
                                            $tco_var_queue = v.value0.tail;
                                            $tco_var_visited = visited;
                                            $copy_result = result;
                                            return;
                                        };
                                        throw new Error("Failed pattern match at PSD3.Data.Graph.Algorithms (line 186, column 24 - line 200, column 41): " + [ v1.constructor.name ]);
                                    };
                                };
                                throw new Error("Failed pattern match at PSD3.Data.Graph.Algorithms (line 182, column 31 - line 200, column 41): " + [ v.constructor.name ]);
                            };
                            while (!$tco_done1) {
                                $tco_result = $tco_loop($tco_var_queue, $tco_var_visited, $copy_result);
                            };
                            return $tco_result;
                        };
                    };
                };
                return go([ startId ])(Data_Set.empty)([  ]);
            };
        };
    };
};
export {
    getReachableNodes,
    extractSpanningTree,
    depthFirstSearch,
    breadthFirstSearch
};
//# sourceMappingURL=index.js.map
